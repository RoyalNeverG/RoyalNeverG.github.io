<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="generator" content="Hexo 4.2.0"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Redis持久化方式 - MilkLc</title><meta description="Redis持久化方式Redis 是一个缓存工具，也叫做 NoSQL 数据库，既然是数据库，必然支持数据的持久化操作。在 Redis 中，数据库持久化一共有两种方案： 1、RDB(快照方式)：半持久化方式 Reids在内存中的数据库记录定时dump到磁盘上的RDB持久化 RDB持久化是指在指定的时间间隔内将内存中的数据集快照写入磁盘，实际操作过程是fork一个子进程，先将数据集写入临时文件，写入成功"><meta property="og:type" content="blog"><meta property="og:title" content="Redis持久化方式"><meta property="og:url" content="http://yoursite.com/2020/07/24/redis/Redis%E6%8C%81%E4%B9%85%E5%8C%96%E6%93%8D%E4%BD%9C/"><meta property="og:site_name" content="MilkLc"><meta property="og:description" content="Redis持久化方式Redis 是一个缓存工具，也叫做 NoSQL 数据库，既然是数据库，必然支持数据的持久化操作。在 Redis 中，数据库持久化一共有两种方案： 1、RDB(快照方式)：半持久化方式 Reids在内存中的数据库记录定时dump到磁盘上的RDB持久化 RDB持久化是指在指定的时间间隔内将内存中的数据集快照写入磁盘，实际操作过程是fork一个子进程，先将数据集写入临时文件，写入成功"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://img.louchen.top/2020/05/rdb02.png"><meta property="og:image" content="http://img.louchen.top/2020/05/aof02.png"><meta property="og:image" content="http://img.louchen.top/2020/05/rdb01.png"><meta property="og:image" content="http://img.louchen.top/2020/05/aof01.png"><meta property="og:image" content="http://img.louchen.top/2020/05/rdb_aof.png"><meta property="article:published_time" content="2020-07-24T15:14:32.580Z"><meta property="article:modified_time" content="2020-05-04T05:13:16.290Z"><meta property="article:author" content="lc"><meta property="article:tag" content="Redis"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="http://img.louchen.top/2020/05/rdb02.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://yoursite.com/2020/07/24/redis/Redis%E6%8C%81%E4%B9%85%E5%8C%96%E6%93%8D%E4%BD%9C/"},"headline":"MilkLc","image":["http://img.louchen.top/2020/05/rdb02.png","http://img.louchen.top/2020/05/aof02.png","http://img.louchen.top/2020/05/rdb01.png","http://img.louchen.top/2020/05/aof01.png","http://img.louchen.top/2020/05/rdb_aof.png"],"datePublished":"2020-07-24T15:14:32.580Z","dateModified":"2020-05-04T05:13:16.290Z","author":{"@type":"Person","name":"lc"},"description":"Redis持久化方式Redis 是一个缓存工具，也叫做 NoSQL 数据库，既然是数据库，必然支持数据的持久化操作。在 Redis 中，数据库持久化一共有两种方案： 1、RDB(快照方式)：半持久化方式 Reids在内存中的数据库记录定时dump到磁盘上的RDB持久化 RDB持久化是指在指定的时间间隔内将内存中的数据集快照写入磁盘，实际操作过程是fork一个子进程，先将数据集写入临时文件，写入成功"}</script><link rel="canonical" href="http://yoursite.com/2020/07/24/redis/Redis%E6%8C%81%E4%B9%85%E5%8C%96%E6%93%8D%E4%BD%9C/"><link rel="icon" href="/img/favicon.ico"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/favicon.ico" alt="MilkLc" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">主页</a><a class="navbar-item" href="/archives">归档</a><a class="navbar-item" href="/categories">分类</a><a class="navbar-item" href="/tags">标签</a><a class="navbar-item" href="/about">关于</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/RoyalNeverG"><i class="fab fa-github"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><input placeholder="你想要查找什么？" type="text"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-07-24T15:14:32.580Z" title="2020-07-24T15:14:32.580Z">2020-07-24</time><span class="level-item"><a class="link-muted" href="/categories/Redis/">Redis</a></span><span class="level-item">16 分钟 读完 (大约 2399 个字)</span></div></div><h1 class="title is-3 is-size-4-mobile">Redis持久化方式</h1><div class="content"><h2 id="Redis持久化方式"><a href="#Redis持久化方式" class="headerlink" title="Redis持久化方式"></a>Redis持久化方式</h2><p>Redis 是一个缓存工具，也叫做 NoSQL 数据库，既然是数据库，必然支持数据的持久化操作。在 Redis 中，数据库持久化一共有两种方案：</p>
<p><strong>1、RDB(快照方式)：半持久化方式</strong></p>
<p><code>Reids在内存中的数据库记录定时dump到磁盘上的RDB持久化</code></p>
<p><code>RDB持久化是指在指定的时间间隔内将内存中的数据集快照写入磁盘，实际操作过程是fork一个子进程，先将数据集写入临时文件，写入成功后，再替换之前的文件，用二进制压缩存储。</code></p>
<a id="more"></a>
<img src="http://img.louchen.top/2020/05/rdb02.png" style="zoom:50%;" />

<p>一次全量备份。存储的形式为二进制序列化的形式，存储比较紧簇，比较省空间。</p>
<p><strong>2、AOF(append only file) 全持久化方式</strong>  </p>
<p><code>Reids的操作日志以追加的方式写入文件</code></p>
<p><code>AOF持久化以日志的形式记录服务器所处理的每一个写、删除操作，查询操作不会记录，以文本的方式记录，可以打开文件看到详细的操作记录。</code></p>
<p>连续的增量备份，存储的是内存修改的指令的记录文本，随着时间的推移，该文本会越来越大。如果我们服务器需要重启，进行数据恢复加载的时候，会非常慢，相当于把文本中的指令从头到尾重新执行一遍，所以我们需要定期对日志进行重新瘦身</p>
<img src="http://img.louchen.top/2020/05/aof02.png" style="zoom:50%;" />

<h3 id="一、RDB（快照持久化）"><a href="#一、RDB（快照持久化）" class="headerlink" title="一、RDB（快照持久化）"></a>一、RDB（快照持久化）</h3><h4 id="1-1原理"><a href="#1-1原理" class="headerlink" title="1.1原理"></a>1.1原理</h4><p>Redis使用操作系统的多进程机制来实现快照持久化。Redis持久化的时候，会调用glibc函数fork一个子进程，然后将快照持久化操作完全交给子进程去处理，而父进程处理客户端请求。在这个过程中，子进程能够看到内存中的数据在子进程产生的一瞬间就固定下来了。再也不会改变，这就是Redis持久化交快照 </p>
<h4 id="1-2具体配置"><a href="#1-2具体配置" class="headerlink" title="1.2具体配置"></a>1.2具体配置</h4><p>在我们重启Redis服务器时，发现之前存储的数据依然还在。所以在Redis中，默认情况下RDB快照持久化是默认开启的，我们在Reidis安装目录下默认会产生一个<code>dump.rdb</code> 文件，这个文件就是备份下来的文件。当Redis重新启动时，就会加载该文件。当我们删除<code>drum.rdb</code>文件时，再去重启服务器，会发现没有数据</p>
<p><strong>redis.conf中的具体配置：</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">快照的频率</span></span><br><span class="line">save 900 1   #900秒内如果有一个键被修改，就备份   </span><br><span class="line">save 300 10</span><br><span class="line">save 60 10000</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">在快照创建出错的时候是否继续执行客户端写命令  </span></span><br><span class="line">stop-writes-on-bgsave-error yes  #默认为yes</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">是否对快照文件进行压缩</span></span><br><span class="line">rdbcompression yes  #默认为yes</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">生成日志文件的名称</span></span><br><span class="line">dbfilename dump.rdb</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">日志文件的目录 默认在当前安装目录的下</span></span><br><span class="line">dir ./</span><br></pre></td></tr></table></figure>

<h4 id="1-3备份的流程"><a href="#1-3备份的流程" class="headerlink" title="1.3备份的流程"></a>1.3备份的流程</h4><p>1、在Redis运行过程中，我们可以向Redis发送一条save命令来创建一个快照。（没有手动指定是，在配置文件中满足条件的快照频率，redis自动帮我们执行）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">手动发送</span></span><br><span class="line">save</span><br></pre></td></tr></table></figure>

<p>但是save是一个阻塞命令，Redis在收到save命令开始处理备份操作的之后，在处理完成之前，将不再处理其他请求。其他命令等待被挂起，所以用到的并不多</p>
<p>2、我们一般使用bgsave命令，bgsave会fork一个子进程去处理备份的事情，不影响父进程处理客户端请求</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bgsave</span><br></pre></td></tr></table></figure>

<p>3、我们定义的备份规则，如果规则 满足，也会自动触发bgsave</p>
<p>4、此外，当我们执行shutdown命令时，也会触发save命令，备份完成后，Redis才会关闭。</p>
<p>5、用Redis搭建主从复制时，在从连上主机之后，会自动发送一个sync同于命令，主机收到命令之后，首先执行bgsave对数据执行快照，然后才会给从机发送快照数据进行同步。 、</p>
<h4 id="1-4-RDB触发备份的三种机制"><a href="#1-4-RDB触发备份的三种机制" class="headerlink" title="1.4 RDB触发备份的三种机制"></a>1.4 RDB触发备份的三种机制</h4><h5 id="①、save"><a href="#①、save" class="headerlink" title="①、save"></a>①、save</h5><p>会阻塞当前Redis服务器，执行save期间，不能执行其他客户端命令，只有当前命令执行完毕，才能执行其他命令</p>
<h5 id="②、bgsave"><a href="#②、bgsave" class="headerlink" title="②、bgsave"></a>②、bgsave</h5><p>redis服务器父进程fork一个子进程执行该save命令，不影响父进程执行客户端的其他的命令</p>
<h5 id="③、自动触发"><a href="#③、自动触发" class="headerlink" title="③、自动触发"></a>③、自动触发</h5><p>在redis.conf配置中，我们可以<code>save 900 1</code>的配置 表示900秒内有一个key修改就执行该备份操作</p>
<img src="http://img.louchen.top/2020/05/rdb01.png" style="zoom:50%;" />

<h3 id="二、AOF持久化"><a href="#二、AOF持久化" class="headerlink" title="二、AOF持久化"></a>二、AOF持久化</h3><p>与快照持久化不同，AOF 持久化是将被执行的命令追加到 aof 文件末尾，在恢复时，只需要把记录下来 的命令从头到尾执行一遍即可。</p>
<p><strong>redis.conf的详细配置：</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">是否开启 aof配置 默认为no</span></span><br><span class="line">appendonly yes</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">AOF文件名</span></span><br><span class="line">appendfilename "appendonly.aof"</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">备份的时机</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> appendfsync always  <span class="comment">#每执行一个命令都追加</span></span></span><br><span class="line">appendfsync everysec  #每秒都执行一次备份</span><br><span class="line"><span class="meta">#</span><span class="bash"> appendfsync no</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">表示AOP文件在压缩时，是否还继续进行同步操作</span></span><br><span class="line">no-appendfsync-on-rewrite no</span><br><span class="line"><span class="meta">#</span><span class="bash">压缩的时机</span></span><br><span class="line">auto-aof-rewrite-percentage 100 #表示当前aof文件大小超过上一次重写时的aof文件大小的百分之多少时，再次进行重新</span><br><span class="line">auto-aof-rewrite-min-size 64mb #如果之前没有重写，则以启动的aof大小为依据，同时要求文件大小至少大于64mb</span><br></pre></td></tr></table></figure>

<p>当我们开启aof配置后，如果也开启了rdb配置，则不知道是哪个在备份，这里我们关闭rdb备份</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">   save ""</span><br><span class="line"><span class="meta">#</span><span class="bash">save 900 1</span></span><br><span class="line"><span class="meta">#</span><span class="bash">save 300 10</span></span><br><span class="line"><span class="meta">#</span><span class="bash">save 60 10000</span></span><br></pre></td></tr></table></figure>

<p>我们删点之前的<code>dump.rdb</code>的备份文件，然后重启服务器，执行一个<code>set k1 v1</code>的测试命令,回到根目录，这时我们发现增加了一个<code>appendonly.aof</code>的文件。进入到文件中:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">*2</span><br><span class="line"><span class="meta">$</span><span class="bash">6</span></span><br><span class="line">SELECT</span><br><span class="line"><span class="meta">$</span><span class="bash">1</span></span><br><span class="line">0</span><br><span class="line">*3</span><br><span class="line"><span class="meta">$</span><span class="bash">3</span></span><br><span class="line">set</span><br><span class="line"><span class="meta">$</span><span class="bash">2</span></span><br><span class="line">k1</span><br><span class="line"><span class="meta">$</span><span class="bash">2</span></span><br><span class="line">v1</span><br></pre></td></tr></table></figure>

<p>我们发现就是通过resp协议来执行的命令</p>
<p><strong>手动发送备份的命令：</strong></p>
<p>原理和gbsave一致</p>
<p>自动执行在配置文件中配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; BGREWRITEAOF</span><br></pre></td></tr></table></figure>

<h4 id="2-1-AOP触发备份的三种机制"><a href="#2-1-AOP触发备份的三种机制" class="headerlink" title="2.1 AOP触发备份的三种机制"></a>2.1 AOP触发备份的三种机制</h4><p>（1）每修改同步always：同步持久化 每次发生数据变更会被立即记录到磁盘 性能较差但数据完整性比较好</p>
<p>（2）每秒同步everysec：异步操作，每秒记录 如果一秒内宕机，有数据丢失</p>
<p>（3）不同no：从不同步</p>
<img src="http://img.louchen.top/2020/05/aof01.png" style="zoom:50%;" />

<h3 id="三、RDB和AOP的选择比较"><a href="#三、RDB和AOP的选择比较" class="headerlink" title="三、RDB和AOP的选择比较"></a>三、RDB和AOP的选择比较</h3><h5 id="1、RDB优势和劣势："><a href="#1、RDB优势和劣势：" class="headerlink" title="1、RDB优势和劣势："></a>1、RDB优势和劣势：</h5><h6 id="①、优势"><a href="#①、优势" class="headerlink" title="①、优势"></a>①、优势</h6><p>（1）RDB文件紧凑，全量备份，非常适合用于进行备份和灾难恢复。</p>
<p>（2）生成RDB文件的时候，redis主进程会fork()一个子进程来处理所有保存工作，主进程不需要进行任何磁盘IO操作。</p>
<p>（3）RDB 在恢复大数据集时的速度比 AOF 的恢复速度要快</p>
<h6 id="②、劣势"><a href="#②、劣势" class="headerlink" title="②、劣势"></a>②、劣势</h6><p>​        RDB快照是一次全量备份，存储的是内存数据的二进制序列化形式，存储上非常紧凑。当进行快照持久化时，会开启一个子进程专门负责快照持久化，子进程会拥有父进程的内存数据，父进程修改内存子进程不会反应出来，所以在快照持久化期间修改的数据不会被保存，可能丢失数据。</p>
<h5 id="2、AOF的优势和劣势"><a href="#2、AOF的优势和劣势" class="headerlink" title="2、AOF的优势和劣势"></a>2、AOF的优势和劣势</h5><h6 id="①、优势-1"><a href="#①、优势-1" class="headerlink" title="①、优势"></a>①、优势</h6><p>（1）AOF可以更好的保护数据不丢失，一般AOF会每隔1秒，通过一个后台线程执行一次fsync操作，<strong>最多丢失1秒钟的数据。</strong></p>
<p>（2）AOF日志文件没有任何磁盘寻址的开销，写入性能非常高，文件不容易破损。</p>
<p>（3）AOF日志文件即使过大的时候，出现后台重写操作，也不会影响客户端的读写。</p>
<p>（4）AOF日志文件的命令通过非常可读的方式进行记录，这个特性非常适合做灾难性的误删除的紧急恢复。比如某人不小心用flushall命令清空了所有数据，只要这个时候后台rewrite还没有发生，那么就可以立即拷贝AOF文件，将最后一条flushall命令给删了，然后再将该AOF文件放回去，就可以通过恢复机制，自动恢复所有数据</p>
<h6 id="②、劣势-1"><a href="#②、劣势-1" class="headerlink" title="②、劣势"></a>②、劣势</h6><p>（1）对于同一份数据来说，AOF日志文件通常比RDB数据快照文件更大</p>
<p>（2）AOF开启后，支持的写QPS会比RDB支持的写QPS低，因为AOF一般会配置成每秒fsync一次日志文件，当然，每秒一次fsync，性能也还是很高的</p>
<p>（3）以前AOF发生过bug，就是通过AOF记录的日志，进行数据恢复的时候，没有恢复一模一样的数据出来。</p>
<img src="http://img.louchen.top/2020/05/rdb_aof.png" style="zoom:50%;" /></div><div class="article-tags size-small is-uppercase mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/Redis/">Redis</a></div><!--!--></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">喜欢这篇文章？打赏一下作者吧</h3><div class="buttons is-centered"><a class="button is-success donate"><span class="icon is-small"><i class="fab fa-weixin"></i></span><span>微信</span><span class="qrcode"><img src="/img/pay.jpg" alt="微信"></span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2020/07/24/redis/Redis%E7%9A%84java%E5%AE%A2%E6%88%B7%E7%AB%AF/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">Jedis和Letture客户端连接Redis</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2020/07/24/redis/Redis%E5%AE%89%E8%A3%85%E6%96%B9%E5%BC%8F/"><span class="level-item">Redis正确安装的几种姿势</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!--></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1"><div class="card widget"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="" src="/img/milk.png" alt="娄晨"></figure><p class="title is-size-4 is-block line-height-inherit">娄晨</p><p class="is-size-6 is-block">学生</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>中国·武汉</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">71</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">19</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">42</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded cursor:pointer" href="/img/wechart.jpg" target="_blank" rel="noopener">联系我</a></div><div class="level is-mobile"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/ppoffice"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Facebook" href="https://facebook.com"><i class="fab fa-facebook"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Dribbble" href="https://dribbble.com"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><div class="card widget" id="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">目录</h3><ul class="menu-list"><li><a class="is-flex" href="#Redis持久化方式"><span class="mr-2">1</span><span>Redis持久化方式</span></a><ul class="menu-list"><li><a class="is-flex" href="#一、RDB（快照持久化）"><span class="mr-2">1.1</span><span>一、RDB（快照持久化）</span></a><ul class="menu-list"><li><a class="is-flex" href="#1-1原理"><span class="mr-2">1.1.1</span><span>1.1原理</span></a></li><li><a class="is-flex" href="#1-2具体配置"><span class="mr-2">1.1.2</span><span>1.2具体配置</span></a></li><li><a class="is-flex" href="#1-3备份的流程"><span class="mr-2">1.1.3</span><span>1.3备份的流程</span></a></li><li><a class="is-flex" href="#③、自动触发"><span class="mr-2">1.1.4</span><span>③、自动触发</span></a></li></ul></li><li><a class="is-flex" href="#二、AOF持久化"><span class="mr-2">1.2</span><span>二、AOF持久化</span></a><ul class="menu-list"><li><a class="is-flex" href="#2-1-AOP触发备份的三种机制"><span class="mr-2">1.2.1</span><span>2.1 AOP触发备份的三种机制</span></a></li></ul></li><li><a class="is-flex" href="#三、RDB和AOP的选择比较"><span class="mr-2">1.3</span><span>三、RDB和AOP的选择比较</span></a><ul class="menu-list"><li><a class="is-flex" href="#②、劣势-1"><span class="mr-2">1.3.1</span><span>②、劣势</span></a></li></ul></li></ul></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">链接</h3><ul class="menu-list"><li><a class="level is-mobile is-mobile" href="http://vhr.louchen.top/index.html" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">人事管理</span></span><span class="level-right"><span class="level-item tag">vhr.louchen.top</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/categories/IDEA/"><span class="level-start"><span class="level-item">IDEA</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/JVM/"><span class="level-start"><span class="level-item">JVM</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/JavaWeb/"><span class="level-start"><span class="level-item">JavaWeb</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Java%E5%9F%BA%E7%A1%80/"><span class="level-start"><span class="level-item">Java基础</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Linux/"><span class="level-start"><span class="level-item">Linux</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/MySQL/"><span class="level-start"><span class="level-item">MySQL</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Redis/"><span class="level-start"><span class="level-item">Redis</span></span><span class="level-end"><span class="level-item tag">15</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/SSM/"><span class="level-start"><span class="level-item">SSM</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Spring/"><span class="level-start"><span class="level-item">Spring</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Spring-Boot/"><span class="level-start"><span class="level-item">Spring Boot</span></span><span class="level-end"><span class="level-item tag">22</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Spring-Cache/"><span class="level-start"><span class="level-item">Spring Cache</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Spring-Security/"><span class="level-start"><span class="level-item">Spring Security</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/SpringBoot/"><span class="level-start"><span class="level-item">SpringBoot</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/SpringMVC/"><span class="level-start"><span class="level-item">SpringMVC</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/%E5%AE%B9%E5%99%A8%E5%8C%96%E6%8A%80%E6%9C%AF/"><span class="level-start"><span class="level-item">容器化技术</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/"><span class="level-start"><span class="level-item">并发编程</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/%E7%89%88%E6%9C%AC%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7/"><span class="level-start"><span class="level-item">版本管理工具</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/%E9%A1%B9%E7%9B%AE%E6%9E%84%E5%BB%BA%E9%83%A8%E7%BD%B2/"><span class="level-start"><span class="level-item">项目构建部署</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2/"><span class="level-start"><span class="level-item">项目部署</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">订阅更新</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button is-primary" type="submit" value="订阅"></div></div></form></div></div></div><div class="column-right-shadow is-hidden-widescreen"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3"><div class="card widget"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content size-small"><p><time dateTime="2020-08-30T13:33:41.737Z">2020-08-30</time></p><p class="title is-6"><a class="link-muted" href="/2020/08/30/docker_linux_nginx_git_maven_gradle/gradle%E8%AF%A6%E8%A7%A3/">Gradle详解(待续)</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/%E7%89%88%E6%9C%AC%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7/">版本管理工具</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-08-30T13:33:41.720Z">2020-08-30</time></p><p class="title is-6"><a class="link-muted" href="/2020/08/30/docker_linux_nginx_git_maven_gradle/Git%E8%AF%A6%E8%A7%A3/">Git详解</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/%E7%89%88%E6%9C%AC%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7/">版本管理工具</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-08-30T13:33:41.696Z">2020-08-30</time></p><p class="title is-6"><a class="link-muted" href="/2020/08/30/docker_linux_nginx_git_maven_gradle/github%E6%90%9C%E7%B4%A2%E6%8A%80%E5%B7%A7/">github搜索技巧</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/%E7%89%88%E6%9C%AC%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7/">版本管理工具</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-08-30T13:33:41.660Z">2020-08-30</time></p><p class="title is-6"><a class="link-muted" href="/2020/08/30/docker_linux_nginx_git_maven_gradle/Maven%E8%AF%A6%E8%A7%A3/">Maven详解</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/%E7%89%88%E6%9C%AC%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7/">版本管理工具</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-08-30T13:32:38.191Z">2020-08-30</time></p><p class="title is-6"><a class="link-muted" href="/2020/08/30/docker_linux_nginx_git_maven_gradle/Nginx%E8%AF%A6%E8%A7%A3/">Nginx详解</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2/">项目部署</a></p></div></article></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/archives/2020/08/"><span class="level-start"><span class="level-item">八月 2020</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/07/"><span class="level-start"><span class="level-item">七月 2020</span></span><span class="level-end"><span class="level-item tag">62</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/ActiveMQ/"><span class="tag">ActiveMQ</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Docker/"><span class="tag">Docker</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Ehcache/"><span class="tag">Ehcache</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/FastDFS/"><span class="tag">FastDFS</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Git/"><span class="tag">Git</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Gradle/"><span class="tag">Gradle</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/IDEA/"><span class="tag">IDEA</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/JAR/"><span class="tag">JAR</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/JDK1-8/"><span class="tag">JDK1.8</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/JVM/"><span class="tag">JVM</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/JWT/"><span class="tag">JWT</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Java%E5%9F%BA%E7%A1%80/"><span class="tag">Java基础</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Linux/"><span class="tag">Linux</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Maven/"><span class="tag">Maven</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/MongoDB/"><span class="tag">MongoDB</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/MySQL/"><span class="tag">MySQL</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Nginx/"><span class="tag">Nginx</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/OAuth2/"><span class="tag">OAuth2</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Quartz/"><span class="tag">Quartz</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/RESTful/"><span class="tag">RESTful</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/RabbitMQ/"><span class="tag">RabbitMQ</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Redis/"><span class="tag">Redis</span><span class="tag is-grey-lightest">16</span></a></div><div class="control"><a class="tags has-addons" href="/tags/SSM/"><span class="tag">SSM</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Servlet/"><span class="tag">Servlet</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Session/"><span class="tag">Session</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Shiro/"><span class="tag">Shiro</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Spring/"><span class="tag">Spring</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Spring-Boot/"><span class="tag">Spring Boot</span><span class="tag is-grey-lightest">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Spring-Security/"><span class="tag">Spring Security</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/SpringBoot/"><span class="tag">SpringBoot</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/SpringMVC/"><span class="tag">SpringMVC</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Swagger2/"><span class="tag">Swagger2</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/WAR/"><span class="tag">WAR</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/WebSocket/"><span class="tag">WebSocket</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F/"><span class="tag">代理模式</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%8F%8D%E5%B0%84/"><span class="tag">反射</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%A4%9A%E6%95%B0%E6%8D%AE%E6%BA%90/"><span class="tag">多数据源</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"><span class="tag">多线程</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/"><span class="tag">定时任务</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%B3%9B%E5%9E%8B/"><span class="tag">泛型</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%B6%88%E6%81%AF%E6%9C%8D%E5%8A%A1/"><span class="tag">消息服务</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E9%82%AE%E4%BB%B6%E6%9C%8D%E5%8A%A1/"><span class="tag">邮件服务</span><span class="tag is-grey-lightest">1</span></a></div></div></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/favicon.ico" alt="MilkLc" height="28"></a><p class="size-small"><span>&copy; 2020 lc</span>  Powered by <a href="#" target="_blank" rel="noopener">LouChen</a>  </p><p class="size-small"><a href="http://www.miitbeian.gov.cn">鄂ICP备19030764号-1</a></p></div><div style="margin-left:-150px"><span id="busuanzi_container_site_pv">本站总访问量 <span id="busuanzi_value_site_pv" style="color:blue;font-size: 17px"></span> 次</span><span class="post-meta-divider"> | </span><span id="busuanzi_container_site_uv" style="display:none">本站访客数 <span id="busuanzi_value_site_uv" style="color:blue;font-size: 17px"></span> 人</span><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><div class="level-end"></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            site: {
                url: 'http://yoursite.com',
                external_link: {"enable":true,"exclude":[]}
            },
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>