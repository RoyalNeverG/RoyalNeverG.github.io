<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="generator" content="Hexo 4.2.0"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>深入理解Spring - MilkLc</title><meta description="​                                                                                SpringFramewrok架构图 一、IOC和DIhttps:&amp;#x2F;&amp;#x2F;www.iteye.com&amp;#x2F;blog&amp;#x2F;jinnianshilongnian-1413846 1、IOC基本概念：  IOC—Inversion of Control"><meta property="og:type" content="blog"><meta property="og:title" content="深入理解Spring"><meta property="og:url" content="http://yoursite.com/2020/07/24/ssm/Spring/"><meta property="og:site_name" content="MilkLc"><meta property="og:description" content="​                                                                                SpringFramewrok架构图 一、IOC和DIhttps:&amp;#x2F;&amp;#x2F;www.iteye.com&amp;#x2F;blog&amp;#x2F;jinnianshilongnian-1413846 1、IOC基本概念：  IOC—Inversion of Control"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://img.louchen.top/2020/07/20200709130228.png"><meta property="og:image" content="http://img.louchen.top/2020/07/20200709160027.png"><meta property="og:image" content="http://img.louchen.top/2020/07/20200709160141.png"><meta property="og:image" content="http://img.louchen.top/2020/07/20200713093056.png"><meta property="og:image" content="http://img.louchen.top/2020/07/20200722164935.png"><meta property="og:image" content="http://img.louchen.top/2020/07/20200711113308.png"><meta property="og:image" content="http://img.louchen.top/2020/07/20200712205033.png"><meta property="og:image" content="http://img.louchen.top/2020/07/20200713201631.png"><meta property="og:image" content="http://img.louchen.top/2020/07/20200713203744.png"><meta property="og:image" content="http://img.louchen.top/2020/07/20200713205542.png"><meta property="og:image" content="http://img.louchen.top/2020/07/20200713213315.png"><meta property="og:image" content="http://img.louchen.top/2020/07/20200714124535.png"><meta property="og:image" content="http://img.louchen.top/2020/07/20200714124557.png"><meta property="og:image" content="http://img.louchen.top/2020/07/20200714124615.png"><meta property="article:published_time" content="2020-07-24T15:14:32.981Z"><meta property="article:modified_time" content="2020-07-24T13:50:31.676Z"><meta property="article:author" content="lc"><meta property="article:tag" content="Spring"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="http://img.louchen.top/2020/07/20200709130228.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://yoursite.com/2020/07/24/ssm/Spring/"},"headline":"MilkLc","image":["http://img.louchen.top/2020/07/20200709130228.png","http://img.louchen.top/2020/07/20200709160027.png","http://img.louchen.top/2020/07/20200709160141.png","http://img.louchen.top/2020/07/20200713093056.png","http://img.louchen.top/2020/07/20200722164935.png","http://img.louchen.top/2020/07/20200711113308.png","http://img.louchen.top/2020/07/20200712205033.png","http://img.louchen.top/2020/07/20200713201631.png","http://img.louchen.top/2020/07/20200713203744.png","http://img.louchen.top/2020/07/20200713205542.png","http://img.louchen.top/2020/07/20200713213315.png","http://img.louchen.top/2020/07/20200714124535.png","http://img.louchen.top/2020/07/20200714124557.png","http://img.louchen.top/2020/07/20200714124615.png"],"datePublished":"2020-07-24T15:14:32.981Z","dateModified":"2020-07-24T13:50:31.676Z","author":{"@type":"Person","name":"lc"},"description":"​                                                                                SpringFramewrok架构图 一、IOC和DIhttps:&#x2F;&#x2F;www.iteye.com&#x2F;blog&#x2F;jinnianshilongnian-1413846 1、IOC基本概念：  IOC—Inversion of Control"}</script><link rel="canonical" href="http://yoursite.com/2020/07/24/ssm/Spring/"><link rel="icon" href="/img/favicon.ico"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/favicon.ico" alt="MilkLc" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">主页</a><a class="navbar-item" href="/archives">归档</a><a class="navbar-item" href="/categories">分类</a><a class="navbar-item" href="/tags">标签</a><a class="navbar-item" href="/about">关于</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/RoyalNeverG"><i class="fab fa-github"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><input placeholder="你想要查找什么？" type="text"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-07-24T15:14:32.981Z" title="2020-07-24T15:14:32.981Z">2020-07-24</time><span class="level-item"><a class="link-muted" href="/categories/Spring/">Spring</a></span><span class="level-item">2 小时 读完 (大约 17888 个字)</span></div></div><h1 class="title is-3 is-size-4-mobile">深入理解Spring</h1><div class="content"><img src="http://img.louchen.top/2020/07/20200709130228.png" style="zoom: 50%;" />

<p>​                                                                                <em>SpringFramewrok架构图</em></p>
<h3 id="一、IOC和DI"><a href="#一、IOC和DI" class="headerlink" title="一、IOC和DI"></a>一、IOC和DI</h3><p><a href="https://www.iteye.com/blog/jinnianshilongnian-1413846">https://www.iteye.com/blog/jinnianshilongnian-1413846</a></p>
<h4 id="1、IOC"><a href="#1、IOC" class="headerlink" title="1、IOC"></a>1、IOC</h4><p><strong>基本概念：</strong></p>
<p> IOC—Inversion of Control 即“控制反转”，不是什么技术，而是一种<strong>设计思想。</strong></p>
<p>在传统Java SE程序设计，我们直接在对象内部通过new进行创建对象，是程序<strong>主动去创建依赖对象</strong>；而IOC是有专门一个容器来创建这些对象，即由IOC容器来控制对象的创建而不再显式地使用new；</p>
<p><strong>主动式(</strong>什么资源都自己创建)：</p>
<a id="more"></a>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserService</span></span>&#123;</span><br><span class="line">    	<span class="comment">//我们在service想要使用dao中的对象，需要手动创建</span></span><br><span class="line">	   UserDao userDao=<span class="keyword">new</span> UserDao();  </span><br><span class="line">       <span class="function"><span class="keyword">public</span> User <span class="title">getUser</span><span class="params">()</span></span>&#123;</span><br><span class="line">           <span class="keyword">return</span> userService.selectUser();</span><br><span class="line">       &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>即 UserService依赖于 UserDao</p>
<img src="http://img.louchen.top/2020/07/20200709160027.png" style="zoom:67%;" />



<p><strong>被动式</strong>(由我们容器创建)：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserService</span></span>&#123;</span><br><span class="line">    	<span class="comment">//我们只需要声明要使用的对象即可，IOC容器会帮我们创建和管理</span></span><br><span class="line">	   UserDao userDao;</span><br><span class="line">       <span class="function"><span class="keyword">public</span> User <span class="title">getUser</span><span class="params">()</span></span>&#123;</span><br><span class="line">           <span class="keyword">return</span> userService.selectUser();</span><br><span class="line">       &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>即 UserService依赖于 UserDao</p>
<img src="http://img.louchen.top/2020/07/20200709160141.png" style="zoom: 67%;" />

<ul>
<li><strong>谁控制谁，控制什么：</strong><ul>
<li>传统Java SE程序设计，我们直接在对象内部通过new进行创建对象，是程序主动去创建依赖对象；而IoC是有专门一个容器来创建这些对象，即由Ioc容器来控制对象的创建；谁控制谁？当然是IoC 容器控制了对象；控制什么？那就是主要控制了外部资源获取（不只是对象包括比如文件等）。</li>
</ul>
</li>
<li><strong>为何是反转，哪些方面反转了：</strong><ul>
<li>有反转就有正转，传统应用程序是由我们自己在对象中主动控制去直接获取依赖对象，也就是正转；而反转则是由容器来帮忙创建及注入依赖对象；为何是反转？因为由容器帮我们查找及注入依赖对象，对象只是被动的接受依赖对象，所以是反转；哪些方面反转了？依赖对象的获取被反转了。</li>
</ul>
</li>
</ul>
<h4 id="2、DI"><a href="#2、DI" class="headerlink" title="2、DI"></a>2、DI</h4><p><strong>基本概念：</strong></p>
<p>DI—Dependency Injection，即“依赖注入”：<strong>即是IOC的实现方式</strong>。是组件之间依赖关系由容器在运行期决定，形象的说，即由容器动态的将某个依赖关系注入到组件之中。依赖注入的目的并非为软件系统带来更多功能，而是为了提升组件重用的频率，并为系统搭建一个灵活、可扩展的平台。通过依赖注入机制，我们只需要通过简单的配置，而无需任何代码就可指定目标需要的资源，完成自身的业务逻辑，而不需要关心具体的资源来自何处，由谁实现。<br>理解DI的关键是：“<strong>谁依赖谁，为什么需要依赖，谁注入谁，注入了什么”</strong>，</p>
<p>●<strong>谁依赖于谁：</strong>当然是应用程序依赖于IoC容器；</p>
<p>●<strong>为什么需要依赖：</strong>应用程序需要IoC容器来提供对象需要的外部资源；</p>
<p>●<strong>谁注入谁：</strong>很明显是IoC容器注入应用程序某个对象，应用程序依赖的对象；</p>
<p><strong>●注入了什么：</strong>就是注入某个对象所需要的外部资源（包括对象、资源、常量数据）。    </p>
<p>​        容器指定那个组件(类)运行的时候，需要另外一个类(组件)；容器通过反射的方式，将容器中准备好的UserDao对象注入到UserService中声明的UserDao属性中。</p>
<h4 id="3、简单IOC实例"><a href="#3、简单IOC实例" class="headerlink" title="3、简单IOC实例"></a>3、简单IOC实例</h4><blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">    <span class="keyword">private</span> String gender;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"person初始化..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--注册一个Person对象。Spring会自动创建这个Person对象--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--一个bean可以注册一个组件(类)--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--id 唯一标识--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--class 类的全路径--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"person1"</span> <span class="attr">class</span>=<span class="string">"org.lc.entity.Person"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--property为属性赋值--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--name属性名 value属性值--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">value</span>=<span class="string">"1001"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">value</span>=<span class="string">"张三"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"age"</span> <span class="attr">value</span>=<span class="string">"12"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"gender"</span> <span class="attr">value</span>=<span class="string">"male"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">     <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"person2"</span> <span class="attr">class</span>=<span class="string">"org.lc.entity.Person"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">value</span>=<span class="string">"1002"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
</blockquote>
<h5 id="1-读取Bean的xml获取Bean实例"><a href="#1-读取Bean的xml获取Bean实例" class="headerlink" title="1)读取Bean的xml获取Bean实例"></a>1)读取Bean的xml获取Bean实例</h5><blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppTest</span> </span>&#123;</span><br><span class="line">    <span class="comment">//从容器中拿到这个组件</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Test1</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//从绝对路径拿到配置文件</span></span><br><span class="line">        <span class="comment">// ApplicationContext ico1 = new FileSystemXmlApplicationContext("");</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//从类路径(src)下拿到配置文件 classpath</span></span><br><span class="line">        ApplicationContext ioc = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"ioc.xml"</span>);</span><br><span class="line">        Person person1 = (Person) ioc.getBean(<span class="string">"person1"</span>);</span><br><span class="line">        Person person11 = (Person) ioc.getBean(<span class="string">"person1"</span>);</span><br><span class="line">        </span><br><span class="line">        Person person2 = (Person) ioc.getBean(<span class="string">"person2"</span>);</span><br><span class="line">        <span class="comment">//true</span></span><br><span class="line">        System.out.println(person1==person11);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<p><strong>注意事项：</strong></p>
<ul>
<li><p>ApplicationContext IOC接口</p>
</li>
<li><p>当创建<code>ApplicationContext</code> IOC容器创建完毕时即<strong>创建所有的对象</strong>. 无需等到getBean时再创建</p>
<ul>
<li><code>ApplicationContext ioc = new ClassPathXmlApplicationContext(&quot;ioc.xml&quot;);</code></li>
</ul>
</li>
<li><p>当配置一个bean，我们的IOC就位我们初始化创建一个实例对象</p>
</li>
<li><p>获取同一个bean多次时，获取的都是同一对象，即我们ICO创建bean对象<strong>是单实例的</strong></p>
</li>
<li><p>找不到我们指定的bean时，会报错<code>org.springframework.beans.factory.NoSuchBeanDefinitionException:</code></p>
</li>
<li><p>所有为对象属性的设置值都是通过set方法实现的</p>
</li>
</ul>
<h5 id="2-处理类型相同的多个Bean"><a href="#2-处理类型相同的多个Bean" class="headerlink" title="2)处理类型相同的多个Bean"></a>2)处理类型相同的多个Bean</h5><ul>
<li><p>当我们通过类对象获取bean时，当配置了多个相同的bean类型，那么会报错</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Person bean = ioc.getBean(<span class="string">"person1"</span>,Person<span class="class">.<span class="keyword">class</span>)</span>;</span><br></pre></td></tr></table></figure>

<p><code>orgspringframework.beans.factory.NoUniqueBeanDefinitionException: No qualifying bean of type &#39;org.lc.entity.Person&#39; available: expected single matching bean but found 2: person1,person2</code></p>
</li>
<li><p>指定要获取bean的id名称和类型</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Person bean = ioc.getBean(<span class="string">"person1"</span>,Person<span class="class">.<span class="keyword">class</span>)</span>;</span><br></pre></td></tr></table></figure>

<h5 id="3-通过Bean中的有参构造器赋值"><a href="#3-通过Bean中的有参构造器赋值" class="headerlink" title="3)通过Bean中的有参构造器赋值"></a>3)通过Bean中的有参构造器赋值</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">   <span class="comment">&lt;!--调用有参构造区进行赋值--&gt;</span></span><br><span class="line">   <span class="comment">&lt;!--person类中必须要有该下面完整的构造器--&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- public Person(int id, String name, int age, String gender) &#123;&#125;--&gt;</span></span><br><span class="line">   <span class="comment">&lt;!--通过有参构造器赋值，无需调用set方法--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"person3"</span> <span class="attr">class</span>=<span class="string">"org.lc.entity.Person"</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">value</span>=<span class="string">"10"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">value</span>=<span class="string">"lc"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"age"</span> <span class="attr">value</span>=<span class="string">"11"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"gender"</span> <span class="attr">value</span>=<span class="string">"male"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>不写name属性的构造器赋值方法：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--当未指定name属性时，则必须按照构造器的属性顺序指定属性值，顺序不能颠倒--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"person4"</span> <span class="attr">class</span>=<span class="string">"org.lc.entity.Person"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span>  <span class="attr">value</span>=<span class="string">"10"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span>  <span class="attr">value</span>=<span class="string">"lc"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span>  <span class="attr">value</span>=<span class="string">"11"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">"male"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>如果赋值顺序颠倒，则可以指定index属性来指定顺序。索引从0开始</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"person4"</span> <span class="attr">class</span>=<span class="string">"org.lc.entity.Person"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span>  <span class="attr">value</span>=<span class="string">"10"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span>  <span class="attr">value</span>=<span class="string">"lc"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">"male"</span> <span class="attr">index</span>=<span class="string">"3"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span>  <span class="attr">value</span>=<span class="string">"11"</span> <span class="attr">index</span>=<span class="string">"2"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>还可以通过type来指定当前构造参数的类型</p>
<h5 id="4-通过p标签赋值属性"><a href="#4-通过p标签赋值属性" class="headerlink" title="4)通过p标签赋值属性"></a>4)通过p标签赋值属性</h5><p>内部还是通过set方法赋值</p>
<p><code>xmlns:p=&quot;http://www.springframework.org/schema/p&quot;</code></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean id="person4" class="org.lc.entity.Person" p:id="12" p:gender="female" p:name="张三" p:age="12"&gt;&lt;/bean&gt;</span><br></pre></td></tr></table></figure>

<h5 id="5-通过Bean赋值属性为null"><a href="#5-通过Bean赋值属性为null" class="headerlink" title="5)通过Bean赋值属性为null"></a>5)通过Bean赋值属性为null</h5><p>其实在xml中写的所有内容都是字符串，赋值给指定属性时类型会自动判断转换。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--若不为bean的属性赋值 则基本类型为默认值，引用类型默认为null--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--若要显示为某个属性赋值为null. 不能写成&lt;property name="id" value="null"&gt;否则还是赋值的为字符串null--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"person1"</span> <span class="attr">class</span>=<span class="string">"org.lc.entity.Person"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"id"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">null</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="6-通过ref引用其他外部Bean对象"><a href="#6-通过ref引用其他外部Bean对象" class="headerlink" title="6)通过ref引用其他外部Bean对象"></a>6)通过ref引用其他外部Bean对象</h5><blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Role</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String nameZh;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String nameCar;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">double</span> moneyCar;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">    <span class="keyword">private</span> String gender;</span><br><span class="line">    <span class="keyword">private</span> Car car;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Role&gt; roleList;</span><br><span class="line">    <span class="keyword">private</span> Properties properties;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String,Object&gt; maps;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"car1"</span> <span class="attr">class</span>=<span class="string">"org.lc.entity.Car"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">value</span>=<span class="string">"111"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"nameCar"</span> <span class="attr">value</span>=<span class="string">"宝马"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"moneyCar"</span> <span class="attr">value</span>=<span class="string">"3600000"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"person1"</span> <span class="attr">class</span>=<span class="string">"org.lc.entity.Person"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--将该属性 引用ref外部的bean--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"car"</span> <span class="attr">ref</span>=<span class="string">"car1"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Car car = (Car) ioc.getBean(<span class="string">"car1"</span>);</span><br><span class="line">Car car1 = ((Person) ioc.getBean(<span class="string">"person1"</span>)).getCar();</span><br><span class="line"><span class="comment">//Car(id=111, nameCar=宝马, moneyCar=3600000.0)</span></span><br><span class="line">System.out.println(car1.toString());</span><br><span class="line">car.setNameCar(<span class="string">"奔驰"</span>);</span><br><span class="line"><span class="comment">//Car(id=111, nameCar=奔驰, moneyCar=3600000.0)</span></span><br><span class="line">System.out.println(car1.toString());</span><br><span class="line"><span class="comment">//true</span></span><br><span class="line">System.out.println(car==car1);</span><br></pre></td></tr></table></figure>

<ul>
<li>通过bean声明的对象和ref引用的对象为同一对象。他们是同一个实例，修改一个对象的属性那么其他应引用该对象的属性也会改变。</li>
</ul>
<h5 id="7-创建使用内部Bean对象"><a href="#7-创建使用内部Bean对象" class="headerlink" title="7)创建使用内部Bean对象"></a>7)创建使用内部Bean对象</h5><ul>
<li>创建内部的bean对象 与外部声明的bean不是同一对象</li>
<li>内部bean不能通过id获取到</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"car1"</span> <span class="attr">class</span>=<span class="string">"org.lc.entity.Car"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">value</span>=<span class="string">"111"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"nameCar"</span> <span class="attr">value</span>=<span class="string">"宝马"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"moneyCar"</span> <span class="attr">value</span>=<span class="string">"3600000"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"person1"</span> <span class="attr">class</span>=<span class="string">"org.lc.entity.Person"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"car"</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--创建内部的bean对象 与外部声明的bean不是同一对象--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.lc.entity.Car"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">value</span>=<span class="string">"222"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"nameCar"</span> <span class="attr">value</span>=<span class="string">"自行车"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Car car = (Car) ioc.getBean(<span class="string">"car1"</span>);</span><br><span class="line">Car car1 = ((Person) ioc.getBean(<span class="string">"person1"</span>)).getCar();</span><br><span class="line"><span class="comment">//Car(id=111, nameCar=宝马, moneyCar=3600000.0)</span></span><br><span class="line">System.out.println(car.toString());</span><br><span class="line"><span class="comment">//Car(id=222, nameCar=自行车, moneyCar=0.0)</span></span><br><span class="line">System.out.println(car1.toString());</span><br></pre></td></tr></table></figure>

<h5 id="8-为List类型赋值"><a href="#8-为List类型赋值" class="headerlink" title="8)为List类型赋值"></a>8)为List类型赋值</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"role1"</span> <span class="attr">class</span>=<span class="string">"org.lc.entity.Role"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">value</span>=<span class="string">"1"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">value</span>=<span class="string">"admin"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"nameZh"</span> <span class="attr">value</span>=<span class="string">"管理员"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"person2"</span> <span class="attr">class</span>=<span class="string">"org.lc.entity.Person"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"roleList"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--为list赋值 相当于 new ArrayList&lt;Role&gt;--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--创建内部的bean并赋值--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.lc.entity.Role"</span> <span class="attr">p:id</span>=<span class="string">"2"</span> <span class="attr">p:name</span>=<span class="string">"test"</span> <span class="attr">p:nameZh</span>=<span class="string">"测试人员"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--引用外部的bean--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">"role1"</span>&gt;</span><span class="tag">&lt;/<span class="name">ref</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Person person2 = (Person) ioc.getBean(<span class="string">"person2"</span>);</span><br><span class="line"> List&lt;Role&gt; roleList = person2.getRoleList();</span><br><span class="line"> <span class="comment">//[Role(id=2, name=test, nameZh=测试人员), Role(id=1, name=admin, nameZh=管理员)]</span></span><br><span class="line"> System.out.println(roleList);</span><br></pre></td></tr></table></figure>

<h5 id="9-为map赋值"><a href="#9-为map赋值" class="headerlink" title="9)为map赋值"></a>9)为map赋值</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"role1"</span> <span class="attr">class</span>=<span class="string">"org.lc.entity.Role"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">value</span>=<span class="string">"1"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">value</span>=<span class="string">"admin"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"nameZh"</span> <span class="attr">value</span>=<span class="string">"管理员"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"person3"</span> <span class="attr">class</span>=<span class="string">"org.lc.entity.Person"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maps"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--为map赋值 相当于new LinkedHashMap&lt;String,Object&gt;--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">map</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--一个entry代表一个健值对--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"key01"</span> <span class="attr">value</span>=<span class="string">"张三"</span>&gt;</span><span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"key02"</span> <span class="attr">value</span>=<span class="string">"18"</span>&gt;</span><span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--将value值引用外部bean--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"key03"</span> <span class="attr">value-ref</span>=<span class="string">"role1"</span>&gt;</span><span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--将value值创建内部bean--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"key04"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.lc.entity.Role"</span> <span class="attr">p:id</span>=<span class="string">"3333"</span> <span class="attr">p:name</span>=<span class="string">"root"</span> <span class="attr">p:nameZh</span>=<span class="string">"超级管理员"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Person person3 = (Person) ioc.getBean(<span class="string">"person3"</span>);</span><br><span class="line">Map&lt;String, Object&gt; maps = person3.getMaps();</span><br><span class="line"><span class="comment">//&#123;key01=张三, key02=18, key03=Role(id=1, name=admin, nameZh=管理员), key04=Role(id=3333, name=root, nameZh=超级管理员)&#125;</span></span><br><span class="line">System.out.println(maps);</span><br></pre></td></tr></table></figure>

<h5 id="10-为Properties赋值"><a href="#10-为Properties赋值" class="headerlink" title="10)为Properties赋值"></a>10)为Properties赋值</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"person4"</span> <span class="attr">class</span>=<span class="string">"org.lc.entity.Person"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"properties"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--为properties属性赋值 相当于properties =new Properties() 所有的key value都是字符串类型 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">props</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--k=v都是字符串 值直接写在标签内--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"username"</span>&gt;</span>root<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"password"</span>&gt;</span>123456<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">props</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Person person3 = (Person) ioc.getBean(<span class="string">"person4"</span>);</span><br><span class="line">Properties properties = person3.getProperties();</span><br><span class="line"><span class="comment">// root</span></span><br><span class="line">System.out.println(properties.getProperty(<span class="string">"username"</span>));</span><br><span class="line"><span class="comment">//123456</span></span><br><span class="line">System.out.println(properties.getProperty(<span class="string">"password"</span>));</span><br></pre></td></tr></table></figure>

<h5 id="11-使用util创建一个可以引用的集合"><a href="#11-使用util创建一个可以引用的集合" class="headerlink" title="11)使用util创建一个可以引用的集合"></a>11)使用util创建一个可以引用的集合</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xmlns:utils&#x3D;&quot;http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;util&quot;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--相当于创建一个new LinkedHashMap 可以通过id 全局使用--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">utils:map</span> <span class="attr">id</span>=<span class="string">"maptutil"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--一个entry代表一个健值对--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"key01"</span> <span class="attr">value</span>=<span class="string">"张三"</span>&gt;</span><span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"key02"</span> <span class="attr">value</span>=<span class="string">"18"</span>&gt;</span><span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--将value值引用外部bean--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"key03"</span> <span class="attr">value-ref</span>=<span class="string">"role1"</span>&gt;</span><span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--将value值创建内部bean--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"key04"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.lc.entity.Role"</span> <span class="attr">p:id</span>=<span class="string">"3333"</span> <span class="attr">p:name</span>=<span class="string">"root"</span> <span class="attr">p:nameZh</span>=<span class="string">"超级管理员"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">utils:map</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--相当于创建一个list集合--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">utils:list</span> <span class="attr">id</span>=<span class="string">"utillist"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--放入一个list--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">list</span>&gt;</span><span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--放入一个普通的value值--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">utils:list</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="12-级联属性赋值"><a href="#12-级联属性赋值" class="headerlink" title="12)级联属性赋值"></a>12)级联属性赋值</h5><ul>
<li>当引用外部的bean并修改其中的属性时，对应外部的bean的属性也会改变。</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"car1"</span> <span class="attr">class</span>=<span class="string">"org.lc.entity.Car"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">value</span>=<span class="string">"111"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"nameCar"</span> <span class="attr">value</span>=<span class="string">"宝马"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"moneyCar"</span> <span class="attr">value</span>=<span class="string">"3600000"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"person5"</span> <span class="attr">class</span>=<span class="string">"org.lc.entity.Person"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--引用外部bean--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"car"</span> <span class="attr">ref</span>=<span class="string">"car1"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--引用外部bean后 并修改bean中的属性--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"car.nameCar"</span> <span class="attr">value</span>=<span class="string">"汗血宝马"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="13-通过parent对指定Bean的继承"><a href="#13-通过parent对指定Bean的继承" class="headerlink" title="13)通过parent对指定Bean的继承"></a>13)通过parent对指定Bean的继承</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"person6"</span> <span class="attr">class</span>=<span class="string">"org.lc.entity.Person"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">value</span>=<span class="string">"1002"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">value</span>=<span class="string">"张三"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"age"</span> <span class="attr">value</span>=<span class="string">"12"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"gender"</span> <span class="attr">value</span>=<span class="string">"male"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--通过parent继承其他的bean--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"person7"</span> <span class="attr">parent</span>=<span class="string">"person6"</span> <span class="attr">class</span>=<span class="string">"org.lc.entity.Person"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--将自己的属性重写  其他的属性继承--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">value</span>=<span class="string">"李四"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Person person7 = (Person) ioc.getBean(<span class="string">"person7"</span>);</span><br><span class="line"><span class="comment">//Person(id=1002, name=李四, age=12, gender=male, car=null, roleList=null, properties=null, maps=null)</span></span><br><span class="line">System.out.println(person7);</span><br></pre></td></tr></table></figure>

<h5 id="14-通过abstract将Bean声明为抽象的"><a href="#14-通过abstract将Bean声明为抽象的" class="headerlink" title="14)通过abstract将Bean声明为抽象的"></a>14)通过abstract将Bean声明为抽象的</h5><ul>
<li>该声明为abstract的bean只能被继承，不能通过id获取到该bean实例对象</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"person6"</span> <span class="attr">class</span>=<span class="string">"org.lc.entity.Person"</span> <span class="attr">abstract</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">value</span>=<span class="string">"1002"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">value</span>=<span class="string">"张三"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"age"</span> <span class="attr">value</span>=<span class="string">"12"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"gender"</span> <span class="attr">value</span>=<span class="string">"male"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="15-Bean之间的依赖创建顺序"><a href="#15-Bean之间的依赖创建顺序" class="headerlink" title="15)Bean之间的依赖创建顺序"></a>15)Bean之间的依赖创建顺序</h5><ul>
<li>默认根据bean声明的先后顺序来创建bean</li>
<li>若指定<code>depends-on</code> 则先依次创建<code>depends-on</code> 中的bean <code>role1,car1</code>再创建<code>person1</code></li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--若根据bean声明的先后顺序来创建bean --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"person1"</span> <span class="attr">class</span>=<span class="string">"org.lc.entity.Person"</span> <span class="attr">depends-on</span>=<span class="string">"role1,car1"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"car1"</span> <span class="attr">class</span>=<span class="string">"org.lc.entity.Car"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"role1"</span> <span class="attr">class</span>=<span class="string">"org.lc.entity.Role"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="4、Bean的作用域-默认为单例"><a href="#4、Bean的作用域-默认为单例" class="headerlink" title="4、Bean的作用域(默认为单例)"></a>4、Bean的作用域(默认为单例)</h4><ul>
<li><strong>prototype</strong> 多实例的<ul>
<li>容器启动默认去创建多实例的bean</li>
<li>每次获取的时候才去创建这个bean</li>
<li>每次获取都会创建一个新的对象</li>
</ul>
</li>
<li><strong>singleton</strong> 单实例的 (默认)<ul>
<li>在<strong>容器启动完成之前就已经创建好对象</strong>，保存在容器中了</li>
<li>任何获取到的该bean都是同一个对象</li>
</ul>
</li>
<li><strong>request</strong> 在web环境下，同一次请求创建一个Bean实例</li>
<li><strong>session</strong> 在web环境下，同一次会话创建一个Bean实例</li>
</ul>
<p><strong>单例(默认)</strong>：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"person1"</span> <span class="attr">class</span>=<span class="string">"org.lc.entity.Person"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">     Person person1 = (Person) ioc.getBean(<span class="string">"person1"</span>);</span><br><span class="line">      Person person2= (Person) ioc.getBean(<span class="string">"person1"</span>);</span><br><span class="line"><span class="comment">//true</span></span><br><span class="line">      System.out.println(person1==person2);</span><br></pre></td></tr></table></figure>

<p><strong>多例：</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"person1"</span> <span class="attr">class</span>=<span class="string">"org.lc.entity.Person"</span> <span class="attr">scope</span>=<span class="string">"prototype"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Person person1 = (Person) ioc.getBean(<span class="string">"person1"</span>);</span><br><span class="line">Person person2= (Person) ioc.getBean(<span class="string">"person1"</span>);</span><br><span class="line"><span class="comment">//false</span></span><br><span class="line">System.out.println(person1==person2);</span><br></pre></td></tr></table></figure>

<h4 id="5、静态工厂和实例工厂创建Bean"><a href="#5、静态工厂和实例工厂创建Bean" class="headerlink" title="5、静态工厂和实例工厂创建Bean"></a>5、静态工厂和实例工厂创建Bean</h4><p>工厂模式：工厂帮我们创建对象，有一个专门帮我们创建对象的类，这个类就是工厂</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Drink</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> capacity;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="1-静态工厂"><a href="#1-静态工厂" class="headerlink" title="1)静态工厂"></a>1)静态工厂</h5><p>工厂本身不需要创建对象；通过工厂中的静态方法调用创建对象    </p>
<p><code>实例对象=工厂类.工厂静态方法()</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//静态工厂</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DrinkStaticFactory</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Drink <span class="title">getDrink</span><span class="params">(String name)</span></span>&#123;</span><br><span class="line">        Drink drink=<span class="keyword">new</span> Drink();</span><br><span class="line">        drink.setId(<span class="number">1</span>);</span><br><span class="line">        drink.setCapacity(<span class="number">1000</span>);</span><br><span class="line">        drink.setName(name);</span><br><span class="line">        <span class="keyword">return</span> drink;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Drink d1 = DrinkStaticFactory.getDrink(<span class="string">"可口可乐"</span>);</span><br><span class="line"><span class="comment">//Drink(id=1, name=可口可乐, capacity=1000)</span></span><br><span class="line">System.out.println(d1);</span><br></pre></td></tr></table></figure>

<h6 id="静态工厂获取bean"><a href="#静态工厂获取bean" class="headerlink" title="静态工厂获取bean"></a><strong>静态工厂获取bean</strong></h6><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--通过静态工厂创建需要的对象， 注意这里并不会创建工厂对象--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--class:工厂的类路径--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--factory-method: 指定方法名，是哪个工厂方法创建对象--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"drink1"</span> <span class="attr">class</span>=<span class="string">"org.lc.factory.DrinkStaticFactory"</span> <span class="attr">factory-method</span>=<span class="string">"getDrink"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--指定该工厂方法传入的参数--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--name：为参数名--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--value 为参数值--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">value</span>=<span class="string">"coco"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Drink drink1 = (Drink) ioc.getBean(<span class="string">"drink1"</span>);</span><br><span class="line"><span class="comment">//Drink(id=1, name=coco, capacity=1000)</span></span><br><span class="line">System.out.println(drink1);</span><br></pre></td></tr></table></figure>

<h5 id="2-实例工厂"><a href="#2-实例工厂" class="headerlink" title="2)实例工厂"></a>2)实例工厂</h5><p>工厂本身需要创建对象。</p>
<p><code>工厂类 工厂对象=new 工厂类();</code></p>
<p><code>实例对象=工厂对象.工厂实例方法();</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DrinkInstanceFactory</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Drink <span class="title">getDrink</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        Drink drink=<span class="keyword">new</span> Drink();</span><br><span class="line">        drink.setId(<span class="number">1</span>);</span><br><span class="line">        drink.setCapacity(<span class="number">1000</span>);</span><br><span class="line">        drink.setName(name);</span><br><span class="line">        <span class="keyword">return</span> drink;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">DrinkInstanceFactory drinkInstanceFactory=<span class="keyword">new</span> DrinkInstanceFactory();</span><br><span class="line">Drink d1 = drinkInstanceFactory.getDrink(<span class="string">"百世可乐"</span>);</span><br><span class="line"><span class="comment">//Drink(id=1, name=百世可乐, capacity=1000)</span></span><br><span class="line">System.out.println(d1);</span><br></pre></td></tr></table></figure>

<h6 id="静态工厂获取bean-1"><a href="#静态工厂获取bean-1" class="headerlink" title="静态工厂获取bean"></a>静态工厂获取bean</h6><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--创建工厂bean对象--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"drinkInstanceFactory"</span> <span class="attr">class</span>=<span class="string">"org.lc.factory.DrinkInstanceFactory"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--在要创建的bean中指定实例工厂的bean--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--factory-bean：工厂bean的id --&gt;</span></span><br><span class="line"><span class="comment">&lt;!--factory-method: 指定工厂的方法名，工厂实例方法的名称--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"drink2"</span> <span class="attr">class</span>=<span class="string">"org.lc.entity.Drink"</span> <span class="attr">factory-bean</span>=<span class="string">"drinkInstanceFactory"</span> <span class="attr">factory-method</span>=<span class="string">"getDrink"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--为该工厂方法传入需要的参数--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--name 参数名--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--value 参数值--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">value</span>=<span class="string">"星巴克"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Drink drink =(Drink)ioc.getBean(<span class="string">"drink2"</span>);</span><br><span class="line"><span class="comment">//Drink(id=1, name=星巴克, capacity=1000)</span></span><br><span class="line">System.out.println(drink);</span><br></pre></td></tr></table></figure>

<h4 id="6、实现FactoryBean工厂获取所需的Bean"><a href="#6、实现FactoryBean工厂获取所需的Bean" class="headerlink" title="6、实现FactoryBean工厂获取所需的Bean"></a>6、实现FactoryBean工厂获取所需的Bean</h4><ul>
<li>public interface FactoryBean<T>为spring的一个接口，只要是实现了这个接口的，都认为是一个工厂</li>
<li>创建该工厂对象，通过getBean方法获取实现FactoryBean&lt;T&gt;中声明的所需要的类型对象</li>
<li>IOC容器启动的时候会创建我们实现FactoryBean的工厂对象，但是并不会创建该需要的Role创建该实例对象(无论是单例还是多例)。只有<strong>获取的时候才会创建实例对象</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyFactoryImp</span> <span class="keyword">implements</span> <span class="title">FactoryBean</span>&lt;<span class="title">Role</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//返回该对象</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Role <span class="title">getObject</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Role role =<span class="keyword">new</span> Role();</span><br><span class="line">        role.setId(<span class="number">1</span>);</span><br><span class="line">        role.setName(<span class="string">"superuser"</span>);</span><br><span class="line">        role.setNameZh(<span class="string">"超级用户"</span>);</span><br><span class="line">        <span class="keyword">return</span> role;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//返回该实例Clss</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Class&lt;?&gt; getObjectType() &#123;</span><br><span class="line">        <span class="keyword">return</span> Role<span class="class">.<span class="keyword">class</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//指定返回的对象是否为单例</span></span><br><span class="line">    <span class="comment">//true 指定为单例</span></span><br><span class="line">    <span class="comment">//false 指定为多例</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isSingleton</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--public interface FactoryBean&lt;T&gt;为spring的一个接口，只要是实现了这个接口的，都认为是一个工厂--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--IOC容器启动的时候并不会 创建该实例对象。只有获取的时候才会创建实例对象--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"myFactoryImpl"</span> <span class="attr">class</span>=<span class="string">"org.lc.factory.MyFactoryImp"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">      Role role =(Role)ioc.getBean(<span class="string">"myFactoryImpl"</span>);</span><br><span class="line">      Role role1 =(Role)ioc.getBean(<span class="string">"myFactoryImpl"</span>);</span><br><span class="line"><span class="comment">//true	</span></span><br><span class="line">      System.out.println(role==role1);</span><br><span class="line"><span class="comment">//Role(id=1, name=superuser, nameZh=超级用户)</span></span><br><span class="line">      System.out.println(role);</span><br></pre></td></tr></table></figure>

<h4 id="7、Bean的生命周期"><a href="#7、Bean的生命周期" class="headerlink" title="7、Bean的生命周期"></a>7、Bean的生命周期</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Role</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String nameZh;</span><br><span class="line">    <span class="comment">//构造器</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Role</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"创建...role"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">//初始化方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initRole</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"初始化role..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">//销毁方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destoryRole</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"销毁role..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="1-单例-默认singleton-："><a href="#1-单例-默认singleton-：" class="headerlink" title="1)单例(默认singleton)："></a>1)单例(默认<code>singleton</code>)：</h5><ul>
<li>单例的对象bean的执行顺序： <strong>(容器启动)构造器</strong>—&gt;  <strong>(容器启动)初始化方法(init-method指定的方法</strong>)—&gt;  (<strong>容器关闭)销毁方法 (destroy-method指定的方法)</strong><ul>
<li>容器启动时调用 <strong>构造器</strong> 和 <strong>初始化方法</strong>, 关闭容器调用close()后<strong>调用销毁方法</strong></li>
</ul>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--指定beans的初始化和销毁方法--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--init-method：指定该bean中的初始化方法，在对象创建时调用--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--destroy-method： 指定该bean的销毁方法。在容器销毁时调用--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"role1"</span> <span class="attr">class</span>=<span class="string">"org.lc.entity.Role"</span> <span class="attr">init-method</span>=<span class="string">"initRole"</span> <span class="attr">destroy-method</span>=<span class="string">"destoryRole"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ConfigurableApplicationContext ioc = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"ioc3.xml"</span>);</span><br><span class="line">System.out.println(<span class="string">"容器要关闭了..."</span>);</span><br><span class="line"><span class="comment">//ioc的关闭容器的方法</span></span><br><span class="line">ioc.close();</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">创建...role</span><br><span class="line">初始化role...</span><br><span class="line">容器要关闭了...</span><br><span class="line">销毁role...</span><br></pre></td></tr></table></figure>

<h5 id="2-多例-prototype"><a href="#2-多例-prototype" class="headerlink" title="2)多例(prototype):"></a>2)多例(<code>prototype</code>):</h5><ul>
<li>多例的对象在获取该对象时才会创建该Bean，即获取对象时调用  <strong>(获取bean时)构造方法</strong>—&gt; <strong>(获取bean时)初始化方法</strong> 。<strong>销毁方法使用完该bean后自动销毁</strong>，容器无需干预。<ul>
<li>对象的销毁不会在容器close()时销毁，该对象使用完自动销毁</li>
</ul>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--指定beans的初始化和销毁方法--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--init-method：指定该bean中的初始化方法，在对象创建时调用--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--destroy-method： 多例时，该实例不会销毁，自动销毁。--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"role1"</span> <span class="attr">class</span>=<span class="string">"org.lc.entity.Role"</span> <span class="attr">init-method</span>=<span class="string">"initRole"</span> <span class="attr">destroy-method</span>=<span class="string">"destoryRole"</span> <span class="attr">scope</span>=<span class="string">"prototype"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ConfigurableApplicationContext ioc = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"ioc3.xml"</span>);</span><br><span class="line">      Role role1 = (Role) ioc.getBean(<span class="string">"role1"</span>);</span><br><span class="line">      System.out.println(<span class="string">"容器要关闭了..."</span>);</span><br><span class="line">      <span class="comment">//ioc的关闭容器的方法</span></span><br><span class="line">      ioc.close();</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">创建...role</span><br><span class="line">初始化role...</span><br><span class="line">容器要关闭了...</span><br></pre></td></tr></table></figure>

<h5 id="3-bean的前置后置处理器"><a href="#3-bean的前置后置处理器" class="headerlink" title="3)bean的前置后置处理器"></a>3)bean的前置后置处理器</h5><p>在bean创建的时候，对实例对象进行的操作。</p>
<p><strong>单例在容器的启动的时候创建bean</strong></p>
<p><strong>多例在获取该bean的时候创建</strong></p>
<ul>
<li>自定义类实现<code>BeanPostProcessor</code>接口。并将该自定义<code>MyProcesserBean</code>处理器注册在bean.xml文件中</li>
<li>所有的bean实例都会在创建时使用该前置和后置处理器。</li>
<li><strong>调用bean构造器方法</strong>–&gt; <strong>调用bean的前置处理器(postProcessBeforeInitialization)</strong> –&gt;<strong>调用bean指定的初始化方法</strong>–&gt;<strong>调用的bean的后置处理器(postProcessAfterInitialization)</strong></li>
<li>若bean没有指定初始化方法则也可以正常使用该处理器</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Role</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String nameZh;</span><br><span class="line">    <span class="comment">//构造器</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Role</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"创建...role"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">//初始化方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initRole</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"初始化role..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">//销毁方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destoryRole</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"销毁role..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyProcesserBean</span> <span class="keyword">implements</span> <span class="title">BeanPostProcessor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * bean调用初始化方法之前的处理器</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> bean bean的构造方法创建的对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> beanName bean在xml中的id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 返回该对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> BeansException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">postProcessBeforeInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"bean初始化之前的处理器:beanname"</span> + beanName);</span><br><span class="line">        System.out.println(<span class="string">"----"</span>+bean);</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * bean调用初始化方法完成后的处理器</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> bean bean的构造方法创建的对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> beanName  bean在xml中的id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 返回该对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> BeansException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">postProcessAfterInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"bean初始化之前的处理器:beanname"</span> + beanName);</span><br><span class="line">        System.out.println(<span class="string">"----"</span>+bean);</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--为该bean指定 初始化执行的方法 和 销毁时执行的方法--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"role1"</span> <span class="attr">class</span>=<span class="string">"org.lc.entity.Role"</span> <span class="attr">init-method</span>=<span class="string">"initRole"</span> <span class="attr">destroy-method</span>=<span class="string">"destoryRole"</span> &gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--配置bean的初始化处理器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"myProcessBean"</span> <span class="attr">class</span>=<span class="string">"org.lc.factory.MyProcesserBean"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Role role1 = (Role) ioc.getBean(<span class="string">"role1"</span>);</span><br><span class="line">System.out.println(<span class="string">"获取bean===="</span>+role1);</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//调用bean的构造器时</span></span><br><span class="line">创建...role</span><br><span class="line">  </span><br><span class="line"><span class="comment">//调用bean的前置处理器  (在bean的指定的初始化方法之前调用)</span></span><br><span class="line">bean初始化之前的处理器:beannamerole1</span><br><span class="line">----Role(id=<span class="number">0</span>, name=<span class="keyword">null</span>, nameZh=<span class="keyword">null</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//调用bean的初始化方法</span></span><br><span class="line">初始化role...</span><br><span class="line"></span><br><span class="line"><span class="comment">//调用bean的后置处理器  (在bean的指定的初始化方法之后调用)</span></span><br><span class="line">bean初始化之前的处理器:beannamerole1</span><br><span class="line">----Role(id=<span class="number">0</span>, name=<span class="keyword">null</span>, nameZh=<span class="keyword">null</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取该bean实例</span></span><br><span class="line">获取bean====Role(id=<span class="number">0</span>, name=<span class="keyword">null</span>, nameZh=<span class="keyword">null</span>)</span><br></pre></td></tr></table></figure>

<h4 id="8、Spring管理连接池"><a href="#8、Spring管理连接池" class="headerlink" title="8、Spring管理连接池"></a>8、Spring管理连接池</h4><p>依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.18<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.46<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="1、通过xml配置连接池"><a href="#1、通过xml配置连接池" class="headerlink" title="1、通过xml配置连接池"></a>1、通过xml配置连接池</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"druidDataSource"</span> <span class="attr">class</span>=<span class="string">"com.alibaba.druid.pool.DruidDataSource"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"root"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"123456"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"jdbc:mysql://localhost:3306/test?serverTimezone=Asia/Shanghai<span class="symbol">&amp;amp;</span>useUnicode=true<span class="symbol">&amp;amp;</span>characterEncoding=UTF-8<span class="symbol">&amp;amp;</span>useSSL=false"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClassName"</span> <span class="attr">value</span>=<span class="string">"com.mysql.jdbc.Driver"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="2、引用外部文件抽取连接配置"><a href="#2、引用外部文件抽取连接配置" class="headerlink" title="2、引用外部文件抽取连接配置"></a>2、引用外部文件抽取连接配置</h5><p>classpath: 固定写法，加载类路径下的配置文件</p>
<p><code>&lt;context:property-placeholder location=&quot;classpath:jdbc.properties&quot; /&gt;</code></p>
<ul>
<li>注意  在配置<code>&lt;property name=&quot;username&quot; value=&quot;${jdbc.username}&quot;&gt;&lt;/property&gt;</code>的value时，不能写成value=”${username}”  因为username为spring中的一个内部属性(当前用户)。在前面加前缀即可</li>
</ul>
<blockquote>
<p>jdbc.properties</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">jdbc.username</span>=<span class="string">root</span></span><br><span class="line"><span class="meta">jdbc.password</span>=<span class="string">123456</span></span><br><span class="line"><span class="meta">jdbc.url</span>=<span class="string">jdbc:mysql://localhost:3306/test?serverTimezone=Asia/Shanghai&amp;useUnicode=true&amp;characterEncoding=UTF-8&amp;useSSL=false</span></span><br><span class="line"><span class="meta">jdbc.dirverClass</span>=<span class="string">com.mysql.jdbc.Driver</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--加载外部的properties配置文件--&gt;</span></span><br><span class="line">   <span class="comment">&lt;!--classpath: 固定写法，加载类路径下的配置文件--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">"classpath:jdbc.properties"</span> /&gt;</span></span><br><span class="line">  </span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"druidDataSource"</span> <span class="attr">class</span>=<span class="string">"com.alibaba.druid.pool.DruidDataSource"</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.username&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.password&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.url&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClassName"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.dirverClass&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
</blockquote>
<p><strong>测试：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ApplicationContext ioc = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"application.xml"</span>);</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Test1</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">    <span class="comment">//通过名称bean的id获取</span></span><br><span class="line">    <span class="comment">// DruidDataSource druidDataSource = (DruidDataSource) ioc.getBean("druidDataSource");</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//通过bean的类型获取(若存在多个类型相同的bena则会报错)</span></span><br><span class="line">    DruidDataSource druidDataSource = ioc.getBean(DruidDataSource<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    DruidPooledConnection connection = druidDataSource.getConnection();</span><br><span class="line">    <span class="comment">//com.mysql.jdbc.JDBC4Connection@6b67034</span></span><br><span class="line">    System.out.println(connection);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="9、基于xml的自动装配"><a href="#9、基于xml的自动装配" class="headerlink" title="9、基于xml的自动装配"></a>9、基于xml的自动装配</h4><blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String nameCar;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">double</span> moneyCar;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Role</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String nameZh;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">    <span class="keyword">private</span> String gender;</span><br><span class="line">    <span class="keyword">private</span> Car car;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Role&gt; roleList;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">(Car car)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.car = car;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<h5 id="1-手动装配"><a href="#1-手动装配" class="headerlink" title="1)手动装配"></a>1)手动装配</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"car1"</span> <span class="attr">class</span>=<span class="string">"org.lc.entity.Car"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"nameCar"</span> <span class="attr">value</span>=<span class="string">"奥迪双钻"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--手动赋值--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"person1"</span> <span class="attr">class</span>=<span class="string">"org.lc.entity.Person"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--通过property的ref引用bean为属性赋值--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"car"</span> <span class="attr">ref</span>=<span class="string">"car1"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="2-自动装配"><a href="#2-自动装配" class="headerlink" title="2)自动装配"></a>2)自动装配</h5><ul>
<li>autowire=”no/default” 不自动装配 不自动为属性赋值  </li>
<li>autowire=”byName”  通过属性名作为id去容器中找这个组件，找到则赋值，找不到赋值为null<pre><code>private Car car; 通过car名称作为id去找  相当于 getBean(&quot;car&quot;);            </code></pre></li>
<li>autowire=”byType”  通过类型去容器中寻找这个组件，找到一个则为其赋值，找到多个则报错。找不到则赋值为null<pre><code>pricate Car car; 通过Car类型寻找  相当于getBean(Car.class);            </code></pre></li>
<li>autowire=”constructor”  通过Person中的构造器进行寻找<pre><code>public Person(Car car) {}
先按照构造器参数的上的Car类型进行寻找，找到则装配，找不到则返回null
如果按照类型找到了多个，则按照构造器car参数名称进行寻找，找到则装配，找不到赋值为null
不会报错</code></pre></li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"car"</span> <span class="attr">class</span>=<span class="string">"org.lc.entity.Car"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"nameCar"</span> <span class="attr">value</span>=<span class="string">"奥迪双钻"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"car2"</span> <span class="attr">class</span>=<span class="string">"org.lc.entity.Car"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"nameCar"</span> <span class="attr">value</span>=<span class="string">"宝马"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--为Person中的自定义属性自动装配--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--通过autowire属性为对象中的所有属性(这里的属性必须为自定义的属性)自动装配--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--autowire:</span></span><br><span class="line"><span class="comment">        autowire="no/default" 不自动装配 不自动为属性赋值</span></span><br><span class="line"><span class="comment">        autowire="byName"  通过属性名作为id去容器中找这个组件，找到则赋值，找不到赋值为null</span></span><br><span class="line"><span class="comment">                    private Car car; 通过car名称作为id去找  相当于 getBean("car");</span></span><br><span class="line"><span class="comment">        autowire="byType"  通过类型去容器中寻找这个组件，找到一个则为其赋值，找到多个则报错。找不到则赋值为null</span></span><br><span class="line"><span class="comment">                    pricate Car car; 通过Car类型寻找  相当于getBean(Car.class);</span></span><br><span class="line"><span class="comment">        autowire="constructor"  通过Person中的构造器进行寻找</span></span><br><span class="line"><span class="comment">                    public Person(Car car) &#123;&#125;</span></span><br><span class="line"><span class="comment">                    先按照构造器参数的上的Car类型进行寻找，找到则装配，找不到则返回null</span></span><br><span class="line"><span class="comment">                    如果按照类型找到了多个，则按照构造器car参数名称进行寻找，找到则装配，找不到赋值为null</span></span><br><span class="line"><span class="comment">                    不会报错</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"person1"</span> <span class="attr">class</span>=<span class="string">"org.lc.entity.Person"</span> <span class="attr">autowire</span>=<span class="string">"byName"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h6 id="装配list集合"><a href="#装配list集合" class="headerlink" title="装配list集合"></a>装配list集合</h6><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"person1"</span> <span class="attr">class</span>=<span class="string">"org.lc.entity.Person"</span> <span class="attr">autowire</span>=<span class="string">"byType"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--下面的三个Role对象都会装配到 List&lt;Role&gt; roleList; 集合中--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"role1"</span> <span class="attr">class</span>=<span class="string">"org.lc.entity.Role"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"nameZh"</span> <span class="attr">value</span>=<span class="string">"测试1"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"role2"</span> <span class="attr">class</span>=<span class="string">"org.lc.entity.Role"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"nameZh"</span> <span class="attr">value</span>=<span class="string">"测试2"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"role3"</span> <span class="attr">class</span>=<span class="string">"org.lc.entity.Role"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"nameZh"</span> <span class="attr">value</span>=<span class="string">"测试3"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="10、SPEL表达式-表达式"><a href="#10、SPEL表达式-表达式" class="headerlink" title="10、SPEL表达式(#表达式)"></a>10、SPEL表达式(#表达式)</h4><p>Spring Expression Language (spring表达式语言)</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"car1"</span> <span class="attr">class</span>=<span class="string">"org.lc.entity.Car"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">value</span>=<span class="string">"111"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"nameCar"</span> <span class="attr">value</span>=<span class="string">"丰田"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"moneyCar"</span> <span class="attr">value</span>=<span class="string">"100000"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"person2"</span> <span class="attr">class</span>=<span class="string">"org.lc.entity.Person"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--计算值--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">value</span>=<span class="string">"#&#123;2*10*10&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--引用其他bean的属性值--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">value</span>=<span class="string">"#&#123;car1.nameCar&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--引用其他bean  和ref属性值一样--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"car"</span> <span class="attr">value</span>=<span class="string">"#&#123;car1&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--调用静态方法和非静态方法--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--语法规则:</span></span><br><span class="line"><span class="comment">        #&#123;T(静态类全类名).静态方法名(参数)&#125;</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"gender"</span> <span class="attr">value</span>=<span class="string">"#&#123;T(java.util.UUID).randomUUID().toString().substring(0,5)&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--调用非静态方法--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"age"</span> <span class="attr">value</span>=<span class="string">"#&#123;car1.getId()&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">       Person person1 = (Person) ioc.getBean(<span class="string">"person2"</span>);</span><br><span class="line"><span class="comment">//Person(id=200, name=丰田, age=111, gender=e57b0, car=Car(id=111, nameCar=丰田, moneyCar=100000.0), roleList=null)</span></span><br><span class="line">        System.out.println(person1);</span><br></pre></td></tr></table></figure>

<h4 id="11、通过注解创建Dao-Service-Controller"><a href="#11、通过注解创建Dao-Service-Controller" class="headerlink" title="11、通过注解创建Dao,Service,Controller"></a>11、通过注解创建Dao,Service,Controller</h4><ul>
<li><p><strong>@Controller</strong>   一般加到控制器类上</p>
</li>
<li><p><strong>@Service</strong> 一般加到服务层上service</p>
</li>
<li><p><strong>@Repository</strong>  一般应用到持久层Dao</p>
</li>
<li><p><strong>@Component</strong>  不属于以上三层时加该注解</p>
</li>
</ul>
<p>上面所有的注解效果都是一样的，只是方便标识和查看</p>
<ul>
<li>默认被以上组件标记的bean声明都是<strong>单例类型</strong></li>
<li>bean的id名默认为<strong>类名首字母小写</strong>。 即<code>UserController</code>的id名 <code>userController</code></li>
</ul>
<blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserDao</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<h5 id="1-扫描指定所有带注解的包"><a href="#1-扫描指定所有带注解的包" class="headerlink" title="1)扫描指定所有带注解的包"></a>1)扫描指定所有带注解的包</h5><blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--扫描所有声明带注解到容器中的包--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--base-package 指定扫描基础包路径--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"org.lc"</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br></pre></td></tr></table></figure>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">      UserController userController1 = (UserController) ioc.getBean(<span class="string">"userController"</span>);</span><br><span class="line">      UserController userController2 = (UserController) ioc.getBean(<span class="string">"userController"</span>);</span><br><span class="line"><span class="comment">//true</span></span><br><span class="line">      System.out.println(userController1==userController2);</span><br></pre></td></tr></table></figure>

<h5 id="2-为指定组件指定id名称"><a href="#2-为指定组件指定id名称" class="headerlink" title="2)为指定组件指定id名称"></a>2)为指定组件指定id名称</h5><p>若注解中只有一个value属性则可省略    </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span>(value = <span class="string">"controller1"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UserController userController1 = (UserController) ioc.getBean(<span class="string">"controller1"</span>);</span><br></pre></td></tr></table></figure>

<h5 id="3-指定bean的作用域-单例，多例"><a href="#3-指定bean的作用域-单例，多例" class="headerlink" title="3)指定bean的作用域(单例，多例)"></a>3)指定bean的作用域(单例，多例)</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span>(value = <span class="string">"controller1"</span>)</span><br><span class="line"><span class="meta">@Scope</span>(value = <span class="string">"prototype"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">      UserController userController1 = (UserController) ioc.getBean(<span class="string">"controller1"</span>);</span><br><span class="line">      UserController userController2 = (UserController) ioc.getBean(<span class="string">"controller1"</span>);</span><br><span class="line"><span class="comment">//false</span></span><br><span class="line">      System.out.println(userController1==userController2);</span><br></pre></td></tr></table></figure>

<h5 id="4-排除扫描不包含的组件context-exclude-filter"><a href="#4-排除扫描不包含的组件context-exclude-filter" class="headerlink" title="4)排除扫描不包含的组件context:exclude-filter"></a>4)排除扫描不包含的组件<code>context:exclude-filter</code></h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--扫描声明为到容器中的包--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--base-package 指定扫描基础包路径--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--默认全部扫描--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"org.lc"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--扫描时排除一些不要的组件--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--type="assignable"  指定排除规则，排除某个具体的类，按照类排除</span></span><br><span class="line"><span class="comment">                expression=""  该类所在的全类名</span></span><br><span class="line"><span class="comment">        type="annotation"  指定排除规则，按照注解排除指定类</span></span><br><span class="line"><span class="comment">                expression=""  该注解的全类名</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:exclude-filter</span> <span class="attr">type</span>=<span class="string">"assignable"</span> <span class="attr">expression</span>=<span class="string">"org.lc.dao.UserDao"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:exclude-filter</span> <span class="attr">type</span>=<span class="string">"annotation"</span> <span class="attr">expression</span>=<span class="string">"org.springframework.stereotype.Service"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="5-扫描包含指定的组件context-include-filter"><a href="#5-扫描包含指定的组件context-include-filter" class="headerlink" title="5)扫描包含指定的组件context:include-filter"></a>5)扫描包含指定的组件<code>context:include-filter</code></h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--扫描声明为到容器中的包--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--base-package 指定扫描基础包路径--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--默认全部扫描--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--注意：这里默认扫描全部，我们要禁用use-default-filters默认的扫描规则，否则还是全部扫描进来了--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"org.lc"</span> <span class="attr">use-default-filters</span>=<span class="string">"false"</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- 值包含标有@Controller注解的类--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">context:include-filter</span> <span class="attr">type</span>=<span class="string">"annotation"</span> <span class="attr">expression</span>=<span class="string">"org.springframework.stereotype.Controller"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="12、-Autowired自动装配原理"><a href="#12、-Autowired自动装配原理" class="headerlink" title="12、@Autowired自动装配原理"></a>12、@Autowired自动装配原理</h4><ul>
<li><p>首先按照注入的类型(UserService)去IOC容器中查找对应的组件，若找到则装配，找不到抛异常</p>
<ul>
<li><pre><code>ioc.getBean(UserService.class);
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 若找到多个，则按照注入的属性名称(userService)作为bean的id去容器中查找，找到则装配，找不到，抛异常</span><br><span class="line"></span><br><span class="line">  - &#96;&#96;&#96;java</span><br><span class="line">    @Autowired</span><br><span class="line">     private UserService userService;</span><br></pre></td></tr></table></figure>
</code></pre></li>
</ul>
</li>
</ul>
<blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="comment">//默认bean的id   userService</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"执行查找用户..UserService"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="comment">////默认bean的id   userServiceExc</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceExc</span> <span class="keyword">extends</span> <span class="title">UserService</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"执行查找用户..UserServiceExc"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line">    <span class="comment">//注入类型  </span></span><br><span class="line">    <span class="comment">//默认按照类型到IOC容器中查找，若找到多个，则以属性名userService作为id去容器中查找指定id的bean。若没找到则抛出异常</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        userService.getUser();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">      UserController userController = (UserController) ioc.getBean(<span class="string">"userController"</span>);</span><br><span class="line"><span class="comment">//执行查找用户..UserService</span></span><br><span class="line">      userController.getUser();</span><br></pre></td></tr></table></figure>

<h5 id="1-配合-Qualifier使用"><a href="#1-配合-Qualifier使用" class="headerlink" title="1)配合@Qualifier使用"></a>1)配合@Qualifier使用</h5><p>若使用@Autowired找到多个类型，注入时不想通过默认属性名作为id寻找，那么直接可以使用@Qualifier按照其指定的名称去容器中找知道的bean</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Qualifier</span>(<span class="string">"userServiceExc"</span>)</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="comment">//若找到多个类型，不想用属性名称作为id查找，则可以直接使用@Qualifier注解中指定的名称查找</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        userService.getUser();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//执行查找用户..UserServiceExc        </span></span><br><span class="line">UserController userController = (UserController) ioc.getBean(UserController<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">userController.getUser();</span><br></pre></td></tr></table></figure>

<h5 id="2-指定-Autowired-required-false"><a href="#2-指定-Autowired-required-false" class="headerlink" title="2)指定@Autowired(required = false)"></a>2)指定<code>@Autowired(required = false)</code></h5><p>若指定@Qualifier还找不到，则将该属性装配为null。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Qualifier</span>(<span class="string">"userServiceExc111"</span>)</span><br><span class="line">    <span class="meta">@Autowired</span>(required = <span class="keyword">false</span>)</span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//UserService:null</span></span><br><span class="line">        System.out.println(<span class="string">"UserService:"</span>+userService);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="3-在方法参数上使用-Autowired和-Qualifier"><a href="#3-在方法参数上使用-Autowired和-Qualifier" class="headerlink" title="3)在方法参数上使用@Autowired和@Qualifier"></a>3)在方法参数上使用@Autowired和@Qualifier</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//容器启动时 会运行此方法</span></span><br><span class="line">    <span class="comment">//自动为为 UserDao和UserService进行装配</span></span><br><span class="line">    <span class="comment">//用法和在属性上一致</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getUser</span><span class="params">(UserDao userDao,@Qualifier(<span class="string">"userServiceExc"</span>)</span>UserService userService) </span>&#123;</span><br><span class="line">        <span class="comment">//userDao:org.lc.dao.UserDao@56a6d5a6</span></span><br><span class="line">        System.out.println(<span class="string">"userDao:"</span>+userDao);</span><br><span class="line">        <span class="comment">//UserService:org.lc.service.UserServiceExc@18ce0030</span></span><br><span class="line">        System.out.println(<span class="string">"UserService:"</span>+userService);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="13、-Resource自动装配与-Autowired的区别"><a href="#13、-Resource自动装配与-Autowired的区别" class="headerlink" title="13、@Resource自动装配与@Autowired的区别"></a>13、@Resource自动装配与@Autowired的区别</h4><h5 id="1-Autowired"><a href="#1-Autowired" class="headerlink" title="1)@Autowired"></a>1)@Autowired</h5><p>用来装配bean, 可作用于字段上, 也可以作用于setter方法上.</p>
<p>是<strong>Spring的注解.</strong> 即<strong>只能在spring框架中使用</strong></p>
<ul>
<li><p>默认情况下要求对象必须存在, 它要求依赖对象必须存在. 若允许null值, 可以设置它的required为false.</p>
</li>
<li><p>默认按照类型byType进行装配注入. 如果想按照名称进行装配的话, 需要与Qualifer注解搭配使用</p>
</li>
</ul>
<h5 id="2-Resource"><a href="#2-Resource" class="headerlink" title="2)@Resource"></a>2)@Resource</h5><p>是<strong>J2EE的注解</strong>. <strong>扩展性更强，可以用在其他框架上</strong>。 所有<em>不能应用@Autowired中的required属性和@Primary注解</em></p>
<ul>
<li>默认按照名称来装配注入,若找到多个相同的名称则抛异常，若找不到则按照bean的类型来找，若找到多个bean类型也抛异常</li>
</ul>
<p>它有两个属性是比较重要的:</p>
<ul>
<li>name: Spring将name的属性值解析为bean的名称, 使用byName的自动注入策略</li>
<li>type: Spring将type的属性值解析为bean的类型, 使用byType的自动注入策略，如果既不指定name属性又不指定type属性, Spring这时通过反射机制默认使用byName自动注入策略</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//默认按照属性名称redisTemplate做为bean的id去容器中找，找到多个抛异常</span></span><br><span class="line"><span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">private</span> RedisTemplate redisTemplate;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//通过type属性注入，则先按照类型找，若找到多个则按照属性名称找</span></span><br><span class="line"><span class="meta">@Resource</span>(type = RedisTemplate<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class"><span class="title">private</span> <span class="title">RedisTemplate</span> <span class="title">redisTemplate</span></span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//通过name，type属性注入  同时按照类型和名称找  找不到抛异常</span></span><br><span class="line"><span class="meta">@Resource</span>(name = <span class="string">"RedisTemplate"</span>,type = RedisTemplate<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class"><span class="title">private</span> <span class="title">RedisTemplate</span> <span class="title">redisTemplate</span></span>;</span><br></pre></td></tr></table></figure>

<h4 id="14、Spring的单元测试"><a href="#14、Spring的单元测试" class="headerlink" title="14、Spring的单元测试"></a>14、Spring的单元测试</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">   <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>    </span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.2.5.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//classpath: 使用指定的xml文件</span></span><br><span class="line"><span class="meta">@ContextConfiguration</span>(locations = <span class="string">"classpath:application.xml"</span>)</span><br><span class="line"><span class="comment">//使用junit4测试</span></span><br><span class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">SpringTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserController userController;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Test</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(userController);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="15、泛型依赖注入"><a href="#15、泛型依赖注入" class="headerlink" title="15、泛型依赖注入"></a>15、泛型依赖注入</h4><p><strong>Dao:</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span>  <span class="class"><span class="keyword">class</span> <span class="title">BaseDao</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookDao</span> <span class="keyword">extends</span> <span class="title">BaseDao</span>&lt;<span class="title">Book</span>&gt;</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"BookDao...保存图书"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserDao</span> <span class="keyword">extends</span> <span class="title">BaseDao</span>&lt;<span class="title">User</span>&gt;</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"UserDao...保存用户"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Service:</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//这里并不用注册为bean对象 因为我们的继承该BaseService的对象已经注册为bean</span></span><br><span class="line"><span class="comment">// 虽然不能够使用private BaseDao&lt;T&gt; baseDao;属性和public void save() &#123;&#125;方法，但是能够继承此方法和属性。</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseService</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//泛型依赖注入，注入一个组件的时候，他的泛型也是参考标准</span></span><br><span class="line">    <span class="comment">//即指定的T为User时 会在容器中寻找 BaseDao&lt;User&gt;类型的对象</span></span><br><span class="line">    <span class="comment">//即指定的T为Book时 会在容器中寻找 BaseDao&lt;Book&gt;类型的对象</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> BaseDao&lt;T&gt; baseDao;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"自动注入的dao:"</span>+baseDao);</span><br><span class="line">        baseDao.save();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookService</span> <span class="keyword">extends</span> <span class="title">BaseService</span>&lt;<span class="title">Book</span>&gt;</span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserService</span> <span class="keyword">extends</span> <span class="title">BaseService</span>&lt;<span class="title">User</span>&gt; </span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<p><strong>测试：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> BookService bookService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Test</span><span class="params">()</span></span>&#123;</span><br><span class="line">    userService.save();</span><br><span class="line">    bookService.save();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">自动注入的dao:org.lc.dao.UserDao@<span class="number">3</span>c19aaa5</span><br><span class="line">UserDao...保存用户</span><br><span class="line">自动注入的dao:org.lc.dao.BookDao@<span class="number">3349e9</span>bb</span><br><span class="line">BookDao...保存图书</span><br></pre></td></tr></table></figure>

<h4 id="16、BeanFactory和ApplicationContext的区别-面试"><a href="#16、BeanFactory和ApplicationContext的区别-面试" class="headerlink" title="16、BeanFactory和ApplicationContext的区别(面试)"></a>16、BeanFactory和ApplicationContext的区别(面试)</h4><img src="http://img.louchen.top/2020/07/20200713093056.png" style="zoom:67%;" />

<ul>
<li><p>ApplicationContext是BeanFactory的子接口</p>
</li>
<li><p>BeanFactory：bean工厂接口；负责创建bean实例；容器里面保存的所有单实例bean起始是一个map(concurrentHashMap)；也是spring最底层的接口</p>
</li>
<li><p>ApplicationContext：是容器接口；更多的负责容器功能的实现；可以基于BeanFactory创建好的对象之上完成强大的容器，容器可以从map中获取这个bean并进行AOP,DI    </p>
</li>
<li><p>BeanFactory是最底层的接口，ApplicationContext留给程序员使用的IOC容器接口；</p>
</li>
<li><p>Spring中最大的模式就是工厂模式</p>
<ul>
<li>通过在xml里面配置bean来让BeanFactory帮用户创建bean</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">""</span> <span class="attr">id</span>=<span class="string">""</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="17、Bean的生命周期-初始化流程-面试"><a href="#17、Bean的生命周期-初始化流程-面试" class="headerlink" title="17、Bean的生命周期(初始化流程)面试"></a>17、Bean的生命周期(初始化流程)面试</h4><p>简单流程 <a href="https://www.jb51.net/article/154487.htm">https://www.jb51.net/article/154487.htm</a></p>
<ul>
<li>Bean 容器找到配置文件中 Spring Bean 的定义。</li>
<li>Bean 容器利用 Java Reflection API 创建一个Bean的实例。</li>
<li>如果涉及到一些属性值 利用 <code>set()</code>方法设置一些属性值。</li>
<li>如果 Bean 实现了 <code>BeanNameAware</code> 接口，调用 <code>setBeanName()</code>方法，传入Bean的名字。</li>
<li>如果 Bean 实现了 <code>BeanClassLoaderAware</code> 接口，调用 <code>setBeanClassLoader()</code>方法，传入 <code>ClassLoader</code>对象的实例。</li>
<li>与上面的类似，如果实现了其他 <code>*.Aware</code>接口，就调用相应的方法。</li>
<li>如果有和加载这个 Bean 的 Spring 容器相关的 <code>BeanPostProcessor</code> 对象，执行<code>postProcessBeforeInitialization()</code> 方法</li>
<li>如果Bean实现了<code>InitializingBean</code>接口，执行<code>afterPropertiesSet()</code>方法。</li>
<li>如果 Bean 在配置文件中的定义包含 init-method 属性，执行指定的方法。</li>
<li>如果有和加载这个 Bean的 Spring 容器相关的 <code>BeanPostProcessor</code> 对象，执行<code>postProcessAfterInitialization()</code> 方法</li>
<li>当要销毁 Bean 的时候，如果 Bean 实现了 <code>DisposableBean</code> 接口，执行 <code>destroy()</code> 方法。</li>
<li>当要销毁 Bean 的时候，如果 Bean 在配置文件中的定义包含 destroy-method 属性，执行指定的方法。</li>
</ul>
<img src="http://img.louchen.top/2020/07/20200722164935.png" style="zoom:80%;" />

<h3 id="二、AOP"><a href="#二、AOP" class="headerlink" title="二、AOP"></a>二、AOP</h3><h4 id="1、基本概念"><a href="#1、基本概念" class="headerlink" title="1、基本概念"></a>1、基本概念</h4><ul>
<li>AOP（Aspect Oriented Programming）称为面向切面编程，在程序开发中主要用来解决一些系统层面上的问题，比如日志，事务，权限等待</li>
<li>在不改变原有的逻辑的基础上，增加一些额外的功能。代理也是这个功能，读写分离也能用aop来做。</li>
<li>将<strong>某段代码</strong><font color=red><strong>动态</strong></font >的切入到<strong>指定方法</strong>的<strong>指定位置</strong>进行运行的这种编程方式，称为面向切面编程</li>
</ul>
<h5 id="AOP与OOP区别？"><a href="#AOP与OOP区别？" class="headerlink" title="AOP与OOP区别？"></a>AOP与OOP区别？</h5><p>AOP可以说是OOP（Object Oriented Programming，面向对象编程）的补充和完善。</p>
<ul>
<li><p>OOP引入封装、继承、多态等概念来建立一种对象层次结构，用于模拟公共行为的一个集合。不过OOP允许开发者定义纵向的关系，但并不适合定义横向的关系，例如日志功能。日志代码往往横向地散布在所有对象层次中，而与它对应的对象的核心功能毫无关系对于其他类型的代码，如安全性、异常处理和透明的持续性也都是如此，这种散布在各处的无关的代码被称为横切（cross cutting），在OOP设计中，它导致了大量代码的重复，而不利于各个模块的重用。</p>
</li>
<li><p>AOP技术恰恰相反，它利用一种称为”横切”的技术，剖解开封装的对象内部，并将那些影响了多个类的公共行为封装到一个可重用模块，并将其命名为”Aspect”，即切面。所谓”切面”，简单说就是那些与业务无关，却为业务模块所共同调用的逻辑或责任封装起来，便于减少系统的重复代码，降低模块之间的耦合度，并有利于未来的可操作性和可维护性。</p>
</li>
</ul>
<h4 id="2、使用场景"><a href="#2、使用场景" class="headerlink" title="2、使用场景"></a>2、使用场景</h4><p>例如<strong>日志记录</strong>，在不改变源代码的情况下动态的加入到指定方法的指定位置</p>
<h5 id="1-基于接口的jdk动态代理实现"><a href="#1-基于接口的jdk动态代理实现" class="headerlink" title="1)基于接口的jdk动态代理实现"></a>1)基于接口的jdk动态代理实现</h5><p>目标对象需要实现一个接口对象，我们的代理对象无需实现接口对象，但是在底层<strong>仍然是通过反射来实现代理对象实现相应的接口</strong></p>
<blockquote>
<p>接口对象</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Caculate</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">substract</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">multiply</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">divide</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>目标对象</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CaculateImpl</span> <span class="keyword">implements</span> <span class="title">Caculate</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//int c=1/0;</span></span><br><span class="line">        <span class="keyword">return</span> a+b;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">substract</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a-b;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">multiply</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a-b;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">divide</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a/b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>获取代理对象</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProxyInstance</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Object object;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ProxyInstance</span><span class="params">(Object object)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.object = object;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//获取代理对象</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">getProxyInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Proxy.newProxyInstance(object.getClass().getClassLoader(), object.getClass().getInterfaces(), (proxy, method, args) -&gt; &#123;</span><br><span class="line">            Object invoke=<span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">"执行:【"</span> + method.getName() + <span class="string">"】方法之前的记录"</span>);</span><br><span class="line">                invoke = method.invoke(object, args);</span><br><span class="line">                System.out.println(<span class="string">"执行:【"</span> + method.getName() + <span class="string">"】方法之后的记录,方法的参数为:【"</span> + Arrays.toString(args) + <span class="string">"】,方法的结果为【"</span> + invoke + <span class="string">"】"</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                System.out.println(<span class="string">"方法抛出的异常为:【"</span>+e.getCause()+<span class="string">"】"</span>);</span><br><span class="line">            &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">"总要执行的记录...."</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">"方法返回结果之前的记录..."</span>);</span><br><span class="line">            <span class="keyword">return</span> invoke;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ProxyInstance proxyInstance = <span class="keyword">new</span> ProxyInstance(<span class="keyword">new</span> CaculateImpl());</span><br><span class="line">        <span class="comment">//获取代理对象时，实际还是在底层为我们的目标对象创建了一个代理对象实现相同的接口。</span></span><br><span class="line">        <span class="comment">//所以这里我们需要使用接口对象带接收返回值</span></span><br><span class="line">        Caculate instance = ((Caculate) proxyInstance.getProxyInstance());</span><br><span class="line">        <span class="keyword">int</span> add = instance.add(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">        System.out.println(add);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">执行:【add】方法之前的记录</span><br><span class="line">执行:【add】方法之后的记录,方法的参数为:【[<span class="number">1</span>, <span class="number">2</span>]】,方法的结果为【<span class="number">3</span>】</span><br><span class="line">总要执行的记录....</span><br><span class="line">方法返回结果之前的记录...</span><br><span class="line"><span class="number">3</span></span><br></pre></td></tr></table></figure>

<h4 id="3、专业术语解释"><a href="#3、专业术语解释" class="headerlink" title="3、专业术语解释"></a>3、专业术语解释</h4><img src="http://img.louchen.top/2020/07/20200711113308.png" style="zoom: 67%;" />



<ul>
<li><p>(1)横切关注点：对哪些方法进行拦截，拦截后怎么处理，这些关注点称之为横切关注点</p>
</li>
<li><p>(2)<strong>Aspect(切面)</strong>:通常是一个类，里面可以定义切入点和通知</p>
</li>
<li><p>(3)JointPoint(连接点):程序执行过程中明确的点，一般是方法的调用。被拦截到的点，因为Spring只支持方法类型的连接点，所以在  Spring中连接点指的就是被拦截到的方法，实际上连接点还可以是字段或者构造器</p>
</li>
<li><p>(4)<strong>Advice(通知):</strong>AOP在特定的切入点上执行的增强处理，有before(前置),after(后置),afterReturning(最终),afterThrowing(异常),around(环绕)</p>
</li>
<li><p>(5)<strong>Pointcut(切入点)</strong>:就是带有通知的连接点，在程序中主要体现为书写<strong>切入点表达式</strong></p>
</li>
<li><p>(6)weave(织入)：将切面应用到目标对象并导致代理对象创建的过程</p>
</li>
<li><p>(7)introduction(引入)：在不修改代码的前提下，引入可以在<strong>运行期</strong>为类动态地添加一些方法或字段</p>
</li>
<li><p>(8)AOP代理(AOP Proxy)：AOP框架创建的对象，代理就是目标对象的加强。Spring中的AOP代理可以使JDK动态代理，也可以是CGLIB代理，前者基于接口，后者基于子类</p>
</li>
<li><p>(9)目标对象（Target Object）: 包含连接点的对象。也被称作被通知或被代理对象。POJO</p>
</li>
</ul>
<h4 id="4、AOP简单配置流程"><a href="#4、AOP简单配置流程" class="headerlink" title="4、AOP简单配置流程"></a>4、AOP简单配置流程</h4><h5 id="配置流程："><a href="#配置流程：" class="headerlink" title="配置流程："></a>配置流程：</h5><ul>
<li><p>1)<strong>将目标类和切面类</strong>(封装了通知方法，切入点方法(切点表达式))<strong>加入到IOC容器中</strong> </p>
</li>
<li><p>2)指定切面类加上<strong>@Aspect</strong>注解</p>
</li>
<li><p>3)告诉Spring切面中的通知(执行方法)在什么时候运行</p>
<ul>
<li><p><strong>@Before</strong> 在目标方法执行之前运行</p>
</li>
<li><p><strong>@After</strong> 在目标方法结束(<strong>无论目标方法是否成功完成</strong>)之后运行</p>
</li>
<li><p><strong>@AfterReturning</strong>  在目标方法<strong>正常完成后</strong>之后运行</p>
</li>
<li><p><strong>@AfterThrowing</strong> 在目标方法抛出异常之后运行</p>
</li>
<li><p><strong>@Around</strong> 环绕通知</p>
</li>
<li><p>相当于：</p>
<ul>
<li><pre><code class="java">            Object invoke=<span class="keyword">null</span>;
            <span class="keyword">try</span> {
                <span class="comment">//@Before</span>
                invoke = method.invoke(object, args);
                 <span class="comment">//@AfterReturning</span>
            } <span class="keyword">catch</span> (Exception e) {
               <span class="comment">//@AfterThrowing</span>
            }<span class="keyword">finally</span> {
               <span class="comment">//@After</span>
            }
            <span class="keyword">return</span> invoke;
&lt;!--￼<span class="number">110</span>--&gt;</code></pre>
</li>
</ul>
</li>
<li><pre><code class="java"><span class="comment">// 在org.lc.aop.CaculateImpl类下的所有方法为pulibc修饰符,返回类型为int,参数为两个int类型的所有方法加上前置通知</span>
<span class="meta">@Before</span>(<span class="string">"execution(public int org.lc.aop.CaculateImpl.*(int,int))"</span>)
&lt;!--￼<span class="number">111</span>--&gt;
</code></pre>
</li>
</ul>
</li>
</ul>
<h5 id="测试："><a href="#测试：" class="headerlink" title="测试："></a><strong>测试：</strong></h5><h6 id="1-目标对象实现了接口-jdk动态代理"><a href="#1-目标对象实现了接口-jdk动态代理" class="headerlink" title="1)目标对象实现了接口(jdk动态代理)"></a>1)目标对象实现了接口(jdk动态代理)</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Caculate</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">substract</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">multiply</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">divide</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CaculateImpl</span> <span class="keyword">implements</span> <span class="title">Caculate</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a+b;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">substract</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a-b;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">multiply</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a-b;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">divide</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a/b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//切面类</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LogUtils</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span>(<span class="string">"execution(public int org.lc.aop.CaculateImpl.*(int,int))"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">startLog</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"执行:【"</span> + <span class="string">"method.getName()"</span> + <span class="string">"】方法之前的记录"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterReturning</span>(<span class="string">"execution(public int org.lc.aop.CaculateImpl.*(int,int))"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">returnLog</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"执行:【"</span> + <span class="string">"method.getName()"</span> + <span class="string">"】方法之后的记录,方法的参数为:【"</span> +<span class="string">" Arrays.toString(args)"</span> + <span class="string">"】,方法的结果为【"</span> + <span class="string">"invoke "</span>+ <span class="string">"】"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterThrowing</span>(<span class="string">"execution(public int org.lc.aop.CaculateImpl.*(int,int))"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">exceptionLog</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"方法抛出的异常为:【"</span>+<span class="string">"e.getCause()"</span>+<span class="string">"】"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@After</span>(<span class="string">"execution(public int org.lc.aop.CaculateImpl.*(int,int))"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">finallyLog</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"总要执行的记录...."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">   <span class="comment">&lt;!--扫描org.lc所有包--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"org.lc"</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!--开启基于注解的AOP注解--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:aspectj-autoproxy</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">   <span class="comment">//注入接口</span></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">   <span class="keyword">private</span> Caculate caculate;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Test</span><span class="params">()</span></span>&#123;</span><br><span class="line">       caculate.add(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">      <span class="comment">//class com.sun.proxy.$Proxy25</span></span><br><span class="line">       System.out.println(caculate.getClass());</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">执行:【method.getName()】方法之前的记录</span><br><span class="line">总要执行的记录....</span><br><span class="line">执行:【method.getName()】方法之后的记录,方法的参数为:【 Arrays.toString(args)】,方法的结果为【invoke 】</span><br></pre></td></tr></table></figure>

<ul>
<li>若目标对象实现了接口，则使用的是jdk动态代理来实现AOP</li>
<li>通过注入<strong>接口对象来使用</strong>，通过<code>caculate.getClass()</code> 方法我们可以发现，AOP底层还是为我们创建了一个代理对象来实现相同的接口的。</li>
</ul>
<h6 id="2-目标对象没有实现接口-cglib代理"><a href="#2-目标对象没有实现接口-cglib代理" class="headerlink" title="2)目标对象没有实现接口(cglib代理)"></a>2)目标对象没有实现接口(cglib代理)</h6><ul>
<li><p>若我们的目标对象没有实现接口，则使用的是cglib代理，默认为我们的<strong>目标类创建了一个内部类作为子类来实现代理</strong>-</p>
</li>
<li><p>通过注入本类使用。</p>
</li>
</ul>
<p>只对<code>CaculateImpl</code>类做修改：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CaculateImpl</span></span>&#123;  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a+b;</span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">substract</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a-b;</span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">multiply</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a-b;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">divide</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a/b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> CaculateImpl caculate;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Test</span><span class="params">()</span></span>&#123;</span><br><span class="line">    caculate.add(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">    <span class="comment">//class org.lc.aop.CaculateImpl$$EnhancerBySpringCGLIB$$92c177be</span></span><br><span class="line">    System.out.println(caculate.getClass());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="5、切点表达式详解"><a href="#5、切点表达式详解" class="headerlink" title="5、切点表达式详解"></a>5、切点表达式详解</h4><p><code>@Before(&quot;execution(访问修饰符 返回类型 类的全路径名.方法名(参数类型1,参数类型2...))&quot;)</code></p>
<p><strong>1)匹配一个或多个字符</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Before</span>(<span class="string">"execution(public int org.lc.aop.CaculateIm*.*(int,int))"</span>)</span><br></pre></td></tr></table></figure>

<p><strong>2)匹配任意一个参数，第一个是int类型，第二个任意参数类型（匹配两个参数）</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Before</span>(<span class="string">"execution(public int org.lc.aop.CaculateIm*.*(int,*))"</span>)</span><br></pre></td></tr></table></figure>

<p><strong>3)匹配任意多个参数，任意参数类型</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Before</span>(<span class="string">"execution(public int org.lc.aop.CaculateIm*.*(..))"</span>)</span><br></pre></td></tr></table></figure>

<p><strong>4)匹配一层路径</strong></p>
<p>即 aop和CaculateIm之间最多有一层路径</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Before</span>(<span class="string">"execution(public int org.lc.aop.*.CaculateIm*.*(int,*))"</span>)</span><br></pre></td></tr></table></figure>

<p><strong>5)匹配多层路径</strong></p>
<p>即 aop和CaculateIm之间可以有任意层路径</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Before</span>(<span class="string">"execution(public int org.lc.aop..CaculateIm*.*(int,*))"</span>)</span><br></pre></td></tr></table></figure>

<p><strong>6)访问修饰符的位置不能写 * ，权限位置不写就行。 public关键字可选</strong></p>
<p><strong>7)最模糊的匹配(最好不要这样写)</strong></p>
<p>任意包下的任意方法的任意参数的任意返回值</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Before</span>(<span class="string">"execution(* *.*(..))"</span>)</span><br></pre></td></tr></table></figure>

<p><strong>8)满足多个表达式&amp;&amp;</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">execution(<span class="keyword">public</span> <span class="keyword">int</span> org.lc.aop.CaculateIm*.*(..))&amp;&amp;execution(<span class="keyword">public</span> <span class="keyword">int</span> org.lc.aop.CaculateIm*.*(<span class="keyword">int</span>,<span class="keyword">int</span>))</span><br></pre></td></tr></table></figure>

<p><strong>8)满足一个表达式 ||</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">execution(<span class="keyword">public</span> <span class="keyword">int</span> org.lc.aop.CaculateIm*.*(<span class="keyword">int</span>,<span class="keyword">double</span>))||execution(<span class="keyword">public</span> <span class="keyword">int</span> org.lc.aop.CaculateIm*.*(<span class="keyword">int</span>,<span class="keyword">int</span>))</span><br></pre></td></tr></table></figure>

<p><strong>9)不满足表达式</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">!execution(<span class="keyword">public</span> <span class="keyword">int</span> org.lc.aop.CaculateIm*.*(..))</span><br></pre></td></tr></table></figure>

<h4 id="6、AOP中的JoinPoint-返回值-异常对象"><a href="#6、AOP中的JoinPoint-返回值-异常对象" class="headerlink" title="6、AOP中的JoinPoint/返回值/异常对象"></a>6、AOP中的<code>JoinPoint</code>/返回值/异常对象</h4><p><code>JoinPoint</code>必须放在<strong>参数列表的第一位</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//切面类</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LogUtils</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 前置通知</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> joinPoint 连接点，封装了目标方法的信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Before</span>(<span class="string">"execution(public int org.lc.aop.CaculateImpl.*(int,int))"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">startLog</span><span class="params">(JoinPoint joinPoint)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//获取方法的参数列表</span></span><br><span class="line">        Object[] args = joinPoint.getArgs();</span><br><span class="line">        <span class="comment">//获取方法对象</span></span><br><span class="line">        Signature signature = joinPoint.getSignature();</span><br><span class="line">        <span class="comment">//获取方法的名称</span></span><br><span class="line">        signature.getName();</span><br><span class="line">        <span class="comment">//获取方法的访问修饰符</span></span><br><span class="line">        signature.getModifiers();</span><br><span class="line">        System.out.println(<span class="string">"执行:【"</span> + signature.getName() + <span class="string">"】方法之前的记录,方法的参数列表为【"</span>+Arrays.toString(args)+<span class="string">"】"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回通知(方法正常返回)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> joinPoint 连接点，封装了目标方法的信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> object 指定返回值 需要在注解中使用 returning = "参数名称"，告诉spring要使用什么参数作为返回值</span></span><br><span class="line"><span class="comment">     *              注意：如果指定返回类型为 double，方法只能返回double的类型才会执行此 返回通知</span></span><br><span class="line"><span class="comment">     *              所以我们在声明返回类型时，一般声明为较大范围的类型</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@AfterReturning</span>(value = <span class="string">"execution(public int org.lc.aop.CaculateImpl.*(int,int))"</span>,returning = <span class="string">"object"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">returnLog</span><span class="params">(JoinPoint joinPoint,Object object)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"执行:【"</span> + joinPoint.getSignature().getName() + <span class="string">"】方法之后的记录,方法的结果为【"</span> + object + <span class="string">"】"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 异常通知 方法抛出异常执行</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> joinPoint</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> e 方法抛出的异常类型 需要在注解中使用 throwing = "参数名称" ,告诉spring要使用什么参数作为返回值</span></span><br><span class="line"><span class="comment">     *          注意：如果指定异常为 NullPointerException的异常，方法只能抛出的异常为NullPointerException的异常才会执行此 异常通知</span></span><br><span class="line"><span class="comment">     *          所以我们在声明异常时，一般声明为较大范围的类型</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@AfterThrowing</span>(value = <span class="string">"execution(public int org.lc.aop.CaculateImpl.*(int,int))"</span>,throwing = <span class="string">"e"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">exceptionLog</span><span class="params">(JoinPoint joinPoint,Exception e)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"【"</span>+joinPoint.getSignature().getName()+<span class="string">"】方法抛出的异常为:【"</span>+e+<span class="string">"】"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 后置通知 无论方法是否正常返回都执行</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> joinPoint</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@After</span>(<span class="string">"execution(public int org.lc.aop.CaculateImpl.*(int,int))"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">finallyLog</span><span class="params">(JoinPoint joinPoint)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"方法【"</span>+joinPoint.getSignature().getName()+<span class="string">"】总要执行的记录...."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="7、提取切点表达式实现重用"><a href="#7、提取切点表达式实现重用" class="headerlink" title="7、提取切点表达式实现重用"></a>7、提取切点表达式实现重用</h4><ul>
<li>给定一个空的无参无返的方法</li>
<li>在方法上加入@Pointcut注解并加上重用的切点表达式</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//切面类</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LogUtils</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 1、给定一个空的无参无返的方法</span></span><br><span class="line"><span class="comment">     * 2、在方法上加入<span class="doctag">@Pointcut</span>注解并加上重用的切点表达式</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Pointcut</span>(<span class="string">"execution(public int org.lc.aop.CaculateImpl.*(int,int))"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span>  <span class="title">myCutPointExpress</span><span class="params">()</span></span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span>(<span class="string">"myCutPointExpress()"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">startLog</span><span class="params">(JoinPoint joinPoint)</span> </span>&#123;</span><br><span class="line">      </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="8、-Around环绕通知的使用"><a href="#8、-Around环绕通知的使用" class="headerlink" title="8、@Around环绕通知的使用"></a>8、@Around环绕通知的使用</h4><p>环绕通知集成了 前置通知，后置通知，返回通知，异常通知 为一体的通知</p>
<ul>
<li>@Around内部就是一个 代理方法  相当于<code>invoke.method(obj,args)</code></li>
</ul>
<p>所以我们环绕通知的实现原理就是帮我们的切面类创建了一个代理对象，代理对象调用<code>invoke.method(obj,args)</code>来决定目标方法的执行时间和前后要处理的通知。而多层的切面，就相当于代理类调用的嵌套</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//切面类</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LogUtils</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 1、给定一个空的无参无返的方法</span></span><br><span class="line"><span class="comment">     * 2、在方法上加入<span class="doctag">@Pointcut</span>注解并加上重用的切点表达式</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Pointcut</span>(<span class="string">"execution(public int org.lc.aop.CaculateImpl.*(int,int))"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span>  <span class="title">myCutPointExpress</span><span class="params">()</span></span>&#123;</span><br><span class="line">    &#125;  </span><br><span class="line">    </span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 环绕通知</span></span><br><span class="line"><span class="comment">     * interface ProceedingJoinPoint extends JoinPoint 可以使用JoinPoint中的方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Around</span>(<span class="string">"myCutPointExpress()"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">aroundAdvice</span><span class="params">(ProceedingJoinPoint pjp)</span></span>&#123;</span><br><span class="line">        <span class="comment">//获取当前执行方法的参数</span></span><br><span class="line">        Object[] args = pjp.getArgs();</span><br><span class="line">        <span class="comment">//获取当前执行的方法</span></span><br><span class="line">        Signature signature = pjp.getSignature();</span><br><span class="line">        Object proceed=<span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//@Before</span></span><br><span class="line">            System.out.println(<span class="string">"【前置通知】+【"</span>+signature.getName()+<span class="string">"】方法执行之前的通知,方法的参数为【"</span>+Arrays.toString(args)+<span class="string">"】"</span>);</span><br><span class="line">            <span class="comment">//相当于利用反射调用目标方法，相当于 invoke.method(obj,args)</span></span><br><span class="line">            <span class="comment">//帮我们执行目标方法</span></span><br><span class="line">            proceed = pjp.proceed(args);</span><br><span class="line">            <span class="comment">//@AfterReturing</span></span><br><span class="line">            System.out.println(<span class="string">"【返回通知】+【"</span>+signature.getName()+<span class="string">"】方法返回之后的通知,方法结果为【"</span>+proceed+<span class="string">"】"</span>);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Throwable throwable) &#123;</span><br><span class="line">            <span class="comment">//@AfterThrowing</span></span><br><span class="line">            System.out.println(<span class="string">"【异常通知】+【"</span>+signature.getName()+<span class="string">"】方法执行异常的通知,异常原因为【"</span>+throwable.getCause()+<span class="string">"】"</span>);</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">//@After</span></span><br><span class="line">            System.out.println(<span class="string">"【后置通知】+【"</span>+signature.getName()+<span class="string">"】方法最终执行的通知"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//将方法执行的结果返回出去 供外部接收使用</span></span><br><span class="line">        <span class="keyword">return</span> proceed;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="9、普通通知和环绕通知共存的执行顺序"><a href="#9、普通通知和环绕通知共存的执行顺序" class="headerlink" title="9、普通通知和环绕通知共存的执行顺序"></a>9、普通通知和环绕通知共存的执行顺序</h4><p><strong>环绕通知总是优先于普通通知执行的</strong>，因为环绕通知控制了目标方法的执行时机，只有环绕通知内部执行了<code>pjp.proceed(args);</code>目标回调方法，普通通知才能运行</p>
<ul>
<li><p>普通通知的执行顺序</p>
<ul>
<li>【普通前置】 –&gt;  目标方法执行 –&gt;【普通后置】–&gt;【普通返回通知】/【异常通知】</li>
</ul>
</li>
<li><p>环绕通知的执行顺序</p>
</li>
<li><p>【环绕前置】 –&gt;  目标方法执行 –&gt;【环绕返回/异常】–&gt;【环绕后置】</p>
</li>
<li><p>环绕通知和普通通知执行属性</p>
<ul>
<li><pre><code class="java">【环绕前置】--&gt; 【普通前置】 --&gt;目标方法执行 --&gt; 【环绕正常返回/异常】--&gt; 【环绕后置】---&gt;【普通后置】--&gt; 【普通返回/异常】
&lt;!--￼<span class="number">132</span>--&gt;
</code></pre>
</li>
</ul>
</li>
</ul>
<h4 id="10、多切面AOP"><a href="#10、多切面AOP" class="headerlink" title="10、多切面AOP"></a>10、多切面AOP</h4><p>1)默认按照切面文件的开头字母顺序决定谁先切入方法，先切入的后返回</p>
<p>2)通过<strong>@Order</strong>注解指定文件的加载顺序，值越小越优先加载</p>
<p>3)切面类中的环绕通知并不会影响其他切面类</p>
<p><strong>若切面L优先于切面A先执行，并且只有切面A中有环绕通知</strong>：则执行顺序如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">【环绕L前置通知】+【add】方法执行之前的通知,方法的参数为【[<span class="number">1</span>, <span class="number">2</span>]】</span><br><span class="line">【前置通知L】执行:【add】方法之前的记录,方法的参数列表为【[<span class="number">1</span>, <span class="number">2</span>]】</span><br><span class="line">【前置通知A】执行:【add】方法之前的记录,方法的参数列表为【[<span class="number">1</span>, <span class="number">2</span>]】</span><br><span class="line">【后置通知A】方法【add】总要执行的记录....</span><br><span class="line">【返回通知A】执行:【add】方法之后的记录,方法的结果为【<span class="number">3</span>】</span><br><span class="line">【环绕L返回通知】+【add】方法返回之后的通知,方法结果为【<span class="number">3</span>】</span><br><span class="line">【环绕L后置通知】+【add】方法最终执行的通知</span><br><span class="line">【后置通知L】方法【add】总要执行的记录....</span><br><span class="line">【返回通知L】执行:【add】方法之后的记录,方法的结果为【<span class="number">3</span>】</span><br></pre></td></tr></table></figure>

<h4 id="11、AOP应用场景"><a href="#11、AOP应用场景" class="headerlink" title="11、AOP应用场景"></a>11、AOP应用场景</h4><p><em>Authentication 权限</em><br> <em>Caching 缓存</em><br> <em>Context passing 内容传递</em><br> <em>Error handling 错误处理</em><br> <em>Lazy loading　懒加载</em><br> <em>Debugging　　调试</em><br> <em>logging, tracing, profiling and monitoring　记录跟踪　优化　校准</em><br> <em>Performance optimization　性能优化</em><br> <em>Persistence　　持久化</em><br> <em>Resource pooling　资源池</em><br> <em>Synchronization　同步</em><br> <em>Transactions 事务</em></p>
<h4 id="12、基于XML配置AOP"><a href="#12、基于XML配置AOP" class="headerlink" title="12、基于XML配置AOP"></a>12、基于XML配置AOP</h4><blockquote>
<p>目标对象</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CaculateImpl</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a+b;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">substract</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a-b;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">multiply</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a-b;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">divide</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a/b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>切面类</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BLogUtils</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">startLog</span><span class="params">(JoinPoint joinPoint)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//获取方法的参数列表</span></span><br><span class="line">        Object[] args = joinPoint.getArgs();</span><br><span class="line">        <span class="comment">//获取方法对象</span></span><br><span class="line">        Signature signature = joinPoint.getSignature();</span><br><span class="line">        System.out.println(<span class="string">"【前置通知】执行:【"</span> + signature.getName() + <span class="string">"】方法之前的记录,方法的参数列表为【"</span> + Arrays.toString(args) + <span class="string">"】"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">returnLog</span><span class="params">(JoinPoint joinPoint, Object object)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"【返回通知】执行:【"</span> + joinPoint.getSignature().getName() + <span class="string">"】方法之后的记录,方法的结果为【"</span> + object + <span class="string">"】"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">exceptionLog</span><span class="params">(JoinPoint joinPoint, Exception e)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"【异常通知】【"</span> + joinPoint.getSignature().getName() + <span class="string">"】方法抛出的异常为:【"</span> + e + <span class="string">"】"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">finallyLog</span><span class="params">(JoinPoint joinPoint)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"【后置通知】方法【"</span> + joinPoint.getSignature().getName() + <span class="string">"】总要执行的记录...."</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">aroundAdvice</span><span class="params">(ProceedingJoinPoint pjp)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//获取当前执行方法的参数</span></span><br><span class="line">        Object[] args = pjp.getArgs();</span><br><span class="line">        <span class="comment">//获取当前执行的方法</span></span><br><span class="line">        Signature signature = pjp.getSignature();</span><br><span class="line">        Object proceed = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">"【环绕前置通知】+【"</span> + signature.getName() + <span class="string">"】方法执行之前的通知,方法的参数为【"</span> + Arrays.toString(args) + <span class="string">"】"</span>);</span><br><span class="line">            <span class="comment">//相当于利用反射调用目标方法，相当于 invoke.method(obj,args)</span></span><br><span class="line">            proceed = pjp.proceed(args);</span><br><span class="line">            System.out.println(<span class="string">"【环绕返回通知】+【"</span> + signature.getName() + <span class="string">"】方法返回之后的通知,方法结果为【"</span> + proceed + <span class="string">"】"</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            System.out.println(<span class="string">"【环绕异常通知】+【"</span> + signature.getName() + <span class="string">"】方法执行异常的通知,异常原因为【"</span> + e + <span class="string">"】"</span>);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable throwable) &#123;</span><br><span class="line">            throwable.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">"【环绕后置通知】+【"</span> + signature.getName() + <span class="string">"】方法最终执行的通知"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> proceed;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>xml配置</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string"> http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/aop/spring-aop.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--注入目标对象--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"caculate"</span> <span class="attr">class</span>=<span class="string">"org.lc.aop.CaculateImpl"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--注入切面类--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"bLogUtils"</span> <span class="attr">class</span>=<span class="string">"org.lc.utils.BLogUtils"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--AOP配置--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--配置切点表达式，声明在切面外部，供整个AOP中的其他切面中使用，为全局切点表达式--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">"mypoint2"</span> <span class="attr">expression</span>=<span class="string">"execution(* org.lc.aop.CaculateImpl.*(int,int))"</span>/&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">&lt;!--指定切面类，引用外部注入的切面类--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">"bLogUtils"</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--配置切点表达式，相当于在bLogUtils切面类中声明的切点表达式，只能在本切面类使用--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">"mypoint1"</span> <span class="attr">expression</span>=<span class="string">"execution(* org.lc.aop.CaculateImpl.*(int,int))"</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--配置环绕通知，并引用切点表达式。</span></span><br><span class="line"><span class="comment">            注意：若环绕通知配置在其他通知后，则环绕前置和普通前置顺序颠倒--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:around</span> <span class="attr">method</span>=<span class="string">"aroundAdvice"</span> <span class="attr">pointcut-ref</span>=<span class="string">"mypoint1"</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:around</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--配置前置通知, 并自定义切点表达式--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">"startLog"</span> <span class="attr">pointcut</span>=<span class="string">"execution(* org.lc.aop.CaculateImpl.*(int,int))"</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:before</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--配置返回通知,并引用切点表达式，并指定作为返回值的参数--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:after-returning</span> <span class="attr">method</span>=<span class="string">"returnLog"</span> <span class="attr">returning</span>=<span class="string">"object"</span> <span class="attr">pointcut-ref</span>=<span class="string">"mypoint1"</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:after-returning</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--配置异常通知，并引用切点表达式，并指定作为异常对象的参数--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:after-throwing</span> <span class="attr">method</span>=<span class="string">"exceptionLog"</span> <span class="attr">pointcut-ref</span>=<span class="string">"mypoint1"</span> <span class="attr">throwing</span>=<span class="string">"e"</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:after-throwing</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--配置后置通知，并指定切点表达式--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:after</span> <span class="attr">method</span>=<span class="string">"finallyLog"</span> <span class="attr">pointcut-ref</span>=<span class="string">"mypoint1"</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:after</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//classpath: 使用指定的xml文件</span></span><br><span class="line"><span class="meta">@ContextConfiguration</span>(locations = <span class="string">"classpath:applicationContext.xml"</span>)</span><br><span class="line"><span class="comment">//使用junit4测试</span></span><br><span class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">SpringTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CaculateImpl caculate;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Test</span><span class="params">()</span></span>&#123;</span><br><span class="line">        caculate.add(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">【环绕前置通知】+【add】方法执行之前的通知,方法的参数为【[<span class="number">1</span>, <span class="number">2</span>]】</span><br><span class="line">【前置通知】执行:【add】方法之前的记录,方法的参数列表为【[<span class="number">1</span>, <span class="number">2</span>]】</span><br><span class="line">【环绕返回通知】+【add】方法返回之后的通知,方法结果为【<span class="number">3</span>】</span><br><span class="line">【环绕后置通知】+【add】方法最终执行的通知</span><br><span class="line">【返回通知】执行:【add】方法之后的记录,方法的结果为【<span class="number">3</span>】</span><br><span class="line">【后置通知】方法【add】总要执行的记录....</span><br></pre></td></tr></table></figure>

<h4 id="13、XML配置多切面"><a href="#13、XML配置多切面" class="headerlink" title="13、XML配置多切面"></a>13、XML配置多切面</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string"> http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/aop/spring-aop.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--注入目标对象--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"caculate"</span> <span class="attr">class</span>=<span class="string">"org.lc.aop.CaculateImpl"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--注入切面类BLogUtils--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"bLogUtils"</span> <span class="attr">class</span>=<span class="string">"org.lc.utils.BLogUtils"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--注入切面类LogUtils--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"logUtils"</span> <span class="attr">class</span>=<span class="string">"org.lc.utils.LogUtils"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--AOP配置--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--配置切点表达式，声明在切面外部，供整个AOP中的其他切面中使用，为全局切点表达式--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">"globalPoincut"</span> <span class="attr">expression</span>=<span class="string">"execution(* org.lc.aop.CaculateImpl.*(int,int))"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--指定切面类BLogUtils，引用外部注入的切面类bLogUtils--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--使用order绝对执行的先后顺序，小的先执行--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">"bLogUtils"</span> <span class="attr">order</span>=<span class="string">"2"</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--配置切点表达式，相当于在bLogUtils切面类中声明的切点表达式，只能在本切面类使用--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">"mypoint1"</span> <span class="attr">expression</span>=<span class="string">"execution(* org.lc.aop.CaculateImpl.*(int,int))"</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--配置环绕通知，并引用切点表达式。</span></span><br><span class="line"><span class="comment">            注意：若环绕通知配置在其他通知后，则环绕前置通知顺序会乱--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:around</span> <span class="attr">method</span>=<span class="string">"aroundAdvice"</span> <span class="attr">pointcut-ref</span>=<span class="string">"mypoint1"</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:around</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--配置前置通知, 并自定义切点表达式--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">"startLog"</span> <span class="attr">pointcut</span>=<span class="string">"execution(* org.lc.aop.CaculateImpl.*(int,int))"</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:before</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--配置返回通知,并引用切点表达式，并指定作为返回值的参数--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:after-returning</span> <span class="attr">method</span>=<span class="string">"returnLog"</span> <span class="attr">returning</span>=<span class="string">"object"</span> <span class="attr">pointcut-ref</span>=<span class="string">"mypoint1"</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:after-returning</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--配置异常通知，并引用切点表达式，并指定作为异常对象的参数--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:after-throwing</span> <span class="attr">method</span>=<span class="string">"exceptionLog"</span> <span class="attr">pointcut-ref</span>=<span class="string">"mypoint1"</span> <span class="attr">throwing</span>=<span class="string">"e"</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:after-throwing</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--配置后置通知，并指定切点表达式--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:after</span> <span class="attr">method</span>=<span class="string">"finallyLog"</span> <span class="attr">pointcut-ref</span>=<span class="string">"mypoint1"</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:after</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--指定切面类LogUtils，引用外部注入的切面类logUtils--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--使用order绝对执行的先后顺序，小的先执行--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">"logUtils"</span> <span class="attr">order</span>=<span class="string">"1"</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--配置环绕通知，并引用切点表达式。</span></span><br><span class="line"><span class="comment">注意：若环绕通知配置在其他通知后，则环绕前置通知顺序会乱--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:around</span> <span class="attr">method</span>=<span class="string">"aroundAdvice"</span> <span class="attr">pointcut-ref</span>=<span class="string">"globalPoincut"</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:around</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--配置前置通知, 并自定义切点表达式--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">"startLog"</span> <span class="attr">pointcut</span>=<span class="string">"execution(* org.lc.aop.CaculateImpl.*(int,int))"</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:before</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--配置返回通知,并引用切点表达式，并指定作为返回值的参数--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:after-returning</span> <span class="attr">method</span>=<span class="string">"returnLog"</span> <span class="attr">returning</span>=<span class="string">"object"</span> <span class="attr">pointcut-ref</span>=<span class="string">"globalPoincut"</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:after-returning</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--配置异常通知，并引用切点表达式，并指定作为异常对象的参数--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:after-throwing</span> <span class="attr">method</span>=<span class="string">"exceptionLog"</span> <span class="attr">pointcut-ref</span>=<span class="string">"mypoint1"</span> <span class="attr">throwing</span>=<span class="string">"e"</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:after-throwing</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--配置后置通知，并指定切点表达式--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:after</span> <span class="attr">method</span>=<span class="string">"finallyLog"</span> <span class="attr">pointcut-ref</span>=<span class="string">"globalPoincut"</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:after</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="三、事务"><a href="#三、事务" class="headerlink" title="三、事务"></a>三、事务</h3><h4 id="1、数据库事务及四大特性-ACID"><a href="#1、数据库事务及四大特性-ACID" class="headerlink" title="1、数据库事务及四大特性(ACID)"></a>1、数据库事务及四大特性(ACID)</h4><p>​        数据库事务（Transaction）是由若干个SQL语句构成的一个操作序列，有点类似于Java的<code>synchronized</code>同步。数据库系统保证在一个事务中的所有SQL要么全部执行成功，要么全部不执行，即数据库事务具有ACID特性：</p>
<ul>
<li><p><strong>原子性(Atomicity):</strong>事务中的所有操作作为一个整体像原子一样不可分割，要么全部成功,要么全部失败。</p>
</li>
<li><p><strong>一致性 (Consistency):</strong>事务执行后，数据库状态与其他业务规则保持一致。如转账业务，无论事务执行成功否，参与转账的两个账号余额之和应该是不变的。</p>
</li>
<li><p><strong>隔离性(Isolation):</strong>并发执行的事务不会相互影响,其对数据库的影响和它们串行执行时一样。比如多个用户同时往一个账户转账,最后账户的结果应该和他们按先后次序转账的结果一样。</p>
</li>
<li><p><strong>持久性(Durability):</strong>事务一旦提交,其对数据库的更新就是持久的。任何事务或系统故障都不会导致数据丢失。</p>
</li>
</ul>
<h4 id="2、MySQL中的事务"><a href="#2、MySQL中的事务" class="headerlink" title="2、MySQL中的事务"></a>2、MySQL中的事务</h4><pre><code>在默认情况下，MySQL**每执行一条SQL语句，都是一个单独的事务**。如果需要在一个事务中包含多条SQL语句，那么需要开启事务和结束事务。</code></pre><ul>
<li><p>开启事务：start transaction</p>
</li>
<li><p>业务SQL操作……..</p>
</li>
<li><p>结束事务：commit或rollback</p>
</li>
</ul>
<p>​        在执行SQL语句之前，先执行start transaction，这就开启了一个事务（事务的起点），然后可以去执行多条SQL语句，最后要结束事务，commit表示提交，即事务中的多条SQL语句所作出的影响会持久到数据库中，或者rollback，表示回滚到事务的起点，之前做的所有操作都被撤销了。</p>
<h5 id="1-修改MySQL隔离级别-默认为可重复读"><a href="#1-修改MySQL隔离级别-默认为可重复读" class="headerlink" title="1)修改MySQL隔离级别(默认为可重复读)"></a>1)修改MySQL隔离级别(默认为可重复读)</h5><p>SET [SESSION] | GLOBAL] TRANSACTION ISOLATION LEVEL {READ UNCOMMITTED | READ COMMITTED | REPEATABLE READ | SERIALIZABLE}</p>
<ul>
<li><p>SESSION 当前会话； GLOBAL全局的； </p>
</li>
<li><p>READ UNCOMMITTED  读未提交；READ COMMITTED 读已提交；REPEATABLE READ  可重复读；SERIALIZABLE 串行化</p>
</li>
<li><p>例如： <code>SET SESSION TRANSACTION IOSLATION LEVEL READ UNCOMMITTED</code>  设置当前会话事务的隔离级别为 读未提交</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>事务隔离级别</th>
<th>脏读</th>
<th>不可重复读</th>
<th>幻读</th>
</tr>
</thead>
<tbody><tr>
<td>读未提交（read-uncommitted）</td>
<td>√</td>
<td>√</td>
<td>√</td>
</tr>
<tr>
<td>不可重复读（read-committed）</td>
<td>×</td>
<td>√</td>
<td>√</td>
</tr>
<tr>
<td>可重复读（repeatable-read）</td>
<td>×</td>
<td>×</td>
<td>√</td>
</tr>
<tr>
<td>串行化（serializable）</td>
<td>×</td>
<td>×</td>
<td>×</td>
</tr>
</tbody></table>
<h5 id="2-查询MySQL的隔离级别"><a href="#2-查询MySQL的隔离级别" class="headerlink" title="2)查询MySQL的隔离级别"></a>2)查询MySQL的隔离级别</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> @@global.tx_isolation   <span class="comment">##查询全局隔离级别</span></span><br><span class="line"><span class="keyword">SELECT</span> @@session.tx_isolation <span class="comment">##查询当前会话隔离级别 (若我们用cmd进入mysql服务，则一个窗口代表一个会话)</span></span><br><span class="line"><span class="keyword">SELECT</span> @@tx_isolation  <span class="comment">##同上</span></span><br></pre></td></tr></table></figure>

<h5 id="3-MySQL事务操作"><a href="#3-MySQL事务操作" class="headerlink" title="3)MySQL事务操作"></a>3)MySQL事务操作</h5><p>开启事务：start transaction</p>
<p>提交事务：commit</p>
<p>回滚事务：rollback</p>
<h4 id="2、JDBC中的事务处理"><a href="#2、JDBC中的事务处理" class="headerlink" title="2、JDBC中的事务处理"></a>2、JDBC中的事务处理</h4><p>在JDBC中处理事务，都是<strong>通过Connection完成的。</strong></p>
<p><strong>同一事务中所有的操作，都在使用同一个Connection对象。</strong></p>
<p>①JDBC中的事务   </p>
<p>Connection的三个方法与事务有关：</p>
<ul>
<li><strong>setAutoCommit（boolean）:</strong>设置是否为自动提交事务，如果true（默认值为true）表示自动提交，也就是每条执行的SQL语句都是一个单独的事务，如果设置为false，那么相当于开启了事务了；<strong>con.setAutoCommit(false) 表示开启事务。</strong></li>
<li><strong>commit（）：提交结束事务。</strong></li>
<li><strong>rollback（）：回滚结束事务。</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">	Connection con = 拿到连接，通过连接完成事务操作</span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">    <span class="comment">//开启事务 并关闭自动提交事务</span></span><br><span class="line">     con.setAutoCommit(<span class="keyword">false</span>);</span><br><span class="line">     <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     *业务逻辑处理</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     **/</span></span><br><span class="line">     con.commit();<span class="comment">//try的最后提交事务      </span></span><br><span class="line">&#125; <span class="keyword">catch</span>(Exception e) &#123;</span><br><span class="line">    con.rollback();<span class="comment">//回滚事务</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3、配置声明式-注解-事务"><a href="#3、配置声明式-注解-事务" class="headerlink" title="3、配置声明式(注解)事务"></a>3、配置声明式(注解)事务</h4><p>声明式事务就好像我们使用AOP中的环绕通知一样来实现JDBC中的事务操作。</p>
<p>我们只需要在需要回滚的方法上加上一个类似于环绕通知的注解(<strong>@Transaction</strong>)来实现方法的回滚</p>
<p>我们的Spring已经为我们提供了一个切面类 <strong>PlatformTransactionManager</strong>  的抽象接口<img src="http://img.louchen.top/2020/07/20200712205033.png" style="zoom:80%;" /></p>
<p>我们只需要配置其实现该接口的不同数据库操作方法的事务管理器即可</p>
<ul>
<li>JPA 使用的：<code>JtaTransactionManager</code> 事务管理器</li>
<li>Hibernate使用的：<code>HibernateTransactionManager</code> 事务管理器</li>
<li>JDBCTemplate使用的 : <code>DataSourceTransactionManager</code> 事务管理器</li>
</ul>
<p><strong>配置流程：</strong></p>
<p>1)配置数据源</p>
<p>2)配置事务管理器(相当于切面类),并指定数据源</p>
<p>3)开启基于注解的事务控制,并指定事务管理器</p>
<blockquote>
<p>表</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE `account` (</span><br><span class="line">  `username` varchar(<span class="number">50</span>) NOT NULL,</span><br><span class="line">  `balance` <span class="keyword">int</span>(<span class="number">11</span>) NOT NULL,</span><br><span class="line">  <span class="function">PRIMARY <span class="title">KEY</span> <span class="params">(`username`)</span></span></span><br><span class="line"><span class="function">) ENGINE</span>=InnoDB DEFAULT CHARSET=utf8mb4;</span><br><span class="line"></span><br><span class="line">CREATE TABLE `book` (</span><br><span class="line">  `isbn` varchar(<span class="number">50</span>) NOT NULL,</span><br><span class="line">  `book_name` varchar(<span class="number">100</span>) DEFAULT NULL,</span><br><span class="line">  `price` <span class="keyword">int</span>(<span class="number">11</span>) DEFAULT NULL,</span><br><span class="line">  <span class="function">PRIMARY <span class="title">KEY</span> <span class="params">(`isbn`)</span></span></span><br><span class="line"><span class="function">) ENGINE</span>=InnoDB DEFAULT CHARSET=utf8mb4;</span><br><span class="line"></span><br><span class="line">CREATE TABLE `book_stock` (</span><br><span class="line">  `isbn` varchar(<span class="number">50</span>) NOT NULL,</span><br><span class="line">  `stock` <span class="keyword">int</span>(<span class="number">11</span>) DEFAULT NULL,</span><br><span class="line">  <span class="function">PRIMARY <span class="title">KEY</span> <span class="params">(`isbn`)</span></span></span><br><span class="line"><span class="function">) ENGINE</span>=InnoDB DEFAULT CHARSET=utf8mb4;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p>dao层</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookDao</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JdbcTemplate jdbcTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 减去某个用户的余额</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> money</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updataBalance</span><span class="params">(String username, <span class="keyword">int</span> money)</span> </span>&#123;</span><br><span class="line">        String sql = <span class="string">"update account set balance=balance-? where username=?"</span>;</span><br><span class="line">        jdbcTemplate.update(sql, money, username);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 按照ISBN号码获取图书的价格</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> isbn</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getPrice</span><span class="params">(String isbn)</span> </span>&#123;</span><br><span class="line">        String sql = <span class="string">"SELECT price from book where isbn=?"</span>;</span><br><span class="line">        <span class="keyword">return</span> jdbcTemplate.queryForObject(sql,Integer<span class="class">.<span class="keyword">class</span>, <span class="title">isbn</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 按照ISBN号码减去库存</span></span><br><span class="line"><span class="comment">     * 这里我们设置每次减1</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> isbn</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateStock</span><span class="params">(String isbn)</span> </span>&#123;</span><br><span class="line">        String sql = <span class="string">"update book_stock set stock=stock-1 where isbn=?"</span>;</span><br><span class="line">        jdbcTemplate.update(sql, isbn);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p>service层</p>
<p><strong>在需要回滚的业务方法上加@Transactional注解</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> BookDao bookDao;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 结账</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> isbn</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">//在需要回滚的业务方法上加@Transactional注解</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">checkout</span><span class="params">(String username, String isbn)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//减库存</span></span><br><span class="line">        bookDao.updateStock(isbn);</span><br><span class="line">        <span class="comment">//查询图书价格</span></span><br><span class="line">        <span class="keyword">int</span> price = bookDao.getPrice(isbn);</span><br><span class="line">        <span class="comment">//减余额</span></span><br><span class="line">        bookDao.updataBalance(username, price);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</blockquote>
<p><strong>核心xml配置文件</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/tx/spring-tx.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/context/spring-context.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">"classpath:jdbc.properties"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"org.lc"</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--注入数据源--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"druidDataSource"</span> <span class="attr">class</span>=<span class="string">"com.alibaba.druid.pool.DruidDataSource"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.username&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.password&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.url&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClassName"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.dirverClass&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--配置jdbctemplate--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"jdbcTemplate"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.core.JdbcTemplate"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"druidDataSource"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--事务控制--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--配置事务管理器(相当于切面类)进行事务控制--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSourceTransactionManager"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--我们控制事务管理器，就是要控制数据源，因为都是通过连接对象来进行事务的提交和回滚--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--控制数据源--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"druidDataSource"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--开启基于注解的事务控制,并指定事务管理器--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--在方法上加@Transaction注解--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:annotation-driven</span> <span class="attr">transaction-manager</span>=<span class="string">"dataSourceTransactionManager"</span>&gt;</span><span class="tag">&lt;/<span class="name">tx:annotation-driven</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>测试</strong>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ContextConfiguration</span>(locations = <span class="string">"classpath:tx.xml"</span>)</span><br><span class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">TranscationTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> BookService bookService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Test</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//在此方法操作中，只要有一步出错，则全部回滚</span></span><br><span class="line">        bookService.checkout(<span class="string">"Tom"</span>,<span class="string">"ISBN-001"</span>);</span><br><span class="line">        System.out.println(<span class="string">"结账成功！"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4、-Transaction注解属性详解"><a href="#4、-Transaction注解属性详解" class="headerlink" title="4、@Transaction注解属性详解"></a>4、@Transaction注解属性详解</h4><blockquote>
<p> @Transaction</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target</span>(&#123;ElementType.TYPE, ElementType.METHOD&#125;)</span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="meta">@Inherited</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Transactional &#123;</span><br><span class="line">    <span class="meta">@AliasFor</span>(<span class="string">"transactionManager"</span>)</span><br><span class="line">    <span class="function">String <span class="title">value</span><span class="params">()</span> <span class="keyword">default</span> ""</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AliasFor</span>(<span class="string">"value"</span>)</span><br><span class="line">    <span class="function">String <span class="title">transactionManager</span><span class="params">()</span> <span class="keyword">default</span> ""</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">Propagation <span class="title">propagation</span><span class="params">()</span> <span class="keyword">default</span> Propagation.REQUIRED</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">Isolation <span class="title">isolation</span><span class="params">()</span> <span class="keyword">default</span> Isolation.DEFAULT</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//设置超时回滚</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">timeout</span><span class="params">()</span> <span class="keyword">default</span> -1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">readOnly</span><span class="params">()</span> <span class="keyword">default</span> <span class="keyword">false</span></span>;</span><br><span class="line"></span><br><span class="line">    Class&lt;? extends Throwable&gt;[] rollbackFor() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    String[] rollbackForClassName() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    Class&lt;? extends Throwable&gt;[] noRollbackFor() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    String[] noRollbackForClassName() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<h5 id="0-transactionManager-配置多事务管理器"><a href="#0-transactionManager-配置多事务管理器" class="headerlink" title="0)transactionManager 配置多事务管理器"></a>0)transactionManager 配置多事务管理器</h5><p>若配置多数据源则需要配置多事务管理器</p>
<p>在使用的使用指定<code>@Transacation(transactionManager =&quot;&quot;)</code>的事务管理器</p>
<h5 id="1-timeout-单位秒"><a href="#1-timeout-单位秒" class="headerlink" title="1)timeout(单位秒)"></a>1)timeout(单位秒)</h5><p><strong>事务超出指定执行时长后自动终止并回滚</strong></p>
<p>设置的timeout为3秒，若执行业务操作的时间超过3秒则会业务回滚，并抛出以下异常</p>
<p><code>org.springframework.transaction.TransactionTimedOutException:</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span>(timeout = <span class="number">3</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">checkout</span><span class="params">(String username, String isbn)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//减库存</span></span><br><span class="line">    bookDao.updateStock(isbn);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        Thread.sleep(<span class="number">3000</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//查询图书价格</span></span><br><span class="line">    <span class="keyword">int</span> price = bookDao.getPrice(isbn);</span><br><span class="line">    <span class="comment">//减余额</span></span><br><span class="line">    bookDao.updataBalance(username, price);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="2-readOnly"><a href="#2-readOnly" class="headerlink" title="2)readOnly"></a>2)readOnly</h5><p><strong>设置事务为只读事务，可以进行事务优化，加快查询速度。忽略并发安全和一些繁琐的操作</strong></p>
<p>设置为只读事务的方法中只能有查询操作，不能有修改操作，否则会报错：</p>
<p><code>org.springframework.dao.TransientDataAccessResourceException: PreparedStatementCallback;</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//默认为false</span></span><br><span class="line"><span class="meta">@Transactional</span>(readOnly = <span class="keyword">true</span>)</span><br></pre></td></tr></table></figure>

<h5 id="3-事务回滚异常分类"><a href="#3-事务回滚异常分类" class="headerlink" title="3)事务回滚异常分类"></a>3)事务回滚异常分类</h5><p><em>默认发生运行时异常都回滚，发生编译时异常不会回滚</em></p>
<ul>
<li><p>运行时异常(非检查异常)：可以不用处理，默认都回滚。</p>
<ul>
<li>例如 空指针异常，数组索引越界异常等</li>
</ul>
</li>
<li><p>编译时异常(检查异常)：通过try-catch，或在方法上声明throws的异常默认不回滚。</p>
<ul>
<li>例如 文件读写流等</li>
</ul>
</li>
</ul>
<p><strong>注意：</strong></p>
<ul>
<li><p>所有被try-catch（包括<strong>运行时异常和非运行异常</strong>）的异常都不会回滚</p>
</li>
<li><p><strong>运行时异常</strong> <em>只有通过throw或throws抛出异常才会回滚</em></p>
</li>
<li><p><strong>非运行时异常</strong>默认不会回滚(因为运行之前就已经被try-catch了)，通过throw和throws抛出异常也不会回滚。只有设置<strong>rollbackFor</strong>指定其非运行时异常，通过thows抛出的异常才能回滚。</p>
</li>
</ul>
<h5 id="4-指定不回滚异常"><a href="#4-指定不回滚异常" class="headerlink" title="4)指定不回滚异常"></a>4)指定不回滚异常</h5><p>设置哪些异常不会回滚；可以设置让回滚的异常不回滚。</p>
<h6 id="②noRollbackForClassName-不常用"><a href="#②noRollbackForClassName-不常用" class="headerlink" title="②noRollbackForClassName(不常用)"></a>②noRollbackForClassName(不常用)</h6><ul>
<li>指定不会滚异常的全路径类名</li>
<li><code>@Transactional(noRollbackForClassName = {&quot;java.lang.ArithmeticException&quot;})</code></li>
</ul>
<h6 id="①noRollbackFor"><a href="#①noRollbackFor" class="headerlink" title="①noRollbackFor"></a>①noRollbackFor</h6><ul>
<li>指定不回滚异常的Class类</li>
<li><code>@Transactional(noRollbackFor = {ArithmeticException.class,NullPointerException.class})</code></li>
</ul>
<p>设置 <strong>算数异常</strong> 和 <strong>空指针异常</strong>不会滚。(默认是运行时异常都要回滚)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">@Transactional</span>(noRollbackFor = &#123;ArithmeticException<span class="class">.<span class="keyword">class</span>,<span class="title">NullPointerException</span>.<span class="title">class</span>&#125;)</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">void</span> <span class="title">checkout</span>(<span class="title">String</span> <span class="title">username</span>, <span class="title">String</span> <span class="title">isbn</span>) </span>&#123;</span><br><span class="line">        <span class="comment">//减库存</span></span><br><span class="line">        bookDao.updateStock(isbn);</span><br><span class="line">        <span class="comment">//查询图书价格</span></span><br><span class="line">        <span class="keyword">int</span> price = bookDao.getPrice(isbn);</span><br><span class="line">        <span class="comment">//减余额</span></span><br><span class="line">        bookDao.updataBalance(username, price);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//遇到此异常不会回滚 (默认回滚)</span></span><br><span class="line">        <span class="keyword">int</span> i=<span class="number">1</span>/<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="5-指定回滚异常"><a href="#5-指定回滚异常" class="headerlink" title="5)指定回滚异常"></a>5)指定回滚异常</h5><p>设置哪些异常会回滚；可以让不会滚的异常发生回滚</p>
<h6 id="①rollbackForClassName-不常用"><a href="#①rollbackForClassName-不常用" class="headerlink" title="①rollbackForClassName(不常用)"></a>①rollbackForClassName(不常用)</h6><ul>
<li>指定会滚异常的全路径类名</li>
<li><code>@Transactional(rollbackForClassName = {&quot;java.io.FileNotFoundException&quot;})</code></li>
</ul>
<h6 id="②rollbackFor"><a href="#②rollbackFor" class="headerlink" title="②rollbackFor"></a>②rollbackFor</h6><ul>
<li>指定回滚异常的Class类</li>
<li><code>@Transactional(rollbackFor = {FileNotFoundException.class})</code></li>
</ul>
<p>设置 <strong>文件找不到异常</strong> 会回滚。(默认是编译时异常不回滚)</p>
<p><strong>注意：</strong>  只有通过throws抛出异常才会回滚，如果try-catch则无效</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">@Transactional</span>(rollbackFor = &#123;FileNotFoundException<span class="class">.<span class="keyword">class</span>&#125;)</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">void</span> <span class="title">checkout</span>(<span class="title">String</span> <span class="title">username</span>, <span class="title">String</span> <span class="title">isbn</span>) <span class="title">throws</span> <span class="title">FileNotFoundException</span> </span>&#123;</span><br><span class="line">        <span class="comment">//减库存</span></span><br><span class="line">        bookDao.updateStock(isbn);</span><br><span class="line">        <span class="comment">//查询图书价格</span></span><br><span class="line">        <span class="keyword">int</span> price = bookDao.getPrice(isbn);</span><br><span class="line">        <span class="comment">//减余额</span></span><br><span class="line">        bookDao.updataBalance(username, price);</span><br><span class="line">	</span><br><span class="line">        <span class="comment">//找不到文件回滚。 (默认不回滚)</span></span><br><span class="line">        <span class="keyword">new</span> FileInputStream(<span class="string">"f://ddd"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="6-事务的隔离级别"><a href="#6-事务的隔离级别" class="headerlink" title="6)事务的隔离级别"></a>6)事务的隔离级别</h5><p><code>@Transactional(isolation = Isolation.REPEATABLE_READ )</code>  </p>
<p><strong>默认隔离级别DEFAULT</strong>， 使用数据库设置的隔离级别 ( 默认 ) ，由 DBA <strong>默认的设置来决定隔离级别 。</strong> </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> Isolation &#123;</span><br><span class="line">    DEFAULT(-<span class="number">1</span>),</span><br><span class="line">    READ_UNCOMMITTED(<span class="number">1</span>),</span><br><span class="line">    READ_COMMITTED(<span class="number">2</span>),</span><br><span class="line">    REPEATABLE_READ(<span class="number">4</span>),</span><br><span class="line">    SERIALIZABLE(<span class="number">8</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> value;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Isolation</span><span class="params">(<span class="keyword">int</span> value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.value = value;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">value</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>多个事务并发操作产生的问题，假设现在有两个事务<strong>T1</strong>和<strong>T2</strong></p>
<h6 id="①读未提交-READ-UNCOMMITTED-–产生脏读和不可重复读和幻读"><a href="#①读未提交-READ-UNCOMMITTED-–产生脏读和不可重复读和幻读" class="headerlink" title="①读未提交(READ UNCOMMITTED)–产生脏读和不可重复读和幻读"></a>①读未提交(READ UNCOMMITTED)–产生脏读和不可重复读和幻读</h6><p>允许T1读取T2未提交后的修改数据，产生脏读。</p>
<p><img src="http://img.louchen.top/2020/07/20200713201631.png" alt=""></p>
<h6 id="②读已提交-READ-COMMITTED-–避免脏读，产生不可重复读和幻读"><a href="#②读已提交-READ-COMMITTED-–避免脏读，产生不可重复读和幻读" class="headerlink" title="②读已提交(READ COMMITTED)–避免脏读，产生不可重复读和幻读"></a>②读已提交(READ COMMITTED)–避免脏读，产生不可重复读和幻读</h6><p>事务T1不能够读取到T2未提交修改的数据。读已提交能够避免脏读。但是不能保证可重复读。</p>
<img src="http://img.louchen.top/2020/07/20200713203744.png" style="zoom:67%;" />

<h6 id="③可重复读-READ-COMMITTED-–避免脏读和不可重复读，产生幻读"><a href="#③可重复读-READ-COMMITTED-–避免脏读和不可重复读，产生幻读" class="headerlink" title="③可重复读(READ COMMITTED)–避免脏读和不可重复读，产生幻读"></a>③可重复读(READ COMMITTED)–避免脏读和不可重复读，产生幻读</h6><p>可重复读为MySQL默认的隔离级别，可重复读也叫快照读，即事物T1第一次读数据的时候，留下一个快照，T2事物对其数据进行任意操作(更新，删除)，事物T1都是从快照中读取，数据保持一致，即便数据从数据库中删除，只要T1还未结束当前事务，读取到的数据依然和开始的不变。</p>
<img src="http://img.louchen.top/2020/07/20200713205542.png" style="zoom:80%;" />

<h6 id="1-什么是幻读？"><a href="#1-什么是幻读？" class="headerlink" title="1)什么是幻读？"></a>1)什么是幻读？</h6><img src="http://img.louchen.top/2020/07/20200713213315.png" style="zoom: 67%;" />

<p>InnoDB实现的RR通过mvcc机制避免了<strong>这种幻读现象。</strong></p>
<p>事务B执行插入操作后，在事务A中查询没有查到B添加的数据行，这就是可重复读。</p>
<p><strong>但是，</strong>在事务A执行了对事务B中插入的数据进行update后，再查询时就查到了事务B中添加的数据，这就是幻读。</p>
<p>这种结果告诉我们其实在MySQL可重复读的隔离级别中并不是完全解决了幻读的问题，而是解决了读数据情况下的幻读问题。而对于修改的操作依旧存在幻读问题，就是说MVCC对于幻读的解决是不彻底的。</p>
<h6 id="④串行化-SERIALIZABLE-–避免一切"><a href="#④串行化-SERIALIZABLE-–避免一切" class="headerlink" title="④串行化(SERIALIZABLE)–避免一切"></a>④串行化(SERIALIZABLE)–避免一切</h6><p>确保事务T1可以多次从一个表中读取到相同的行，在T1事务执行期间，禁止其他事务对这个表添加，更新，删除操作，可以避免任何并发问题，但是<strong>其性能十分低下。</strong></p>
<h5 id="7-事务的传播行为"><a href="#7-事务的传播行为" class="headerlink" title="7)事务的传播行为"></a>7)事务的传播行为</h5><p><code>@Transactional(propagation = Propagation.REQUIRED)</code>  默认的传播行为<strong>REQUIRED</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> Propagation &#123;</span><br><span class="line">    REQUIRED(<span class="number">0</span>),</span><br><span class="line">    SUPPORTS(<span class="number">1</span>),</span><br><span class="line">    MANDATORY(<span class="number">2</span>),</span><br><span class="line">    REQUIRES_NEW(<span class="number">3</span>),</span><br><span class="line">    NOT_SUPPORTED(<span class="number">4</span>),</span><br><span class="line">    NEVER(<span class="number">5</span>),</span><br><span class="line">    NESTED(<span class="number">6</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> value;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Propagation</span><span class="params">(<span class="keyword">int</span> value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.value = value;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">value</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>事务传播行为类型</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>支持当前事务情况：↓</td>
<td></td>
</tr>
<tr>
<td><strong>PROPAGATION_REQUIRED</strong></td>
<td>如果当前没有事务，就新建一个事务，如果已经存在一个事务中，加入到这个事务中。<strong>Spring中的默认的传播行为，常用。</strong></td>
</tr>
<tr>
<td><strong>PROPAGATION_SUPPORTS</strong></td>
<td>如果当前存在事务,则加入该事务;如果当前没有事务,则以非事务的方式继续运行。</td>
</tr>
<tr>
<td><strong>PROPAGATION_MANDATORY</strong></td>
<td>如果当前存在事务,则加入该事务;如果当前没有事务,则抛出异常。(mandatory:强制性)</td>
</tr>
<tr>
<td>不支持当前事务：↓</td>
<td></td>
</tr>
<tr>
<td><strong>PROPAGATION_REQUIRES_NEW</strong></td>
<td>创建一个新的事务,如果当前存在事务,则把当前事务挂起。<strong>常用。</strong></td>
</tr>
<tr>
<td><strong>PROPAGATION_NOT_SUPPORTED</strong></td>
<td>以非事务方式运行,如果当前存在事务,则把当前事务挂起。</td>
</tr>
<tr>
<td><strong>PROPAGATION_NEVER</strong></td>
<td>以非事务方式运行,如果当前存在事务,则抛出异常。</td>
</tr>
<tr>
<td>其他情况：↓</td>
<td></td>
</tr>
<tr>
<td><strong>PROPAGATION_NESTED</strong></td>
<td>如果当前存在事务,则创建一个事务作为当前事务的嵌套事务来运行;如果当前没有事务,则该取值等价于PROPAGATION_REQUIRED。</td>
</tr>
</tbody></table>
<h6 id="REQUIRES-NEW和REQUIRED传播行为详解"><a href="#REQUIRES-NEW和REQUIRED传播行为详解" class="headerlink" title="REQUIRES_NEW和REQUIRED传播行为详解"></a>REQUIRES_NEW和REQUIRED传播行为详解</h6><img src="http://img.louchen.top/2020/07/20200714124535.png" style="zoom:80%;" />

<img src="http://img.louchen.top/2020/07/20200714124557.png" style="zoom:80%;" />



<img src="http://img.louchen.top/2020/07/20200714124615.png" style="zoom:80%;" />

<blockquote>
<p> DAO层</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookDao</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JdbcTemplate jdbcTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 减去某个用户的余额</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> money</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updataBalance</span><span class="params">(String username, <span class="keyword">int</span> money)</span> </span>&#123;</span><br><span class="line">        String sql = <span class="string">"update account set balance=balance-? where username=?"</span>;</span><br><span class="line">        jdbcTemplate.update(sql, money, username);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 按照ISBN号码获取图书的价格</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> isbn</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getPrice</span><span class="params">(String isbn)</span> </span>&#123;</span><br><span class="line">        String sql = <span class="string">"SELECT price from book where isbn=?"</span>;</span><br><span class="line">        <span class="keyword">return</span> jdbcTemplate.queryForObject(sql,Integer<span class="class">.<span class="keyword">class</span>, <span class="title">isbn</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 按照ISBN号码减去库存</span></span><br><span class="line"><span class="comment">     * 这里我们设置每次减1</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> isbn</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateStock</span><span class="params">(String isbn)</span> </span>&#123;</span><br><span class="line">        String sql = <span class="string">"update book_stock set stock=stock-1 where isbn=?"</span>;</span><br><span class="line">        jdbcTemplate.update(sql, isbn);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据 isbn修改书的价格</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> isbn</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> price</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updatePrice</span><span class="params">(String isbn, <span class="keyword">int</span> price)</span> </span>&#123;</span><br><span class="line">        String sql=<span class="string">"update book set price=? where isbn=?"</span>;</span><br><span class="line">        jdbcTemplate.update(sql, price, isbn);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>service层   (内层事务)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> BookDao bookDao;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 结账</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> isbn</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Transactional</span>(propagation = Propagation.REQUIRES_NEW)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">checkout</span><span class="params">(String username, String isbn)</span></span>&#123;</span><br><span class="line">        <span class="comment">//减库存</span></span><br><span class="line">        bookDao.updateStock(isbn);</span><br><span class="line">        <span class="comment">//查询图书价格</span></span><br><span class="line">        <span class="keyword">int</span> price = bookDao.getPrice(isbn);</span><br><span class="line">        <span class="comment">//减余额</span></span><br><span class="line">        bookDao.updataBalance(username, price);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// int i=1/0;</span></span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">    <span class="meta">@Transactional</span>(propagation =Propagation.REQUIRED)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updatePrice</span><span class="params">(String isbn, <span class="keyword">int</span> price)</span> </span>&#123;</span><br><span class="line">        bookDao.updatePrice(isbn, price);</span><br><span class="line">        <span class="keyword">int</span> i=<span class="number">1</span>/<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>service (外层事务）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MultipleTransactionService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> BookService bookService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//外层事务</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">multipleTran</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//内层事务1</span></span><br><span class="line">        bookService.checkout(<span class="string">"Tom"</span>, <span class="string">"ISBN-001"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//内层事务2</span></span><br><span class="line">        bookService.updatePrice(<span class="string">"ISBN-003"</span>,<span class="number">500</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// int i=1/0;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p>测试代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ContextConfiguration</span>(locations = <span class="string">"classpath:tx.xml"</span>)</span><br><span class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">TranscationTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MultipleTransactionService multipleTransactionService;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Test1</span><span class="params">()</span></span>&#123;</span><br><span class="line">        multipleTransactionService.multipleTran();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<ul>
<li><p>外层事务默认为 <code>REQUIRES</code></p>
<p><strong>注意：下面的异常必须为抛出异常 ，try-catch异常不会回滚</strong>。</p>
<ul>
<li>当内部事务1和内部事务2的传播行为是<code>REQUIRES_NEW</code> ,  无论外层事务是否发生异常，内部事务都回新建一个自己的事务，不会回滚</li>
<li>当内部事务1和内部事务2的传播行为是<code>REQUIRES</code> ,  内部事务会依赖外部事务，外层事务发生异常，内部事务全部回滚</li>
<li>当内部事务1为<code>REQUIRES</code> ，事务2位<code>REQUIRES_NEW</code>, 当内部事务1发生异常，则会向上抛出，若事务1在事务2前面执行，那么事务2并不会执行，事务1提前回滚。</li>
<li>当内部事务1为<code>REQUIRES_NEW</code> ，事务2位<code>REQUIRES</code>, 当内部事务2发生异常，则会向上抛出，事务1新建事务运行并不会回滚，事务2回滚。</li>
</ul>
</li>
<li><p>若内部事务依赖于外部事务，那么在内部事务设置的其他属性如：timeout并不会生效，需要在外部事务上设置。</p>
</li>
<li><p>不能在同一Service类中实现事务嵌套，否则无效，<strong>例如：</strong></p>
<ul>
<li><pre><code class="java"><span class="meta">@Service</span>
<span class="class"><span class="keyword">class</span> <span class="title">MultipleService</span></span>{
    <span class="meta">@Autowired</span>
    <span class="keyword">private</span> BookDao bookDao;

    <span class="meta">@Transaction</span>
    <span class="function"><span class="keyword">void</span> <span class="title">mA</span><span class="params">()</span></span>{}

    <span class="meta">@Transaction</span>
    <span class="function"><span class="keyword">void</span> <span class="title">mB</span><span class="params">()</span></span>{}

    <span class="meta">@Transaction</span>
    <span class="function"><span class="keyword">void</span> <span class="title">mC</span><span class="params">()</span></span>{
        <span class="comment">//失效，相当于三个事务为同一个事务</span>
        mA();
        mB();
    }
}
&lt;!--￼<span class="number">158</span>--&gt;
</code></pre>
</li>
</ul>
</li>
</ul>
<blockquote>
<p>xml配置</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/tx/spring-tx.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/aop/spring-aop.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/context/spring-context.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">"classpath:jdbc.properties"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"org.lc"</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!--注入数据源--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"druidDataSource"</span> <span class="attr">class</span>=<span class="string">"com.alibaba.druid.pool.DruidDataSource"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.username&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.password&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.url&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClassName"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.dirverClass&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--配置jdbctemplate--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"jdbcTemplate"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.core.JdbcTemplate"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"druidDataSource"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--事务控制--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--配置事务管理器(相当于切面类)进行事务控制--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSourceTransactionManager"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--我们控制事务管理器，就是要控制数据源，因为都是通过连接对象来进行事务的提交和回滚--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--控制数据源--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"druidDataSource"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--定义切点表达式  指定哪些方法需要增强--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--指定ser开头的包及其下面的任意包和任意方法作为切点--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">"txPoint"</span> <span class="attr">expression</span>=<span class="string">"execution(* org.lc.ser*.*.*(..))"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--事务增强</span></span><br><span class="line"><span class="comment">        advice-ref:配置哪些方法需要进行事务的配置</span></span><br><span class="line"><span class="comment">        pointcut-ref：指定哪些方法需要进行增强</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">"myAdvice"</span> <span class="attr">pointcut-ref</span>=<span class="string">"txPoint"</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:advisor</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--配置事务增强</span></span><br><span class="line"><span class="comment">    transaction-manager：指定事务管理器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:advice</span> <span class="attr">id</span>=<span class="string">"myAdvice"</span> <span class="attr">transaction-manager</span>=<span class="string">"dataSourceTransactionManager"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--配置事务属性--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--指定增强的方法的事务属性配置--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--为所有方法配置 事务--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"*"</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--为checkout 配送事务传播行为 REQUIRED，隔离级别REPEATABLE_READ，超时值 -1(永远不会超时)--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"checkout"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span> <span class="attr">timeout</span>=<span class="string">"-1"</span> <span class="attr">isolation</span>=<span class="string">"REPEATABLE_READ"</span> /&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--为所有get开头的方法 设为只读--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"get*"</span> <span class="attr">read-only</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tx:advice</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="6、事务失效的几种情况"><a href="#6、事务失效的几种情况" class="headerlink" title="6、事务失效的几种情况"></a>6、事务失效的几种情况</h4></div><div class="article-tags size-small is-uppercase mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/Spring/">Spring</a></div><!--!--></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">喜欢这篇文章？打赏一下作者吧</h3><div class="buttons is-centered"><a class="button is-success donate"><span class="icon is-small"><i class="fab fa-weixin"></i></span><span>微信</span><span class="qrcode"><img src="/img/pay.jpg" alt="微信"></span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2020/07/24/ssm/SpringMVC/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">SpringMVC知识梳理</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2020/07/24/ssm/Servlet+JavaWeb/"><span class="level-item">Servlet详解</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!--></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1"><div class="card widget"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="" src="/img/milk.png" alt="娄晨"></figure><p class="title is-size-4 is-block line-height-inherit">娄晨</p><p class="is-size-6 is-block">学生</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>中国·武汉</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">70</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">19</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">40</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded cursor:pointer" href="/img/wechart.jpg" target="_blank" rel="noopener">联系我</a></div><div class="level is-mobile"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/ppoffice"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Facebook" href="https://facebook.com"><i class="fab fa-facebook"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Dribbble" href="https://dribbble.com"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><div class="card widget" id="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">目录</h3><ul class="menu-list"><li><a class="is-flex" href="#一、IOC和DI"><span class="mr-2">1</span><span>一、IOC和DI</span></a><ul class="menu-list"><li><a class="is-flex" href="#1、IOC"><span class="mr-2">1.1</span><span>1、IOC</span></a></li><li><a class="is-flex" href="#2、DI"><span class="mr-2">1.2</span><span>2、DI</span></a></li><li><a class="is-flex" href="#3、简单IOC实例"><span class="mr-2">1.3</span><span>3、简单IOC实例</span></a><ul class="menu-list"><li><a class="is-flex" href="#1-读取Bean的xml获取Bean实例"><span class="mr-2">1.3.1</span><span>1)读取Bean的xml获取Bean实例</span></a></li><li><a class="is-flex" href="#2-处理类型相同的多个Bean"><span class="mr-2">1.3.2</span><span>2)处理类型相同的多个Bean</span></a></li><li><a class="is-flex" href="#3-通过Bean中的有参构造器赋值"><span class="mr-2">1.3.3</span><span>3)通过Bean中的有参构造器赋值</span></a></li><li><a class="is-flex" href="#4-通过p标签赋值属性"><span class="mr-2">1.3.4</span><span>4)通过p标签赋值属性</span></a></li><li><a class="is-flex" href="#5-通过Bean赋值属性为null"><span class="mr-2">1.3.5</span><span>5)通过Bean赋值属性为null</span></a></li><li><a class="is-flex" href="#6-通过ref引用其他外部Bean对象"><span class="mr-2">1.3.6</span><span>6)通过ref引用其他外部Bean对象</span></a></li><li><a class="is-flex" href="#7-创建使用内部Bean对象"><span class="mr-2">1.3.7</span><span>7)创建使用内部Bean对象</span></a></li><li><a class="is-flex" href="#8-为List类型赋值"><span class="mr-2">1.3.8</span><span>8)为List类型赋值</span></a></li><li><a class="is-flex" href="#9-为map赋值"><span class="mr-2">1.3.9</span><span>9)为map赋值</span></a></li><li><a class="is-flex" href="#10-为Properties赋值"><span class="mr-2">1.3.10</span><span>10)为Properties赋值</span></a></li><li><a class="is-flex" href="#11-使用util创建一个可以引用的集合"><span class="mr-2">1.3.11</span><span>11)使用util创建一个可以引用的集合</span></a></li><li><a class="is-flex" href="#12-级联属性赋值"><span class="mr-2">1.3.12</span><span>12)级联属性赋值</span></a></li><li><a class="is-flex" href="#13-通过parent对指定Bean的继承"><span class="mr-2">1.3.13</span><span>13)通过parent对指定Bean的继承</span></a></li><li><a class="is-flex" href="#14-通过abstract将Bean声明为抽象的"><span class="mr-2">1.3.14</span><span>14)通过abstract将Bean声明为抽象的</span></a></li><li><a class="is-flex" href="#15-Bean之间的依赖创建顺序"><span class="mr-2">1.3.15</span><span>15)Bean之间的依赖创建顺序</span></a></li></ul></li><li><a class="is-flex" href="#4、Bean的作用域-默认为单例"><span class="mr-2">1.4</span><span>4、Bean的作用域(默认为单例)</span></a></li><li><a class="is-flex" href="#5、静态工厂和实例工厂创建Bean"><span class="mr-2">1.5</span><span>5、静态工厂和实例工厂创建Bean</span></a><ul class="menu-list"><li><a class="is-flex" href="#静态工厂获取bean"><span class="mr-2">1.5.1</span><span>静态工厂获取bean</span></a></li><li><a class="is-flex" href="#静态工厂获取bean-1"><span class="mr-2">1.5.2</span><span>静态工厂获取bean</span></a></li></ul></li><li><a class="is-flex" href="#6、实现FactoryBean工厂获取所需的Bean"><span class="mr-2">1.6</span><span>6、实现FactoryBean工厂获取所需的Bean</span></a></li><li><a class="is-flex" href="#7、Bean的生命周期"><span class="mr-2">1.7</span><span>7、Bean的生命周期</span></a><ul class="menu-list"><li><a class="is-flex" href="#1-单例-默认singleton-："><span class="mr-2">1.7.1</span><span>1)单例(默认singleton)：</span></a></li><li><a class="is-flex" href="#2-多例-prototype"><span class="mr-2">1.7.2</span><span>2)多例(prototype):</span></a></li><li><a class="is-flex" href="#3-bean的前置后置处理器"><span class="mr-2">1.7.3</span><span>3)bean的前置后置处理器</span></a></li></ul></li><li><a class="is-flex" href="#8、Spring管理连接池"><span class="mr-2">1.8</span><span>8、Spring管理连接池</span></a><ul class="menu-list"><li><a class="is-flex" href="#1、通过xml配置连接池"><span class="mr-2">1.8.1</span><span>1、通过xml配置连接池</span></a></li><li><a class="is-flex" href="#2、引用外部文件抽取连接配置"><span class="mr-2">1.8.2</span><span>2、引用外部文件抽取连接配置</span></a></li></ul></li><li><a class="is-flex" href="#9、基于xml的自动装配"><span class="mr-2">1.9</span><span>9、基于xml的自动装配</span></a><ul class="menu-list"><li><a class="is-flex" href="#1-手动装配"><span class="mr-2">1.9.1</span><span>1)手动装配</span></a></li><li><a class="is-flex" href="#装配list集合"><span class="mr-2">1.9.2</span><span>装配list集合</span></a></li></ul></li><li><a class="is-flex" href="#10、SPEL表达式-表达式"><span class="mr-2">1.10</span><span>10、SPEL表达式(#表达式)</span></a></li><li><a class="is-flex" href="#11、通过注解创建Dao-Service-Controller"><span class="mr-2">1.11</span><span>11、通过注解创建Dao,Service,Controller</span></a><ul class="menu-list"><li><a class="is-flex" href="#1-扫描指定所有带注解的包"><span class="mr-2">1.11.1</span><span>1)扫描指定所有带注解的包</span></a></li><li><a class="is-flex" href="#2-为指定组件指定id名称"><span class="mr-2">1.11.2</span><span>2)为指定组件指定id名称</span></a></li><li><a class="is-flex" href="#3-指定bean的作用域-单例，多例"><span class="mr-2">1.11.3</span><span>3)指定bean的作用域(单例，多例)</span></a></li><li><a class="is-flex" href="#4-排除扫描不包含的组件context-exclude-filter"><span class="mr-2">1.11.4</span><span>4)排除扫描不包含的组件context:exclude-filter</span></a></li><li><a class="is-flex" href="#5-扫描包含指定的组件context-include-filter"><span class="mr-2">1.11.5</span><span>5)扫描包含指定的组件context:include-filter</span></a></li></ul></li><li><a class="is-flex" href="#12、-Autowired自动装配原理"><span class="mr-2">1.12</span><span>12、@Autowired自动装配原理</span></a><ul class="menu-list"><li><a class="is-flex" href="#1-配合-Qualifier使用"><span class="mr-2">1.12.1</span><span>1)配合@Qualifier使用</span></a></li><li><a class="is-flex" href="#2-指定-Autowired-required-false"><span class="mr-2">1.12.2</span><span>2)指定@Autowired(required = false)</span></a></li><li><a class="is-flex" href="#3-在方法参数上使用-Autowired和-Qualifier"><span class="mr-2">1.12.3</span><span>3)在方法参数上使用@Autowired和@Qualifier</span></a></li></ul></li><li><a class="is-flex" href="#13、-Resource自动装配与-Autowired的区别"><span class="mr-2">1.13</span><span>13、@Resource自动装配与@Autowired的区别</span></a><ul class="menu-list"><li><a class="is-flex" href="#1-Autowired"><span class="mr-2">1.13.1</span><span>1)@Autowired</span></a></li><li><a class="is-flex" href="#2-Resource"><span class="mr-2">1.13.2</span><span>2)@Resource</span></a></li></ul></li><li><a class="is-flex" href="#14、Spring的单元测试"><span class="mr-2">1.14</span><span>14、Spring的单元测试</span></a></li><li><a class="is-flex" href="#15、泛型依赖注入"><span class="mr-2">1.15</span><span>15、泛型依赖注入</span></a></li><li><a class="is-flex" href="#16、BeanFactory和ApplicationContext的区别-面试"><span class="mr-2">1.16</span><span>16、BeanFactory和ApplicationContext的区别(面试)</span></a></li><li><a class="is-flex" href="#17、Bean的生命周期-初始化流程-面试"><span class="mr-2">1.17</span><span>17、Bean的生命周期(初始化流程)面试</span></a></li></ul></li><li><a class="is-flex" href="#二、AOP"><span class="mr-2">2</span><span>二、AOP</span></a><ul class="menu-list"><li><a class="is-flex" href="#1、基本概念"><span class="mr-2">2.1</span><span>1、基本概念</span></a><ul class="menu-list"><li><a class="is-flex" href="#AOP与OOP区别？"><span class="mr-2">2.1.1</span><span>AOP与OOP区别？</span></a></li></ul></li><li><a class="is-flex" href="#2、使用场景"><span class="mr-2">2.2</span><span>2、使用场景</span></a><ul class="menu-list"><li><a class="is-flex" href="#1-基于接口的jdk动态代理实现"><span class="mr-2">2.2.1</span><span>1)基于接口的jdk动态代理实现</span></a></li></ul></li><li><a class="is-flex" href="#3、专业术语解释"><span class="mr-2">2.3</span><span>3、专业术语解释</span></a></li><li><a class="is-flex" href="#4、AOP简单配置流程"><span class="mr-2">2.4</span><span>4、AOP简单配置流程</span></a><ul class="menu-list"><li><a class="is-flex" href="#配置流程："><span class="mr-2">2.4.1</span><span>配置流程：</span></a></li><li><a class="is-flex" href="#2-目标对象没有实现接口-cglib代理"><span class="mr-2">2.4.2</span><span>2)目标对象没有实现接口(cglib代理)</span></a></li></ul></li><li><a class="is-flex" href="#5、切点表达式详解"><span class="mr-2">2.5</span><span>5、切点表达式详解</span></a></li><li><a class="is-flex" href="#6、AOP中的JoinPoint-返回值-异常对象"><span class="mr-2">2.6</span><span>6、AOP中的JoinPoint/返回值/异常对象</span></a></li><li><a class="is-flex" href="#7、提取切点表达式实现重用"><span class="mr-2">2.7</span><span>7、提取切点表达式实现重用</span></a></li><li><a class="is-flex" href="#8、-Around环绕通知的使用"><span class="mr-2">2.8</span><span>8、@Around环绕通知的使用</span></a></li><li><a class="is-flex" href="#9、普通通知和环绕通知共存的执行顺序"><span class="mr-2">2.9</span><span>9、普通通知和环绕通知共存的执行顺序</span></a></li><li><a class="is-flex" href="#10、多切面AOP"><span class="mr-2">2.10</span><span>10、多切面AOP</span></a></li><li><a class="is-flex" href="#11、AOP应用场景"><span class="mr-2">2.11</span><span>11、AOP应用场景</span></a></li><li><a class="is-flex" href="#12、基于XML配置AOP"><span class="mr-2">2.12</span><span>12、基于XML配置AOP</span></a></li><li><a class="is-flex" href="#13、XML配置多切面"><span class="mr-2">2.13</span><span>13、XML配置多切面</span></a></li></ul></li><li><a class="is-flex" href="#三、事务"><span class="mr-2">3</span><span>三、事务</span></a><ul class="menu-list"><li><a class="is-flex" href="#1、数据库事务及四大特性-ACID"><span class="mr-2">3.1</span><span>1、数据库事务及四大特性(ACID)</span></a></li><li><a class="is-flex" href="#2、MySQL中的事务"><span class="mr-2">3.2</span><span>2、MySQL中的事务</span></a><ul class="menu-list"><li><a class="is-flex" href="#1-修改MySQL隔离级别-默认为可重复读"><span class="mr-2">3.2.1</span><span>1)修改MySQL隔离级别(默认为可重复读)</span></a></li><li><a class="is-flex" href="#2-查询MySQL的隔离级别"><span class="mr-2">3.2.2</span><span>2)查询MySQL的隔离级别</span></a></li><li><a class="is-flex" href="#3-MySQL事务操作"><span class="mr-2">3.2.3</span><span>3)MySQL事务操作</span></a></li></ul></li><li><a class="is-flex" href="#2、JDBC中的事务处理"><span class="mr-2">3.3</span><span>2、JDBC中的事务处理</span></a></li><li><a class="is-flex" href="#3、配置声明式-注解-事务"><span class="mr-2">3.4</span><span>3、配置声明式(注解)事务</span></a></li><li><a class="is-flex" href="#4、-Transaction注解属性详解"><span class="mr-2">3.5</span><span>4、@Transaction注解属性详解</span></a><ul class="menu-list"><li><a class="is-flex" href="#0-transactionManager-配置多事务管理器"><span class="mr-2">3.5.1</span><span>0)transactionManager 配置多事务管理器</span></a></li><li><a class="is-flex" href="#1-timeout-单位秒"><span class="mr-2">3.5.2</span><span>1)timeout(单位秒)</span></a></li><li><a class="is-flex" href="#2-readOnly"><span class="mr-2">3.5.3</span><span>2)readOnly</span></a></li><li><a class="is-flex" href="#3-事务回滚异常分类"><span class="mr-2">3.5.4</span><span>3)事务回滚异常分类</span></a></li><li><a class="is-flex" href="#①noRollbackFor"><span class="mr-2">3.5.5</span><span>①noRollbackFor</span></a></li><li><a class="is-flex" href="#②rollbackFor"><span class="mr-2">3.5.6</span><span>②rollbackFor</span></a></li><li><a class="is-flex" href="#④串行化-SERIALIZABLE-–避免一切"><span class="mr-2">3.5.7</span><span>④串行化(SERIALIZABLE)–避免一切</span></a></li><li><a class="is-flex" href="#REQUIRES-NEW和REQUIRED传播行为详解"><span class="mr-2">3.5.8</span><span>REQUIRES_NEW和REQUIRED传播行为详解</span></a></li></ul></li><li><a class="is-flex" href="#6、事务失效的几种情况"><span class="mr-2">3.6</span><span>6、事务失效的几种情况</span></a></li></ul></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">链接</h3><ul class="menu-list"><li><a class="level is-mobile is-mobile" href="http://vhr.louchen.top/index.html" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">人事管理</span></span><span class="level-right"><span class="level-item tag">vhr.louchen.top</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/categories/Git/"><span class="level-start"><span class="level-item">Git</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/IDEA/"><span class="level-start"><span class="level-item">IDEA</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/JavaWeb/"><span class="level-start"><span class="level-item">JavaWeb</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Java%E5%9F%BA%E7%A1%80/"><span class="level-start"><span class="level-item">Java基础</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Linux/"><span class="level-start"><span class="level-item">Linux</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/MySQL/"><span class="level-start"><span class="level-item">MySQL</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Nginx/"><span class="level-start"><span class="level-item">Nginx</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Redis/"><span class="level-start"><span class="level-item">Redis</span></span><span class="level-end"><span class="level-item tag">15</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/SSM/"><span class="level-start"><span class="level-item">SSM</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Spring/"><span class="level-start"><span class="level-item">Spring</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Spring-Boot/"><span class="level-start"><span class="level-item">Spring Boot</span></span><span class="level-end"><span class="level-item tag">22</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Spring-Cache/"><span class="level-start"><span class="level-item">Spring Cache</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Spring-Security/"><span class="level-start"><span class="level-item">Spring Security</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/SpringBoot/"><span class="level-start"><span class="level-item">SpringBoot</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/SpringMVC/"><span class="level-start"><span class="level-item">SpringMVC</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Windows/"><span class="level-start"><span class="level-item">Windows</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/"><span class="level-start"><span class="level-item">并发编程</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/%E8%99%9A%E6%8B%9F%E6%9C%BA/"><span class="level-start"><span class="level-item">虚拟机</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/%E9%A1%B9%E7%9B%AE%E6%9E%84%E5%BB%BA%E9%83%A8%E7%BD%B2/"><span class="level-start"><span class="level-item">项目构建部署</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">订阅更新</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button is-primary" type="submit" value="订阅"></div></div></form></div></div></div><div class="column-right-shadow is-hidden-widescreen"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3"><div class="card widget"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content size-small"><p><time dateTime="2020-08-07T11:31:32.683Z">2020-08-07</time></p><p class="title is-6"><a class="link-muted" href="/2020/08/07/mysql/MySQL%E5%9F%BA%E7%A1%80/">MySQL基础</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/MySQL/">MySQL</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-08-07T11:31:32.646Z">2020-08-07</time></p><p class="title is-6"><a class="link-muted" href="/2020/08/07/mysql/MySQL%E8%BF%9B%E9%98%B6/">MySQL进阶</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/MySQL/">MySQL</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-07-24T15:14:33.039Z">2020-07-24</time></p><p class="title is-6"><a class="link-muted" href="/2020/07/24/websocket/WebSocket%E7%AE%80%E4%BB%8B/">WebSocket和Socket初识</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/Spring-Boot/">Spring Boot</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-07-24T15:14:33.038Z">2020-07-24</time></p><p class="title is-6"><a class="link-muted" href="/2020/07/24/websocket/SpringBoot%E6%95%B4%E5%90%88WebSocket/">SpringBoot整合WebSocket</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/Spring-Boot/">Spring Boot</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-07-24T15:14:33.027Z">2020-07-24</time></p><p class="title is-6"><a class="link-muted" href="/2020/07/24/thread/%E5%A4%9A%E7%BA%BF%E7%A8%8B/">深入理解Java并发编程</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/">并发编程</a></p></div></article></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/archives/2020/08/"><span class="level-start"><span class="level-item">八月 2020</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/07/"><span class="level-start"><span class="level-item">七月 2020</span></span><span class="level-end"><span class="level-item tag">68</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/ActiveMQ/"><span class="tag">ActiveMQ</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Docker/"><span class="tag">Docker</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Ehcache/"><span class="tag">Ehcache</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/FastDFS/"><span class="tag">FastDFS</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Git/"><span class="tag">Git</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/IDEA/"><span class="tag">IDEA</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/JAR/"><span class="tag">JAR</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/JDK1-8/"><span class="tag">JDK1.8</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/JVM/"><span class="tag">JVM</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/JWT/"><span class="tag">JWT</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Java%E5%9F%BA%E7%A1%80/"><span class="tag">Java基础</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Maven/"><span class="tag">Maven</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/MongoDB/"><span class="tag">MongoDB</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/MySQL/"><span class="tag">MySQL</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Nginx/"><span class="tag">Nginx</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/OAuth2/"><span class="tag">OAuth2</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Quartz/"><span class="tag">Quartz</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/RESTful/"><span class="tag">RESTful</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/RabbitMQ/"><span class="tag">RabbitMQ</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Redis/"><span class="tag">Redis</span><span class="tag is-grey-lightest">16</span></a></div><div class="control"><a class="tags has-addons" href="/tags/SSM/"><span class="tag">SSM</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Servlet/"><span class="tag">Servlet</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Session/"><span class="tag">Session</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Shiro/"><span class="tag">Shiro</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Spring/"><span class="tag">Spring</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Spring-Boot/"><span class="tag">Spring Boot</span><span class="tag is-grey-lightest">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Spring-Security/"><span class="tag">Spring Security</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/SpringBoot/"><span class="tag">SpringBoot</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/SpringMVC/"><span class="tag">SpringMVC</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Swagger2/"><span class="tag">Swagger2</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/WAR/"><span class="tag">WAR</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/WebSocket/"><span class="tag">WebSocket</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F/"><span class="tag">代理模式</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%8F%8D%E5%B0%84/"><span class="tag">反射</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%A4%9A%E6%95%B0%E6%8D%AE%E6%BA%90/"><span class="tag">多数据源</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"><span class="tag">多线程</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/"><span class="tag">定时任务</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%B3%9B%E5%9E%8B/"><span class="tag">泛型</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%B6%88%E6%81%AF%E6%9C%8D%E5%8A%A1/"><span class="tag">消息服务</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E9%82%AE%E4%BB%B6%E6%9C%8D%E5%8A%A1/"><span class="tag">邮件服务</span><span class="tag is-grey-lightest">1</span></a></div></div></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/favicon.ico" alt="MilkLc" height="28"></a><p class="size-small"><span>&copy; 2020 lc</span>  Powered by <a href="#" target="_blank" rel="noopener">LouChen</a>  </p><p class="size-small"><a href="http://www.miitbeian.gov.cn">鄂ICP备19030764号-1</a></p></div><div style="margin-left:-150px"><span id="busuanzi_container_site_pv">本站总访问量 <span id="busuanzi_value_site_pv" style="color:blue;font-size: 17px"></span> 次</span><span class="post-meta-divider"> | </span><span id="busuanzi_container_site_uv" style="display:none">本站访客数 <span id="busuanzi_value_site_uv" style="color:blue;font-size: 17px"></span> 人</span><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><div class="level-end"></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            site: {
                url: 'http://yoursite.com',
                external_link: {"enable":true,"exclude":[]}
            },
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>