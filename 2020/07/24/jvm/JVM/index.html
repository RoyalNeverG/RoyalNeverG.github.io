<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="generator" content="Hexo 4.2.0"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>深入理解JVM虚拟机 - MilkLc</title><meta description="Ⅰ、jvm简介一、什么是JVMjava虚拟机(java virtual machine)    java程序的运行环境(java二进制字节码的运行环境) 好处：  一次编写，导出运行 自动内存管理，垃圾回收功能 多态 数组下标越界检查 …  二、jre、jdk、jvm的区别？"><meta property="og:type" content="blog"><meta property="og:title" content="深入理解JVM虚拟机"><meta property="og:url" content="http://yoursite.com/2020/07/24/jvm/JVM/"><meta property="og:site_name" content="MilkLc"><meta property="og:description" content="Ⅰ、jvm简介一、什么是JVMjava虚拟机(java virtual machine)    java程序的运行环境(java二进制字节码的运行环境) 好处：  一次编写，导出运行 自动内存管理，垃圾回收功能 多态 数组下标越界检查 …  二、jre、jdk、jvm的区别？"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://img.louchen.top/2020/06/20200607100740.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200606175600.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200607103601.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200606195415.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200606200525.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200606201902.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200606204055.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200606204739.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200606210845.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200606213536.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200606213815.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200606214420.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200606220054.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200607094603.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200606221952.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200606223456.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200607094633.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200607094705.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200606224236.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200607095215.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200607095846.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200607095938.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200607100034.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200607100223.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200607102244.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200607104419.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200607104400.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200607110324.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200608122421.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200608125756.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200608130415.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200609100526.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200609101353.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200609101909.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200609102630.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200609104056.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200609104733.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200609105239.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200609105610.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200609110400.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200610151337.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200611114208.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200610152107.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200610152127.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200610181103.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200610181319.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200610195843.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200611111814.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200611114330.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200611122240.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200611173322.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200613101502.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200613100746.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200613100825.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200613101319.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200613103558.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200613105502.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200613170355.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200613210928.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200613211422.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200613211637.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200613211929.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200613212609.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200613212729.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200613213049.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200613213158.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200613214708.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200613214727.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200613214814.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200613214922.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200613214958.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200613215013.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200613215013.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200613215049.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200613215116.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200613215245.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200613215319.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200613231752.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200613231914.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200613232121.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200613232221.png"><meta property="og:image" content="c:/Users/42119/AppData/Roaming/Typora/typora-user-images/image-20200613232430140.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200613232533.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200613232759.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200613233048.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200613233356.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200613233523.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200613233554.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200615212941.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200615214343.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200615214359.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200615232133.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200615232158.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200615233345.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200615233426.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200616173543.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200616173727.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200616174119.png"><meta property="og:image" content="http://img.louchen.top/2020/06/20200617000920.png"><meta property="article:published_time" content="2020-07-24T15:14:32.229Z"><meta property="article:modified_time" content="2020-08-30T13:28:51.719Z"><meta property="article:author" content="lc"><meta property="article:tag" content="JVM"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="http://img.louchen.top/2020/06/20200607100740.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://yoursite.com/2020/07/24/jvm/JVM/"},"headline":"MilkLc","image":["http://img.louchen.top/2020/06/20200607100740.png","http://img.louchen.top/2020/06/20200606175600.png","http://img.louchen.top/2020/06/20200607103601.png","http://img.louchen.top/2020/06/20200606195415.png","http://img.louchen.top/2020/06/20200606200525.png","http://img.louchen.top/2020/06/20200606201902.png","http://img.louchen.top/2020/06/20200606204055.png","http://img.louchen.top/2020/06/20200606204739.png","http://img.louchen.top/2020/06/20200606210845.png","http://img.louchen.top/2020/06/20200606213536.png","http://img.louchen.top/2020/06/20200606213815.png","http://img.louchen.top/2020/06/20200606214420.png","http://img.louchen.top/2020/06/20200606220054.png","http://img.louchen.top/2020/06/20200607094603.png","http://img.louchen.top/2020/06/20200606221952.png","http://img.louchen.top/2020/06/20200606223456.png","http://img.louchen.top/2020/06/20200607094633.png","http://img.louchen.top/2020/06/20200607094705.png","http://img.louchen.top/2020/06/20200606224236.png","http://img.louchen.top/2020/06/20200607095215.png","http://img.louchen.top/2020/06/20200607095846.png","http://img.louchen.top/2020/06/20200607095938.png","http://img.louchen.top/2020/06/20200607100034.png","http://img.louchen.top/2020/06/20200607100223.png","http://img.louchen.top/2020/06/20200607102244.png","http://img.louchen.top/2020/06/20200607104419.png","http://img.louchen.top/2020/06/20200607104400.png","http://img.louchen.top/2020/06/20200607110324.png","http://img.louchen.top/2020/06/20200608122421.png","http://img.louchen.top/2020/06/20200608125756.png","http://img.louchen.top/2020/06/20200608130415.png","http://img.louchen.top/2020/06/20200609100526.png","http://img.louchen.top/2020/06/20200609101353.png","http://img.louchen.top/2020/06/20200609101909.png","http://img.louchen.top/2020/06/20200609102630.png","http://img.louchen.top/2020/06/20200609104056.png","http://img.louchen.top/2020/06/20200609104733.png","http://img.louchen.top/2020/06/20200609105239.png","http://img.louchen.top/2020/06/20200609105610.png","http://img.louchen.top/2020/06/20200609110400.png","http://img.louchen.top/2020/06/20200610151337.png","http://img.louchen.top/2020/06/20200611114208.png","http://img.louchen.top/2020/06/20200610152107.png","http://img.louchen.top/2020/06/20200610152127.png","http://img.louchen.top/2020/06/20200610181103.png","http://img.louchen.top/2020/06/20200610181319.png","http://img.louchen.top/2020/06/20200610195843.png","http://img.louchen.top/2020/06/20200611111814.png","http://img.louchen.top/2020/06/20200611114330.png","http://img.louchen.top/2020/06/20200611122240.png","http://img.louchen.top/2020/06/20200611173322.png","http://img.louchen.top/2020/06/20200613101502.png","http://img.louchen.top/2020/06/20200613100746.png","http://img.louchen.top/2020/06/20200613100825.png","http://img.louchen.top/2020/06/20200613101319.png","http://img.louchen.top/2020/06/20200613103558.png","http://img.louchen.top/2020/06/20200613105502.png","http://img.louchen.top/2020/06/20200613170355.png","http://img.louchen.top/2020/06/20200613210928.png","http://img.louchen.top/2020/06/20200613211422.png","http://img.louchen.top/2020/06/20200613211637.png","http://img.louchen.top/2020/06/20200613211929.png","http://img.louchen.top/2020/06/20200613212609.png","http://img.louchen.top/2020/06/20200613212729.png","http://img.louchen.top/2020/06/20200613213049.png","http://img.louchen.top/2020/06/20200613213158.png","http://img.louchen.top/2020/06/20200613214708.png","http://img.louchen.top/2020/06/20200613214727.png","http://img.louchen.top/2020/06/20200613214814.png","http://img.louchen.top/2020/06/20200613214922.png","http://img.louchen.top/2020/06/20200613214958.png","http://img.louchen.top/2020/06/20200613215013.png","http://img.louchen.top/2020/06/20200613215013.png","http://img.louchen.top/2020/06/20200613215049.png","http://img.louchen.top/2020/06/20200613215116.png","http://img.louchen.top/2020/06/20200613215245.png","http://img.louchen.top/2020/06/20200613215319.png","http://img.louchen.top/2020/06/20200613231752.png","http://img.louchen.top/2020/06/20200613231914.png","http://img.louchen.top/2020/06/20200613232121.png","http://img.louchen.top/2020/06/20200613232221.png","c:/Users/42119/AppData/Roaming/Typora/typora-user-images/image-20200613232430140.png","http://img.louchen.top/2020/06/20200613232533.png","http://img.louchen.top/2020/06/20200613232759.png","http://img.louchen.top/2020/06/20200613233048.png","http://img.louchen.top/2020/06/20200613233356.png","http://img.louchen.top/2020/06/20200613233523.png","http://img.louchen.top/2020/06/20200613233554.png","http://img.louchen.top/2020/06/20200615212941.png","http://img.louchen.top/2020/06/20200615214343.png","http://img.louchen.top/2020/06/20200615214359.png","http://img.louchen.top/2020/06/20200615232133.png","http://img.louchen.top/2020/06/20200615232158.png","http://img.louchen.top/2020/06/20200615233345.png","http://img.louchen.top/2020/06/20200615233426.png","http://img.louchen.top/2020/06/20200616173543.png","http://img.louchen.top/2020/06/20200616173727.png","http://img.louchen.top/2020/06/20200616174119.png","http://img.louchen.top/2020/06/20200617000920.png"],"datePublished":"2020-07-24T15:14:32.229Z","dateModified":"2020-08-30T13:28:51.719Z","author":{"@type":"Person","name":"lc"},"description":"Ⅰ、jvm简介一、什么是JVMjava虚拟机(java virtual machine)    java程序的运行环境(java二进制字节码的运行环境) 好处：  一次编写，导出运行 自动内存管理，垃圾回收功能 多态 数组下标越界检查 …  二、jre、jdk、jvm的区别？"}</script><link rel="canonical" href="http://yoursite.com/2020/07/24/jvm/JVM/"><link rel="icon" href="/img/favicon.ico"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/favicon.ico" alt="MilkLc" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">主页</a><a class="navbar-item" href="/archives">归档</a><a class="navbar-item" href="/categories">分类</a><a class="navbar-item" href="/tags">标签</a><a class="navbar-item" href="/about">关于</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/RoyalNeverG"><i class="fab fa-github"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><input placeholder="你想要查找什么？" type="text"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-07-24T15:14:32.229Z" title="2020-07-24T15:14:32.229Z">2020-07-24</time><span class="level-item"><a class="link-muted" href="/categories/JVM/">JVM</a></span><span class="level-item">3 小时 读完 (大约 22940 个字)</span></div></div><h1 class="title is-3 is-size-4-mobile">深入理解JVM虚拟机</h1><div class="content"><h2 id="Ⅰ、jvm简介"><a href="#Ⅰ、jvm简介" class="headerlink" title="Ⅰ、jvm简介"></a>Ⅰ、jvm简介</h2><h3 id="一、什么是JVM"><a href="#一、什么是JVM" class="headerlink" title="一、什么是JVM"></a>一、什么是JVM</h3><p>java虚拟机<strong>(java virtual machine)</strong>    java程序的运行环境(java二进制字节码的运行环境)</p>
<p><strong>好处：</strong></p>
<ul>
<li>一次编写，导出运行</li>
<li>自动内存管理，垃圾回收功能</li>
<li>多态</li>
<li>数组下标越界检查</li>
<li>…</li>
</ul>
<h3 id="二、jre、jdk、jvm的区别？"><a href="#二、jre、jdk、jvm的区别？" class="headerlink" title="二、jre、jdk、jvm的区别？"></a>二、jre、jdk、jvm的区别？</h3><img src="http://img.louchen.top/2020/06/20200607100740.png" style="zoom: 67%;" />
<a id="more"></a>
### 三、JVM组成部分

<img src="http://img.louchen.top/2020/06/20200606175600.png" style="zoom: 50%;" />

<h3 id="四、常见的jvm"><a href="#四、常见的jvm" class="headerlink" title="四、常见的jvm"></a>四、常见的jvm</h3><p><img src="http://img.louchen.top/2020/06/20200607103601.png" alt=""></p>
<h2 id="Ⅱ、JVM内存结构"><a href="#Ⅱ、JVM内存结构" class="headerlink" title="Ⅱ、JVM内存结构"></a>Ⅱ、JVM内存结构</h2><h3 id="一、程序计数器-Program-Counter-Register"><a href="#一、程序计数器-Program-Counter-Register" class="headerlink" title="一、程序计数器(Program Counter Register)"></a>一、程序计数器(<em>Program Counter Register</em>)</h3><img src="http://img.louchen.top/2020/06/20200606195415.png" style="zoom: 67%;" />

<p><img src="http://img.louchen.top/2020/06/20200606200525.png" alt=""></p>
<h4 id="1-1定义"><a href="#1-1定义" class="headerlink" title="1.1定义"></a>1.1定义</h4><p><em>Program Counter Register</em> 程序计数器（寄存器） </p>
<ul>
<li><p><strong>java程序执行流程：</strong>首先java源代码编译成 –&gt; 二进制字节码(包含一系列jvm指令)–&gt; 通过解释器解释成机器码–&gt;机器码交给cpu识别运行</p>
</li>
<li><p><strong>程序计数器实现：</strong>在物理实现上是<strong>寄存器</strong>实现的</p>
</li>
<li><p><strong>作用：</strong>是记住下一条jvm指令的执行地址 (例如执行地址0 的代码getstatic,那么jvm就会存储3所对应的地址astore_1) </p>
</li>
<li><p><strong>特点：</strong></p>
<ul>
<li>线程私有</li>
<li>不会存在内存溢出</li>
</ul>
</li>
</ul>
<h3 id="二、虚拟机栈-Java-Virtual-Machine-Stacks"><a href="#二、虚拟机栈-Java-Virtual-Machine-Stacks" class="headerlink" title="二、虚拟机栈(Java Virtual Machine Stacks )"></a>二、虚拟机栈(Java Virtual Machine Stacks )</h3><img src="http://img.louchen.top/2020/06/20200606201902.png" style="zoom: 80%;" />

<h4 id="2-1定义"><a href="#2-1定义" class="headerlink" title="2.1定义"></a>2.1定义</h4><p>Java Virtual Machine Stacks （Java 虚拟机栈）</p>
<ul>
<li><p>栈中存的是基本数据类型和堆中对象的引用</p>
</li>
<li><p>每个线程运行时所分配的内存为虚拟机栈，jvm为每个线程分配一个<strong>虚拟机栈</strong></p>
</li>
<li><p>每个栈有多个栈帧(Frame)组成,对应着每个方法调用时的所占用的内存(每个运行的方法对应一个栈帧)</p>
</li>
<li><p>每个线程只能有一个<strong>活动栈帧</strong>(正在执行的那个方法)、对应着当前正在执行的那个方法</p>
</li>
</ul>
<h4 id="2-2栈演示："><a href="#2-2栈演示：" class="headerlink" title="2.2栈演示："></a><strong>2.2栈演示：</strong></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">T1</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        method1();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">method1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        method2(<span class="number">2</span>,<span class="number">3</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">method2</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a+b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="http://img.louchen.top/2020/06/20200606204055.png" alt=""></p>
<p>方法执行过程通过压栈的方式，为每一个方法分配一个栈帧，方法执行完后，采用先进后出的方式依次出栈。</p>
<h4 id="2-3问题辨析"><a href="#2-3问题辨析" class="headerlink" title="2.3问题辨析"></a>2.3问题辨析</h4><h5 id="①垃圾回收是否涉及栈内存？"><a href="#①垃圾回收是否涉及栈内存？" class="headerlink" title="①垃圾回收是否涉及栈内存？"></a>①垃圾回收是否涉及栈内存？</h5><p>不涉及，栈帧对应着一个一个的方法，方法执行完后，将出栈，自动释放内存。垃圾回收只是对堆内存回收</p>
<h5 id="②栈内存越大越好吗？"><a href="#②栈内存越大越好吗？" class="headerlink" title="②栈内存越大越好吗？"></a>②栈内存越大越好吗？</h5><p>可通过-Xss分配栈的内存，默认根据机器的内存自动分配。若本机内存500M,栈内存设置为1M,那么可以创建500个线程来使用分配栈的内存</p>
<p><img src="http://img.louchen.top/2020/06/20200606204739.png" alt=""></p>
<h5 id="③方法内的局部变量是否线程安全？"><a href="#③方法内的局部变量是否线程安全？" class="headerlink" title="③方法内的局部变量是否线程安全？"></a>③方法内的局部变量是否线程安全？</h5><p>不会，每个线程对应一个虚拟机栈，方法的执行对应每一个栈帧，内存相互独立，不会干扰。</p>
<ul>
<li>如果方法内的局部变量没有逃离方法的作用范围，则线程安全</li>
<li>若引用类型的变量通过方法传参，返回值返回则非线程安全</li>
</ul>
<h4 id="2-4栈内存溢出-StackOverflowError"><a href="#2-4栈内存溢出-StackOverflowError" class="headerlink" title="2.4栈内存溢出(StackOverflowError)"></a>2.4栈内存溢出(StackOverflowError)</h4><h5 id="①栈帧过多导致内存溢出-方法的递归调用"><a href="#①栈帧过多导致内存溢出-方法的递归调用" class="headerlink" title="①栈帧过多导致内存溢出(方法的递归调用)"></a>①栈帧过多导致内存溢出(<strong>方法的递归调用</strong>)</h5><h5 id="②栈帧过大导致栈内存溢出-Xss"><a href="#②栈帧过大导致栈内存溢出-Xss" class="headerlink" title="②栈帧过大导致栈内存溢出(-Xss)"></a>②栈帧过大导致栈内存溢出(-Xss)</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">T2</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> count;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            method1();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            System.out.println(count);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span>  <span class="title">method1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        count++;</span><br><span class="line">        method1();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">java.lang.StackOverflowError	</span><br><span class="line">	at org.lc.jvm_stack.T2.method1(T2.java:<span class="number">23</span>)</span><br><span class="line">    <span class="comment">//....</span></span><br><span class="line"><span class="number">18340</span></span><br></pre></td></tr></table></figure>

<p>上述递归方法执行了18340后出现栈的溢出，我们可以通过修改栈的内存大小为512K来让栈更快溢出</p>
<p><img src="http://img.louchen.top/2020/06/20200606210845.png" alt=""></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">java.lang.StackOverflowError	</span><br><span class="line">	at org.lc.jvm_stack.T2.method1(T2.java:<span class="number">23</span>)</span><br><span class="line">	<span class="comment">//....</span></span><br><span class="line"><span class="number">6617</span></span><br></pre></td></tr></table></figure>

<p>这次只递归调用了6617此即溢出</p>
<h5 id="③线程运行诊断-jstack"><a href="#③线程运行诊断-jstack" class="headerlink" title="③线程运行诊断(jstack)"></a>③线程运行诊断(jstack)</h5><h6 id="1-cpu过高-线程高负荷运行没有终止"><a href="#1-cpu过高-线程高负荷运行没有终止" class="headerlink" title="1)cpu过高(线程高负荷运行没有终止)"></a>1)cpu过高(线程高负荷运行没有终止)</h6><p>例如：线程中没有终止的条件对while(true)循环</p>
<ul>
<li>用top定位哪个进程对cpu的占用过高</li>
<li><code>ps H -eo pid,tid,%cpu | grep 进程id</code>（用ps命令进一步定位是哪个线程引起的cpu占用过高） <ul>
<li>H: 展示所有进程中的所有线程信息</li>
<li>eo: 输出指定内容</li>
<li>pid:进程id</li>
<li>tid:线程id</li>
<li>%cpu: cpu占用信息</li>
<li>| grep <code>进程id</code> : 利用管道操作符查找匹配进程id</li>
</ul>
</li>
</ul>
<img src="http://img.louchen.top/2020/06/20200606213536.png" style="zoom:50%;" />

<ul>
<li><p>找到占用高的cpu的线程后，记住进程id，使用 <code>jstack 进程id</code></p>
</li>
<li><p><code>jstack 进程id</code>  列出该进程下的所有线程信息</p>
<ul>
<li>可以根据线程id 找到有问题的线程，进一步定位到问题代码的源码行号。因为使用jstack展示的线程信息的id为16进制,所以我们需要将占用cpu高的<strong>线程tid</strong>，32665转换为16进制为7F99，找到7F99对应的线程thread1，找到出问题的代码行数</li>
</ul>
<img src="http://img.louchen.top/2020/06/20200606213815.png" style="zoom: 50%;" />

<img src="http://img.louchen.top/2020/06/20200606214420.png" style="zoom: 50%;" />

</li>
</ul>
<h6 id="2-程序运行很长时间没有结果-死锁"><a href="#2-程序运行很长时间没有结果-死锁" class="headerlink" title="2)程序运行很长时间没有结果 (死锁)"></a>2)程序运行很长时间没有结果 (死锁)</h6><h3 id="三、本地方法栈-Native-Method-Stacks"><a href="#三、本地方法栈-Native-Method-Stacks" class="headerlink" title="三、本地方法栈(Native Method Stacks)"></a>三、本地方法栈(Native Method Stacks)</h3><img src="http://img.louchen.top/2020/06/20200606220054.png" style="zoom: 80%;" />

<p>为本地的方法提供一块内存空间；例如Object中的wait,clone,sleep方法，方法用native修饰</p>
<h3 id="四、堆-Heap"><a href="#四、堆-Heap" class="headerlink" title="四、堆(Heap)"></a>四、堆(Heap)</h3><img src="http://img.louchen.top/2020/06/20200607094603.png" style="zoom:67%;" />

<h4 id="4-1定义"><a href="#4-1定义" class="headerlink" title="4.1定义"></a>4.1定义</h4><p><strong>Heap 堆</strong> </p>
<ul>
<li><strong>通过 new 关键字</strong>，创建对象都会使用堆内存。jdk&gt;=1.7类的静态变量也存在堆中。jdk&lt;=1.6类的静态变量存在方法区</li>
</ul>
<p><strong>特点:</strong></p>
<ul>
<li>它是线程共享的，堆中对象都需要考虑线程安全的问题 </li>
<li>有垃圾回收机制</li>
</ul>
<h4 id="4-2堆内存溢出-OutofMemoryError-Xmx"><a href="#4-2堆内存溢出-OutofMemoryError-Xmx" class="headerlink" title="4.2堆内存溢出(OutofMemoryError)(-Xmx)"></a>4.2堆内存溢出(OutofMemoryError)(-Xmx)</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">T1</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> i=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            String a = <span class="string">"hello"</span>;</span><br><span class="line">            <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">                a=a+a; <span class="comment">//会不断创建字符串进行拼接，该对象一直不被释放</span></span><br><span class="line">                i++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable throwable) &#123;</span><br><span class="line">            throwable.printStackTrace();</span><br><span class="line">            System.out.println(i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">java.lang.OutOfMemoryError: Java heap space</span><br><span class="line">	at java.util.Arrays.copyOfRange(Arrays.java:<span class="number">3664</span>)</span><br><span class="line">	at java.lang.String.&lt;init&gt;(String.java:<span class="number">207</span>)</span><br><span class="line">	at java.lang.StringBuilder.toString(StringBuilder.java:<span class="number">407</span>)</span><br><span class="line">	at org.lc.jvm_heap.T1.main(T1.java:<span class="number">16</span>)</span><br><span class="line"><span class="number">26</span></span><br></pre></td></tr></table></figure>

<p>通过参数-Xmx修改堆内存大小为8M缩短堆内存的溢出时间</p>
<p><img src="http://img.louchen.top/2020/06/20200606221952.png" alt=""></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">java.lang.OutOfMemoryError: Java heap space</span><br><span class="line">	at java.util.Arrays.copyOf(Arrays.java:<span class="number">3332</span>)</span><br><span class="line">	at java.lang.AbstractStringBuilder.ensureCapacityInternal(AbstractStringBuilder.java:<span class="number">124</span>)</span><br><span class="line">	at java.lang.AbstractStringBuilder.append(AbstractStringBuilder.java:<span class="number">448</span>)</span><br><span class="line">	at java.lang.StringBuilder.append(StringBuilder.java:<span class="number">136</span>)</span><br><span class="line">	at org.lc.jvm_heap.T1.main(T1.java:<span class="number">16</span>)</span><br><span class="line"><span class="number">17</span></span><br></pre></td></tr></table></figure>

<h4 id="4-3堆内存诊断"><a href="#4-3堆内存诊断" class="headerlink" title="4.3堆内存诊断"></a>4.3堆内存诊断</h4><h5 id="①jps-工具"><a href="#①jps-工具" class="headerlink" title="①jps 工具"></a>①jps 工具</h5><blockquote>
<p>模拟高内存占用代码</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">T2</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"1....."</span>);</span><br><span class="line">        Thread.sleep(<span class="number">30000</span>);</span><br><span class="line">        <span class="keyword">byte</span>[] array=<span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>*<span class="number">1024</span>*<span class="number">10</span>];</span><br><span class="line">        System.out.println(<span class="string">"2...."</span>);</span><br><span class="line">        Thread.sleep(<span class="number">30000</span>);</span><br><span class="line">        array=<span class="keyword">null</span>;</span><br><span class="line">        System.gc();<span class="comment">//垃圾回收</span></span><br><span class="line">        System.out.println(<span class="string">"3...."</span>);</span><br><span class="line">        Thread.sleep(<span class="number">100000000L</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>查看当前系统中S哪些 java 进程 </li>
<li><img src="http://img.louchen.top/2020/06/20200606223456.png" style="zoom: 67%;" />

</li>
</ul>
<h5 id="②jmap-工具"><a href="#②jmap-工具" class="headerlink" title="②jmap 工具"></a>②jmap 工具</h5><ul>
<li>查看堆内存占用情况 <code>jmap - heap 进程id</code></li>
<li><img src="http://img.louchen.top/2020/06/20200607094633.png" style="zoom: 80%;" />

</li>
</ul>
<h5 id="③jconsole工具"><a href="#③jconsole工具" class="headerlink" title="③jconsole工具"></a>③jconsole工具</h5><ul>
<li>图形界面的，多功能的监测工具，可以连续监测 </li>
<li>直接输入jconsole命令即可</li>
<li><img src="http://img.louchen.top/2020/06/20200607094705.png" alt=""></li>
<li><img src="http://img.louchen.top/2020/06/20200606224236.png" style="zoom: 67%;" />

</li>
</ul>
<h5 id="④jvisualvm工具-高内存占用"><a href="#④jvisualvm工具-高内存占用" class="headerlink" title="④jvisualvm工具(高内存占用)"></a>④jvisualvm工具(高内存占用)</h5><p><em>程序运行很长时间没有结果</em></p>
<blockquote>
<p>模拟代码</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">T3</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        List&lt;Student&gt; list=<span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">200</span>; i++) &#123;</span><br><span class="line">            list.add(<span class="keyword">new</span> Student());</span><br><span class="line">        &#125;</span><br><span class="line">        Thread.sleep(<span class="number">100000000L</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">byte</span>[] big = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span> * <span class="number">1024</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>我们首先使用<strong>jconsole</strong>工具来查看，并执行GC</li>
</ul>
<img src="http://img.louchen.top/2020/06/20200607095215.png" style="zoom: 67%;" />

<ul>
<li>我们发现虽然执行GC回收了一些内存，但是但是占用很高的内存。这时我们使用<strong>jvisualvm</strong>命令</li>
</ul>
<p><img src="http://img.louchen.top/2020/06/20200607095846.png" alt=""></p>
<ul>
<li>执行堆Dump，对内存进行<strong>快照</strong></li>
<li>点击查找<img src="http://img.louchen.top/2020/06/20200607095938.png" alt=""></li>
<li>点击进入占用内存大的类<img src="http://img.louchen.top/2020/06/20200607100034.png" style="zoom: 67%;" /></li>
<li>我们查看elementData存储的为元素Size有200个,每个元素占用1M作用。查看代码找出问题<img src="http://img.louchen.top/2020/06/20200607100223.png" style="zoom: 80%;" /></li>
</ul>
<h3 id="五、方法区-Method-Area"><a href="#五、方法区-Method-Area" class="headerlink" title="五、方法区(Method Area)"></a>五、方法区(Method Area)</h3><img src="http://img.louchen.top/2020/06/20200607102244.png" style="zoom: 80%;" />

<h4 id="5-1定义"><a href="#5-1定义" class="headerlink" title="5.1定义"></a>5.1定义</h4><p>官方：<a href="https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-2.html#jvms-2.5.4">https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-2.html#jvms-2.5.4</a></p>
<p>​        Java虚拟机有一个<strong>区域的方法,是所有Java虚拟机线程之间共享</strong>。方法区域类似于编译代码的存储区域传统语言或类似于“文本”段在一个操作系统的过程。它<strong>存储</strong>每个<strong>类结构</strong>如<strong>运行时常量池</strong>、<strong>字段</strong>和<strong>方法的数据</strong>和<strong>方法</strong>和<strong>构造函数的代码</strong>,包括<strong>特殊方法</strong>(§2.9)中使用的<strong>类和实例初始化和接口初始化(类的构造器)</strong>。方法区在jvm启动时创建，<strong>逻辑</strong>上(概念)是<strong>堆的组成部分</strong>。所以我们的方法区只是一种规范，方法区的实现由不同厂商决定，不强制它的实现位置。</p>
<h4 id="5-2组成"><a href="#5-2组成" class="headerlink" title="5.2组成"></a>5.2组成</h4><p>在我们使用的Oracle的jdk实现版本中，方法区的实现如下：</p>
<ul>
<li><p><strong>jdk1.6</strong>  </p>
<ul>
<li><p><strong>method Area</strong>只是一种概念。具体的实现是<strong>永久代(PermGen)</strong></p>
</li>
<li><p><strong>StringTable</strong>为串池</p>
</li>
<li><p><img src="http://img.louchen.top/2020/06/20200607104419.png" alt=""></p>
</li>
</ul>
</li>
<li><p><strong>jdk1.8</strong></p>
<ul>
<li><p>方法区的实现由永久代废弃，变为<strong>元空间(Metaspace)</strong>的实现，占用的内存为本地内存，即操作系统的内存</p>
</li>
<li><p><img src="http://img.louchen.top/2020/06/20200607104400.png" alt=""></p>
</li>
</ul>
</li>
</ul>
<h4 id="5-3方法区内存溢出-XX-MaxMetaspaceSize"><a href="#5-3方法区内存溢出-XX-MaxMetaspaceSize" class="headerlink" title="5.3方法区内存溢出(-XX:MaxMetaspaceSize)"></a>5.3方法区内存溢出(-XX:MaxMetaspaceSize)</h4><blockquote>
<p> 测试代码</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ClassLoader: 用来加载类的二进制字节码</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">T4</span> <span class="keyword">extends</span> <span class="title">ClassLoader</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> j=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            T4 test=<span class="keyword">new</span> T4();</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10000</span>; i++,j++) &#123;</span><br><span class="line">                <span class="comment">//ClassWriter 作用是生成类的二进制字节码</span></span><br><span class="line">                ClassWriter cw=<span class="keyword">new</span> ClassWriter(<span class="number">0</span>);</span><br><span class="line"><span class="comment">//                版本号 ; publc;  类名；包名； 父类； 接口</span></span><br><span class="line">                cw.visit(Opcodes.V1_8, Opcodes.ACC_PUBLIC, <span class="string">"Class"</span>+i,<span class="keyword">null</span>, <span class="string">"java/lang/Object"</span>, <span class="keyword">null</span>);</span><br><span class="line"><span class="comment">//                返回byte[]</span></span><br><span class="line">                <span class="keyword">byte</span>[] code=cw.toByteArray();</span><br><span class="line"><span class="comment">//                执行了类的加载</span></span><br><span class="line">                test.defineClass(<span class="string">"Class"</span>+i,code, <span class="number">0</span>, code.length); <span class="comment">//Class对象</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            System.out.println(j);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">10000</span></span><br></pre></td></tr></table></figure>

<p>默认不会出现内存溢出，因为此时<strong>jdk1.8</strong>的元空间实现的方法区使用的为操作系统的内存。本机操作系统内存足够大。</p>
<p>设置元空间(方法区)的大小为8M参数：<strong>-XX:MaxMetaspaceSize=10m</strong></p>
<p><img src="http://img.louchen.top/2020/06/20200607110324.png" alt=""></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//加载3331个类文件内存溢出</span></span><br><span class="line"><span class="number">3331</span></span><br><span class="line">Exception in thread <span class="string">"main"</span> java.lang.OutOfMemoryError: Compressed <span class="class"><span class="keyword">class</span> <span class="title">space</span></span></span><br><span class="line"><span class="class">	<span class="title">at</span> <span class="title">java</span>.<span class="title">lang</span>.<span class="title">ClassLoader</span>.<span class="title">defineClass1</span>(<span class="title">Native</span> <span class="title">Method</span>)</span></span><br><span class="line">	at java.lang.ClassLoader.defineClass(ClassLoader.java:763)</span><br><span class="line">	at java.lang.ClassLoader.defineClass(ClassLoader.java:<span class="number">642</span>)</span><br><span class="line">	at org.lc.jvm_heap.T4.main(T4.java:<span class="number">27</span>)</span><br><span class="line"></span><br><span class="line">Process finished with exit code <span class="number">1</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>1.8 以前会导致永久代内存溢出</strong><ul>
<li>设置永久代内存大小 <code>-XX:MaxPermSize=10m</code></li>
<li><code>java.lang.OutOfMemoryError: permGen space</code></li>
</ul>
</li>
<li><strong>1.8 之后会导致元空间内存溢出(默认不会溢出)</strong><ul>
<li>设置元空间内存大小 <code>-XX:MaxMetaspaceSize=10m</code></li>
<li><code>java.lang.OutOfMemoryError: Compressed class space</code></li>
</ul>
</li>
</ul>
<h4 id="5-4常量池-amp-运行时常量池"><a href="#5-4常量池-amp-运行时常量池" class="headerlink" title="5.4常量池&amp;运行时常量池"></a>5.4常量池&amp;运行时常量池</h4><blockquote>
<p>测试代码</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">T1</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"hello world"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p> 反编译文件：<code>javap -v T1.class</code></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">Last modified <span class="number">2020</span>-<span class="number">6</span>-<span class="number">7</span>; size <span class="number">547</span> bytes</span><br><span class="line">  MD5 checksum <span class="number">8f</span>4a2ef03e7776481657f0feef4a573a</span><br><span class="line">  Compiled from <span class="string">"T1.java"</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">org</span>.<span class="title">lc</span>.<span class="title">method_area</span>.<span class="title">T1</span></span></span><br><span class="line">  minor version: 0</span><br><span class="line">  major version: <span class="number">52</span></span><br><span class="line">  flags: ACC_PUBLIC, ACC_SUPER</span><br><span class="line">      <span class="comment">//常量池.......main方法中的指令根据`#序号`会在此处寻找对应的类型和输出的值</span></span><br><span class="line">Constant pool:</span><br><span class="line">   #1 = Methodref          #6.#20         // java/lang/Object."&lt;init&gt;":()V</span><br><span class="line">   #2 = Fieldref           #21.#22        // java/lang/System.out:Ljava/io/PrintStream;</span><br><span class="line">   #3 = String             #23            // hello world</span><br><span class="line">   #4 = Methodref          #24.#25        // java/io/PrintStream.println:(Ljava/lang/String;)V</span><br><span class="line">   #5 = Class              #26            // org/lc/method_area/T1</span><br><span class="line">   #6 = Class              #27            // java/lang/Object</span><br><span class="line">   #7 = Utf8               &lt;init&gt;</span><br><span class="line">   #8 = Utf8               ()V</span><br><span class="line">   #9 = Utf8               Code</span><br><span class="line">  #10 = Utf8               LineNumberTable</span><br><span class="line">  #11 = Utf8               LocalVariableTable</span><br><span class="line">  #12 = Utf8               this</span><br><span class="line">  #13 = Utf8               Lorg/lc/method_area/T1;</span><br><span class="line">  #14 = Utf8               main</span><br><span class="line">  #15 = Utf8               ([Ljava/lang/String;)V</span><br><span class="line">  #16 = Utf8               args</span><br><span class="line">  #17 = Utf8               [Ljava/lang/String;</span><br><span class="line">  #18 = Utf8               SourceFile</span><br><span class="line">  #19 = Utf8               T1.java</span><br><span class="line">  #20 = NameAndType        #7:#8          // "&lt;init&gt;":()V</span><br><span class="line">  #21 = Class              #28            // java/lang/System</span><br><span class="line">  #22 = NameAndType        #29:#30        // out:Ljava/io/PrintStream;</span><br><span class="line">  #23 = Utf8               hello world</span><br><span class="line">  #24 = Class              #31            // java/io/PrintStream</span><br><span class="line">  #25 = NameAndType        #32:#33        // println:(Ljava/lang/String;)V</span><br><span class="line">  #26 = Utf8               org/lc/method_area/T1</span><br><span class="line">  #27 = Utf8               java/lang/Object</span><br><span class="line">  #28 = Utf8               java/lang/System</span><br><span class="line">  #29 = Utf8               out</span><br><span class="line">  #30 = Utf8               Ljava/io/PrintStream;</span><br><span class="line">  #31 = Utf8               java/io/PrintStream</span><br><span class="line">  #32 = Utf8               println</span><br><span class="line">  #33 = Utf8               (Ljava/lang/String;)V</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">public</span> org.lc.method_area.T1();</span><br><span class="line">    descriptor: ()V</span><br><span class="line">    flags: ACC_PUBLIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=<span class="number">1</span>, locals=<span class="number">1</span>, args_size=<span class="number">1</span></span><br><span class="line">         <span class="number">0</span>: aload_0</span><br><span class="line">         1: invokespecial #1                  // Method java/lang/Object."&lt;init&gt;":()V</span><br><span class="line">         <span class="number">4</span>: <span class="keyword">return</span></span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line <span class="number">10</span>: <span class="number">0</span></span><br><span class="line">      LocalVariableTable:</span><br><span class="line">        Start  Length  Slot  Name   Signature</span><br><span class="line">            <span class="number">0</span>       <span class="number">5</span>     <span class="number">0</span>  <span class="keyword">this</span>   Lorg/lc/method_area/T1;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(java.lang.String[])</span></span>;</span><br><span class="line">    descriptor: ([Ljava/lang/String;)V</span><br><span class="line">    flags: ACC_PUBLIC, ACC_STATIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=<span class="number">2</span>, locals=<span class="number">1</span>, args_size=<span class="number">1</span></span><br><span class="line">         <span class="comment">//通过`#序号`的方式在常量池Constant pool中寻找对应的类型。</span></span><br><span class="line">         0: getstatic     #2   //在常量池中寻找#2序号               // Field java/lang/System.out:Ljava/io/PrintStream;</span><br><span class="line">         3: ldc           #3                  // String hello world</span><br><span class="line">         5: invokevirtual #4                  // Method java/io/PrintStream.println:(Ljava/lang/String;)V</span><br><span class="line">         <span class="number">8</span>: <span class="keyword">return</span></span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line <span class="number">12</span>: <span class="number">0</span></span><br><span class="line">        line <span class="number">13</span>: <span class="number">8</span></span><br><span class="line">      LocalVariableTable:</span><br><span class="line">        Start  Length  Slot  Name   Signature</span><br><span class="line">            <span class="number">0</span>       <span class="number">9</span>     <span class="number">0</span>  args   [Ljava/lang/String;</span><br><span class="line">&#125;</span><br><span class="line">SourceFile: <span class="string">"T1.java"</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>常量池</strong>，就是一张表，虚拟机指令根据这张常量表找到<strong>要执行的类名、方法名、参数类型、字面量</strong> 等信息 </li>
<li><strong>运行时常量池</strong>，常量池是 *.class 文件中的，当该类被加载，它的常量池信息就会放入运行时常量 池，并把里面的<code>#符号</code>地址变为真实地址，此时的常量池就叫运行时常量池</li>
</ul>
<h4 id="5-5StringTable-串池"><a href="#5-5StringTable-串池" class="headerlink" title="5.5StringTable(串池)"></a>5.5StringTable(串池)</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">T1</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"><span class="comment">//        1、串池 StringTable["a","b,"ab"] hashtable结构，不能扩容</span></span><br><span class="line"><span class="comment">//        2、串池中的字符串都不是重复的，若发现首次在串池中找不到所需的字符串，则会在创建的时候保存在串池中一份</span></span><br><span class="line"><span class="comment">//        3、字符串都是懒惰加载的,即允许到该代码行时才会在串池中创建存储</span></span><br><span class="line"><span class="comment">//        4、通过String s1=new String("ab")创建的字符传,若常量池中没有则，则会先将常量"ab"放在常量池中保存一份。再通过new一个String对象来从常量池中加载该"ab"常量,但是引用的变量s1为堆中的地址。只有调用s1.intern()方法，此s1才会执行常量池中的地址        </span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//        将"a" 保存在串池</span></span><br><span class="line">        String s1 = <span class="string">"a"</span>;</span><br><span class="line"><span class="comment">//        将"b" 保存在串池</span></span><br><span class="line">        String s2 = <span class="string">"b"</span>;</span><br><span class="line"><span class="comment">//        将"ab" 保存在串池</span></span><br><span class="line">        String s3 = <span class="string">"ab"</span>;</span><br><span class="line"><span class="comment">//        反编译发现 new StringBuilder().append(s1).append(s2).toString()。 即new String("ab")</span></span><br><span class="line"><span class="comment">//        重新在堆中创建一个字符串对象</span></span><br><span class="line">        String s4 = s1 + s2;</span><br><span class="line"><span class="comment">//        因为"a","b"在编译期已确定不会再更改，所以jvm在编译期间就帮我们优化为"ab"</span></span><br><span class="line">        String s5 = <span class="string">"a"</span> + <span class="string">"b"</span>;</span><br><span class="line"><span class="comment">//        反编译发现 new StringBuilder().append(s1).append("b").toString()。 即new String("ab")</span></span><br><span class="line">        String s6 = s1 + <span class="string">"b"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//        true，都是指向串池中的地址</span></span><br><span class="line">        System.out.println(s3==s5);</span><br><span class="line"><span class="comment">//        s3位串池中的地址。s6为堆中的地址，即false</span></span><br><span class="line">        System.out.println(s3==s6);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>javap -v T1.class</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">  Last modified <span class="number">2020</span>-<span class="number">6</span>-<span class="number">7</span>; size <span class="number">993</span> bytes</span><br><span class="line">  MD5 checksum <span class="number">72</span>da179befc5b24f8006197550ecf10c</span><br><span class="line">  Compiled from <span class="string">"T1.java"</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">org</span>.<span class="title">lc</span>.<span class="title">method_area</span>.<span class="title">T1</span></span></span><br><span class="line">  minor version: 0</span><br><span class="line">  major version: <span class="number">52</span></span><br><span class="line">  flags: ACC_PUBLIC, ACC_SUPER</span><br><span class="line">Constant pool:</span><br><span class="line">   #1 = Methodref          #12.#37        // java/lang/Object."&lt;init&gt;":()V</span><br><span class="line">   #2 = String             #38            // a</span><br><span class="line">   #3 = String             #39            // b</span><br><span class="line">   #4 = String             #40            // ab</span><br><span class="line">   <span class="comment">//....</span></span><br><span class="line">        stack=<span class="number">3</span>, locals=<span class="number">7</span>, args_size=<span class="number">1</span></span><br><span class="line">       		<span class="comment">//从串池中加载(即在常量池#2位置加载字符串a) a</span></span><br><span class="line">         0: ldc           #2                  // String a</span><br><span class="line">           	<span class="comment">//存储给变量Slot=1的变量，即变量s1</span></span><br><span class="line">         <span class="number">2</span>: astore_1 </span><br><span class="line">           <span class="comment">//从串池中加载 b  </span></span><br><span class="line">         3: ldc           #3                  // String b</span><br><span class="line">           <span class="comment">//存储给变量Slot=2的变量，即变量s2</span></span><br><span class="line">         <span class="number">5</span>: astore_2</span><br><span class="line">           <span class="comment">//从串池中加载 ab </span></span><br><span class="line">         6: ldc           #4                  // String ab</span><br><span class="line">           <span class="comment">//存储给变量Slot=3的变量，即变量s3</span></span><br><span class="line">         <span class="number">8</span>: astore_3</span><br><span class="line">           <span class="comment">//创建StringBuilder对象</span></span><br><span class="line">         9: new           #5                  // class java/lang/StringBuilder</span><br><span class="line">        <span class="number">12</span>: dup</span><br><span class="line">            <span class="comment">//创建一个无参的构造函数</span></span><br><span class="line">        13: invokespecial #6                  // Method java/lang/StringBuilder."&lt;init&gt;":()V</span><br><span class="line">            <span class="comment">//从Slot=1的变量位置读取字符串String s1="a"</span></span><br><span class="line">        <span class="number">16</span>: aload_1</span><br><span class="line">            <span class="comment">//使用append方法</span></span><br><span class="line">        17: invokevirtual #7                  // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;</span><br><span class="line">            <span class="comment">//从Slot=2的变量位置读取字符串String s2="b"</span></span><br><span class="line">        <span class="number">20</span>: aload_2</span><br><span class="line">            <span class="comment">//再次使用append方法</span></span><br><span class="line">        21: invokevirtual #7                  // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;</span><br><span class="line">            <span class="comment">//回调虚方法 toString()</span></span><br><span class="line">        24: invokevirtual #8                  // Method java/lang/StringBuilder.toString:()Ljava/lang/String;</span><br><span class="line">            <span class="comment">//储存到slot=4的位置 即储存给变量s4</span></span><br><span class="line">        <span class="number">27</span>: astore        <span class="number">4</span></span><br><span class="line">            <span class="comment">//直接从常量池中的#4位置加载字符串"ab"</span></span><br><span class="line">        29: ldc           #4                  // String ab</span><br><span class="line">            <span class="comment">//储存给Slot=5的位置，即变量s5</span></span><br><span class="line">        <span class="number">31</span>: astore        <span class="number">5</span></span><br><span class="line">            <span class="comment">//下面同理</span></span><br><span class="line">        33: new           #5                  // class java/lang/StringBuilder</span><br><span class="line">        <span class="number">36</span>: dup</span><br><span class="line">        37: invokespecial #6                  // Method java/lang/StringBuilder."&lt;init&gt;":()V</span><br><span class="line">        <span class="number">40</span>: aload_1</span><br><span class="line">        41: invokevirtual #7                  // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;</span><br><span class="line">        44: ldc           #3                  // String b</span><br><span class="line">        46: invokevirtual #7                  // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;</span><br><span class="line">        49: invokevirtual #8                  // Method java/lang/StringBuilder.toString:()Ljava/lang/String;</span><br><span class="line">        <span class="number">52</span>: astore        <span class="number">6</span></span><br><span class="line">        54: getstatic     #9                  // Field java/lang/System.out:Ljava/io/PrintStream;</span><br><span class="line">        <span class="number">57</span>: aload_3</span><br><span class="line">        <span class="number">58</span>: aload         <span class="number">6</span></span><br><span class="line">        <span class="number">60</span>: if_acmpne     <span class="number">67</span></span><br><span class="line">        <span class="number">63</span>: iconst_1</span><br><span class="line">        <span class="number">64</span>: goto          <span class="number">68</span></span><br><span class="line">        <span class="number">67</span>: iconst_0</span><br><span class="line">        68: invokevirtual #10                 // Method java/io/PrintStream.println:(Z)V</span><br><span class="line">        <span class="number">71</span>: <span class="keyword">return</span></span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line <span class="number">16</span>: <span class="number">0</span></span><br><span class="line">        line <span class="number">18</span>: <span class="number">3</span></span><br><span class="line">        line <span class="number">20</span>: <span class="number">6</span></span><br><span class="line">        line <span class="number">23</span>: <span class="number">9</span></span><br><span class="line">        line <span class="number">25</span>: <span class="number">29</span></span><br><span class="line">        line <span class="number">26</span>: <span class="number">33</span></span><br><span class="line">        line <span class="number">28</span>: <span class="number">54</span></span><br><span class="line">        line <span class="number">29</span>: <span class="number">71</span></span><br><span class="line">            <span class="comment">//从此处加载和赋值变量</span></span><br><span class="line">      LocalVariableTable:</span><br><span class="line">        Start  Length  Slot  Name   Signature</span><br><span class="line">            <span class="number">0</span>      <span class="number">72</span>     <span class="number">0</span>  args   [Ljava/lang/String;</span><br><span class="line">            <span class="number">3</span>      <span class="number">69</span>     <span class="number">1</span>    s1   Ljava/lang/String;</span><br><span class="line">            <span class="number">6</span>      <span class="number">66</span>     <span class="number">2</span>    s2   Ljava/lang/String;</span><br><span class="line">            <span class="number">9</span>      <span class="number">63</span>     <span class="number">3</span>    s3   Ljava/lang/String;</span><br><span class="line">           <span class="number">29</span>      <span class="number">43</span>     <span class="number">4</span>    s4   Ljava/lang/String;</span><br><span class="line">           <span class="number">33</span>      <span class="number">39</span>     <span class="number">5</span>    s5   Ljava/lang/String;</span><br><span class="line">           <span class="number">54</span>      <span class="number">18</span>     <span class="number">6</span>    s6   Ljava/lang/String;</span><br><span class="line">		<span class="comment">//.....</span></span><br></pre></td></tr></table></figure>

<h4 id="5-6StringTable特性"><a href="#5-6StringTable特性" class="headerlink" title="5.6StringTable特性"></a>5.6StringTable特性</h4><ul>
<li>常量池中的字符串仅是符号，第一次用到时才变为对象 </li>
<li>利用串池的机制，来避免重复创建字符串对象 </li>
<li>字符串变量拼接的原理是 StringBuilder （1.8） </li>
<li>字符串常量拼接的原理是编译期优化 </li>
<li>可以使用 <strong>intern</strong> 方法，主动将串池中还没有的字符串对象放入串池<ul>
<li>1.8 将这个字符串对象尝试放入串池，如果有则并不会放入，如果没有则放入串池， 会把串 池中的对象返回 </li>
<li>1.6 将这个字符串对象尝试放入串池，如果有则并不会放入，如果没有会把此对象复制一份， 放入串池， 会把<strong>串池中的对象返回</strong></li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">T2</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"><span class="comment">//        首先在串池中放入 "a","b"</span></span><br><span class="line">        String s1 = <span class="keyword">new</span> String(<span class="string">"a"</span>) + <span class="keyword">new</span> String(<span class="string">"b"</span>);</span><br><span class="line"><span class="comment">//        再将s1拼接成的"ab"手动放入串池，串池中没有，放入成功，则s1指向串池的内容。</span></span><br><span class="line">        String s2=s1.intern();  <span class="comment">//将s1放入串池的地址赋值给s2</span></span><br><span class="line"><span class="comment">//        所以 s1也为串池的内容 true   //注意若这里的jdk版本为1.6那么为fasle，因为这里会将对象s1拷贝一份到常量池,使用s1的时候还是堆中的对象，而不是常量池中的对象</span></span><br><span class="line">        System.out.println(s1 == <span class="string">"ab"</span>);</span><br><span class="line"><span class="comment">//        所以 s2也为串池的内容 true</span></span><br><span class="line">        System.out.println(s2 == <span class="string">"ab"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">T2</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"><span class="comment">//        首先在串池中放入 "ab"</span></span><br><span class="line">        String s0=<span class="string">"ab"</span>;</span><br><span class="line"><span class="comment">//        再在串池放入 "a" "b"</span></span><br><span class="line">        String s1 = <span class="keyword">new</span> String(<span class="string">"a"</span>) + <span class="keyword">new</span> String(<span class="string">"b"</span>);</span><br><span class="line"><span class="comment">//        再将s1拼接成的"ab"手动放入串池。</span></span><br><span class="line"><span class="comment">//        注意此时的串池中有"ab",则放入失败。返回串池中的"ab"给s2</span></span><br><span class="line">        String s2=s1.intern();</span><br><span class="line"><span class="comment">//        所以 s1是堆中的那个对象new String("ab")    false</span></span><br><span class="line">        System.out.println(s1 == s0);</span><br><span class="line"><span class="comment">//        所以 s2也为串池的内容          true</span></span><br><span class="line">        System.out.println(s2 == s0);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="5-7StringTale位置"><a href="#5-7StringTale位置" class="headerlink" title="5.7StringTale位置"></a>5.7StringTale位置</h4><ul>
<li>jdk1.6的时候，串池在方法区，即永久代。</li>
<li>jdk1.8的时候，串池在堆空间。方法区为元空间, 即本地内存。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">T3</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        List&lt;String&gt; list=<span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">int</span> j=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">260000</span>; i++) &#123;</span><br><span class="line">                list.add(String.valueOf(i).intern());</span><br><span class="line">                j++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable throwable) &#123;</span><br><span class="line">            throwable.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            System.out.println(j);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">java.lang.OutOfMemoryError: GC overhead limit exceeded <span class="comment">//超过了GC回收的限制  GC花费了大量的时间进行垃圾回收，但是还是只回收了一部分内存。</span></span><br><span class="line">	at java.lang.Integer.toString(Integer.java:<span class="number">401</span>)</span><br><span class="line">	at java.lang.String.valueOf(String.java:<span class="number">3099</span>)</span><br><span class="line">	at org.lc.method_area.T3.main(T3.java:<span class="number">19</span>)</span><br><span class="line"><span class="number">145683</span></span><br></pre></td></tr></table></figure>

<p>关掉GC回收，<code>-Xmx10m -XX:-UseGCOverheadLimit</code>  </p>
<p><code>-XX:-UseGCOverheadLimit</code>  -代表关闭 +代表开启</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">java.lang.OutOfMemoryError: Java heap space <span class="comment">//堆空间内存溢出</span></span><br><span class="line">	at java.lang.Integer.toString(Integer.java:<span class="number">401</span>)</span><br><span class="line">	at java.lang.String.valueOf(String.java:<span class="number">3099</span>)</span><br><span class="line">	at org.lc.method_area.T3.main(T3.java:<span class="number">19</span>)</span><br><span class="line"><span class="number">146834</span></span><br></pre></td></tr></table></figure>

<h4 id="5-8StringTable-垃圾回收"><a href="#5-8StringTable-垃圾回收" class="headerlink" title="5.8StringTable 垃圾回收"></a>5.8StringTable 垃圾回收</h4><p>当串池中的数据快占用满堆内存的时候，会触发一次GC垃圾回收操作，将没有地址引用的对象进行垃圾进行回收</p>
<h4 id="5-8StringTable调优"><a href="#5-8StringTable调优" class="headerlink" title="5.8StringTable调优"></a>5.8StringTable调优</h4><h5 id="①调整XX-StringTableSize"><a href="#①调整XX-StringTableSize" class="headerlink" title="①调整XX:StringTableSize"></a>①调整XX:StringTableSize</h5><p>StringTable是由hash表加链表组成(和hashmap类似)</p>
<p>例如：如果要把上万级的单词数量代码加载到串池中。若串池的StringTable的桶的个数过少，则索引时间会变慢，hash冲突会变高。</p>
<p>若读取到的40万个单词存到串池中，若设置StringTable个数为1000,那么每个桶的放的个数为400个单词。寻找字符串的时间会非常慢。所以当我们存储的字符串非常多需要放到串池中，那么我们可以考虑设置StringTable桶的个数：</p>
<p><code>-XX:StringTableSize=桶个数</code>，来减少hash碰撞的概率。</p>
<h5 id="②决定是否将字符串入池-使用intern-）"><a href="#②决定是否将字符串入池-使用intern-）" class="headerlink" title="②决定是否将字符串入池(使用intern()）"></a>②决定是否将字符串入池(使用intern()）</h5><p>当我们使用的字符串有大量的重复串时，我们可以使用<strong>String</strong>的<strong>intern()</strong>方法入池,下次遇到重复的串存储时，直接从串池中拿即可。减少内存占用。</p>
<p>在jdk1.8的时候，<strong>intern()</strong>方法首先对字符串入池，若池中存在则返回池中的字符串，否则将该字符串入池</p>
<h3 id="六、直接内存-Direct-Memory"><a href="#六、直接内存-Direct-Memory" class="headerlink" title="六、直接内存(Direct Memory)"></a>六、直接内存(Direct Memory)</h3><h4 id="6-1NIO-IO"><a href="#6-1NIO-IO" class="headerlink" title="6.1NIO/IO"></a>6.1NIO/IO</h4><ul>
<li><strong>同步阻塞IO模型</strong>读取文件：<ul>
<li>java本身不具备磁盘读写的能力，必须调用操作系统的函数才能方法读取内存中的数据</li>
<li>当CPU运行到内核态时，磁盘文件先加载到系统缓存区，java会在内存中划分一块缓冲区，再将系统缓冲区的代码读到java堆内存的缓冲区，完成一次缓冲拷贝，周而复始完成读取操作。</li>
</ul>
</li>
</ul>
<img src="http://img.louchen.top/2020/06/20200608122421.png" style="zoom: 50%;" />



<ul>
<li><strong>同步非阻塞NIO模型</strong>读取文件：<ul>
<li>操作系统划分一块direct memory区，操作系统和java代码都可以直接访问此缓冲区的数据，所以NIO少了一部分数据的复制操作。</li>
</ul>
</li>
</ul>
<img src="http://img.louchen.top/2020/06/20200608125756.png" style="zoom: 50%;" />

<h4 id="6-2定义"><a href="#6-2定义" class="headerlink" title="6.2定义"></a>6.2定义</h4><ul>
<li>常见于 NIO 操作时，用于<strong>数据缓冲区</strong></li>
<li>分配回收成本较高，但读写性能高 </li>
<li><strong>不受 JVM 内存回收管理</strong>（<strong>System.gc()</strong>只能回收jvm的垃圾，不能回收直接内存）</li>
</ul>
<h4 id="6-3直接内存溢出"><a href="#6-3直接内存溢出" class="headerlink" title="6.3直接内存溢出"></a>6.3直接内存溢出</h4><blockquote>
<p>使用NIO划分内存区域，模拟内存溢出</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">T4</span> </span>&#123;</span><br><span class="line">    <span class="comment">//100mb</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> _100Mb = <span class="number">1024</span> * <span class="number">1024</span> * <span class="number">100</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        List&lt;ByteBuffer&gt; list=<span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">int</span> i=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">                <span class="comment">//一次划分直接内存100MB</span></span><br><span class="line">                ByteBuffer byteBuffer=ByteBuffer.allocateDirect(_100Mb);</span><br><span class="line">                list.add(byteBuffer);</span><br><span class="line">                i++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            System.out.println(i);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Exception in thread <span class="string">"main"</span> java.lang.OutOfMemoryError: Direct buffer memory</span><br><span class="line">	at java.nio.Bits.reserveMemory(Bits.java:<span class="number">694</span>)</span><br><span class="line">	at java.nio.DirectByteBuffer.&lt;init&gt;(DirectByteBuffer.java:<span class="number">123</span>)</span><br><span class="line">	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:<span class="number">311</span>)</span><br><span class="line">	at org.lc.method_area.T4.main(T4.java:<span class="number">27</span>)</span><br><span class="line"><span class="number">36</span></span><br></pre></td></tr></table></figure>

<h4 id="6-4直接内存分配和回收原理"><a href="#6-4直接内存分配和回收原理" class="headerlink" title="6.4直接内存分配和回收原理"></a>6.4直接内存分配和回收原理</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">T1</span> </span>&#123;</span><br><span class="line"><span class="comment">//    1GB</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> _1GB=<span class="number">1024</span>*<span class="number">1024</span>*<span class="number">1024</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"><span class="comment">//        划分一块1GB大小的直接内存</span></span><br><span class="line">        ByteBuffer byteBuffer=ByteBuffer.allocateDirect(_1GB);</span><br><span class="line">        System.out.println(<span class="string">"分配完毕..."</span>);</span><br><span class="line">        System.in.read();</span><br><span class="line">        System.out.println(<span class="string">"开始释放..."</span>);</span><br><span class="line">        </span><br><span class="line">        System.gc();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们查看任务资源管理器，查看该程序的内存占用情况为1GB：</p>
<img src="http://img.louchen.top/2020/06/20200608130415.png" style="zoom:50%;" />

<p>运行完该代码后，发现内存已释放，我们能否得出结论是<strong>System.gc()</strong>释放的吗？不是。</p>
<ul>
<li><p>通过底层发现是使用了 <strong>Unsafe</strong> 对象完成<strong>直接内存的分配回收</strong>，并且回收<strong>需要主动调用 freeMemory</strong> 方法 </p>
</li>
<li><p><strong>ByteBuﬀer</strong> 的实现类内部，使用了 <strong>Cleaner</strong> （虚引用）来监测 <strong>ByteBuﬀer</strong> 对象，一旦 <strong>ByteBuﬀer</strong> 对象被垃圾回收，那么就会由 <strong>ReferenceHandler</strong> 线程通过 <strong>Cleaner</strong> 的 <strong>clean</strong> 方法调 用 <strong>freeMemory</strong> 来释放直接内存</p>
</li>
</ul>
<h5 id="①禁用显示的垃圾回收-System-gc"><a href="#①禁用显示的垃圾回收-System-gc" class="headerlink" title="①禁用显示的垃圾回收(System.gc())"></a>①禁用显示的垃圾回收(System.gc())</h5><p>即让System.gc()失效，避免程序员在代码中无意使用该Full GC方式回收垃圾，会回收新生代和老年代，会造成程序暂停时间较长。</p>
<p><em>-XX:+DisableExplicitGC</em>   禁用GC回收</p>
<p><em>-XX:-DisableExplicitGC</em>    开启GC回收</p>
<p>禁用垃圾回收以后，我们可以使用<strong>Unsafe</strong>的<strong>freeMemory</strong>来实现垃圾回收。或者等到内存占用到一定比例由jvm自动回收</p>
<h2 id="Ⅲ、垃圾回收"><a href="#Ⅲ、垃圾回收" class="headerlink" title="Ⅲ、垃圾回收"></a>Ⅲ、垃圾回收</h2><h3 id="一、如何判断对象可以回收"><a href="#一、如何判断对象可以回收" class="headerlink" title="一、如何判断对象可以回收"></a>一、如何判断对象可以回收</h3><h4 id="1-1引用计数法-废弃"><a href="#1-1引用计数法-废弃" class="headerlink" title="1.1引用计数法(废弃)"></a>1.1引用计数法(废弃)</h4><p>对象被引用，计数+1</p>
<p>对象直接相互引用，但是两个对象都没用到，对象无法回收<img src="http://img.louchen.top/2020/06/20200609100526.png" alt=""></p>
<h4 id="1-2可达性分析算法"><a href="#1-2可达性分析算法" class="headerlink" title="1.2可达性分析算法"></a>1.2可达性分析算法</h4><ul>
<li>Java 虚拟机中的垃圾回收器采用可达性分析来探索所有存活的对象</li>
<li>扫描堆中的对象，看是否能够沿着 <strong>GC Root对象 为起点的引用链找到该对象</strong>，找不到，表示可以 回收</li>
<li>哪些对象可以作为 <strong>GC Root</strong> ?<ul>
<li>系统类，<em>Object,HashMap,String…</em></li>
<li>本地方法</li>
<li>正在加锁的对象</li>
<li>活动线程中的对象</li>
</ul>
</li>
</ul>
<h4 id="1-3四种引用"><a href="#1-3四种引用" class="headerlink" title="1.3四种引用"></a>1.3四种引用</h4><blockquote>
<p>注：实线代表强引用</p>
</blockquote>
<img src="http://img.louchen.top/2020/06/20200609101353.png" style="zoom: 50%;" />

<h5 id="①强引用"><a href="#①强引用" class="headerlink" title="①强引用"></a>①强引用</h5><ul>
<li>只有所有 GC Roots 对象都不通过【强引用】引用该对象，该对象才能被垃圾回</li>
</ul>
<p><strong>强引用类型</strong>是我们平时写代码的时候最常用的引用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//创建一个对象，new出来的对象都是分配在java堆中的</span></span><br><span class="line">        Sample sample = <span class="keyword">new</span> Sample();   <span class="comment">//sample这个引用就是强引用</span></span><br><span class="line"></span><br><span class="line">        sample = <span class="keyword">null</span>;  </span><br><span class="line">        <span class="comment">//将这个引用指向空指针,</span></span><br><span class="line">        <span class="comment">//那么上面那个刚new来的对象就没用任何其它有效的引用指向它了</span></span><br><span class="line">        <span class="comment">//也就说该对象对于垃圾收集器是符合条件的</span></span><br><span class="line">        <span class="comment">//因此在接下来某个时间点 GC进行收集动作的时候, 该对象将会被销毁，内存被释放</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sample</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>由以上图可知，<strong>GCRoot</strong>根对象<strong>C和B</strong>同时引用对象<strong>A1</strong>,那么此时<strong>A1对象不能被回收。</strong></p>
<p>只有<strong>C和B同时断开</strong>和A1对象的引用时，<strong>A1对象才能被回收</strong></p>
<img src="http://img.louchen.top/2020/06/20200609101909.png" style="zoom: 50%;" />

<h5 id="②软引用"><a href="#②软引用" class="headerlink" title="②软引用"></a>②软引用</h5><ul>
<li>仅有软引用引用该对象时，在垃圾回收后，内存仍不足时会再次出发垃圾回收，回收软引用 对象 </li>
<li>可以配合引用队列来释放软引用自身 </li>
</ul>
<p>当<strong>A2对象有强对象B</strong>引用它时，<strong>A2对象不能被回收</strong></p>
<p>当<strong>A2没有被强对象引用</strong>时，<strong>只是被C对象间接引用(软引用)</strong>，那么当jvm进行垃圾回收时，若回收后还是发现内存不足，那么A2对象也有可能会被回收</p>
<img src="http://img.louchen.top/2020/06/20200609102630.png" style="zoom:50%;" />

<h5 id="③弱引用"><a href="#③弱引用" class="headerlink" title="③弱引用"></a>③弱引用</h5><ul>
<li>仅有弱引用引用该对象时，在垃圾回收时，无论内存是否充足，都会回收弱引用对象 </li>
<li>可以配合引用队列来释放弱引用自身 </li>
</ul>
<p>当<strong>A3对象有强对象B</strong>引用它时，<strong>A3对象不能被回收</strong></p>
<p>当<strong>A2没有被强对象B引用时</strong>，<strong>只是被C对象间接引用</strong>(弱引用)，那么当jvm进行垃圾回收操作时，无论内存是否充足，<strong>该对象都会被回收</strong></p>
<img src="http://img.louchen.top/2020/06/20200609104056.png" style="zoom:50%;" />

<h6 id="1-软弱引用配合引用队列"><a href="#1-软弱引用配合引用队列" class="headerlink" title="1)软弱引用配合引用队列"></a>1)软弱引用配合引用队列</h6><p><strong>软引用和弱引用可以配合引用队列使用，也可以不配合引用队列使用</strong></p>
<p>当软引用和弱引用的对象被释放后，引用自身也是一个对象，如果在创建的时候给软弱引用分配了一个引用队列，软弱引用所引用的对象被回收时，该软弱引用会进入这个引用队列。因为软弱引用也占用一定内存，也有可能被强引用所引用，所以需要当对软弱引用进行释放的时候，需要在引用队列中找到该软弱引用把它释放掉</p>
<img src="http://img.louchen.top/2020/06/20200609104733.png" style="zoom:50%;" />

<h5 id="④虚引用"><a href="#④虚引用" class="headerlink" title="④虚引用"></a>④虚引用</h5><ul>
<li>必须配合引用队列使用，主要配合 ByteBuﬀer 使用，被引用对象回收时，会将虚引用入队， 由 Reference Handler 线程调用虚引用相关方法释放直接内存 </li>
</ul>
<p>例如:当我们使用ByteBuffer声明一块直接内存的时候，如果ByteBuffer没有被B对象引用时，ByteBuffer可能被回收，但是此时所分配的直接内存不能被jvm所直接回收，所以此时ByteBuffer被释放后，虚引用会进入引用队列，使用Unsafe中的freeMemory方法找到该直接内存地址把该直接内存释放掉</p>
<img src="http://img.louchen.top/2020/06/20200609105239.png" style="zoom:50%;" />

<img src="http://img.louchen.top/2020/06/20200609105610.png" style="zoom:50%;" />

<h5 id="⑤终结器引用"><a href="#⑤终结器引用" class="headerlink" title="*⑤终结器引用"></a>*⑤终结器引用</h5><ul>
<li>无需手动编码，但其内部配合引用队列使用，在垃圾回收时，终结器引用入队（被引用对象 暂时没有被回收），再由 Finalizer 线程通过终结器引用找到被引用对象并调用它的 ﬁnalize 方法，第二次 GC 时才能回收被引用对象 </li>
</ul>
<p>当A4对象没有被强B对象引用时，A4对象可能会被回收，当jvm对A4对象回收时，会为A4对象创建一个终结器引用，并把该引用放入引用队列，这是A4对象还没有被回收，jvm在合适的时机再用一个优先级很低的finallizehandler线程，去队列中寻找有没有一个新加入的终结器引用，根据终结器引用找到该A4对象，并调用finallize()方法，释放该对象内存。所以该方法效率非常低，在第二次的时候才能被回收，优先级较低的线程使该finallize()可能不会被执行。</p>
<img src="http://img.louchen.top/2020/06/20200609110400.png" style="zoom:50%;" />

<h6 id="1-虚引用和终结器引用必须配合引用队列使用"><a href="#1-虚引用和终结器引用必须配合引用队列使用" class="headerlink" title="1)虚引用和终结器引用必须配合引用队列使用"></a>1)虚引用和终结器引用必须配合引用队列使用</h6><h4 id="1-4四种引用的应用"><a href="#1-4四种引用的应用" class="headerlink" title="1.4四种引用的应用"></a>1.4四种引用的应用</h4><h5 id="①软引用"><a href="#①软引用" class="headerlink" title="①软引用"></a>①软引用</h5><blockquote>
<p>未使用引用，将堆内存设置为20M</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">T1</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> _4MB=<span class="number">4</span>*<span class="number">1024</span>*<span class="number">1024</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        List&lt;<span class="keyword">byte</span>[]&gt; list=<span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">            list.add(<span class="keyword">new</span> <span class="keyword">byte</span>[_4MB]);</span><br><span class="line">        &#125;</span><br><span class="line">        System.in.read();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//发生堆内存溢出</span></span><br><span class="line">Exception in thread <span class="string">"main"</span> java.lang.OutOfMemoryError: Java heap space</span><br><span class="line">	at org.lc.jvm_reference.T1.main(T1.java:<span class="number">19</span>)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>使用软引用</p>
<p><code>-XX:+PrintGCDetails -verbose:gc</code>  查看GC的详细信息</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">soft</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//创建软引用对象，此时引用 List--&gt; SoftReference --&gt; byte[]</span></span><br><span class="line">        List&lt;SoftReference&lt;<span class="keyword">byte</span>[]&gt;&gt; list=<span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">            SoftReference&lt;<span class="keyword">byte</span>[]&gt; softReference = <span class="keyword">new</span> SoftReference&lt;&gt;(<span class="keyword">new</span> <span class="keyword">byte</span>[_4MB]);</span><br><span class="line">            list.add(softReference);</span><br><span class="line">            System.out.println(list.size());</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">"循环结束..."</span>+list.size());</span><br><span class="line">        <span class="keyword">for</span> (SoftReference&lt;<span class="keyword">byte</span>[]&gt; ref : list) &#123;</span><br><span class="line">            System.out.println(ref.get());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="comment">//加入第四个字节对象时，发现内存不足，进行一次垃圾回收</span></span><br><span class="line">[GC (Allocation Failure) [PSYoungGen: <span class="number">1994</span>K-&gt;<span class="number">488</span>K(<span class="number">6144</span>K)] <span class="number">14282</span>K-&gt;<span class="number">13005</span>K(<span class="number">19968</span>K), <span class="number">0.0027620</span> secs] [Times: user=<span class="number">0.00</span> sys=<span class="number">0.00</span>, real=<span class="number">0.00</span> secs] </span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="comment">//但是，回收后发现内存还是不足，即进行软引用的垃圾回收，将前面四个软引用回收掉</span></span><br><span class="line">[GC (Allocation Failure) --[PSYoungGen: <span class="number">4696</span>K-&gt;<span class="number">4696</span>K(<span class="number">6144</span>K)] <span class="number">17214</span>K-&gt;<span class="number">17222</span>K(<span class="number">19968</span>K), <span class="number">0.0009000</span> secs] [Times: user=<span class="number">0.00</span> sys=<span class="number">0.00</span>, real=<span class="number">0.00</span> secs] </span><br><span class="line">[<span class="function">Full <span class="title">GC</span> <span class="params">(Ergonomics)</span> [PSYoungGen: 4696K-&gt;4520<span class="title">K</span><span class="params">(<span class="number">6144</span>K)</span>] [ParOldGen: 12525K-&gt;12491<span class="title">K</span><span class="params">(<span class="number">13824</span>K)</span>] 17222K-&gt;17012<span class="title">K</span><span class="params">(<span class="number">19968</span>K)</span>, [Metaspace: 3214K-&gt;3214<span class="title">K</span><span class="params">(<span class="number">1056768</span>K)</span>], 0.0042977 secs] [Times: user</span>=<span class="number">0.06</span> sys=<span class="number">0.02</span>, real=<span class="number">0.00</span> secs] </span><br><span class="line">[GC (Allocation Failure) --[PSYoungGen: <span class="number">4520</span>K-&gt;<span class="number">4520</span>K(<span class="number">6144</span>K)] <span class="number">17012</span>K-&gt;<span class="number">17052</span>K(<span class="number">19968</span>K), <span class="number">0.0005820</span> secs] [Times: user=<span class="number">0.00</span> sys=<span class="number">0.00</span>, real=<span class="number">0.00</span> secs]</span><br><span class="line"><span class="comment">//触发full gc,把新生代和老年代内存都释放掉，即回收前四个软引用</span></span><br><span class="line">[<span class="function">Full <span class="title">GC</span> <span class="params">(Allocation Failure)</span> [PSYoungGen: 4520K-&gt;0<span class="title">K</span><span class="params">(<span class="number">6144</span>K)</span>] [ParOldGen: 12531K-&gt;610<span class="title">K</span><span class="params">(<span class="number">8704</span>K)</span>] 17052K-&gt;610<span class="title">K</span><span class="params">(<span class="number">14848</span>K)</span>, [Metaspace: 3214K-&gt;3214<span class="title">K</span><span class="params">(<span class="number">1056768</span>K)</span>], 0.0055406 secs] [Times: user</span>=<span class="number">0.00</span> sys=<span class="number">0.00</span>, real=<span class="number">0.01</span> secs] </span><br><span class="line"><span class="number">5</span></span><br><span class="line">循环结束...<span class="number">5</span></span><br><span class="line"><span class="keyword">null</span></span><br><span class="line"><span class="keyword">null</span></span><br><span class="line"><span class="keyword">null</span></span><br><span class="line"><span class="keyword">null</span></span><br><span class="line">    <span class="comment">//只获得了最后一次加入对象</span></span><br><span class="line">[B@<span class="number">135f</span>baa4</span><br><span class="line">Heap</span><br><span class="line"> <span class="comment">//新生代占的内存最大，即为最后一次加入的字节数组大小</span></span><br><span class="line"> PSYoungGen      total <span class="number">6144</span>K, used <span class="number">4376</span>K [<span class="number">0x00000000ff980000</span>, <span class="number">0x0000000100000000</span>, <span class="number">0x0000000100000000</span>)</span><br><span class="line">  eden space <span class="number">5632</span>K, <span class="number">77</span>% used [<span class="number">0x00000000ff980000</span>,<span class="number">0x00000000ffdc6220</span>,<span class="number">0x00000000fff00000</span>)</span><br><span class="line">  from space <span class="number">512</span>K, <span class="number">0</span>% used [<span class="number">0x00000000fff00000</span>,<span class="number">0x00000000fff00000</span>,<span class="number">0x00000000fff80000</span>)</span><br><span class="line">  to   space <span class="number">512</span>K, <span class="number">0</span>% used [<span class="number">0x00000000fff80000</span>,<span class="number">0x00000000fff80000</span>,<span class="number">0x0000000100000000</span>)</span><br><span class="line">     <span class="comment">//老年代的被回收</span></span><br><span class="line"> ParOldGen       total <span class="number">8704</span>K, used <span class="number">610</span>K [<span class="number">0x00000000fec00000</span>, <span class="number">0x00000000ff480000</span>, <span class="number">0x00000000ff980000</span>)</span><br><span class="line">  object space <span class="number">8704</span>K, <span class="number">7</span>% used [<span class="number">0x00000000fec00000</span>,<span class="number">0x00000000fec98888</span>,<span class="number">0x00000000ff480000</span>)</span><br><span class="line"> Metaspace       used <span class="number">3220</span>K, capacity <span class="number">4500</span>K, committed <span class="number">4864</span>K, reserved <span class="number">1056768</span>K</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">space</span>    <span class="title">used</span> 349<span class="title">K</span>, <span class="title">capacity</span> 388<span class="title">K</span>, <span class="title">committed</span> 512<span class="title">K</span>, <span class="title">reserved</span> 1048576<span class="title">K</span></span></span><br></pre></td></tr></table></figure>

<h6 id="1-使用引用队列"><a href="#1-使用引用队列" class="headerlink" title="1)使用引用队列"></a>1)使用引用队列</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">T1</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> _4MB=<span class="number">4</span>*<span class="number">1024</span>*<span class="number">1024</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">//创建软引用对象，此时引用 List--&gt; SoftReference --&gt; byte[]</span></span><br><span class="line">        List&lt;SoftReference&lt;<span class="keyword">byte</span>[]&gt;&gt; list=<span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line"><span class="comment">//        引用队列</span></span><br><span class="line">        ReferenceQueue&lt;<span class="keyword">byte</span>[]&gt; queue=<span class="keyword">new</span> ReferenceQueue&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">            <span class="comment">//软引用关联引用队列</span></span><br><span class="line">            SoftReference&lt;<span class="keyword">byte</span>[]&gt; softReference = <span class="keyword">new</span> SoftReference&lt;&gt;(<span class="keyword">new</span> <span class="keyword">byte</span>[_4MB],queue);</span><br><span class="line">            list.add(softReference);</span><br><span class="line">            System.out.println(list.size());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//        从队列中获取无用的 软引用对象，并移除</span></span><br><span class="line">        Reference&lt;? extends <span class="keyword">byte</span>[]&gt; poll = queue.poll();</span><br><span class="line">        <span class="keyword">while</span> (poll != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">//从集合重移除无用的软引用对象</span></span><br><span class="line">            list.remove(poll);</span><br><span class="line"><span class="comment">//            从队列中移除</span></span><br><span class="line">            poll=queue.poll();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"循环结束..."</span>+list.size());</span><br><span class="line">        <span class="keyword">for</span> (SoftReference&lt;<span class="keyword">byte</span>[]&gt; ref : list) &#123;</span><br><span class="line">            System.out.println(ref.get());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">5</span></span><br><span class="line">循环结束...<span class="number">1</span></span><br><span class="line">[B@<span class="number">135f</span>baa4</span><br></pre></td></tr></table></figure>

<h5 id="②弱引用"><a href="#②弱引用" class="headerlink" title="②弱引用"></a>②弱引用</h5><h6 id="1-使用引用队列-1"><a href="#1-使用引用队列-1" class="headerlink" title="1)使用引用队列"></a>1)使用引用队列</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">T2</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> _4MB=<span class="number">4</span>*<span class="number">1024</span>*<span class="number">1024</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        List&lt;WeakReference&lt;<span class="keyword">byte</span>[]&gt;&gt; list=<span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">            WeakReference&lt;<span class="keyword">byte</span>[]&gt; weakReference = <span class="keyword">new</span> WeakReference&lt;&gt;(<span class="keyword">new</span> <span class="keyword">byte</span>[_4MB]);</span><br><span class="line">            list.add(weakReference);</span><br><span class="line">            <span class="keyword">for</span> (WeakReference&lt;<span class="keyword">byte</span>[]&gt; w:list)&#123;</span><br><span class="line">                System.out.print(w.get()+<span class="string">""</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">"循环结束"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[B@<span class="number">135f</span>baa4</span><br><span class="line">[B@<span class="number">135f</span>baa4[B@<span class="number">45</span>ee12a7</span><br><span class="line">[B@<span class="number">135f</span>baa4[B@<span class="number">45</span>ee12a7[B@<span class="number">330</span>bedb4</span><br><span class="line"><span class="comment">//存入第四个对象的时候发生一次垃圾回收     触发minorGC回收年轻代                  </span></span><br><span class="line">[GC (Allocation Failure) [PSYoungGen: <span class="number">1993</span>K-&gt;<span class="number">488</span>K(<span class="number">6144</span>K)] <span class="number">14281</span>K-&gt;<span class="number">12985</span>K(<span class="number">19968</span>K), <span class="number">0.0019001</span> secs] [Times: user=<span class="number">0.00</span> sys=<span class="number">0.00</span>, real=<span class="number">0.00</span> secs] </span><br><span class="line">  <span class="comment">//第四个对象勉强存放成功</span></span><br><span class="line">[B@<span class="number">135f</span>baa4[B@<span class="number">45</span>ee12a7[B@<span class="number">330</span>bedb4[B@<span class="number">2503</span>dbd3</span><br><span class="line">  <span class="comment">//第五次存入对象的之前   再触发minorGC回收年轻代   回收掉第四次的若引用对象                       </span></span><br><span class="line">[GC (Allocation Failure) [PSYoungGen: <span class="number">4696</span>K-&gt;<span class="number">488</span>K(<span class="number">6144</span>K)] <span class="number">17194</span>K-&gt;<span class="number">13065</span>K(<span class="number">19968</span>K), <span class="number">0.0006471</span> secs] [Times: user=<span class="number">0.00</span> sys=<span class="number">0.00</span>, real=<span class="number">0.00</span> secs] </span><br><span class="line">[B@<span class="number">135f</span>baa4[B@<span class="number">45</span>ee12a7[B@<span class="number">330</span>bedb4 <span class="keyword">null</span> [B@<span class="number">4</span>b67cf4d</span><br><span class="line">循环结束</span><br><span class="line">Heap</span><br><span class="line"> PSYoungGen      total <span class="number">6144</span>K, used <span class="number">4752</span>K [<span class="number">0x00000000ff980000</span>, <span class="number">0x0000000100000000</span>, <span class="number">0x0000000100000000</span>)</span><br><span class="line">  eden space <span class="number">5632</span>K, <span class="number">75</span>% used [<span class="number">0x00000000ff980000</span>,<span class="number">0x00000000ffdaa000</span>,<span class="number">0x00000000fff00000</span>)</span><br><span class="line">  from space <span class="number">512</span>K, <span class="number">95</span>% used [<span class="number">0x00000000fff80000</span>,<span class="number">0x00000000ffffa020</span>,<span class="number">0x0000000100000000</span>)</span><br><span class="line">  to   space <span class="number">512</span>K, <span class="number">0</span>% used [<span class="number">0x00000000fff00000</span>,<span class="number">0x00000000fff00000</span>,<span class="number">0x00000000fff80000</span>)</span><br><span class="line"> ParOldGen       total <span class="number">13824</span>K, used <span class="number">12577</span>K [<span class="number">0x00000000fec00000</span>, <span class="number">0x00000000ff980000</span>, <span class="number">0x00000000ff980000</span>)</span><br><span class="line">  object space <span class="number">13824</span>K, <span class="number">90</span>% used [<span class="number">0x00000000fec00000</span>,<span class="number">0x00000000ff848700</span>,<span class="number">0x00000000ff980000</span>)</span><br><span class="line"> Metaspace       used <span class="number">3218</span>K, capacity <span class="number">4500</span>K, committed <span class="number">4864</span>K, reserved <span class="number">1056768</span>K</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">space</span>    <span class="title">used</span> 349<span class="title">K</span>, <span class="title">capacity</span> 388<span class="title">K</span>, <span class="title">committed</span> 512<span class="title">K</span>, <span class="title">reserved</span> 1048576<span class="title">K</span></span></span><br></pre></td></tr></table></figure>

<h3 id="二、垃圾回收算法"><a href="#二、垃圾回收算法" class="headerlink" title="二、垃圾回收算法"></a>二、垃圾回收算法</h3><h4 id="2-1标记清除-Mark-Sweep"><a href="#2-1标记清除-Mark-Sweep" class="headerlink" title="2.1标记清除(Mark Sweep)"></a>2.1标记清除(Mark Sweep)</h4><ul>
<li>速度快</li>
<li>会造成内存碎片</li>
</ul>
<p>先记录未被使用的对象(垃圾)的起始地址，再清除该起始地址的数据，<strong>并不会整理合并地址块</strong>，新加入的对象地址直接塞到对应空的地址块即可</p>
<img src="http://img.louchen.top/2020/06/20200610151337.png" style="zoom: 67%;" />

<h4 id="2-2标记整理-Mark-Compact"><a href="#2-2标记整理-Mark-Compact" class="headerlink" title="2.2标记整理(Mark Compact)"></a>2.2标记整理(Mark Compact)</h4><ul>
<li>速度慢</li>
<li>没有内存碎片</li>
</ul>
<p>对比垃圾清除算法，多了一步再垃圾进行清除后，会对内存碎片进行整理，使存储空间得到充分利用，缺点时耗费性能。</p>
<p>清除一块垃圾的时候，将存活的对象向前移动。</p>
<img src="http://img.louchen.top/2020/06/20200611114208.png" style="zoom:50%;" />

<h4 id="2-3复制-Copy"><a href="#2-3复制-Copy" class="headerlink" title="2.3复制(Copy)"></a>2.3复制(Copy)</h4><ul>
<li>不会有内存碎片</li>
<li>复制占用双倍的内存空间</li>
</ul>
<p>占用双倍的存储空间，首先将被GCRoot引用的对象移动至另一块内存区域，并进行整理，留下的垃圾区域直接清除，然后再交换两块内存区域的位置</p>
<p><img src="http://img.louchen.top/2020/06/20200610152107.png" style="zoom:50%;" /><img src="http://img.louchen.top/2020/06/20200610152127.png" alt=""></p>
<h3 id="三、分代垃圾回收"><a href="#三、分代垃圾回收" class="headerlink" title="三、分代垃圾回收"></a>三、分代垃圾回收</h3><img src="http://img.louchen.top/2020/06/20200610181103.png" style="zoom: 67%;" />

<img src="http://img.louchen.top/2020/06/20200610181319.png" style="zoom:67%;" />

<img src="http://img.louchen.top/2020/06/20200610195843.png" style="zoom:67%;" />

<p>​        首先，先创建的对象放入伊甸园区，伊甸园被区被占满后，触发第一次<strong>Minor GC</strong>，采用可达性分析算法，根据<strong>GC Root</strong>引用链去找可以回收的垃圾，将垃圾进行标记，标记成功，采用复制算法，将回收后幸存的垃圾复制到<strong>幸存区To</strong>中，并让幸存对象的<strong>寿命加1</strong>，然后可以回收掉伊甸园中其他的垃圾，将<strong>幸存区To</strong>的位置和<strong>幸存区From</strong>的位置进行交换(它们内存空间大小不会改变,此时存活的对象在<strong>幸存区From</strong>中)。即伊甸园中的空间已释放，又可以创建新的对象放入伊甸园中。当伊甸园中的内存又满了的时候，再触发第二次Minor GC，再根据引用链找到<strong>伊甸园</strong>和<strong>幸存区From</strong>中的对象，将存活的对象放入幸存区To中，将伊甸园中来的对象寿命加1，将幸存区From中还存或的对象加1(即变成2)，剩下在伊甸园和幸存区From中的垃圾清除释放，然后又把在幸存To中的对象位置和幸存区From进行交换(此时存活对象在幸存区From中)。</p>
<p>​        当幸存区中的对象年龄的阈值超过默认值15时，我们的虚拟机认为这是价值较高的对象，不会被轻易回收，会将该对象晋升到老年代中，老年代不会轻易被回收。或者当年轻代中的内存被占满的时候，这是还要放比较大的对象时，新生代中已存在的对象会忽略阈值的限制直接晋升到老年代，腾出空间给新加入的对象使用。</p>
<p>​        当老年代内存也快满的时候，会触发一次<strong>Full GC</strong>来触发一次老年代的垃圾回收,<strong>Full GC</strong>会回收新生代和老年代的垃圾回收。当老年代空间不足时会先尝试触发minor gc（JDK 6 update 24 之后规定，只要老年代的连续空间大于新时代的对象总大小或者平均晋升大小就会进行minor GC），如果之后空间不足(又有对象从新生代区域升级到老年代)，那么触发Full gc, 那么stop the world会更长，应避免这种操作，如果full gc后老年代空间还不足则 out of memory   </p>
<p><strong>要点：</strong></p>
<ul>
<li><p>full gc 又叫 major gc (major garbage collection )</p>
</li>
<li><p>新生代区的GC会频繁进行。因而，一般在这里需要使用速度快、效率高的算法，使新生代区能尽快空闲出来。</p>
</li>
<li><p>对象首先分配在伊甸园区</p>
</li>
<li><p>新生代空间不足时，触发Minor GC，伊甸园和from存货的对象使用copy赋值到to中，是存活对象的年龄加1，并且交换form,to中的值，并释放的垃圾对象</p>
</li>
<li><p>minor gc 会引发 stop the world 暂停其他用户的线程，等待垃圾回收结束，用户线程才恢复运行。</p>
</li>
<li><p>对象寿命超过阈值时，会晋升至老年代，最大寿命是15(4bit 1111 转为十进制为15)</p>
</li>
<li><p>当老年代空间不足时会先尝试触发minor gc（JDK 6 update 24 之后规定，只要老年代的连续空间大于新时代的对象总大小或者平均晋升大小就会进行minor GC），如果之后空间不足(又有对象从新生代区域升级到老年代)，那么触发Full gc, 那么stop the world会更长，应避免这种操作，如果full gc后老年代空间还不足则 out of memory   </p>
</li>
</ul>
<h4 id="3-1为什么要进行分代垃圾回收"><a href="#3-1为什么要进行分代垃圾回收" class="headerlink" title="3.1为什么要进行分代垃圾回收"></a>3.1为什么要进行分代垃圾回收</h4><p>分代的垃圾回收策略，是基于这样一个事实：<strong>不同的对象的生命周期是不一样的。因此，不同生命周期的对象可以采取不同的收集方式，以便提高回收效率。</strong></p>
<p>在Java程序运行的过程中，会产生大量的对象，其中有些对象是与业务信息相关，比如Http请求中的Session对象、线程、Socket连接，这类对象跟业务直接挂钩，因此生命周期比较长。但是还有一些对象，主要是程序运行过程中生成的临时变量，这些对象生命周期会比较短，比如：String对象，由于其不变类的特性，系统会产生大量的这些对象，有些对象甚至只用一次即可回收。</p>
<p>试想，在不进行对象存活时间区分的情况下，每次垃圾回收都是对整个堆空间进行回收，花费时间相对会长，同时，因为每次回收都需要遍历所有存活对象，但实际上，对于生命周期长的对象而言，这种遍历是没有效果的，因为可能进行了很多次遍历，但是他们依旧存在。因此，分代垃圾回收采用分治的思想，进行代的划分，把不同生命周期的对象放在不同代上，不同代上采用最适合它的垃圾回收方式进行回收。</p>
<h4 id="3-2相关JVM参数"><a href="#3-2相关JVM参数" class="headerlink" title="3.2相关JVM参数"></a>3.2相关JVM参数</h4><table>
<thead>
<tr>
<th>堆初始大小</th>
<th>-Xms</th>
</tr>
</thead>
<tbody><tr>
<td>堆最大大小</td>
<td>-Xmx 或 -XX:MaxHeapSize=size</td>
</tr>
<tr>
<td>新生代大小</td>
<td>-Xmn 或 (-XX:NewSize=size + -XX:MaxNewSize=size )</td>
</tr>
<tr>
<td>幸存区比例（动态）</td>
<td>-XX:InitialSurvivorRatio=ratio 和 -XX:+UseAdaptiveSizePolicy</td>
</tr>
<tr>
<td>幸存区比例</td>
<td>-XX:SurvivorRatio=ratio</td>
</tr>
<tr>
<td>晋升阈值</td>
<td>-XX:MaxTenuringThreshold=threshold</td>
</tr>
<tr>
<td>晋升详情</td>
<td>-XX:+PrintTenuringDistribution</td>
</tr>
<tr>
<td>GC详情</td>
<td>-XX:+PrintGCDetails -verbose:gc</td>
</tr>
<tr>
<td>FullGC</td>
<td>前 MinorGC -XX:+ScavengeBeforeFullGC   (fullgc前是否进行minor gc  默认开启)</td>
</tr>
</tbody></table>
<h4 id="3-3GC分析"><a href="#3-3GC分析" class="headerlink" title="3.3GC分析"></a>3.3GC分析</h4><h5 id="①基本信息"><a href="#①基本信息" class="headerlink" title="①基本信息"></a>①基本信息</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">T1</span> </span>&#123;</span><br><span class="line"><span class="comment">//    模拟512KB对象存储</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> _512KB=<span class="number">512</span>*<span class="number">1024</span>;</span><br><span class="line"><span class="comment">//    模拟1MB</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> _1MB=<span class="number">1024</span>*<span class="number">1024</span>;</span><br><span class="line"><span class="comment">//    模拟6MB</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> _6MB=<span class="number">6</span>*<span class="number">1024</span>*<span class="number">1024</span>;</span><br><span class="line"><span class="comment">//    模拟7MB</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> _7MB=<span class="number">7</span>*<span class="number">1024</span>*<span class="number">1024</span>;</span><br><span class="line"><span class="comment">//    模拟8MB</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> _8MB=<span class="number">8</span>*<span class="number">1024</span>*<span class="number">1024</span>;</span><br><span class="line"> <span class="comment">//设置虚拟机参数 -Xms20M( 堆初始大小20M) -Xmx20M(堆最大大小20M) -Xmn10M(新生代大小10M) -XX:+UseSerialGC(使用UseSerialGC垃圾回收器保证幸存区大小不会动态调整) -XX:+PrintGCDetails -verbose:gc(打印gc日志)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Heap</span><br><span class="line">    <span class="comment">//新生代         总大小为9M，还有1M分配给幸存区To空闲的一块位置</span></span><br><span class="line"> def <span class="keyword">new</span> generation   total <span class="number">9216</span>K, used <span class="number">1997</span>K [<span class="number">0x00000000fec00000</span>, <span class="number">0x00000000ff600000</span>, <span class="number">0x00000000ff600000</span>)</span><br><span class="line">  <span class="comment">//伊甸园区           已经使用24%(系统启动类)                                  </span></span><br><span class="line">  eden space <span class="number">8192</span>K,  <span class="number">24</span>% used [<span class="number">0x00000000fec00000</span>, <span class="number">0x00000000fedf37f8</span>, <span class="number">0x00000000ff400000</span>)</span><br><span class="line">  <span class="comment">//幸存区From                             </span></span><br><span class="line">  from space <span class="number">1024</span>K,   <span class="number">0</span>% used [<span class="number">0x00000000ff400000</span>, <span class="number">0x00000000ff400000</span>, <span class="number">0x00000000ff500000</span>)</span><br><span class="line">  <span class="comment">//幸存区To</span></span><br><span class="line">  to   space <span class="number">1024</span>K,   <span class="number">0</span>% used [<span class="number">0x00000000ff500000</span>, <span class="number">0x00000000ff500000</span>, <span class="number">0x00000000ff600000</span>)</span><br><span class="line">   <span class="comment">//老年代</span></span><br><span class="line"> tenured generation   total <span class="number">10240</span>K, used <span class="number">0</span>K [<span class="number">0x00000000ff600000</span>, <span class="number">0x0000000100000000</span>, <span class="number">0x0000000100000000</span>)</span><br><span class="line">   the space <span class="number">10240</span>K,   <span class="number">0</span>% used [<span class="number">0x00000000ff600000</span>, <span class="number">0x00000000ff600000</span>, <span class="number">0x00000000ff600200</span>, <span class="number">0x0000000100000000</span>)</span><br><span class="line">   <span class="comment">//元空间</span></span><br><span class="line"> Metaspace       used <span class="number">3093</span>K, capacity <span class="number">4496</span>K, committed <span class="number">4864</span>K, reserved <span class="number">1056768</span>K</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">space</span>    <span class="title">used</span> 335<span class="title">K</span>, <span class="title">capacity</span> 388<span class="title">K</span>, <span class="title">committed</span> 512<span class="title">K</span>, <span class="title">reserved</span> 1048576<span class="title">K</span></span></span><br></pre></td></tr></table></figure>

<h5 id="②minor-gc"><a href="#②minor-gc" class="headerlink" title="②minor gc"></a>②minor gc</h5><blockquote>
<p>触发第一次GC:</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        List&lt;<span class="keyword">byte</span>[]&gt; list=<span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        list.add(<span class="keyword">new</span> <span class="keyword">byte</span>[_7MB]);</span><br><span class="line">        list.add(<span class="keyword">new</span> <span class="keyword">byte</span>[_512KB]);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//首先存入7MB对象时伊甸园区存不下，触发一次minor gc垃圾回收后，512K的对象恰好放到伊甸园区。</span></span><br><span class="line"><span class="comment">//                              新生代(总大小为9216k)回收前占2001k,回收后占628k   堆(总大小为19456K)回收前占2001k,回收后占628k </span></span><br><span class="line">[GC (Allocation Failure) [DefNew: <span class="number">2001</span>K-&gt;<span class="number">628</span>K(<span class="number">9216</span>K), <span class="number">0.0012164</span> secs] <span class="number">2001</span>K-&gt;<span class="number">628</span>K(<span class="number">19456</span>K), <span class="number">0.0012517</span> secs] <span class="comment">//花费时间 0.00</span></span><br><span class="line">[Times: user=<span class="number">0.00</span> sys=<span class="number">0.00</span>, real=<span class="number">0.00</span> secs] </span><br><span class="line">Heap</span><br><span class="line">    <span class="comment">//此时新生代内存已经非常紧张</span></span><br><span class="line"> def <span class="keyword">new</span> generation   total <span class="number">9216</span>K, used <span class="number">8718</span>K [<span class="number">0x00000000fec00000</span>, <span class="number">0x00000000ff600000</span>, <span class="number">0x00000000ff600000</span>)</span><br><span class="line">     <span class="comment">//伊甸园区栈已使用98%                                          </span></span><br><span class="line">  eden space <span class="number">8192</span>K,  <span class="number">98</span>% used [<span class="number">0x00000000fec00000</span>, <span class="number">0x00000000ff3e6840</span>, <span class="number">0x00000000ff400000</span>)</span><br><span class="line">     <span class="comment">//幸存区From已占用61%                          </span></span><br><span class="line">  from space <span class="number">1024</span>K,  <span class="number">61</span>% used [<span class="number">0x00000000ff500000</span>, <span class="number">0x00000000ff59d1b8</span>, <span class="number">0x00000000ff600000</span>)</span><br><span class="line">  to   space <span class="number">1024</span>K,   <span class="number">0</span>% used [<span class="number">0x00000000ff400000</span>, <span class="number">0x00000000ff400000</span>, <span class="number">0x00000000ff500000</span>)</span><br><span class="line"> tenured generation   total <span class="number">10240</span>K, used <span class="number">0</span>K [<span class="number">0x00000000ff600000</span>, <span class="number">0x0000000100000000</span>, <span class="number">0x0000000100000000</span>)</span><br><span class="line">   the space <span class="number">10240</span>K,   <span class="number">0</span>% used [<span class="number">0x00000000ff600000</span>, <span class="number">0x00000000ff600000</span>, <span class="number">0x00000000ff600200</span>, <span class="number">0x0000000100000000</span>)</span><br><span class="line"> Metaspace       used <span class="number">3202</span>K, capacity <span class="number">4496</span>K, committed <span class="number">4864</span>K, reserved <span class="number">1056768</span>K</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">space</span>    <span class="title">used</span> 347<span class="title">K</span>, <span class="title">capacity</span> 388<span class="title">K</span>, <span class="title">committed</span> 512<span class="title">K</span>, <span class="title">reserved</span> 1048576<span class="title">K</span></span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>触发第二次GC:</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        List&lt;<span class="keyword">byte</span>[]&gt; list=<span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        list.add(<span class="keyword">new</span> <span class="keyword">byte</span>[_7MB]);</span><br><span class="line">        list.add(<span class="keyword">new</span> <span class="keyword">byte</span>[_512KB]);</span><br><span class="line">        list.add(<span class="keyword">new</span> <span class="keyword">byte</span>[_512KB]);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//当存入_7MB触发该次GC,进行垃圾回收，512k恰好放入伊甸园区</span></span><br><span class="line">[GC (Allocation Failure) [DefNew: <span class="number">2001</span>K-&gt;<span class="number">620</span>K(<span class="number">9216</span>K), <span class="number">0.0014167</span> secs] <span class="number">2001</span>K-&gt;<span class="number">620</span>K(<span class="number">19456</span>K), <span class="number">0.0014490</span> secs] [Times: user=<span class="number">0.00</span> sys=<span class="number">0.00</span>, real=<span class="number">0.00</span> secs] </span><br><span class="line"><span class="comment">//当存入第二个512k对象时，触发第二次minor gc</span></span><br><span class="line">[GC (Allocation Failure) [DefNew: <span class="number">8628</span>K-&gt;<span class="number">517</span>K(<span class="number">9216</span>K), <span class="number">0.0045477</span> secs] <span class="number">8628</span>K-&gt;<span class="number">8284</span>K(<span class="number">19456</span>K), <span class="number">0.0045761</span> secs] [Times: user=<span class="number">0.00</span> sys=<span class="number">0.00</span>, real=<span class="number">0.00</span> secs] </span><br><span class="line">Heap</span><br><span class="line">    <span class="comment">//此时的新生代                  只占用1193k</span></span><br><span class="line"> def <span class="keyword">new</span> generation   total <span class="number">9216</span>K, used <span class="number">1193</span>K [<span class="number">0x00000000fec00000</span>, <span class="number">0x00000000ff600000</span>, <span class="number">0x00000000ff600000</span>)</span><br><span class="line">  eden space <span class="number">8192</span>K,   <span class="number">8</span>% used [<span class="number">0x00000000fec00000</span>, <span class="number">0x00000000feca91d8</span>, <span class="number">0x00000000ff400000</span>)</span><br><span class="line">  from space <span class="number">1024</span>K,  <span class="number">50</span>% used [<span class="number">0x00000000ff400000</span>, <span class="number">0x00000000ff481580</span>, <span class="number">0x00000000ff500000</span>)</span><br><span class="line">  to   space <span class="number">1024</span>K,   <span class="number">0</span>% used [<span class="number">0x00000000ff500000</span>, <span class="number">0x00000000ff500000</span>, <span class="number">0x00000000ff600000</span>)</span><br><span class="line"> <span class="comment">//新生代的中的7MB对象晋升到老年代中，当内存非常紧张时，会忽略阈值的限制，直接进入老年代                              </span></span><br><span class="line"> tenured generation   total <span class="number">10240</span>K, used <span class="number">7766</span>K [<span class="number">0x00000000ff600000</span>, <span class="number">0x0000000100000000</span>, <span class="number">0x0000000100000000</span>)</span><br><span class="line">   the space <span class="number">10240</span>K,  <span class="number">75</span>% used [<span class="number">0x00000000ff600000</span>, <span class="number">0x00000000ffd95af8</span>, <span class="number">0x00000000ffd95c00</span>, <span class="number">0x0000000100000000</span>)</span><br><span class="line"> Metaspace       used <span class="number">3216</span>K, capacity <span class="number">4496</span>K, committed <span class="number">4864</span>K, reserved <span class="number">1056768</span>K</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">space</span>    <span class="title">used</span> 349<span class="title">K</span>, <span class="title">capacity</span> 388<span class="title">K</span>, <span class="title">committed</span> 512<span class="title">K</span>, <span class="title">reserved</span> 1048576<span class="title">K</span></span></span><br></pre></td></tr></table></figure>

<h5 id="③大对象直接晋升老年代"><a href="#③大对象直接晋升老年代" class="headerlink" title="③大对象直接晋升老年代"></a>③大对象直接晋升老年代</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        List&lt;<span class="keyword">byte</span>[]&gt; list=<span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        list.add(<span class="keyword">new</span> <span class="keyword">byte</span>[_8MB]);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//当我们的对象超过新生代存放的最大大小时，会直接进入老年代。就是你新生代gc再干净，也存不下</span></span><br><span class="line"> def <span class="keyword">new</span> generation   total <span class="number">9216</span>K, used <span class="number">2165</span>K [<span class="number">0x00000000fec00000</span>, <span class="number">0x00000000ff600000</span>, <span class="number">0x00000000ff600000</span>)</span><br><span class="line">  eden space <span class="number">8192</span>K,  <span class="number">26</span>% used [<span class="number">0x00000000fec00000</span>, <span class="number">0x00000000fee1d620</span>, <span class="number">0x00000000ff400000</span>)</span><br><span class="line">  from space <span class="number">1024</span>K,   <span class="number">0</span>% used [<span class="number">0x00000000ff400000</span>, <span class="number">0x00000000ff400000</span>, <span class="number">0x00000000ff500000</span>)</span><br><span class="line">  to   space <span class="number">1024</span>K,   <span class="number">0</span>% used [<span class="number">0x00000000ff500000</span>, <span class="number">0x00000000ff500000</span>, <span class="number">0x00000000ff600000</span>)</span><br><span class="line"> tenured generation   total <span class="number">10240</span>K, used <span class="number">8192</span>K [<span class="number">0x00000000ff600000</span>, <span class="number">0x0000000100000000</span>, <span class="number">0x0000000100000000</span>)</span><br><span class="line">   the space <span class="number">10240</span>K,  <span class="number">80</span>% used [<span class="number">0x00000000ff600000</span>, <span class="number">0x00000000ffe00010</span>, <span class="number">0x00000000ffe00200</span>, <span class="number">0x0000000100000000</span>)</span><br><span class="line"> Metaspace       used <span class="number">3215</span>K, capacity <span class="number">4496</span>K, committed <span class="number">4864</span>K, reserved <span class="number">1056768</span>K</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">space</span>    <span class="title">used</span> 349<span class="title">K</span>, <span class="title">capacity</span> 388<span class="title">K</span>, <span class="title">committed</span> 512<span class="title">K</span>, <span class="title">reserved</span> 1048576<span class="title">K</span></span></span><br></pre></td></tr></table></figure>

<h5 id="④Full-gc"><a href="#④Full-gc" class="headerlink" title="④Full gc"></a>④Full gc</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    List&lt;<span class="keyword">byte</span>[]&gt; list=<span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    list.add(<span class="keyword">new</span> <span class="keyword">byte</span>[_8MB]);</span><br><span class="line">    list.add(<span class="keyword">new</span> <span class="keyword">byte</span>[_8MB]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//内存溢出前，full gc触发新生代的minor gc垃圾回收</span></span><br><span class="line">[GC (Allocation Failure) [DefNew: <span class="number">2001</span>K-&gt;<span class="number">649</span>K(<span class="number">9216</span>K), <span class="number">0.0012435</span> secs][Tenured: <span class="number">8192</span>K-&gt;<span class="number">8840</span>K(<span class="number">10240</span>K), <span class="number">0.0023755</span> secs] <span class="number">10193</span>K-&gt;<span class="number">8840</span>K(<span class="number">19456</span>K), [Metaspace: <span class="number">3209</span>K-&gt;<span class="number">3209</span>K(<span class="number">1056768</span>K)], <span class="number">0.0036723</span> secs] [Times: user=<span class="number">0.00</span> sys=<span class="number">0.00</span>, real=<span class="number">0.00</span> secs] </span><br><span class="line"><span class="comment">//触发full gc</span></span><br><span class="line">[<span class="function">Full <span class="title">GC</span> <span class="params">(Allocation Failure)</span> [Tenured: 8840K-&gt;8822<span class="title">K</span><span class="params">(<span class="number">10240</span>K)</span>, 0.0015547 secs] 8840K-&gt;8822<span class="title">K</span><span class="params">(<span class="number">19456</span>K)</span>, [Metaspace: 3209K-&gt;3209<span class="title">K</span><span class="params">(<span class="number">1056768</span>K)</span>], 0.0015824 secs] [Times: user</span>=<span class="number">0.02</span> sys=<span class="number">0.00</span>, real=<span class="number">0.00</span> secs] </span><br><span class="line">Heap</span><br><span class="line"> def <span class="keyword">new</span> generation   total <span class="number">9216</span>K, used <span class="number">246</span>K [<span class="number">0x00000000fec00000</span>, <span class="number">0x00000000ff600000</span>, <span class="number">0x00000000ff600000</span>)</span><br><span class="line">  eden space <span class="number">8192</span>K,   <span class="number">3</span>% used [<span class="number">0x00000000fec00000</span>, <span class="number">0x00000000fec3d890</span>, <span class="number">0x00000000ff400000</span>)</span><br><span class="line">  from space <span class="number">1024</span>K,   <span class="number">0</span>% used [<span class="number">0x00000000ff500000</span>, <span class="number">0x00000000ff500000</span>, <span class="number">0x00000000ff600000</span>)</span><br><span class="line">  to   space <span class="number">1024</span>K,   <span class="number">0</span>% used [<span class="number">0x00000000ff400000</span>, <span class="number">0x00000000ff400000</span>, <span class="number">0x00000000ff500000</span>)</span><br><span class="line"> tenured generation   total <span class="number">10240</span>K, used <span class="number">8822</span>K [<span class="number">0x00000000ff600000</span>, <span class="number">0x0000000100000000</span>, <span class="number">0x0000000100000000</span>)</span><br><span class="line">   the space <span class="number">10240</span>K,  <span class="number">86</span>% used [<span class="number">0x00000000ff600000</span>, <span class="number">0x00000000ffe9d948</span>, <span class="number">0x00000000ffe9da00</span>, <span class="number">0x0000000100000000</span>)</span><br><span class="line"> Metaspace       used <span class="number">3241</span>K, capacity <span class="number">4496</span>K, committed <span class="number">4864</span>K, reserved <span class="number">1056768</span>K</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">space</span>    <span class="title">used</span> 352<span class="title">K</span>, <span class="title">capacity</span> 388<span class="title">K</span>, <span class="title">committed</span> 512<span class="title">K</span>, <span class="title">reserved</span> 1048576<span class="title">K</span></span></span><br><span class="line">Exception in thread "main" java.lang.OutOfMemoryError: Java heap space</span><br><span class="line">	at org.lc.jvm_gc.T1.main(T1.java:<span class="number">30</span>)</span><br></pre></td></tr></table></figure>

<h5 id="⑤一个线程中的OOM，不会导致我们主程序结束"><a href="#⑤一个线程中的OOM，不会导致我们主程序结束" class="headerlink" title="⑤一个线程中的OOM，不会导致我们主程序结束"></a>⑤一个线程中的OOM，不会导致我们主程序结束</h5><h3 id="四、垃圾回收器"><a href="#四、垃圾回收器" class="headerlink" title="四、垃圾回收器"></a>四、垃圾回收器</h3><h4 id="1、垃圾回收器比较"><a href="#1、垃圾回收器比较" class="headerlink" title="1、垃圾回收器比较"></a>1、垃圾回收器比较</h4><h5 id="①串行"><a href="#①串行" class="headerlink" title="①串行"></a>①串行</h5><blockquote>
<ul>
<li>单线程</li>
<li>堆内存较小，适应个人电脑</li>
</ul>
</blockquote>
<h5 id="②吞吐量优先"><a href="#②吞吐量优先" class="headerlink" title="②吞吐量优先"></a>②吞吐量优先</h5><blockquote>
<ul>
<li>多线程</li>
<li>堆内存较大，多核cpu</li>
<li>让单位时间内，stw的时间最端。 即某一段时间内发生的gc次数少。但是每次耗费的时间多</li>
</ul>
</blockquote>
<h5 id="③响应时间优先"><a href="#③响应时间优先" class="headerlink" title="③响应时间优先"></a>③响应时间优先</h5><blockquote>
<ul>
<li>多线程</li>
<li>堆内存较大</li>
<li>多核cpu</li>
<li>尽可能让单次stw的时间最短 。即某一段时间发生的gc虽然多，但是每次耗费的时间短</li>
</ul>
</blockquote>
<h4 id="2、串行-Serial"><a href="#2、串行-Serial" class="headerlink" title="2、串行(Serial)"></a>2、串行(Serial)</h4><p>①<code>-XX:+UseSerialGC</code>  = Serial + SerialOld (<strong>包括新生代和老年代的垃圾回收器</strong>)</p>
<p>采用<em>新生代</em>：<strong>复制算法</strong>，<em>老年代</em>：<strong>标记整理算法</strong>进行垃圾回收。当一个线程进行垃圾的回收，其他的用户线程会阻塞，保证正在进行数据内存整理不受其他线程的干扰</p>
<img src="http://img.louchen.top/2020/06/20200611111814.png" style="zoom:67%;" />

<h4 id="3、吞吐量垃圾回收-Parallel并行"><a href="#3、吞吐量垃圾回收-Parallel并行" class="headerlink" title="3、吞吐量垃圾回收(Parallel并行)"></a>3、吞吐量垃圾回收(Parallel并行)</h4><p>并行收集器。</p>
<p>采用<em>新生代</em>：<strong>复制算法</strong>，<em>老年代</em>：<strong>标记整理算法</strong>进行垃圾回收</p>
<p>垃圾回收线程的个数取决于CPU核心数，充分利用CPU的性能。</p>
<p>①<code>-XX:+UseParallelGC</code>  :<strong>新生代的垃圾回收器</strong>。  </p>
<p><code>-XX:+UseParallelOldGC</code>  <strong>老年代的垃圾回收器</strong>。 jdk8默认开启的，只要开启一个，另一个自动开启。</p>
<p>②<code>-XX:+UseAdaptiveSizePolicy</code> :动态调整堆中新生代中区域大小</p>
<p>③<code>-XX:GCTimeRatio=ratio</code>   gc时间比率，一般为 1+(1+ratio)   ratio一般为19，即100分钟执行gc时间为2分钟</p>
<p>④<code>-XX:MaxGCPauseMillis=ms</code>  默认200ms gc最大暂停时间</p>
<p>⑤<code>-XX:ParallelGCThreads=n</code> 垃圾回收线程的个数</p>
<img src="http://img.louchen.top/2020/06/20200611114330.png" style="zoom:67%;" />

<h4 id="4、响应时间优先-CMS-并发标记清除"><a href="#4、响应时间优先-CMS-并发标记清除" class="headerlink" title="4、响应时间优先(CMS:并发标记清除)"></a>4、响应时间优先(CMS:并发标记清除)</h4><ul>
<li><p><strong>并行（Parallel）</strong> ：指多条垃圾收集线程并行工作，但此时用户线程仍然处于等待状态。</p>
</li>
<li><p><strong>并发（Concurrent）</strong>：指用户线程与垃圾收集线程同时执行（但不一定是并行，可能会交替执行），用户程序在继续运行，而垃圾收集器运行在另一个 CPU 上。</p>
</li>
<li><p><strong>CMS （Concurrent Mark Sweep）</strong>：收集器是一种以获取最短回收停顿时间为目标的收集器。它非常符合在注重用户体验的应用上使用。</p>
</li>
<li><p><strong>CMS（Concurrent Mark Sweep）</strong>：收集器是 HotSpot 虚拟机第一款真正意义上的并发收集器，它第一次实现了让垃圾收集线程与用户线程（基本上）同时工作。</p>
</li>
<li><p><strong>CMS存在的问题</strong>：因为采用标记清除的方式清除垃圾，当新生代和老年代内存碎片非常多时，此时会并发gc失败，会退化使用串行的gc方式，使gc执行的时间变得很长</p>
</li>
</ul>
<p>①<code>-XX:+UseConcMarkSweepGC</code>：老年代的垃圾回收器 ,当该垃圾回收器执行失败时，会退化到执行使用Serial Old串行的收集器 </p>
<p> <code>-XX:+UseParNewGC</code>  新生代的垃圾回收器。</p>
<p>②<code>-XX:ParallelGCThreads=n</code> ： 并行的线程数</p>
<p><code>-XX:ConcGCThreads=threads</code>：并发的线程数 </p>
<p>一般如果cpu总核数为4，那么并行数为3(执行其他用户线程)，并发数为1(执行垃圾回收)</p>
<p>③<code>-XX:CMSInitiatingOccupancyFraction=percent</code> </p>
<p>  若percent为80，则代表当老年代内存为80的时候，就出发一次垃圾回收。目的时留下多余的空间给浮动垃圾(并行清理的过程中，其他用户线程留下的垃圾)。percent值越小，触发gc的时间就越早</p>
<p>④<code>-XX:+CMSScavengeBeforeRemark</code> 在重新标记之前，对新生代做一次垃圾回收</p>
<p>从名字中的<strong>Mark Sweep</strong>这两个词可以看出，CMS 收集器是一种 <strong>“标记-清除”算法</strong>实现的，它的运作过程相比于前面几种垃圾收集器来说更加复杂一些。整个过程分为<strong>四个步骤</strong>：</p>
<ul>
<li><strong>初始标记(会stw)：</strong> 暂停所有的其他线程，并记录下直接与 root 相连的对象，速度很快 ；</li>
<li><strong>并发标记(不会stw)：</strong> 同时开启 GC 和用户线程，用一个闭包结构去记录可达对象。但在这个阶段结束，这个闭包结构并不能保证包含当前所有的可达对象。因为用户线程可能会不断的更新引用域，所以 GC 线程无法保证可达性分析的实时性。所以这个算法里会跟踪记录这些发生引用更新的地方。</li>
<li><strong>重新标记：</strong> 重新标记阶段就是为了修正并发标记期间因为用户程序继续运行而导致标记产生变动的那一部分对象的标记记录，这个阶段的停顿时间一般会比初始标记阶段的时间稍长，远远比并发标记阶段时间短</li>
<li><strong>并发清除：</strong> 开启用户线程，同时 GC 线程开始对未标记的区域做清扫</li>
</ul>
<img src="http://img.louchen.top/2020/06/20200611122240.png" style="zoom:67%;" />

<h5 id="1-并发和并行的区别？"><a href="#1-并发和并行的区别？" class="headerlink" title="1)并发和并行的区别？"></a>1)并发和并行的区别？</h5><img src="http://img.louchen.top/2020/06/20200611173322.png" style="zoom: 67%;" />



<p> 如果某个系统支持两个或者多个动作（Action）<strong>同时存在</strong>，那么这个系统就是一个<strong>并发系统</strong>。如果某个系统支持两个或者多个动作<strong>同时执行</strong>，那么这个系统就是一个<strong>并行系统</strong>。并发系统与并行系统这两个定义之间的关键差异在于<strong>“存在”</strong>这个词。</p>
<p>在并发程序中可以同时拥有两个或者多个线程。这意味着，如果程序在单核处理器上运行，那么这两个线程将交替地换入或者换出内存。这些线程是同时“存在”的——每个线程都处于执行过程中的某个状态。如果程序能够并行执行，那么就一定是运行在多核处理器上。此时，程序中的每个线程都将分配到一个独立的处理器核上，因此可以同时运行。</p>
<p><strong>“并行”概念是“并发”概念的一个子集</strong>。也就是说，你可以编写一个拥有多个线程或者进程的并发程序，但如果没有多核处理器来执行这个程序，那么就不能以并行方式来运行代码。因此，凡是在求解单个问题时涉及多个执行流程的编程模式或者执行行为，都属于并发编程的范畴。</p>
<h4 id="5、G1-Garbage-First-收集器"><a href="#5、G1-Garbage-First-收集器" class="headerlink" title="5、G1 (Garbage-First)收集器"></a>5、<strong>G1 (Garbage-First)</strong>收集器</h4><ul>
<li><p>2004 论文发布 </p>
</li>
<li><p>2009 JDK 6u14 体验 </p>
</li>
<li><p>2012 JDK 7u4 官方支持 </p>
</li>
<li><p>2017 JDK 9 默认</p>
</li>
</ul>
<p><strong>适用场景：</strong></p>
<ul>
<li><p>同时注重吞吐量（Throughput）和低延迟（Low latency），默认的暂停目标是 200 ms </p>
</li>
<li><p>超大堆内存，会将堆划分为多个大小相等的 Region </p>
</li>
<li><p>整体上是 标记+整理 算法，两个区域之间是 复制 算法</p>
</li>
</ul>
<p>相关 JVM 参数</p>
<ul>
<li><code>-XX:+UseG1GC</code></li>
<li><code>-XX:G1HeapRegionSize=size</code></li>
<li><code>-XX:MaxGCPauseMillis=time</code></li>
</ul>
<h5 id="①G1垃圾回收阶段"><a href="#①G1垃圾回收阶段" class="headerlink" title="①G1垃圾回收阶段"></a>①G1垃圾回收阶段</h5><img src="http://img.louchen.top/2020/06/20200613101502.png" style="zoom:50%;" />

<h6 id="1-Young-Collection-新生代垃圾回收"><a href="#1-Young-Collection-新生代垃圾回收" class="headerlink" title="1)Young Collection(新生代垃圾回收)"></a>1)Young Collection(新生代垃圾回收)</h6><p>会 STW。新创建的对象会放入伊甸园区</p>
<img src="http://img.louchen.top/2020/06/20200613100746.png" style="zoom: 50%;" />

<p>进行新生代的垃圾回收后通过复制算法将伊甸园(E)中存活的对象放入幸存区(S)</p>
<img src="http://img.louchen.top/2020/06/20200613100825.png" style="zoom:50%;" />

<p>当幸存区中的对象满了的时候或者幸存区中的对象年龄超过阈值的年龄时，幸存区中对象将会晋升到老年代中(S)</p>
<img src="http://img.louchen.top/2020/06/20200613101319.png" style="zoom:50%;" />

<h6 id="2-Young-Collection-CM-新生代垃圾回收-并发标记"><a href="#2-Young-Collection-CM-新生代垃圾回收-并发标记" class="headerlink" title="2) Young Collection + CM (新生代垃圾回收+并发标记)"></a>2) Young Collection + CM (新生代垃圾回收+并发标记)</h6><blockquote>
<p> 基本步骤</p>
</blockquote>
<ul>
<li><strong>初始标记：</strong>在 Young GC 时会进行 GC Root 的初始标记(<strong>找到根对象</strong>)</li>
<li><strong>并发标记:  ** <em>老年代</em>占用堆空间比例达到阈值时，进行</strong>并发标记**（不会 STW）</li>
</ul>
<img src="http://img.louchen.top/2020/06/20200613103558.png" style="zoom:50%;" />

<h6 id="3-Mixed-Collection-混合收集"><a href="#3-Mixed-Collection-混合收集" class="headerlink" title="3)Mixed Collection(混合收集)"></a>3)Mixed Collection(混合收集)</h6><p>会对 E(伊甸园区)、S(幸存区)、O(老年代) 进行全面垃圾回收</p>
<ul>
<li><strong>最终标记（Remark）</strong>会 STW 。解决在并发标记中用户线程改变的一些需要回收垃圾对象的引用。</li>
<li><strong>拷贝存活（Evacuation）</strong>会 STW。</li>
<li>注意，这里的老年代也会采用复制算法进行清除垃圾，但是不会全部进行复制清除，而是会根据最大暂停时间MaxGCPauseMillis来动态清除需要回收的垃圾。若设定的最大暂停时间够，则执行老年代的全部垃圾清除，否则将根据jvm来自动判断哪些垃圾优先清除获得收益最大。</li>
</ul>
<img src="http://img.louchen.top/2020/06/20200613105502.png" style="zoom:50%;" />

<h4 id="6、Full-GC"><a href="#6、Full-GC" class="headerlink" title="6、Full GC"></a>6、Full GC</h4><ul>
<li><p>SerialGC </p>
<ul>
<li>新生代内存不足发生的垃圾收集 - minor gc </li>
<li>老年代内存不足发生的垃圾收集 - full gc</li>
</ul>
</li>
<li><p>ParallelGC</p>
<ul>
<li>新生代内存不足发生的垃圾收集 - minor gc </li>
<li>老年代内存不足发生的垃圾收集 - full gc</li>
</ul>
</li>
<li><p>G1,CMS</p>
<ul>
<li>新生代内存不足发生的垃圾收集 - minor gc </li>
<li>老年代内存不足   <ul>
<li>当老年代内存占比45%(默认)以上，会触发<strong>并发标记</strong>和<strong>混合收集</strong>阶段。如果回收速度 &gt; 用户线程产生垃圾  (还是属于并发标记阶段)。 当回收速度&lt; 用户线程产生垃圾 (退化为串行的收集器，触发full fc)</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="Ⅳ、类加载和字节码技术"><a href="#Ⅳ、类加载和字节码技术" class="headerlink" title="Ⅳ、类加载和字节码技术"></a>Ⅳ、类加载和字节码技术</h2><p><em>1.类文件结构 2. 字节码指令 3. 编译期处理 4. 类加载阶段 5. 类加载器 6. 运行期优化</em></p>
<img src="http://img.louchen.top/2020/06/20200613170355.png" style="zoom:67%;" />

<h3 id="一、类文件结构"><a href="#一、类文件结构" class="headerlink" title="一、类文件结构"></a>一、类文件结构</h3><blockquote>
<p>根据 Java 虚拟机规范，类文件由单个 ClassFile 结构组成：</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">ClassFile &#123;</span><br><span class="line">    u4             magic; <span class="comment">//Class 文件的标志</span></span><br><span class="line">    u2             minor_version;<span class="comment">//Class 的小版本号</span></span><br><span class="line">    u2             major_version;<span class="comment">//Class 的大版本号</span></span><br><span class="line">    u2             constant_pool_count;<span class="comment">//常量池的数量</span></span><br><span class="line">    cp_info        constant_pool[constant_pool_count-<span class="number">1</span>];<span class="comment">//常量池</span></span><br><span class="line">    u2             access_flags;<span class="comment">//Class 的访问标记</span></span><br><span class="line">    u2             this_class;<span class="comment">//当前类</span></span><br><span class="line">    u2             super_class;<span class="comment">//父类</span></span><br><span class="line">    u2             interfaces_count;<span class="comment">//接口</span></span><br><span class="line">    u2             interfaces[interfaces_count];<span class="comment">//一个类可以实现多个接口</span></span><br><span class="line">    u2             fields_count;<span class="comment">//Class 文件的字段属性</span></span><br><span class="line">    field_info     fields[fields_count];<span class="comment">//一个类会可以有个字段</span></span><br><span class="line">    u2             methods_count;<span class="comment">//Class 文件的方法数量</span></span><br><span class="line">    method_info    methods[methods_count];<span class="comment">//一个类可以有个多个方法</span></span><br><span class="line">    u2             attributes_count;<span class="comment">//此类的属性表中的属性数</span></span><br><span class="line">    attribute_info attributes[attributes_count];<span class="comment">//属性表集合</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="1、魔数"><a href="#1、魔数" class="headerlink" title="1、魔数"></a>1、魔数</h4><h4 id="2、版本"><a href="#2、版本" class="headerlink" title="2、版本"></a>2、版本</h4><h4 id="3、常量池"><a href="#3、常量池" class="headerlink" title="3、常量池"></a>3、常量池</h4><p>常量池中每一项常量都是一个表，这14种表有一个共同的特点：<strong>开始的第一位是一个 u1 类型的标志位 -tag 来标识常量的类型，代表当前这个常量属于哪种常量类型．</strong></p>
<table>
<thead>
<tr>
<th>类型</th>
<th>标志（tag）</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>CONSTANT_utf8_info</td>
<td>1</td>
<td>UTF-8编码的字符串</td>
</tr>
<tr>
<td>CONSTANT_Integer_info</td>
<td>3</td>
<td>整形字面量</td>
</tr>
<tr>
<td>CONSTANT_Float_info</td>
<td>4</td>
<td>浮点型字面量</td>
</tr>
<tr>
<td>CONSTANT_Long_info</td>
<td>５</td>
<td>长整型字面量</td>
</tr>
<tr>
<td>CONSTANT_Double_info</td>
<td>６</td>
<td>双精度浮点型字面量</td>
</tr>
<tr>
<td>CONSTANT_Class_info</td>
<td>７</td>
<td>类或接口的符号引用</td>
</tr>
<tr>
<td>CONSTANT_String_info</td>
<td>８</td>
<td>字符串类型字面量</td>
</tr>
<tr>
<td>CONSTANT_Fieldref_info</td>
<td>９</td>
<td>字段的符号引用</td>
</tr>
<tr>
<td>CONSTANT_Methodref_info</td>
<td>10</td>
<td>类中方法的符号引用</td>
</tr>
<tr>
<td>CONSTANT_InterfaceMethodref_info</td>
<td>11</td>
<td>接口中方法的符号引用</td>
</tr>
<tr>
<td>CONSTANT_NameAndType_info</td>
<td>12</td>
<td>字段或方法的符号引用</td>
</tr>
<tr>
<td>CONSTANT_MothodType_info</td>
<td>16</td>
<td>标志方法类型</td>
</tr>
<tr>
<td>CONSTANT_MethodHandle_info</td>
<td>15</td>
<td>表示方法句柄</td>
</tr>
<tr>
<td>CONSTANT_InvokeDynamic_info</td>
<td>18</td>
<td>表示一个动态方法调用点</td>
</tr>
</tbody></table>
<h4 id="4、访问标识与继承信息"><a href="#4、访问标识与继承信息" class="headerlink" title="4、访问标识与继承信息"></a>4、访问标识与继承信息</h4><h4 id="5、Filed信息"><a href="#5、Filed信息" class="headerlink" title="5、Filed信息"></a>5、Filed信息</h4><img src="http://img.louchen.top/2020/06/20200613210928.png" style="zoom: 80%;" />

<h4 id="6、method信息"><a href="#6、method信息" class="headerlink" title="6、method信息"></a>6、method信息</h4><h4 id="7、附加信息"><a href="#7、附加信息" class="headerlink" title="7、附加信息"></a>7、附加信息</h4><h3 id="二、字节码指令"><a href="#二、字节码指令" class="headerlink" title="二、字节码指令"></a>二、字节码指令</h3><h4 id="1、javap工具"><a href="#1、javap工具" class="headerlink" title="1、javap工具"></a>1、javap工具</h4><p>自己分析类文件结构太麻烦了，Oracle 提供了 javap 工具来反编译 class 文件  </p>
<p>反编译：<code>javap -v 编译后的class文件名称.class</code></p>
<blockquote>
<p>java源文件</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">T1</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"hello wrold"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>class反编译文件</p>
<p><code>javap -v T1.class</code></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line">Classfile /F:/jvm/jvm_demo/target/classes/org/lc/jvm_class/T1<span class="class">.<span class="keyword">class</span></span></span><br><span class="line"><span class="class">  //最后修改时间               字节大小</span></span><br><span class="line"><span class="class">    <span class="title">Last</span> <span class="title">modified</span> 2020-6-13</span>; size <span class="number">543</span> bytes</span><br><span class="line">  <span class="comment">//md5签名</span></span><br><span class="line">  MD5 checksum <span class="number">8f</span>97f15345eca913d4885be87c3c3632</span><br><span class="line">  <span class="comment">//编译哪个原文件</span></span><br><span class="line">  Compiled from <span class="string">"T1.java"</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">org</span>.<span class="title">lc</span>.<span class="title">jvm_class</span>.<span class="title">T1</span></span></span><br><span class="line">  minor version: 0</span><br><span class="line">   <span class="comment">//魔数 代表jdk8 </span></span><br><span class="line">  major version: <span class="number">52</span></span><br><span class="line">    <span class="comment">//访问修饰符</span></span><br><span class="line">  flags: ACC_PUBLIC, ACC_SUPER</span><br><span class="line">     <span class="comment">//常量池</span></span><br><span class="line">Constant pool:</span><br><span class="line"><span class="comment">//     方法引用             引用的位置#6和位置#20   引用的详细信息</span></span><br><span class="line">   #1 = Methodref          #6.#20         // java/lang/Object."&lt;init&gt;":()V</span><br><span class="line">  <span class="comment">//字段引用                引用的位置#6和位置#22    引用的详细信息</span></span><br><span class="line">   #2 = Fieldref           #21.#22        // java/lang/System.out:Ljava/io/PrintStream;</span><br><span class="line">   #3 = String             #23            // hello wrold</span><br><span class="line">   #4 = Methodref          #24.#25        // java/io/PrintStream.println:(Ljava/lang/String;)V</span><br><span class="line">   #5 = Class              #26            // org/lc/jvm_class/T1</span><br><span class="line">   #6 = Class              #27            // java/lang/Object</span><br><span class="line">   #7 = Utf8               &lt;init&gt;</span><br><span class="line">   #8 = Utf8               ()V</span><br><span class="line">   #9 = Utf8               Code</span><br><span class="line">  #10 = Utf8               LineNumberTable</span><br><span class="line">  #11 = Utf8               LocalVariableTable</span><br><span class="line">  #12 = Utf8               this</span><br><span class="line">  #13 = Utf8               Lorg/lc/jvm_class/T1;</span><br><span class="line">  #14 = Utf8               main</span><br><span class="line">  #15 = Utf8               ([Ljava/lang/String;)V</span><br><span class="line">  #16 = Utf8               args</span><br><span class="line">  #17 = Utf8               [Ljava/lang/String;</span><br><span class="line">  #18 = Utf8               SourceFile</span><br><span class="line">  #19 = Utf8               T1.java</span><br><span class="line">  #20 = NameAndType        #7:#8          // "&lt;init&gt;":()V</span><br><span class="line">  #21 = Class              #28            // java/lang/System</span><br><span class="line">  #22 = NameAndType        #29:#30        // out:Ljava/io/PrintStream;</span><br><span class="line">  #23 = Utf8               hello wrold</span><br><span class="line">  #24 = Class              #31            // java/io/PrintStream</span><br><span class="line">  #25 = NameAndType        #32:#33        // println:(Ljava/lang/String;)V</span><br><span class="line">  #26 = Utf8               org/lc/jvm_class/T1</span><br><span class="line">  #27 = Utf8               java/lang/Object</span><br><span class="line">  #28 = Utf8               java/lang/System</span><br><span class="line">  #29 = Utf8               out</span><br><span class="line">  #30 = Utf8               Ljava/io/PrintStream;</span><br><span class="line">  #31 = Utf8               java/io/PrintStream</span><br><span class="line">  #32 = Utf8               println</span><br><span class="line">  #33 = Utf8               (Ljava/lang/String;)V</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//构造方法</span></span><br><span class="line">  <span class="keyword">public</span> org.lc.jvm_class.T1();</span><br><span class="line">    <span class="comment">//构造方法的参数信息</span></span><br><span class="line">    descriptor: ()V</span><br><span class="line">     <span class="comment">//访问修饰符</span></span><br><span class="line">    flags: ACC_PUBLIC</span><br><span class="line">    Code:</span><br><span class="line">    <span class="comment">//最大操作栈的深度 局部变量表的长度  参数的长度</span></span><br><span class="line">      stack=<span class="number">1</span>, locals=<span class="number">1</span>, args_size=<span class="number">1</span></span><br><span class="line">         <span class="comment">//把局部变量表的第0项加到操作数栈</span></span><br><span class="line">         <span class="number">0</span>: aload_0</span><br><span class="line">          <span class="comment">//调用常量池#1 中的方法</span></span><br><span class="line">         1: invokespecial #1                  // Method java/lang/Object."&lt;init&gt;":()V</span><br><span class="line">           <span class="comment">//返回</span></span><br><span class="line">         <span class="number">4</span>: <span class="keyword">return</span></span><br><span class="line">        <span class="comment">//上面的0 1 4代表字节码中的行号</span></span><br><span class="line">      LineNumberTable:</span><br><span class="line">    	<span class="comment">//10代表源java文件中的行号  0代表字节码中的行号</span></span><br><span class="line">        line <span class="number">10</span>: <span class="number">0</span></span><br><span class="line">        <span class="comment">//	//本地变量表</span></span><br><span class="line">      LocalVariableTable:</span><br><span class="line">   	<span class="comment">//从字节码的文件start行开始到length的作用范围为5行  变量名为this</span></span><br><span class="line">        Start  Length  Slot  Name   Signature</span><br><span class="line">            <span class="number">0</span>       <span class="number">5</span>     <span class="number">0</span>  <span class="keyword">this</span>   Lorg/lc/jvm_class/T1;</span><br><span class="line">	<span class="comment">//main方法</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(java.lang.String[])</span></span>;</span><br><span class="line">    descriptor: ([Ljava/lang/String;)V</span><br><span class="line">    flags: ACC_PUBLIC, ACC_STATIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=<span class="number">2</span>, locals=<span class="number">1</span>, args_size=<span class="number">1</span></span><br><span class="line">            <span class="comment">//到常量池中的#2取静态变量System.out</span></span><br><span class="line">         0: getstatic     #2                  // Field java/lang/System.out:Ljava/io/PrintStream;</span><br><span class="line">           <span class="comment">//加载常量池中的hello world常量</span></span><br><span class="line">         3: ldc           #3                  // String hello wrold</span><br><span class="line">            <span class="comment">//回调方法PrintStream.println</span></span><br><span class="line">         5: invokevirtual #4                  // Method java/io/PrintStream.println:(Ljava/lang/String;)V</span><br><span class="line">            <span class="comment">//返回</span></span><br><span class="line">         <span class="number">8</span>: <span class="keyword">return</span></span><br><span class="line">      LineNumberTable:</span><br><span class="line">        <span class="comment">//源文件中的12行对象 字节码中的第0行</span></span><br><span class="line">        line <span class="number">12</span>: <span class="number">0</span></span><br><span class="line">        line <span class="number">13</span>: <span class="number">8</span></span><br><span class="line">      LocalVariableTable:</span><br><span class="line">        Start  Length  Slot  Name    Signature</span><br><span class="line">            <span class="number">0</span>       <span class="number">9</span>     <span class="number">0</span>  args   [Ljava/lang/String;</span><br><span class="line">&#125;</span><br><span class="line">SourceFile: <span class="string">"T1.java"</span></span><br></pre></td></tr></table></figure>

<h4 id="2、图解方法执行流程"><a href="#2、图解方法执行流程" class="headerlink" title="2、图解方法执行流程"></a>2、图解方法执行流程</h4><h5 id="1-原始java代码"><a href="#1-原始java代码" class="headerlink" title="1)原始java代码"></a>1)原始java代码</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo3_1</span> </span>&#123;    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;        </span><br><span class="line">        <span class="keyword">int</span> a = <span class="number">10</span>; </span><br><span class="line">        <span class="comment">//当存储的整数小于short的最大范围内，和方法的字节码指令存在一起</span></span><br><span class="line">        <span class="comment">//当存储的整数大于short的最大值时，它会存在常量池中</span></span><br><span class="line">        <span class="keyword">int</span> b = Short.MAX_VALUE + <span class="number">1</span>;        </span><br><span class="line">        <span class="keyword">int</span> c = a + b;        </span><br><span class="line">        System.out.println(c);    </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="2-编译后的字节码"><a href="#2-编译后的字节码" class="headerlink" title="2)编译后的字节码"></a>2)编译后的字节码</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line">  Last modified <span class="number">2020</span>-<span class="number">6</span>-<span class="number">13</span>; size <span class="number">602</span> bytes</span><br><span class="line">  MD5 checksum <span class="number">6</span>db3390c8e1a174924ec1bb427f963ed</span><br><span class="line">  Compiled from <span class="string">"T2.java"</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">org</span>.<span class="title">lc</span>.<span class="title">jvm_class</span>.<span class="title">T2</span></span></span><br><span class="line">  minor version: 0</span><br><span class="line">  major version: <span class="number">52</span></span><br><span class="line">  flags: ACC_PUBLIC, ACC_SUPER</span><br><span class="line">Constant pool:</span><br><span class="line">   #1 = Methodref          #7.#25         // java/lang/Object."&lt;init&gt;":()V</span><br><span class="line">   #2 = Class              #26            // java/lang/Short</span><br><span class="line">   #3 = Integer            32768</span><br><span class="line">   #4 = Fieldref           #27.#28        // java/lang/System.out:Ljava/io/PrintStream;</span><br><span class="line">   #5 = Methodref          #29.#30        // java/io/PrintStream.println:(I)V</span><br><span class="line">   #6 = Class              #31            // org/lc/jvm_class/T2</span><br><span class="line">   #7 = Class              #32            // java/lang/Object</span><br><span class="line">   #8 = Utf8               &lt;init&gt;</span><br><span class="line">   #9 = Utf8               ()V</span><br><span class="line">  #10 = Utf8               Code</span><br><span class="line">  #11 = Utf8               LineNumberTable</span><br><span class="line">  #12 = Utf8               LocalVariableTable</span><br><span class="line">  #13 = Utf8               this</span><br><span class="line">  #14 = Utf8               Lorg/lc/jvm_class/T2;</span><br><span class="line">  #15 = Utf8               main</span><br><span class="line">  #16 = Utf8               ([Ljava/lang/String;)V</span><br><span class="line">  #17 = Utf8               args</span><br><span class="line">  #18 = Utf8               [Ljava/lang/String;</span><br><span class="line">  #19 = Utf8               a</span><br><span class="line">  #20 = Utf8               I</span><br><span class="line">  #21 = Utf8               b</span><br><span class="line">  #22 = Utf8               c</span><br><span class="line">  #23 = Utf8               SourceFile</span><br><span class="line">  #24 = Utf8               T2.java</span><br><span class="line">  #25 = NameAndType        #8:#9          // "&lt;init&gt;":()V</span><br><span class="line">  #26 = Utf8               java/lang/Short</span><br><span class="line">  #27 = Class              #33            // java/lang/System</span><br><span class="line">  #28 = NameAndType        #34:#35        // out:Ljava/io/PrintStream;</span><br><span class="line">  #29 = Class              #36            // java/io/PrintStream</span><br><span class="line">  #30 = NameAndType        #37:#38        // println:(I)V</span><br><span class="line">  #31 = Utf8               org/lc/jvm_class/T2</span><br><span class="line">  #32 = Utf8               java/lang/Object</span><br><span class="line">  #33 = Utf8               java/lang/System</span><br><span class="line">  #34 = Utf8               out</span><br><span class="line">  #35 = Utf8               Ljava/io/PrintStream;</span><br><span class="line">  #36 = Utf8               java/io/PrintStream</span><br><span class="line">  #37 = Utf8               println</span><br><span class="line">  #38 = Utf8               (I)V</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">public</span> org.lc.jvm_class.T2();</span><br><span class="line">    descriptor: ()V</span><br><span class="line">    flags: ACC_PUBLIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=<span class="number">1</span>, locals=<span class="number">1</span>, args_size=<span class="number">1</span></span><br><span class="line">         <span class="number">0</span>: aload_0</span><br><span class="line">         1: invokespecial #1                  // Method java/lang/Object."&lt;init&gt;":()V</span><br><span class="line">         <span class="number">4</span>: <span class="keyword">return</span></span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line <span class="number">10</span>: <span class="number">0</span></span><br><span class="line">      LocalVariableTable:</span><br><span class="line">        Start  Length  Slot  Name   Signature</span><br><span class="line">            <span class="number">0</span>       <span class="number">5</span>     <span class="number">0</span>  <span class="keyword">this</span>   Lorg/lc/jvm_class/T2;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(java.lang.String[])</span></span>;</span><br><span class="line">    descriptor: ([Ljava/lang/String;)V</span><br><span class="line">    flags: ACC_PUBLIC, ACC_STATIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=<span class="number">2</span>, locals=<span class="number">4</span>, args_size=<span class="number">1</span></span><br><span class="line">         <span class="number">0</span>: bipush        <span class="number">10</span></span><br><span class="line">         <span class="number">2</span>: istore_1</span><br><span class="line">         3: ldc           #3                  // int 32768</span><br><span class="line">         <span class="number">5</span>: istore_2</span><br><span class="line">         <span class="number">6</span>: iload_1</span><br><span class="line">         <span class="number">7</span>: iload_2</span><br><span class="line">         <span class="number">8</span>: iadd</span><br><span class="line">         <span class="number">9</span>: istore_3</span><br><span class="line">        10: getstatic     #4                  // Field java/lang/System.out:Ljava/io/PrintStream;</span><br><span class="line">        <span class="number">13</span>: iload_3</span><br><span class="line">        14: invokevirtual #5                  // Method java/io/PrintStream.println:(I)V</span><br><span class="line">        <span class="number">17</span>: <span class="keyword">return</span></span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line <span class="number">12</span>: <span class="number">0</span></span><br><span class="line">        line <span class="number">15</span>: <span class="number">3</span></span><br><span class="line">        line <span class="number">16</span>: <span class="number">6</span></span><br><span class="line">        line <span class="number">17</span>: <span class="number">10</span></span><br><span class="line">        line <span class="number">18</span>: <span class="number">17</span></span><br><span class="line">      LocalVariableTable:</span><br><span class="line">        Start  Length  Slot  Name   Signature</span><br><span class="line">            <span class="number">0</span>      <span class="number">18</span>     <span class="number">0</span>  args   [Ljava/lang/String;</span><br><span class="line">            <span class="number">3</span>      <span class="number">15</span>     <span class="number">1</span>     a   I</span><br><span class="line">            <span class="number">6</span>      <span class="number">12</span>     <span class="number">2</span>     b   I</span><br><span class="line">           <span class="number">10</span>       <span class="number">8</span>     <span class="number">3</span>     c   I</span><br><span class="line">&#125;</span><br><span class="line">SourceFile: <span class="string">"T2.java"</span></span><br></pre></td></tr></table></figure>

<h5 id="3-常量载入运行时常量池"><a href="#3-常量载入运行时常量池" class="headerlink" title="3)常量载入运行时常量池"></a>3)常量载入运行时常量池</h5><p>将字节码中的常量池内容载入到运行时常量池中(也是属于<strong>方法区</strong>)</p>
<img src="http://img.louchen.top/2020/06/20200613211422.png" style="zoom: 80%;" />

<h5 id="4-方法字节码载入方法区"><a href="#4-方法字节码载入方法区" class="headerlink" title="4)方法字节码载入方法区"></a>4)方法字节码载入方法区</h5><p>将字节码中的方法载入方法区</p>
<img src="http://img.louchen.top/2020/06/20200613211637.png" style="zoom:80%;" />

<h5 id="5-main线程开始运行，分配栈帧内存"><a href="#5-main线程开始运行，分配栈帧内存" class="headerlink" title="5)main线程开始运行，分配栈帧内存"></a>5)main线程开始运行，分配栈帧内存</h5><p>stack=2  操作栈的深度2</p>
<p>locals=4 局部变量表的长度4</p>
<img src="http://img.louchen.top/2020/06/20200613211929.png" style="zoom: 67%;" />

<h5 id="6-执行引擎开始执行字节码"><a href="#6-执行引擎开始执行字节码" class="headerlink" title="6)执行引擎开始执行字节码"></a>6)执行引擎开始执行字节码</h5><h6 id="1-bipush-10"><a href="#1-bipush-10" class="headerlink" title="(1) bipush 10"></a>(1) bipush 10</h6><ul>
<li><p>将一个 byte 压入操作数栈（其长度会补齐 4 个字节），类似的指令还有 </p>
</li>
<li><p>sipush 将一个 short 压入操作数栈（其长度会补齐 4 个字节） </p>
</li>
<li><p>ldc 将一个 int 压入操作数栈 </p>
</li>
<li><p>ldc2_w 将一个 long 压入操作数栈（分两次压入，因为 long 是 8 个字节） </p>
</li>
<li><p>这里小的数字都是和字节码指令存在一起，超过 short 范围的数字存入了常量池</p>
</li>
</ul>
<img src="http://img.louchen.top/2020/06/20200613212609.png" style="zoom: 67%;" />

<h6 id="2-istore-1"><a href="#2-istore-1" class="headerlink" title="(2) istore_1"></a>(2) istore_1</h6><p>将操作数栈顶数据弹出，存入局部变量表的 slot 1</p>
<p>这一步相当于 *<em>int a=10; *</em>的操作</p>
<img src="http://img.louchen.top/2020/06/20200613212729.png" style="zoom: 80%;" />

<h6 id="3-ldc-3"><a href="#3-ldc-3" class="headerlink" title="(3) ldc #3"></a>(3) ldc #3</h6><ul>
<li><p><strong>从常量池加载</strong> #3 数据到操作数栈 </p>
</li>
<li><p>注意 Short.MAX_VALUE 是 32767，所以 32768 = Short.MAX_VALUE + 1 实际是在编译期间计算 好的</p>
</li>
</ul>
<img src="http://img.louchen.top/2020/06/20200613213049.png" style="zoom: 80%;" />

<h6 id="4-istore-2"><a href="#4-istore-2" class="headerlink" title="(4) istore_2"></a>(4) istore_2</h6><img src="http://img.louchen.top/2020/06/20200613213158.png" style="zoom:80%;" />

<h6 id="5-iload-1"><a href="#5-iload-1" class="headerlink" title="(5)iload_1"></a>(5)iload_1</h6><img src="http://img.louchen.top/2020/06/20200613214708.png" style="zoom:80%;" />

<h6 id="6-iload-2"><a href="#6-iload-2" class="headerlink" title="(6)iload_2"></a>(6)iload_2</h6><img src="http://img.louchen.top/2020/06/20200613214727.png" style="zoom:80%;" />

<h6 id="7-iadd"><a href="#7-iadd" class="headerlink" title="(7)iadd"></a>(7)iadd</h6><img src="http://img.louchen.top/2020/06/20200613214814.png" style="zoom:80%;" />

<h6 id="8-istore-3"><a href="#8-istore-3" class="headerlink" title="(8)istore_3"></a>(8)istore_3</h6><img src="http://img.louchen.top/2020/06/20200613214922.png" style="zoom:80%;" />

<h6 id="9-getstatic-4"><a href="#9-getstatic-4" class="headerlink" title="(9)getstatic #4"></a>(9)getstatic #4</h6><p><img src="http://img.louchen.top/2020/06/20200613214958.png" style="zoom:80%;" /><img src="http://img.louchen.top/2020/06/20200613215013.png" alt=""></p>
<img src="http://img.louchen.top/2020/06/20200613215013.png" style="zoom:80%;" />

<h6 id="10-iload-3"><a href="#10-iload-3" class="headerlink" title="(10)iload_3"></a>(10)iload_3</h6><img src="http://img.louchen.top/2020/06/20200613215049.png" style="zoom: 67%;" />

<img src="http://img.louchen.top/2020/06/20200613215116.png" style="zoom:67%;" />

<h6 id="11-invokevirtual-5"><a href="#11-invokevirtual-5" class="headerlink" title="(11)invokevirtual #5"></a>(11)invokevirtual #5</h6><ul>
<li><p>找到常量池 #5 项 </p>
</li>
<li><p>定位到方法区 java/io/PrintStream.println:(I)V 方法 </p>
</li>
<li><p>生成新的栈帧（分配 locals、stack等） </p>
</li>
<li><p>传递参数，执行新栈帧中的字节码</p>
</li>
</ul>
<img src="http://img.louchen.top/2020/06/20200613215245.png" style="zoom: 67%;" />

<ul>
<li><p>执行完毕，弹出栈帧 </p>
</li>
<li><p>清除 main 操作数栈内容</p>
</li>
</ul>
<img src="http://img.louchen.top/2020/06/20200613215319.png" style="zoom:67%;" />

<h6 id="12-return"><a href="#12-return" class="headerlink" title="(12)return"></a>(12)return</h6><ul>
<li><p>完成 main 方法调用，弹出 main 栈帧 </p>
</li>
<li><p>程序结束</p>
</li>
</ul>
<h5 id="7-i-i问题"><a href="#7-i-i问题" class="headerlink" title="7) i++/++i问题"></a>7) i++/++i问题</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">T3</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> a=<span class="number">10</span>;</span><br><span class="line">        <span class="keyword">int</span> b=a++ + ++a + a--;</span><br><span class="line">        System.out.println(a);</span><br><span class="line">        System.out.println(b);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>反编译文件</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line">  Last modified <span class="number">2020</span>-<span class="number">6</span>-<span class="number">13</span>; size <span class="number">577</span> bytes</span><br><span class="line">  MD5 checksum <span class="number">27586</span>d3e5e18016da857182af5251ba9</span><br><span class="line">  Compiled from <span class="string">"T3.java"</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">org</span>.<span class="title">lc</span>.<span class="title">jvm_class</span>.<span class="title">T3</span></span></span><br><span class="line">  minor version: 0</span><br><span class="line">  major version: <span class="number">52</span></span><br><span class="line">  flags: ACC_PUBLIC, ACC_SUPER</span><br><span class="line">Constant pool:</span><br><span class="line">   #1 = Methodref          #5.#22         // java/lang/Object."&lt;init&gt;":()V</span><br><span class="line">   #2 = Fieldref           #23.#24        // java/lang/System.out:Ljava/io/PrintStream;</span><br><span class="line">   #3 = Methodref          #25.#26        // java/io/PrintStream.println:(I)V</span><br><span class="line">   #4 = Class              #27            // org/lc/jvm_class/T3</span><br><span class="line">   #5 = Class              #28            // java/lang/Object</span><br><span class="line">   #6 = Utf8               &lt;init&gt;</span><br><span class="line">   #7 = Utf8               ()V</span><br><span class="line">   #8 = Utf8               Code</span><br><span class="line">   #9 = Utf8               LineNumberTable</span><br><span class="line">  #10 = Utf8               LocalVariableTable</span><br><span class="line">  #11 = Utf8               this</span><br><span class="line">  #12 = Utf8               Lorg/lc/jvm_class/T3;</span><br><span class="line">  #13 = Utf8               main</span><br><span class="line">  #14 = Utf8               ([Ljava/lang/String;)V</span><br><span class="line">  #15 = Utf8               args</span><br><span class="line">  #16 = Utf8               [Ljava/lang/String;</span><br><span class="line">  #17 = Utf8               a</span><br><span class="line">  #18 = Utf8               I</span><br><span class="line">  #19 = Utf8               b</span><br><span class="line">  #20 = Utf8               SourceFile</span><br><span class="line">  #21 = Utf8               T3.java</span><br><span class="line">  #22 = NameAndType        #6:#7          // "&lt;init&gt;":()V</span><br><span class="line">  #23 = Class              #29            // java/lang/System</span><br><span class="line">  #24 = NameAndType        #30:#31        // out:Ljava/io/PrintStream;</span><br><span class="line">  #25 = Class              #32            // java/io/PrintStream</span><br><span class="line">  #26 = NameAndType        #33:#34        // println:(I)V</span><br><span class="line">  #27 = Utf8               org/lc/jvm_class/T3</span><br><span class="line">  #28 = Utf8               java/lang/Object</span><br><span class="line">  #29 = Utf8               java/lang/System</span><br><span class="line">  #30 = Utf8               out</span><br><span class="line">  #31 = Utf8               Ljava/io/PrintStream;</span><br><span class="line">  #32 = Utf8               java/io/PrintStream</span><br><span class="line">  #33 = Utf8               println</span><br><span class="line">  #34 = Utf8               (I)V</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">public</span> org.lc.jvm_class.T3();</span><br><span class="line">    descriptor: ()V</span><br><span class="line">    flags: ACC_PUBLIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=<span class="number">1</span>, locals=<span class="number">1</span>, args_size=<span class="number">1</span></span><br><span class="line">         <span class="number">0</span>: aload_0</span><br><span class="line">         1: invokespecial #1                  // Method java/lang/Object."&lt;init&gt;":()V</span><br><span class="line">         <span class="number">4</span>: <span class="keyword">return</span></span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line <span class="number">10</span>: <span class="number">0</span></span><br><span class="line">      LocalVariableTable:</span><br><span class="line">        Start  Length  Slot  Name   Signature</span><br><span class="line">            <span class="number">0</span>       <span class="number">5</span>     <span class="number">0</span>  <span class="keyword">this</span>   Lorg/lc/jvm_class/T3;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(java.lang.String[])</span></span>;</span><br><span class="line">    descriptor: ([Ljava/lang/String;)V</span><br><span class="line">    flags: ACC_PUBLIC, ACC_STATIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=<span class="number">2</span>, locals=<span class="number">3</span>, args_size=<span class="number">1</span></span><br><span class="line">         <span class="number">0</span>: bipush        <span class="number">10</span></span><br><span class="line">         <span class="number">2</span>: istore_1</span><br><span class="line">         <span class="number">3</span>: iload_1</span><br><span class="line">         <span class="number">4</span>: iinc          <span class="number">1</span>, <span class="number">1</span></span><br><span class="line">         <span class="number">7</span>: iinc          <span class="number">1</span>, <span class="number">1</span></span><br><span class="line">        <span class="number">10</span>: iload_1</span><br><span class="line">        <span class="number">11</span>: iadd</span><br><span class="line">        <span class="number">12</span>: iload_1</span><br><span class="line">        <span class="number">13</span>: iinc          <span class="number">1</span>, -<span class="number">1</span></span><br><span class="line">        <span class="number">16</span>: iadd</span><br><span class="line">        <span class="number">17</span>: istore_2</span><br><span class="line">        18: getstatic     #2                  // Field java/lang/System.out:Ljava/io/PrintStream;</span><br><span class="line">        <span class="number">21</span>: iload_1</span><br><span class="line">        22: invokevirtual #3                  // Method java/io/PrintStream.println:(I)V</span><br><span class="line">        25: getstatic     #2                  // Field java/lang/System.out:Ljava/io/PrintStream;</span><br><span class="line">        <span class="number">28</span>: iload_2</span><br><span class="line">        29: invokevirtual #3                  // Method java/io/PrintStream.println:(I)V</span><br><span class="line">        <span class="number">32</span>: <span class="keyword">return</span></span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line <span class="number">12</span>: <span class="number">0</span></span><br><span class="line">        line <span class="number">13</span>: <span class="number">3</span></span><br><span class="line">        line <span class="number">14</span>: <span class="number">18</span></span><br><span class="line">        line <span class="number">15</span>: <span class="number">25</span></span><br><span class="line">        line <span class="number">16</span>: <span class="number">32</span></span><br><span class="line">      LocalVariableTable:</span><br><span class="line">        Start  Length  Slot  Name   Signature</span><br><span class="line">            <span class="number">0</span>      <span class="number">33</span>     <span class="number">0</span>  args   [Ljava/lang/String;</span><br><span class="line">            <span class="number">3</span>      <span class="number">30</span>     <span class="number">1</span>     a   I</span><br><span class="line">           <span class="number">18</span>      <span class="number">15</span>     <span class="number">2</span>     b   I</span><br><span class="line">&#125;</span><br><span class="line">SourceFile: <span class="string">"T3.java"</span></span><br></pre></td></tr></table></figure>

<p><strong>注意:</strong></p>
<ul>
<li><p>iinc 指令(自增指令)是直接在局部变量 slot 上进行运算 </p>
</li>
<li><p>a++ 和 ++a 的区别是先执行 iload (从本地变量表加载)还是 先执行 iinc</p>
</li>
</ul>
<p>【1】首先将10入栈</p>
<img src="http://img.louchen.top/2020/06/20200613231752.png" style="zoom: 67%;" />

<p>【2】将10出栈存入局部变量表中的变量a</p>
<img src="http://img.louchen.top/2020/06/20200613231914.png" style="zoom:67%;" />

<p>【3】读取a变量的值加载到栈中</p>
<img src="http://img.louchen.top/2020/06/20200613232121.png" style="zoom:67%;" />

<p>【4】执行a++操作，即在slot槽中完成自增1操作，但是不会影响栈中已经加载的数据。此时的a为11</p>
<img src="http://img.louchen.top/2020/06/20200613232221.png" style="zoom:67%;" />

<p>【5】执行++a的iinc操作，即再次在slot槽中完成自增1操作但是不会影响栈中已经加载的数据。此时的a为12</p>
<img src="C:\Users\42119\AppData\Roaming\Typora\typora-user-images\image-20200613232430140.png" alt="image-20200613232430140" style="zoom:67%;" />

<p>【6】iload加载局部变量表中a的值并入栈</p>
<img src="http://img.louchen.top/2020/06/20200613232533.png" style="zoom:67%;" />

<p>【7】在栈中完成add加操作 </p>
<img src="http://img.louchen.top/2020/06/20200613232759.png" style="zoom:67%;" />

<p>【8】执行a - - 的iload操作完成入栈,此时a为12</p>
<img src="http://img.louchen.top/2020/06/20200613233048.png" style="zoom:67%;" />

<p>【9】执行a– 的iinc的操作完成自减1的操作 ，此时a为11</p>
<img src="http://img.louchen.top/2020/06/20200613233356.png" style="zoom:67%;" />

<p>【10】在栈中完成add累加操作</p>
<img src="http://img.louchen.top/2020/06/20200613233523.png" style="zoom:67%;" />

<p>【11】将34出栈，存入本地变量表中的变量b</p>
<img src="http://img.louchen.top/2020/06/20200613233554.png" style="zoom:67%;" />

<h5 id="8-静态块-静态变量执行流程-类的初始化-lt-cinit-gt-V"><a href="#8-静态块-静态变量执行流程-类的初始化-lt-cinit-gt-V" class="headerlink" title="8)静态块/静态变量执行流程(类的初始化&lt;cinit&gt;()V )"></a>8)静态块/静态变量执行流程(类的初始化&lt;cinit&gt;()V )</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">T4</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="comment">//静态成员变量的再次声明修改必须在静态块中或者方法中才能修改</span></span><br><span class="line">        i=<span class="number">20</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//先把i放入常量池中，赋值操作还未执行，从上到下依次执行静态块中的赋值操作</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> i=<span class="number">10</span>;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="comment">//静态成员变量的再次声明修改必须在静态块中或者方法中才能修改</span></span><br><span class="line">        i=<span class="number">30</span>;</span><br><span class="line">        j=<span class="number">10</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//先把j放入常量池中，赋值操作还未执行，从上到下依次执行静态块中的赋值操作</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> j=<span class="number">20</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//30</span></span><br><span class="line">        System.out.println(i);</span><br><span class="line">        <span class="comment">//20</span></span><br><span class="line">        System.out.println(j);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>编译器会按从上至下的顺序，收集所有 static 静态代码块和静态成员赋值的代码，<strong>合并为一个特殊的方法</strong> <strong>&lt;cinit&gt;()V ：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> &#123;&#125;;</span><br><span class="line">    descriptor: ()V</span><br><span class="line">    flags: ACC_STATIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=<span class="number">1</span>, locals=<span class="number">0</span>, args_size=<span class="number">0</span></span><br><span class="line">          <span class="comment">//20压栈</span></span><br><span class="line">         <span class="number">0</span>: bipush        <span class="number">20</span></span><br><span class="line">           <span class="comment">//赋值常量池中的变量i</span></span><br><span class="line">         2: putstatic     #3                  // Field i:I</span><br><span class="line">          <span class="comment">//10压栈</span></span><br><span class="line">         <span class="number">5</span>: bipush        <span class="number">10</span></span><br><span class="line">          <span class="comment">//赋值常量池中变量i</span></span><br><span class="line">         7: putstatic     #3                  // Field i:I</span><br><span class="line">        <span class="number">10</span>: bipush        <span class="number">30</span></span><br><span class="line">        12: putstatic     #3                  // Field i:I</span><br><span class="line">        <span class="number">15</span>: bipush        <span class="number">10</span></span><br><span class="line">        17: putstatic     #5                  // Field j:I</span><br><span class="line">        <span class="number">20</span>: <span class="keyword">return</span></span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line <span class="number">12</span>: <span class="number">0</span></span><br><span class="line">        line <span class="number">14</span>: <span class="number">5</span></span><br><span class="line">        line <span class="number">16</span>: <span class="number">10</span></span><br><span class="line">        line <span class="number">17</span>: <span class="number">15</span></span><br><span class="line">        line <span class="number">18</span>: <span class="number">20</span></span><br></pre></td></tr></table></figure>

<p><strong>&lt;cinit&gt;()V</strong> 方法会在类加载的<strong>初始化阶段被调用</strong></p>
<h5 id="9-游离块-构造函数执行流程-对象的初始化"><a href="#9-游离块-构造函数执行流程-对象的初始化" class="headerlink" title="9)游离块/构造函数执行流程(对象的初始化)"></a>9)游离块/构造函数执行流程(对象的初始化)</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">T5</span> </span>&#123;</span><br><span class="line">    <span class="comment">//构造函数中的所有操作，总是在所有成员变量和游离块中的内容依次加载完毕才会执行</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">T5</span><span class="params">(String a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//最后执行</span></span><br><span class="line">        <span class="keyword">this</span>.a = a;</span><br><span class="line">        <span class="keyword">this</span>.b = b;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//成员变量a的声明先放入常量池中，但赋值操作还未进行,从上到下依次加载成员变量和赋值操作</span></span><br><span class="line">    <span class="keyword">private</span> String a=<span class="string">"s1"</span>;</span><br><span class="line">    &#123;</span><br><span class="line">        b=<span class="number">20</span>;</span><br><span class="line">    &#125;</span><br><span class="line">   <span class="comment">//成员变量a的声明先放入常量池中，但赋值操作还未进行，从上到下依次加载成员变量和赋值操作</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> b=<span class="number">10</span>;</span><br><span class="line">    &#123;</span><br><span class="line">        a = <span class="string">"s2"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        T5 t5 = <span class="keyword">new</span> T5(<span class="string">"S3"</span>, <span class="number">30</span>);</span><br><span class="line">        System.out.println(t5.a);</span><br><span class="line">        System.out.println(t5.b);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>编译器会按从上至下的顺序，收集所有 {} 代码块和成员变量赋值的代码，形成新的构造方法，但<strong>原始构 造方法内的代码总是在后</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> org.lc.jvm_class.T5(java.lang.String, <span class="keyword">int</span>);</span><br><span class="line">   descriptor: (Ljava/lang/String;I)V</span><br><span class="line">   flags: ACC_PUBLIC</span><br><span class="line">   Code:</span><br><span class="line">     stack=<span class="number">2</span>, locals=<span class="number">3</span>, args_size=<span class="number">3</span></span><br><span class="line">        <span class="number">0</span>: aload_0</span><br><span class="line">        1: invokespecial #1                  // Method java/lang/Object."&lt;init&gt;":()V</span><br><span class="line">        <span class="number">4</span>: aload_0</span><br><span class="line">        5: ldc           #2                  // String s1</span><br><span class="line">        7: putfield      #3                  // Field a:Ljava/lang/String;</span><br><span class="line">       <span class="number">10</span>: aload_0</span><br><span class="line">       <span class="number">11</span>: bipush        <span class="number">20</span></span><br><span class="line">       13: putfield      #4                  // Field b:I</span><br><span class="line">       <span class="number">16</span>: aload_0</span><br><span class="line">       <span class="number">17</span>: bipush        <span class="number">10</span></span><br><span class="line">       19: putfield      #4                  // Field b:I</span><br><span class="line">       <span class="number">22</span>: aload_0</span><br><span class="line">       23: ldc           #5                  // String s2</span><br><span class="line">       25: putfield      #3                  // Field a:Ljava/lang/String;</span><br><span class="line">       <span class="number">28</span>: aload_0</span><br><span class="line">       <span class="number">29</span>: aload_1</span><br><span class="line">       30: putfield      #3                  // Field a:Ljava/lang/String;</span><br><span class="line">       <span class="number">33</span>: aload_0</span><br><span class="line">       <span class="number">34</span>: iload_2</span><br><span class="line">       35: putfield      #4                  // Field b:I</span><br><span class="line">       <span class="number">38</span>: <span class="keyword">return</span></span><br><span class="line">     LineNumberTable:</span><br><span class="line">       line <span class="number">20</span>: <span class="number">0</span></span><br><span class="line">       line <span class="number">11</span>: <span class="number">4</span></span><br><span class="line">       line <span class="number">13</span>: <span class="number">10</span></span><br><span class="line">       line <span class="number">15</span>: <span class="number">16</span></span><br><span class="line">       line <span class="number">17</span>: <span class="number">22</span></span><br><span class="line">       line <span class="number">21</span>: <span class="number">28</span></span><br><span class="line">       line <span class="number">22</span>: <span class="number">33</span></span><br><span class="line">       line <span class="number">23</span>: <span class="number">38</span></span><br><span class="line">     LocalVariableTable:</span><br><span class="line">       Start  Length  Slot  Name   Signature</span><br><span class="line">           <span class="number">0</span>      <span class="number">39</span>     <span class="number">0</span>  <span class="keyword">this</span>   Lorg/lc/jvm_class/T5;</span><br><span class="line">           <span class="number">0</span>      <span class="number">39</span>     <span class="number">1</span>     a   Ljava/lang/String;</span><br><span class="line">           <span class="number">0</span>      <span class="number">39</span>     <span class="number">2</span>     b   I</span><br></pre></td></tr></table></figure>

<h5 id="10-不同方法的调用"><a href="#10-不同方法的调用" class="headerlink" title="10)不同方法的调用"></a>10)不同方法的调用</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">T6</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">T6</span><span class="params">()</span> </span>&#123; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span> </span>&#123; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">test2</span><span class="params">()</span> </span>&#123; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test3</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test4</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        T6 t6=<span class="keyword">new</span> T6();</span><br><span class="line">        t6.test1();</span><br><span class="line">        t6.test2();</span><br><span class="line">        t6.test3();</span><br><span class="line"><span class="comment">//        类名直接调用</span></span><br><span class="line">        T6.test4();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(java.lang.String[])</span></span>;</span><br><span class="line">  descriptor: ([Ljava/lang/String;)V</span><br><span class="line">  flags: ACC_PUBLIC, ACC_STATIC</span><br><span class="line">  Code:</span><br><span class="line">    stack=<span class="number">2</span>, locals=<span class="number">2</span>, args_size=<span class="number">1</span></span><br><span class="line">       <span class="comment">//new一个对象在堆中。 在操作数栈中分配一块引用</span></span><br><span class="line">       0: new           #2                  // class org/lc/jvm_class/T6</span><br><span class="line">       <span class="comment">//将栈中的对象的引用赋值一份调用此构造方法，然后出栈释放</span></span><br><span class="line">       <span class="number">3</span>: dup</span><br><span class="line">       <span class="comment">//构造方法唯一确定</span></span><br><span class="line">       4: invokespecial #3                  // Method "&lt;init&gt;":()V</span><br><span class="line">       <span class="number">7</span>: astore_1</span><br><span class="line">       <span class="number">8</span>: aload_1</span><br><span class="line">       <span class="comment">//private私有方法唯一确定，不能被继承，即直接能够直接从类中找到该方法</span></span><br><span class="line">       9: invokespecial #4                  // Method test1:()V</span><br><span class="line">      <span class="number">12</span>: aload_1</span><br><span class="line">      <span class="comment">//final方法唯一确定，即不能被覆盖，即直接能够直接从类中找到该方法      </span></span><br><span class="line">      13: invokespecial #5                  // Method test2:()V</span><br><span class="line">      <span class="number">16</span>: aload_1</span><br><span class="line">      <span class="comment">//public公共方法不能确定，可能被其他类重写，在编译期间不能确定。</span></span><br><span class="line">      17: invokevirtual #6                  // Method test3:()V</span><br><span class="line">      <span class="comment">//static静态方法，直接通过类名调用。</span></span><br><span class="line">      20: invokestatic  #7                  // Method test4:()V</span><br><span class="line">      <span class="number">23</span>: <span class="keyword">return</span></span><br><span class="line">    LineNumberTable:</span><br><span class="line">      line <span class="number">17</span>: <span class="number">0</span></span><br><span class="line">      line <span class="number">18</span>: <span class="number">8</span></span><br><span class="line">      line <span class="number">19</span>: <span class="number">12</span></span><br><span class="line">      line <span class="number">20</span>: <span class="number">16</span></span><br><span class="line">      line <span class="number">22</span>: <span class="number">20</span></span><br><span class="line">      line <span class="number">23</span>: <span class="number">23</span></span><br><span class="line">    LocalVariableTable:</span><br><span class="line">      Start  Length  Slot  Name   Signature</span><br><span class="line">          <span class="number">0</span>      <span class="number">24</span>     <span class="number">0</span>  args   [Ljava/lang/String;</span><br><span class="line">          <span class="number">8</span>      <span class="number">16</span>     <span class="number">1</span>    t6   Lorg/lc/jvm_class/T6;</span><br></pre></td></tr></table></figure>

<p><strong>invokespecial</strong>，<strong>invokestatic</strong>属于静态绑定，即在编译期间就能确定其唯一性。</p>
<p><strong>invokevirtual</strong> 属于动态绑定，需要在运行时才能确定其唯一性。</p>
<h5 id="11-synchronized字节码分析"><a href="#11-synchronized字节码分析" class="headerlink" title="11)synchronized字节码分析"></a>11)synchronized字节码分析</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">T8</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Object lock=<span class="keyword">new</span> Object();</span><br><span class="line">        <span class="keyword">synchronized</span> (lock) &#123;</span><br><span class="line">            System.out.println(<span class="string">"ok"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="keyword">public</span> org.lc.jvm_class.T8();</span><br><span class="line">    descriptor: ()V</span><br><span class="line">    flags: ACC_PUBLIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=<span class="number">1</span>, locals=<span class="number">1</span>, args_size=<span class="number">1</span></span><br><span class="line">         <span class="number">0</span>: aload_0</span><br><span class="line">         1: invokespecial #1                  // Method java/lang/Object."&lt;init&gt;":()V</span><br><span class="line">         <span class="number">4</span>: <span class="keyword">return</span></span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line <span class="number">10</span>: <span class="number">0</span></span><br><span class="line">      LocalVariableTable:</span><br><span class="line">        Start  Length  Slot  Name   Signature</span><br><span class="line">            <span class="number">0</span>       <span class="number">5</span>     <span class="number">0</span>  <span class="keyword">this</span>   Lorg/lc/jvm_class/T8;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(java.lang.String[])</span></span>;</span><br><span class="line">    descriptor: ([Ljava/lang/String;)V</span><br><span class="line">    flags: ACC_PUBLIC, ACC_STATIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=<span class="number">2</span>, locals=<span class="number">4</span>, args_size=<span class="number">1</span></span><br><span class="line">          <span class="comment">//new一份对象放入堆中，将地址引用放入操作数栈中</span></span><br><span class="line">         0: new           #2                  // class java/lang/Object</span><br><span class="line">          <span class="comment">//赋值一份该对象的在栈中的引用，这个引用将调用构造方法</span></span><br><span class="line">         <span class="number">3</span>: dup</span><br><span class="line">         4: invokespecial #1                  // Method java/lang/Object."&lt;init&gt;":()V</span><br><span class="line">          <span class="comment">//将对象赋给lock变量 Object lock=new Object();</span></span><br><span class="line">         <span class="number">7</span>: astore_1</span><br><span class="line">          <span class="comment">//将对象引用加载到操作数栈</span></span><br><span class="line">         <span class="number">8</span>: aload_1</span><br><span class="line">          <span class="comment">//赋值一份锁对象，分别对应一份加锁一份解锁用</span></span><br><span class="line">         <span class="number">9</span>: dup</span><br><span class="line">        <span class="number">10</span>: astore_2  <span class="comment">//这里赋值的对象加到一个本地变量表中的匿名参数中astrore_2上</span></span><br><span class="line">        <span class="number">11</span>: monitorenter</span><br><span class="line">        12: getstatic     #3                  // Field java/lang/System.out:Ljava/io/PrintStream;</span><br><span class="line">        15: ldc           #4                  // String ok</span><br><span class="line">        17: invokevirtual #5                  // Method java/io/PrintStream.println:(Ljava/lang/String;)V</span><br><span class="line">        <span class="number">20</span>: aload_2</span><br><span class="line">        <span class="number">21</span>: monitorexit</span><br><span class="line">        <span class="number">22</span>: goto          <span class="number">30</span></span><br><span class="line">        <span class="number">25</span>: astore_3</span><br><span class="line">        <span class="number">26</span>: aload_2</span><br><span class="line">        <span class="number">27</span>: monitorexit</span><br><span class="line">        <span class="number">28</span>: aload_3</span><br><span class="line">        <span class="number">29</span>: athrow</span><br><span class="line">        <span class="number">30</span>: <span class="keyword">return</span></span><br><span class="line">      Exception table:</span><br><span class="line">         from    to  target type</span><br><span class="line">            <span class="number">12</span>    <span class="number">22</span>    <span class="number">25</span>   any</span><br><span class="line">            <span class="number">25</span>    <span class="number">28</span>    <span class="number">25</span>   any</span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line <span class="number">12</span>: <span class="number">0</span></span><br><span class="line">        line <span class="number">13</span>: <span class="number">8</span></span><br><span class="line">        line <span class="number">14</span>: <span class="number">12</span></span><br><span class="line">        line <span class="number">15</span>: <span class="number">20</span></span><br><span class="line">        line <span class="number">16</span>: <span class="number">30</span></span><br><span class="line">      LocalVariableTable:</span><br><span class="line">        Start  Length  Slot  Name   Signature</span><br><span class="line">            <span class="number">0</span>      <span class="number">31</span>     <span class="number">0</span>  args   [Ljava/lang/String;</span><br><span class="line">            <span class="number">8</span>      <span class="number">23</span>     <span class="number">1</span>  lock   Ljava/lang/Object;</span><br><span class="line">      StackMapTable: number_of_entries = <span class="number">2</span></span><br><span class="line">        frame_type = <span class="number">255</span> <span class="comment">/* full_frame */</span></span><br><span class="line">          offset_delta = <span class="number">25</span></span><br><span class="line">          locals = [ class "[Ljava/lang/String;", class java/lang/Object, class java/lang/Object ]</span><br><span class="line">          stack = [ class java/lang/Throwable ]</span><br><span class="line">        frame_type = <span class="number">250</span> <span class="comment">/* chop */</span></span><br><span class="line">          offset_delta = <span class="number">4</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="三、编译器处理"><a href="#三、编译器处理" class="headerlink" title="三、编译器处理"></a>三、编译器处理</h3><p>所谓的 *<em>语法糖 *</em>其实就是指 java 编译器把 *.java 源码编译为 *.class 字节码的过程中，自动生成 和转换的一些代码，主要是为了减轻程序员的负担，算是 java 编译器给我们的一个额外福利（给糖吃 嘛）<br>注意，以下代码的分析，借助了 javap 工具，idea 的反编译功能，idea 插件 jclasslib 等工具。另外， 编译器转换的结果直接就是 class 字节码，只是为了便于阅读，给出了 几乎等价 的 java 源码方式，并 不是编译器还会转换出中间的 java 源码，切记</p>
<h4 id="1、默认构造函数"><a href="#1、默认构造函数" class="headerlink" title="1、默认构造函数"></a>1、默认构造函数</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">T1</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>伪字节码：</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.lc.jvm_compiler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">T1</span> </span>&#123;</span><br><span class="line">   <span class="comment">// 这个无参构造是编译器帮助我们加上的 </span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">T1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 即调用父类 Object 的无参构造方法，即调用 java/lang/Object." &lt;init&gt;":()V </span></span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2、自动拆装箱"><a href="#2、自动拆装箱" class="headerlink" title="2、自动拆装箱"></a>2、自动拆装箱</h4><p><strong>包装类.valueOf(值);</strong>  //装箱</p>
<p><strong>包装类实例对象.intValue();</strong> //拆箱</p>
<p>这个特性是 JDK 5 开始加入的， 代码片段1 ：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">T1</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Integer x=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> y=x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这段代码在 JDK 5 之前是无法编译通过的，必须改写为 代码片段2 :</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">T1</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Integer x=Integer.valueOf(<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">int</span> y=x.intValue();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3、泛型集合取值"><a href="#3、泛型集合取值" class="headerlink" title="3、泛型集合取值"></a>3、泛型集合取值</h4><p>泛型也是在 JDK 5 开始加入的特性，但 java 在编译泛型代码后会执行 <strong>泛型擦除</strong> 的动作，即泛型信息 在编译为字节码之后就丢失了，实际的类型都当做了 <strong>Object 类型来处理</strong>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">T1</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        List&lt;Integer&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        list.add(<span class="number">10</span>); <span class="comment">// 实际调用的是 List.add(Object e)</span></span><br><span class="line">        Integer x = list.get(<span class="number">0</span>); <span class="comment">// 实际调用的是 Object obj = List.get(int index);  </span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>所以在取值时，编译器真正生成的字节码中，还要额外做一个类型转换的操作：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 需要将 Object 转为 Integer </span></span><br><span class="line">Integer x = (Integer)list.get(<span class="number">0</span>);</span><br></pre></td></tr></table></figure>

<p>如果前面的 x 变量类型修改为 int 基本类型那么终生成的字节码是：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 需要将 Object 转为 Integer, 并执行拆箱操作 </span></span><br><span class="line"><span class="keyword">int</span> x = ((Integer)list.get(<span class="number">0</span>)).intValue();</span><br></pre></td></tr></table></figure>

<h4 id="4、可变参数"><a href="#4、可变参数" class="headerlink" title="4、可变参数"></a>4、可变参数</h4><p>可变参数也是 JDK 5 开始加入的新特性： 例如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">T2</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        foo(<span class="string">"hello"</span>,<span class="string">"world"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">foo</span><span class="params">(String... args)</span> </span>&#123;</span><br><span class="line"><span class="comment">//        直接赋值</span></span><br><span class="line">        String[] array=args;</span><br><span class="line">        System.out.println(array);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可变参数 <strong>String… args</strong> 其实是一个 <strong>String[] args</strong> ，从代码中的赋值语句中就可以看出来。 同 样 java 编译器会在编译期间将上述代码变换为：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">T2</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        foo(<span class="keyword">new</span> String[]&#123;<span class="string">"hello"</span>,<span class="string">"world"</span>&#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">foo</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"><span class="comment">//        直接赋值</span></span><br><span class="line">        String[] array=args;</span><br><span class="line">        System.out.println(array);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>注意 :</strong></p>
<p>如果调用了 <strong>foo()</strong> 则等价代码为 <strong>foo(new String[]{})</strong> ，创建了一个空的数组，而<strong>不会 传递 null 进去</strong></p>
<h4 id="5、foreach循环"><a href="#5、foreach循环" class="headerlink" title="5、foreach循环"></a>5、foreach循环</h4><blockquote>
<p>数组的循环</p>
</blockquote>
<p>仍是 JDK 5 开始引入的语法糖，数组的循环：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">T3</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"><span class="comment">//        数组的初始化赋值操作</span></span><br><span class="line">        <span class="keyword">int</span>[] array = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>&#125;;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> arr : array) &#123;</span><br><span class="line">            System.out.println(arr);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">T3</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span>[] array = <span class="keyword">new</span> <span class="keyword">int</span>[]&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>&#125;;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; array.length; i++) &#123;</span><br><span class="line">            System.out.println(array[i]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p> 集合的循环</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">T3</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        List&lt;Integer&gt; list = Arrays.asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>);</span><br><span class="line">        <span class="keyword">for</span> (Integer i : list) &#123;</span><br><span class="line">            System.out.println(i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>实际被编译器转换为对迭代器的调用：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        List&lt;Integer&gt; list = Arrays.asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>);</span><br><span class="line">        Iterator var2 = list.iterator();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(var2.hasNext()) &#123;</span><br><span class="line">            Integer i = (Integer)var2.next();</span><br><span class="line">            System.out.println(i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><strong>注意:</strong></p>
<p><strong>foreach 循环写法</strong>，能够配合数组，以及所有实现了 <strong>Iterable 接口</strong>的集合类一起使用，其 中 <strong>Iterable 用来</strong>获取集合的迭代器（ <strong>Iterator</strong>)</p>
<h4 id="6、switch字符串"><a href="#6、switch字符串" class="headerlink" title="6、switch字符串"></a>6、switch字符串</h4><p><strong>枚举允许的类型：</strong></p>
<ul>
<li>基本数据类型：byte, short, char, int</li>
<li>包装数据类型：Byte, Short, Character, Integer</li>
<li>枚举类型：Enum Jdk 7+（JDK1.7之后） 开始支持</li>
<li>字符串类型：String（Jdk 7+（JDK1.7之后） 开始支持</li>
</ul>
<p>不支持boolean和double，float，long型</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">choose</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> (str) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"hello"</span>:</span><br><span class="line">                System.out.println(<span class="string">"h"</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"world"</span>:</span><br><span class="line">                System.out.println(<span class="string">"w"</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>注意 switch 配合 <strong>String 和枚举使用</strong>时，<strong>变量不能为null</strong>，原因分析完语法糖转换后的代码应当自 然清楚</p>
<blockquote>
<p>字节码：</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">choose</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">byte</span> var2 = -<span class="number">1</span>;</span><br><span class="line">    	<span class="comment">//其实是将字符串转换为hashcode 即为字符串和枚举时不能为空</span></span><br><span class="line">        <span class="keyword">switch</span>(str.hashCode()) &#123;</span><br><span class="line">          <span class="comment">//case的变量在编译的时候已经确定</span></span><br><span class="line">        <span class="keyword">case</span> <span class="number">99162322</span>:</span><br><span class="line">            <span class="keyword">if</span> (str.equals(<span class="string">"hello"</span>)) &#123;</span><br><span class="line">                var2 = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">113318802</span>:</span><br><span class="line">            <span class="keyword">if</span> (str.equals(<span class="string">"world"</span>)) &#123;</span><br><span class="line">                var2 = <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">switch</span>(var2) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">            System.out.println(<span class="string">"h"</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">            System.out.println(<span class="string">"w"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>可以看到，执行了两遍 switch，第一遍是根据字符串的 hashCode 和 equals 将字符串的转换为相应 byte 类型，第二遍才是利用 byte 执行进行比较。</p>
<p>为什么第一遍时必须既比较 hashCode，又利用 equals 比较呢？hashCode 是为了提高效率，减少可 能的比较；<strong>而 equals 是为了防止 hashCode 冲突</strong>，例如 BM 和 C. 这两个字符串的hashCode值都是 2123 ，如果有如下代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">choose</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> (str) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"BM"</span>:</span><br><span class="line">                System.out.println(<span class="string">"h"</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"C."</span>:</span><br><span class="line">                System.out.println(<span class="string">"w"</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>字节码</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">choose</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">byte</span> var2 = -<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">switch</span>(str.hashCode()) &#123;</span><br><span class="line">         <span class="comment">//hash碰撞</span></span><br><span class="line">        <span class="keyword">case</span> <span class="number">2123</span>:</span><br><span class="line">             <span class="comment">//hash碰撞后再采用equals进行值的比较，提高效率。这样做和hashmap类似</span></span><br><span class="line">            <span class="keyword">if</span> (str.equals(<span class="string">"C."</span>)) &#123;</span><br><span class="line">                var2 = <span class="number">1</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (str.equals(<span class="string">"BM"</span>)) &#123;</span><br><span class="line">                var2 = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">switch</span>(var2) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">                System.out.println(<span class="string">"h"</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">                System.out.println(<span class="string">"w"</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h4 id="7、switch枚举"><a href="#7、switch枚举" class="headerlink" title="7、switch枚举"></a>7、switch枚举</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">T4</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">choose</span><span class="params">(Sex sex)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> (sex) &#123;</span><br><span class="line">            <span class="keyword">case</span> MALE:</span><br><span class="line">                System.out.println(<span class="string">"男"</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> FEMALE:</span><br><span class="line">                System.out.println(<span class="string">"女"</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">enum</span> Sex&#123;</span><br><span class="line">    MALE,</span><br><span class="line">    FEMALE</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="http://img.louchen.top/2020/06/20200615212941.png" style="zoom: 80%;" />

<h4 id="8、枚举类"><a href="#8、枚举类" class="headerlink" title="8、枚举类"></a>8、枚举类</h4><p>JDK 7 新增了<strong>枚举类</strong>，以前面的性别枚举为例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> Sex &#123;    </span><br><span class="line">    MALE, </span><br><span class="line">    FEMALE </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>转换后代码：</p>
<img src="http://img.louchen.top/2020/06/20200615214343.png" style="zoom:80%;" />

<img src="http://img.louchen.top/2020/06/20200615214359.png" style="zoom:80%;" />

<h4 id="9、try-with-resources"><a href="#9、try-with-resources" class="headerlink" title="9、try-with-resources"></a>9、try-with-resources</h4><p>JDK 7 开始新增了<strong>对需要关闭的资源处理</strong>的特殊语法 <strong>try-with-resources</strong>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>(资源变量 = 创建资源对象)&#123;</span><br><span class="line">    </span><br><span class="line">&#125; <span class="keyword">catch</span>( ) &#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其中资源对象需要实现 <strong>AutoCloseable</strong> 接口，例如 InputStream 、 OutputStream 、 Connection 、 Statement 、 ResultSet 等接口都实现了 <strong>AutoCloseable</strong> ，使用 try-withresources 可以<strong>不用写 finally 语句块，编译器会帮助生成关闭资源代码</strong>，例如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> (InputStream is = <span class="keyword">new</span> FileInputStream(<span class="string">"d:/1.txt"</span>)) &#123;</span><br><span class="line">            System.out.println(is);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><strong>编译后的代码：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            InputStream is = <span class="keyword">new</span> FileInputStream(<span class="string">"d:/1.txt"</span>);</span><br><span class="line">            Throwable var2 = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                System.out.println(is);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Throwable var12) &#123;</span><br><span class="line">                <span class="comment">//var2是我们代码出现的异常</span></span><br><span class="line">                var2 = var12;</span><br><span class="line">                <span class="keyword">throw</span> var12;</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                <span class="comment">//判断资源不为空</span></span><br><span class="line">                <span class="keyword">if</span> (is != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="comment">//如果我们代码有异常</span></span><br><span class="line">                    <span class="keyword">if</span> (var2 != <span class="keyword">null</span>) &#123;</span><br><span class="line">                        <span class="keyword">try</span> &#123;</span><br><span class="line">                            is.close();</span><br><span class="line">                        &#125; <span class="keyword">catch</span> (Throwable var11) &#123;</span><br><span class="line">                            <span class="comment">// 如果 close 出现异常，作为被压制异常添加 </span></span><br><span class="line">                            var2.addSuppressed(var11);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="comment">// 如果我们代码没有异常，close 出现的异常就是后 catch 块中的 e </span></span><br><span class="line">                        is.close();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException var14) &#123;</span><br><span class="line">            var14.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>为什么要设计一个 <strong>addSuppressed(Throwable e)</strong> （添加被压制异常）的方法呢？是为了防止异常信 息的丢失（想想 try-with-resources 生成的 ﬁanlly 中如果抛出了异常）：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">T5</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> (MyResouce myResouce=<span class="keyword">new</span> MyResouce())&#123;</span><br><span class="line">            <span class="keyword">int</span> i=<span class="number">1</span>/<span class="number">0</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="comment">//执行的代码异常</span></span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyResouce</span> <span class="keyword">implements</span>  <span class="title">AutoCloseable</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//关闭时的异常</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">"close异常"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>执行的代码和关闭时的异常都能捕获到。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">java.lang.ArithmeticException: / by zero</span><br><span class="line">	at org.lc.jvm_compiler.T5.main(T5.java:<span class="number">20</span>)</span><br><span class="line">	Suppressed: java.lang.Exception: close异常</span><br><span class="line">		at org.lc.jvm_compiler.MyResouce.close(T5.java:<span class="number">30</span>)</span><br><span class="line">		at org.lc.jvm_compiler.T5.main(T5.java:<span class="number">21</span>)</span><br></pre></td></tr></table></figure>

<h4 id="10、方法重写时的桥接"><a href="#10、方法重写时的桥接" class="headerlink" title="10、方法重写时的桥接"></a>10、方法重写时的桥接</h4><p>我们都知道，方法重写时对返回值分两种情况：</p>
<ul>
<li>父子类的返回值完全一致 </li>
<li>子类返回值可以是父类返回值的子类（比较绕口，见下面的例子）</li>
</ul>
<img src="http://img.louchen.top/2020/06/20200615232133.png" style="zoom:80%;" />

<p>对于子类，java 编译器会做如下处理：</p>
<img src="http://img.louchen.top/2020/06/20200615232158.png" style="zoom: 80%;" />

<p>其中桥接方法比较特殊，仅对 java 虚拟机可见，并且与原来的 public Integer m() 没有命名冲突，可以 用下面反射代码来验证</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (Method m : B<span class="class">.<span class="keyword">class</span>.<span class="title">getDeclaredMethods</span>()) </span>&#123;</span><br><span class="line">    System.out.println(m); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>会输出：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> java.lang.Integer test.candy.B.m()</span><br><span class="line"><span class="keyword">public</span> java.lang.Number test.candy.B.m()</span><br></pre></td></tr></table></figure>

<h4 id="11、匿名内部类"><a href="#11、匿名内部类" class="headerlink" title="11、匿名内部类"></a>11、匿名内部类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">T7</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Runnable runnable=<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                System.out.println(<span class="string">"ok"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p> 转换之后的代码：</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 额外生成的类 </span></span><br><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Candy11</span>$1 <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;    </span><br><span class="line">    Candy11$<span class="number">1</span>() &#123;    &#125;    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;        </span><br><span class="line">        System.out.println(<span class="string">"ok"</span>);    </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">T7</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Runnable runnable=<span class="keyword">new</span> Candy11$<span class="number">1</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>引用局部变量的匿名内部类</strong></p>
<img src="http://img.louchen.top/2020/06/20200615233345.png" style="zoom:80%;" />

<blockquote>
<p>转换后代码：</p>
</blockquote>
<img src="http://img.louchen.top/2020/06/20200615233426.png" style="zoom:80%;" />



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">T7</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">(<span class="keyword">final</span> <span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">        Runnable runnable=<span class="keyword">new</span> Candy11$<span class="number">1</span>(x);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>为了保证一致性，即局部变量中的值在匿名内部类中使用始终不变，即在局部变量上加final</strong></p>
<h3 id="四、类加载阶段"><a href="#四、类加载阶段" class="headerlink" title="四、类加载阶段"></a>四、类加载阶段</h3><h4 id="1、加载"><a href="#1、加载" class="headerlink" title="1、加载"></a>1、加载</h4><ul>
<li><p>将<strong>类的字节码载入方法区</strong>中，内部采用 C++ 的 instanceKlass 描述 java 类，它的重要 ﬁeld 有： </p>
<ul>
<li>_java_mirror 即 java 的类镜像，例如对 String 来说，就是 String.class，作用是把 klass 暴 露给 java 使用 </li>
<li>_super 即父类 </li>
<li>_ﬁelds 即成员变量 </li>
<li>_methods 即方法 </li>
<li>_constants 即常量池 </li>
<li>_class_loader 即类加载器</li>
<li>_vtable 虚方法表 </li>
<li>_itable 接口方法表 </li>
</ul>
</li>
<li><p>如果这个类还有父类没有加载，<strong>先加载父类</strong></p>
</li>
<li><p>加载和链接可能是交替运行的</p>
</li>
</ul>
<blockquote>
<p> 注意:</p>
</blockquote>
<ul>
<li><p>instanceKlass 这样的【元数据】是<strong>存储在方法区</strong>（1.8 后的元空间内），但 <strong>_java_mirror 是存储在堆中</strong> </p>
</li>
<li><p>可以通过前面介绍的 HSDB 工具查看</p>
</li>
</ul>
<img src="http://img.louchen.top/2020/06/20200616173543.png" style="zoom:80%;" />

<h4 id="2、链接"><a href="#2、链接" class="headerlink" title="2、链接"></a>2、链接</h4><h5 id="①验证"><a href="#①验证" class="headerlink" title="①验证"></a>①验证</h5><p>验证类是否符合 JVM规范，安全性检查 用 UE 等支持二进制的编辑器修改 HelloWorld.class 的魔数，在控制台运行</p>
<img src="http://img.louchen.top/2020/06/20200616173727.png" style="zoom: 67%;" />

<h5 id="②准备"><a href="#②准备" class="headerlink" title="②准备"></a>②准备</h5><p>为 static 变量分配空间，设置默认值</p>
<ul>
<li><p>static 变量在 JDK 7 之前存储于 instanceKlass 末尾(方法区元空间)，从 JDK 7 开始，存储于 _java_mirror 末尾(堆) </p>
</li>
<li><p>static 变量分配空间和赋值是两个步骤，<strong>分配空间在准备阶段完成，赋值在初始化阶段完成</strong> </p>
</li>
<li><p>如果 static 变量是 ﬁnal 的基本类型，以及字符串常量，那么<strong>编译阶段值就确定</strong>了，<strong>赋值在准备阶 段完成</strong> </p>
</li>
<li><p>如果 static 变量是 ﬁnal 的，但属于引用类型，那么赋值也会在<strong>初始化阶段完成</strong></p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">T8</span> </span>&#123;</span><br><span class="line">    <span class="comment">//静态成员是在准备阶段做分配空间的操作(和赋初始值)，并未赋值</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> a;</span><br><span class="line">    <span class="comment">//静态成员是在准备阶段做分配空间的操作，在类的构造(&lt;cinit()V&gt;)时候即初始化阶段赋值</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> b=<span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//静态final成员，若为基本类型(包括String)。在准备阶段即完成赋值操作，</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> c=<span class="number">20</span>;</span><br><span class="line">    <span class="comment">//静态final成员在准备阶段即完成赋值操作</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> String d = <span class="string">"hello"</span>;</span><br><span class="line">    <span class="comment">//静态final成员，若为引用类型(String除外)，赋值阶段是在类的构造(&lt;cinit()V&gt;)进行的即初始化阶段</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> Object e=<span class="keyword">new</span> Object();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p> 字节码：</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">int</span> a;</span><br><span class="line">    descriptor: I</span><br><span class="line">    flags: ACC_STATIC</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">int</span> b;</span><br><span class="line">    descriptor: I</span><br><span class="line">    flags: ACC_STATIC</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> c;</span><br><span class="line">    descriptor: I</span><br><span class="line">    flags: ACC_STATIC, ACC_FINAL</span><br><span class="line">    ConstantValue: <span class="keyword">int</span> <span class="number">20</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">final</span> java.lang.String d;</span><br><span class="line">    descriptor: Ljava/lang/String;</span><br><span class="line">    flags: ACC_STATIC, ACC_FINAL</span><br><span class="line">    ConstantValue: String hello</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">final</span> java.lang.Object e;</span><br><span class="line">    descriptor: Ljava/lang/Object;</span><br><span class="line">    flags: ACC_STATIC, ACC_FINAL</span><br><span class="line"></span><br><span class="line">      <span class="comment">//构造方法</span></span><br><span class="line">  <span class="keyword">public</span> org.lc.jvm_compiler.T8();</span><br><span class="line">    descriptor: ()V</span><br><span class="line">    flags: ACC_PUBLIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=<span class="number">1</span>, locals=<span class="number">1</span>, args_size=<span class="number">1</span></span><br><span class="line">         <span class="number">0</span>: aload_0</span><br><span class="line">         1: invokespecial #1                  // Method java/lang/Object."&lt;init&gt;":()V</span><br><span class="line">         <span class="number">4</span>: <span class="keyword">return</span></span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line <span class="number">10</span>: <span class="number">0</span></span><br><span class="line">      LocalVariableTable:</span><br><span class="line">        Start  Length  Slot  Name   Signature</span><br><span class="line">            <span class="number">0</span>       <span class="number">5</span>     <span class="number">0</span>  <span class="keyword">this</span>   Lorg/lc/jvm_compiler/T8;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//类的构造</span></span><br><span class="line">  <span class="keyword">static</span> &#123;&#125;;</span><br><span class="line">    descriptor: ()V</span><br><span class="line">    flags: ACC_STATIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=<span class="number">2</span>, locals=<span class="number">0</span>, args_size=<span class="number">0</span></span><br><span class="line">         <span class="number">0</span>: bipush        <span class="number">10</span></span><br><span class="line">         2: putstatic     #2                  // Field b:I</span><br><span class="line">         5: new           #3                  // class java/lang/Object</span><br><span class="line">         <span class="number">8</span>: dup</span><br><span class="line">         9: invokespecial #1                  // Method java/lang/Object."&lt;init&gt;":()V</span><br><span class="line">        12: putstatic     #4                  // Field e:Ljava/lang/Object;</span><br><span class="line">        <span class="number">15</span>: <span class="keyword">return</span></span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line <span class="number">14</span>: <span class="number">0</span></span><br><span class="line">        line <span class="number">19</span>: <span class="number">5</span></span><br><span class="line">&#125;</span><br><span class="line">SourceFile: <span class="string">"T8.java"</span></span><br></pre></td></tr></table></figure>

<h5 id="③解析"><a href="#③解析" class="headerlink" title="③解析"></a>③解析</h5><p>将常量池中的<strong>符号引用解析为直接引用</strong>。我们将字节码的方法字段等信息加载到方法区，未解析之前这些只是一些未知的符号，当经过解析之后，将把符号和内存中的位置(地址)相关联。</p>
<img src="http://img.louchen.top/2020/06/20200616174119.png" style="zoom:67%;" />

<h4 id="3、初始化"><a href="#3、初始化" class="headerlink" title="3、初始化"></a>3、初始化</h4><p><code>&lt;cinit&gt;()v方法</code></p>
<p>初始化即调用<code>&lt;cinit&gt;()v</code>,虚拟机会保证这个类的『构造方法』的线程安全</p>
<p><strong>发生的时机：</strong></p>
<blockquote>
<p>会发生初始化</p>
</blockquote>
<p>概括得说，<em>类初始化</em>是【懒惰的】</p>
<ul>
<li>main 方法所在的类，总会被首先初始化</li>
<li>首次访问这个类的静态变量或静态方法时 </li>
<li>子类初始化，如果父类还没初始化，会引发 父类的初始化</li>
<li>子类访问父类的静态变量，只会触发父类的初始化 </li>
<li>Class.forName  默认会造成类的初始化</li>
<li>new 会导致初始化</li>
<li>调用静态方法会触发类的初始化，若父类未初始化，则会优先触发父类的初始化。若子类调用父类的静态方法则，只会触发父类的初始化</li>
</ul>
<blockquote>
<p>不会发生初始化</p>
</blockquote>
<ul>
<li>访问类的 static ﬁnal 静态常量（基本类型和字符串）不会触发初始化。在<strong>链接的准备阶段</strong>即完成赋值操作。</li>
<li>类对象.class 不会触发初始化 。 在类加载的时候就会加载此Class (_java_mirror 即 java 的类镜像)</li>
<li>创建该类的数组不会触发初始化</li>
<li>调用类加载器的loadClass方法</li>
<li>Class.forName的第二个参数为false。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> a=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">"a init"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> <span class="keyword">extends</span> <span class="title">A</span></span>&#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">double</span> b=<span class="number">5.0</span>;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">boolean</span> c=<span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">"b init"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">T1</span> </span>&#123;  </span><br><span class="line"></span><br><span class="line"><span class="comment">//  若类初始化 则会执行static中的内容</span></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">"main init"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//有main方法所在的类会初始化</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ClassNotFoundException </span>&#123;</span><br><span class="line"><span class="comment">//     ***************************不会初始化的情况***********************************</span></span><br><span class="line"><span class="comment">//        1、静态常量(基本类型和字符串)不会触发初始化</span></span><br><span class="line"><span class="comment">//        System.out.println(B.b);</span></span><br><span class="line"><span class="comment">//        2、类.class不会触发初始化(加载阶段已经创建好class)</span></span><br><span class="line"><span class="comment">//        System.out.println(B.class);</span></span><br><span class="line"><span class="comment">//        3、创建该类的数组不会触发初始化</span></span><br><span class="line"><span class="comment">//        System.out.println(new B[0]);</span></span><br><span class="line"><span class="comment">//        4、不会初始化A,B 但是会加载A,B</span></span><br><span class="line"><span class="comment">//        ClassLoader c1= Thread.currentThread().getContextClassLoader();</span></span><br><span class="line"><span class="comment">//        c1.loadClass("org.lc.jvm_classloader.B");</span></span><br><span class="line"><span class="comment">//        5、不会初始化A,B 但是会加载A,B</span></span><br><span class="line"><span class="comment">//        ClassLoader c2=Thread.currentThread().getContextClassLoader();</span></span><br><span class="line"><span class="comment">//        不初始化:参数设为false</span></span><br><span class="line"><span class="comment">//        Class.forName("org.lc.jvm_classloader.B", false, c2);</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//     ***************************会初始化的情况***********************************</span></span><br><span class="line"><span class="comment">//       1、首次访问这个类的静态变量或静态方法时。初始化A</span></span><br><span class="line"><span class="comment">//        System.out.println(A.a);</span></span><br><span class="line"><span class="comment">//       2、子类初始化，如果父类还没有初始化，会引发父类的初始化。初始化A,B。父类优先初始化</span></span><br><span class="line"><span class="comment">//        System.out.println(B.c);</span></span><br><span class="line"><span class="comment">//       3、子类访问父类的静态变量，只触发父类的初始化，初始化A</span></span><br><span class="line"><span class="comment">//        System.out.println(B.a);</span></span><br><span class="line"><span class="comment">//        4、会初始A,B. 优先初始化父类A</span></span><br><span class="line"><span class="comment">//        Class.forName("org.lc.jvm_classloader.B");</span></span><br><span class="line"><span class="comment">//        从源码 默认初始化参数为true</span></span><br><span class="line"><span class="comment">//        return forName0(className, true, ClassLoader.getClassLoader(caller), caller);</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4、练习"><a href="#4、练习" class="headerlink" title="*4、练习"></a>*4、练习</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">T2</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"><span class="comment">//        不会初始化</span></span><br><span class="line">        System.out.println(E.a);</span><br><span class="line"><span class="comment">//        不会初始化</span></span><br><span class="line">        System.out.println(E.b);</span><br><span class="line">        <span class="comment">//会初始化</span></span><br><span class="line">        System.out.println(E.c);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">E</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">"E init"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> a = <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String b = <span class="string">"hello"</span>;</span><br><span class="line">    <span class="comment">//会初始化  因为jvm在编译期间自动帮我们对20进行装箱的操作</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Integer c = <span class="number">20</span>; <span class="comment">//Integer.valueOf(20);</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>安全的单例模式：</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//静态内部类可以访问外部类的成员</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">LazyHolder</span></span>&#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">final</span> Singleton INSTANCE=<span class="keyword">new</span> Singleton();</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// 第一次调用 getInstance 方法，才会导致内部类加载和初始化其静态成员</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> LazyHolder.INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="5、静态成员存储位置"><a href="#5、静态成员存储位置" class="headerlink" title="*5、静态成员存储位置"></a>*5、静态成员存储位置</h4><p>​        在JDK8之前，<strong>静态成员（静态变量和静态方法）都是存储在方法区（永久代）中的静态区</strong>中（这里指类被加载后，静态成员的存储位置）。但在JDK8之后，永久代被移除了，取而代之的是元空间（metaspace）。但元空间中存储的主要是.class文件的元数据信息，<strong>静态成员的存储位置由方法区转到了堆内存（heap）中。</strong><br>​        不过，不管是JDK8，还是更早的版本中，静态方法的执行（不仅仅是静态方法，还有普通的成员方法）都是在栈内存（stack）中进行的。每个线程都会在栈内存中开辟一个栈，在调用方法时，对应的方法都会在执行这个方法的线程的栈中创建一个“栈帧”，栈帧中保存了局部变量表（基本数据类型和对象引用）、操作数栈、动态连接和返回地址等信息。等到方法执行完毕，栈帧被销毁，对应的内存也将被释放</p>
<h3 id="五、类加载器"><a href="#五、类加载器" class="headerlink" title="五、类加载器"></a>五、类加载器</h3><h4 id="1、类加载器分类"><a href="#1、类加载器分类" class="headerlink" title="1、类加载器分类"></a>1、类加载器分类</h4><p>以jdk8为例：</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>加载哪的类</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>Bootstrap ClassLoader(启动类加载器)</td>
<td>JAVA_HOME/jre/lib</td>
<td>无法直接访问</td>
</tr>
<tr>
<td>Extension ClassLoader(扩展类加载器)</td>
<td>JAVA_HOME/jre/lib/ext</td>
<td>上级为 Bootstrap，显示为 null</td>
</tr>
<tr>
<td>Application ClassLoader(应用程序加载器)</td>
<td>classpath(我们应用程序启动的路径)</td>
<td>上级为 Extension</td>
</tr>
<tr>
<td>自定义类加载器</td>
<td>自定义</td>
<td>上级为 Application</td>
</tr>
</tbody></table>
<p><strong>Bootstrap ClassLoader启动类加载器由c++实现</strong>。其余的加载器均由j<strong>ava实现且全部继承自java.lang.ClassLoader</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">T3</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ClassNotFoundException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//1、使用 Class类获取该类的ClassLoader对象。 获取该类的类加载器</span></span><br><span class="line">        <span class="comment">//null  说明为启动类加载器</span></span><br><span class="line">        System.out.println(String<span class="class">.<span class="keyword">class</span>.<span class="title">getClassLoader</span>())</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2、使用 ClassLoader类加载器对象的getParent()获取该类的上一级加载器</span></span><br><span class="line">        <span class="comment">//sun.misc.Launcher$ExtClassLoader@135fbaa4 说明为本级为应用程序类加载器。上一级为扩展类加载器</span></span><br><span class="line">        System.out.println(T1<span class="class">.<span class="keyword">class</span>.<span class="title">getClassLoader</span>().<span class="title">getParent</span>())</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3、上述方式1,2不会触发类的初始化</span></span><br><span class="line">        <span class="comment">//通过Class.forName会触发类的初始化</span></span><br><span class="line">        Class&lt;?&gt; aClass = Class.forName(<span class="string">"org.lc.jvm_classloader.T1"</span>);</span><br><span class="line">        <span class="comment">//sun.misc.Launcher$AppClassLoader@18b4aac2  说明为应用程序类加载器</span></span><br><span class="line">        System.out.println(aClass.getClassLoader());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2、双亲委派模式"><a href="#2、双亲委派模式" class="headerlink" title="2、双亲委派模式"></a>2、双亲委派模式</h4><p>所谓的双亲委派，就是指<strong>调用类加载器的 loadClass 方法时</strong>，<strong>查找类的规则</strong></p>
<p>默认通过ClassLoader加载指定类走的是双亲委派机制</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">T3</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ClassNotFoundException </span>&#123;</span><br><span class="line">        ClassLoader classLoader = T3<span class="class">.<span class="keyword">class</span>.<span class="title">getClassLoader</span>()</span>;</span><br><span class="line">        System.out.println(classLoader.loadClass(<span class="string">"org.lc.jvm_classloader.T1"</span>).getClassLoader());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>源码分析</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> Class&lt;?&gt; loadClass(String name, <span class="keyword">boolean</span> resolve)</span><br><span class="line">        <span class="keyword">throws</span> ClassNotFoundException</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (getClassLoadingLock(name)) &#123;</span><br><span class="line">            <span class="comment">// First, check if the class has already been loaded</span></span><br><span class="line">            <span class="comment">//1、首先检查本类的类加载器是否已经加载该类，首次肯定没有。</span></span><br><span class="line">            Class&lt;?&gt; c = findLoadedClass(name);</span><br><span class="line">            <span class="keyword">if</span> (c == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">long</span> t0 = System.nanoTime();</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="comment">//2、如果本类的上级类加载器不为空</span></span><br><span class="line">                    <span class="keyword">if</span> (parent != <span class="keyword">null</span>) &#123;</span><br><span class="line">                        <span class="comment">//3、使用上级的类加载器查找该类是否加载。采用递归的方式继续向上级查找</span></span><br><span class="line">                        c = parent.loadClass(name, <span class="keyword">false</span>);</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="comment">//4、直到上级为空即为BootstrapClassloader时，然后调用</span></span><br><span class="line">                        c = findBootstrapClassOrNull(name);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">                    <span class="comment">//类没找到抛出异常</span></span><br><span class="line">                    <span class="comment">// ClassNotFoundException thrown if class not found</span></span><br><span class="line">                    <span class="comment">// from the non-null parent class loader</span></span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (c == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="comment">// If still not found, then invoke findClass in order</span></span><br><span class="line">                    <span class="comment">// to find the class.</span></span><br><span class="line">                    <span class="comment">//当递归到BootstrapClassloader加载器时，会分别使用各自的加载器向下递归加载类，若找到则返回，否则抛出的异常ClassNotFoundException被下一级类加载器捕获</span></span><br><span class="line">                    <span class="keyword">long</span> t1 = System.nanoTime();</span><br><span class="line">                    <span class="comment">//使用各自的类加载器加载该类</span></span><br><span class="line">                    c = findClass(name);</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// this is the defining class loader; record the stats</span></span><br><span class="line">                    sun.misc.PerfCounter.getParentDelegationTime().addTime(t1 - t0);</span><br><span class="line">                    sun.misc.PerfCounter.getFindClassTime().addElapsedTimeFrom(t1);</span><br><span class="line">                    sun.misc.PerfCounter.getFindClasses().increment();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (resolve) &#123;</span><br><span class="line">                resolveClass(c);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> c;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>就上述例子执行流程</p>
</blockquote>
<p>1、首先使用本类的加载器(<code>应用程序类加载器</code>)查看要加载的类T1是否被加载，首次应该没用被加载。</p>
<p>2、然后会使用本类的上一级加载器(<code>扩展类加载器</code>)查看T1类是否被加载(<code>parent.loadClass(name, false)</code>)，此时开始递归调用，直到递归到parent为null即到<code>启动类加载器</code>的时候，查看T1类是否被加载，若没有则开始使用启动类加载器加载此类，若找不到此类，则抛出异常，该异常有下一级类加载器捕获。从上到下依次使用各自的类加载器加载此类。直达加载到此类返回，或者抛出异常ClassNotFoundException。</p>
<p>3、从本级的类加载器开始向上级类加载器寻找要加载的类是否已经被加载，直到递归到顶级类加载器(BootStrapClassloader)时，若还未发现要加载的类没有被加载，则开始使用各自的类加载器加载要加载的类(findClass(name))，从上级往下级依次使用类加载器加载。知道找到类或抛出异常</p>
<img src="http://img.louchen.top/2020/06/20200617000920.png" style="zoom:80%;" />

<h5 id="双亲委派的作用："><a href="#双亲委派的作用：" class="headerlink" title="双亲委派的作用："></a>双亲委派的作用：</h5><ul>
<li>防止重复加载同一个<code>.class</code>。通过委托去向上面问一问，加载过了，就不用再加载一遍。保证数据安全。</li>
<li>保证核心<code>.class</code>不能被篡改。通过委托方式，不会去篡改核心<code>.class</code>，即使篡改也不会去加载，即使加载也不会是同一个<code>.class</code>对象了。不同的加载器加载同一个<code>.class</code>也不是同一个<code>Class</code>对象。这样保证了<code>Class</code>执行安全。</li>
</ul>
<h4 id="3、线程上下文类加载器"><a href="#3、线程上下文类加载器" class="headerlink" title="3、线程上下文类加载器"></a>3、线程上下文类加载器</h4><p>我们在使用 JDBC 时，都需要加载 Driver 驱动，不知道你注意到没有，<strong>不写</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Class.forName(<span class="string">"com.mysql.jdbc.Driver"</span>)</span><br></pre></td></tr></table></figure>

<p>也是可以让 com.mysql.jdbc.Driver 正确加载的，你知道是怎么做的吗？</p>
<p>让我们追踪一下源码:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DriverManager</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 注册驱动的集合    </span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> CopyOnWriteArrayList&lt;DriverInfo&gt; registeredDrivers= <span class="keyword">new</span> CopyOnWriteArrayList&lt;&gt;();</span><br><span class="line">    <span class="comment">// 初始化驱动    </span></span><br><span class="line">    <span class="keyword">static</span> &#123;        </span><br><span class="line">        loadInitialDrivers();        </span><br><span class="line">        println(<span class="string">"JDBC DriverManager initialized"</span>);    </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>先不看别的，看看 DriverManager 的类加载器：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">System.out.println(DriverManager<span class="class">.<span class="keyword">class</span>.<span class="title">getClassLoader</span>())</span>;</span><br></pre></td></tr></table></figure>

<p>打印 null，表示它的类加载器是 <strong>Bootstrap ClassLoader</strong>，会到 JAVA_HOME/jre/lib 下搜索类，但 JAVA_HOME/jre/lib 下显然没有 mysql-connector-java-5.1.47.jar 包，这样问题来了，在 DriverManager 的静态代码块中，怎么能正确加载 com.mysql.jdbc.Driver 呢？ </p>
<p>这里其实是<strong>打破双亲委派模式的规则</strong>，因为我们发现DriverManager 的类加载器为启动类加载器，但是启动类加载器中并没有类文件，所以无法找到</p>
<p><strong>1)使用ServiceLoader机制加载启动 即SPI</strong></p>
<p><strong>Thread.currentThread().getContextClassLoader();</strong>  获取的还是启动类加载器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;S&gt; <span class="function">ServiceLoader&lt;S&gt; <span class="title">load</span><span class="params">(Class&lt;S&gt; service)</span> </span>&#123;</span><br><span class="line">       <span class="comment">//默认把应用程序类加载器赋值给当前线程。当前线程获取的时候拿到的即为应用程序类加载器</span></span><br><span class="line">        ClassLoader cl = Thread.currentThread().getContextClassLoader();</span><br><span class="line">        <span class="keyword">return</span> ServiceLoader.load(service, cl);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">ServiceLoader&lt;Driver&gt; loadedDrivers = ServiceLoader.load(Driver<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">               Iterator&lt;Driver&gt; driversIterator = loadedDrivers.iterator();</span><br><span class="line">               <span class="keyword">try</span>&#123;</span><br><span class="line">                   <span class="keyword">while</span>(driversIterator.hasNext()) &#123;</span><br><span class="line">                       driversIterator.next();</span><br><span class="line">                   &#125;</span><br><span class="line">               &#125; <span class="keyword">catch</span>(Throwable t) &#123;</span><br><span class="line">               <span class="comment">// Do nothing</span></span><br><span class="line">               &#125;</span><br><span class="line">               <span class="keyword">return</span> <span class="keyword">null</span>;</span><br></pre></td></tr></table></figure>

<p><strong>2)使用 jdbc.drivers 定义的驱动名加载驱动</strong> </p>
<p>我们从源码发现，其实内部还是调用的一个 <strong>ClassLoader.getSystemClassLoader()</strong> 获得的是<strong>应用程序类加载器</strong>加载Dirver驱动</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (drivers == <span class="keyword">null</span> || drivers.equals(<span class="string">""</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        String[] driversList = drivers.split(<span class="string">":"</span>);</span><br><span class="line">        println(<span class="string">"number of Drivers:"</span> + driversList.length);</span><br><span class="line">        <span class="keyword">for</span> (String aDriver : driversList) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                println(<span class="string">"DriverManager.Initialize: loading "</span> + aDriver);</span><br><span class="line">                <span class="comment">//使用ClassLoader.getSystemClassLoader()获得应用程序类加载器加载驱动</span></span><br><span class="line">                Class.forName(aDriver, <span class="keyword">true</span>,</span><br><span class="line">                        ClassLoader.getSystemClassLoader());</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">                println(<span class="string">"DriverManager.Initialize: load failed: "</span> + ex);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<h4 id="4、自定义类加载器"><a href="#4、自定义类加载器" class="headerlink" title="4、自定义类加载器"></a>4、自定义类加载器</h4><p> 什么时候需要自定义类加载器</p>
<p>1）想加载非 classpath <strong>随意路径中的类文件</strong> </p>
<p>2）都是通过接口来使用实现，希望解耦时，常用在框架设计 </p>
<p>3）这些类希望予以隔离，<strong>不同应用的同名类都可以加载，不冲突，常见于 tomcat 容器</strong></p>
<p>步骤：</p>
<ol>
<li>继承 ClassLoader 父类 </li>
<li>要遵从双亲委派机制，重写 ﬁndClass 方法 注意不是重写 loadClass 方法，否则不会走双亲委派机制 </li>
<li>读取类文件的字节码 </li>
<li>调用父类的 deﬁneClass 方法来加载类 </li>
<li>使用者调用该类加载器的 loadClass 方法</li>
</ol>
<p><strong>注意</strong>：认定是同一个类的条件是：<strong>类加载器相同，名称相同，命名空间相同。</strong> 使用<strong>不同的类加载器加载的类不同</strong></p>
</div><div class="article-tags size-small is-uppercase mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/JVM/">JVM</a></div><!--!--></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">喜欢这篇文章？打赏一下作者吧</h3><div class="buttons is-centered"><a class="button is-success donate"><span class="icon is-small"><i class="fab fa-weixin"></i></span><span>微信</span><span class="qrcode"><img src="/img/pay.jpg" alt="微信"></span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2020/07/24/mq/SpringBoot%E6%95%B4%E5%90%88ActiveMQ/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">SpringBoot整合ActiveMQ</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2020/07/24/javase/%E6%B3%9B%E5%9E%8B/"><span class="level-item">Java泛型知识梳理</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!--></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1"><div class="card widget"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="" src="/img/milk.png" alt="娄晨"></figure><p class="title is-size-4 is-block line-height-inherit">娄晨</p><p class="is-size-6 is-block">学生</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>中国·武汉</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">71</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">19</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">42</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded cursor:pointer" href="/img/wechart.jpg" target="_blank" rel="noopener">联系我</a></div><div class="level is-mobile"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/ppoffice"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Facebook" href="https://facebook.com"><i class="fab fa-facebook"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Dribbble" href="https://dribbble.com"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><div class="card widget" id="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">目录</h3><ul class="menu-list"><li><a class="is-flex" href="#Ⅰ、jvm简介"><span class="mr-2">1</span><span>Ⅰ、jvm简介</span></a><ul class="menu-list"><li><a class="is-flex" href="#一、什么是JVM"><span class="mr-2">1.1</span><span>一、什么是JVM</span></a></li><li><a class="is-flex" href="#二、jre、jdk、jvm的区别？"><span class="mr-2">1.2</span><span>二、jre、jdk、jvm的区别？</span></a></li><li><a class="is-flex" href="#四、常见的jvm"><span class="mr-2">1.3</span><span>四、常见的jvm</span></a></li></ul></li><li><a class="is-flex" href="#Ⅱ、JVM内存结构"><span class="mr-2">2</span><span>Ⅱ、JVM内存结构</span></a><ul class="menu-list"><li><a class="is-flex" href="#一、程序计数器-Program-Counter-Register"><span class="mr-2">2.1</span><span>一、程序计数器(Program Counter Register)</span></a><ul class="menu-list"><li><a class="is-flex" href="#1-1定义"><span class="mr-2">2.1.1</span><span>1.1定义</span></a></li></ul></li><li><a class="is-flex" href="#二、虚拟机栈-Java-Virtual-Machine-Stacks"><span class="mr-2">2.2</span><span>二、虚拟机栈(Java Virtual Machine Stacks )</span></a><ul class="menu-list"><li><a class="is-flex" href="#2-1定义"><span class="mr-2">2.2.1</span><span>2.1定义</span></a></li><li><a class="is-flex" href="#2-2栈演示："><span class="mr-2">2.2.2</span><span>2.2栈演示：</span></a></li><li><a class="is-flex" href="#③方法内的局部变量是否线程安全？"><span class="mr-2">2.2.3</span><span>③方法内的局部变量是否线程安全？</span></a></li><li><a class="is-flex" href="#2-程序运行很长时间没有结果-死锁"><span class="mr-2">2.2.4</span><span>2)程序运行很长时间没有结果 (死锁)</span></a></li></ul></li><li><a class="is-flex" href="#三、本地方法栈-Native-Method-Stacks"><span class="mr-2">2.3</span><span>三、本地方法栈(Native Method Stacks)</span></a></li><li><a class="is-flex" href="#四、堆-Heap"><span class="mr-2">2.4</span><span>四、堆(Heap)</span></a><ul class="menu-list"><li><a class="is-flex" href="#4-1定义"><span class="mr-2">2.4.1</span><span>4.1定义</span></a></li><li><a class="is-flex" href="#4-2堆内存溢出-OutofMemoryError-Xmx"><span class="mr-2">2.4.2</span><span>4.2堆内存溢出(OutofMemoryError)(-Xmx)</span></a></li><li><a class="is-flex" href="#④jvisualvm工具-高内存占用"><span class="mr-2">2.4.3</span><span>④jvisualvm工具(高内存占用)</span></a></li></ul></li><li><a class="is-flex" href="#五、方法区-Method-Area"><span class="mr-2">2.5</span><span>五、方法区(Method Area)</span></a><ul class="menu-list"><li><a class="is-flex" href="#5-1定义"><span class="mr-2">2.5.1</span><span>5.1定义</span></a></li><li><a class="is-flex" href="#5-2组成"><span class="mr-2">2.5.2</span><span>5.2组成</span></a></li><li><a class="is-flex" href="#5-3方法区内存溢出-XX-MaxMetaspaceSize"><span class="mr-2">2.5.3</span><span>5.3方法区内存溢出(-XX:MaxMetaspaceSize)</span></a></li><li><a class="is-flex" href="#5-4常量池-amp-运行时常量池"><span class="mr-2">2.5.4</span><span>5.4常量池&amp;运行时常量池</span></a></li><li><a class="is-flex" href="#5-5StringTable-串池"><span class="mr-2">2.5.5</span><span>5.5StringTable(串池)</span></a></li><li><a class="is-flex" href="#5-6StringTable特性"><span class="mr-2">2.5.6</span><span>5.6StringTable特性</span></a></li><li><a class="is-flex" href="#5-7StringTale位置"><span class="mr-2">2.5.7</span><span>5.7StringTale位置</span></a></li><li><a class="is-flex" href="#5-8StringTable-垃圾回收"><span class="mr-2">2.5.8</span><span>5.8StringTable 垃圾回收</span></a></li><li><a class="is-flex" href="#②决定是否将字符串入池-使用intern-）"><span class="mr-2">2.5.9</span><span>②决定是否将字符串入池(使用intern()）</span></a></li></ul></li><li><a class="is-flex" href="#六、直接内存-Direct-Memory"><span class="mr-2">2.6</span><span>六、直接内存(Direct Memory)</span></a><ul class="menu-list"><li><a class="is-flex" href="#6-1NIO-IO"><span class="mr-2">2.6.1</span><span>6.1NIO/IO</span></a></li><li><a class="is-flex" href="#6-2定义"><span class="mr-2">2.6.2</span><span>6.2定义</span></a></li><li><a class="is-flex" href="#6-3直接内存溢出"><span class="mr-2">2.6.3</span><span>6.3直接内存溢出</span></a></li><li><a class="is-flex" href="#①禁用显示的垃圾回收-System-gc"><span class="mr-2">2.6.4</span><span>①禁用显示的垃圾回收(System.gc())</span></a></li></ul></li></ul></li><li><a class="is-flex" href="#Ⅲ、垃圾回收"><span class="mr-2">3</span><span>Ⅲ、垃圾回收</span></a><ul class="menu-list"><li><a class="is-flex" href="#一、如何判断对象可以回收"><span class="mr-2">3.1</span><span>一、如何判断对象可以回收</span></a><ul class="menu-list"><li><a class="is-flex" href="#1-1引用计数法-废弃"><span class="mr-2">3.1.1</span><span>1.1引用计数法(废弃)</span></a></li><li><a class="is-flex" href="#1-2可达性分析算法"><span class="mr-2">3.1.2</span><span>1.2可达性分析算法</span></a></li><li><a class="is-flex" href="#1-虚引用和终结器引用必须配合引用队列使用"><span class="mr-2">3.1.3</span><span>1)虚引用和终结器引用必须配合引用队列使用</span></a></li><li><a class="is-flex" href="#1-使用引用队列-1"><span class="mr-2">3.1.4</span><span>1)使用引用队列</span></a></li></ul></li><li><a class="is-flex" href="#二、垃圾回收算法"><span class="mr-2">3.2</span><span>二、垃圾回收算法</span></a><ul class="menu-list"><li><a class="is-flex" href="#2-1标记清除-Mark-Sweep"><span class="mr-2">3.2.1</span><span>2.1标记清除(Mark Sweep)</span></a></li><li><a class="is-flex" href="#2-2标记整理-Mark-Compact"><span class="mr-2">3.2.2</span><span>2.2标记整理(Mark Compact)</span></a></li><li><a class="is-flex" href="#2-3复制-Copy"><span class="mr-2">3.2.3</span><span>2.3复制(Copy)</span></a></li></ul></li><li><a class="is-flex" href="#三、分代垃圾回收"><span class="mr-2">3.3</span><span>三、分代垃圾回收</span></a><ul class="menu-list"><li><a class="is-flex" href="#3-1为什么要进行分代垃圾回收"><span class="mr-2">3.3.1</span><span>3.1为什么要进行分代垃圾回收</span></a></li><li><a class="is-flex" href="#3-2相关JVM参数"><span class="mr-2">3.3.2</span><span>3.2相关JVM参数</span></a></li><li><a class="is-flex" href="#⑤一个线程中的OOM，不会导致我们主程序结束"><span class="mr-2">3.3.3</span><span>⑤一个线程中的OOM，不会导致我们主程序结束</span></a></li></ul></li><li><a class="is-flex" href="#四、垃圾回收器"><span class="mr-2">3.4</span><span>四、垃圾回收器</span></a><ul class="menu-list"><li><a class="is-flex" href="#③响应时间优先"><span class="mr-2">3.4.1</span><span>③响应时间优先</span></a></li><li><a class="is-flex" href="#2、串行-Serial"><span class="mr-2">3.4.2</span><span>2、串行(Serial)</span></a></li><li><a class="is-flex" href="#3、吞吐量垃圾回收-Parallel并行"><span class="mr-2">3.4.3</span><span>3、吞吐量垃圾回收(Parallel并行)</span></a></li><li><a class="is-flex" href="#1-并发和并行的区别？"><span class="mr-2">3.4.4</span><span>1)并发和并行的区别？</span></a></li><li><a class="is-flex" href="#3-Mixed-Collection-混合收集"><span class="mr-2">3.4.5</span><span>3)Mixed Collection(混合收集)</span></a></li><li><a class="is-flex" href="#6、Full-GC"><span class="mr-2">3.4.6</span><span>6、Full GC</span></a></li></ul></li></ul></li><li><a class="is-flex" href="#Ⅳ、类加载和字节码技术"><span class="mr-2">4</span><span>Ⅳ、类加载和字节码技术</span></a><ul class="menu-list"><li><a class="is-flex" href="#一、类文件结构"><span class="mr-2">4.1</span><span>一、类文件结构</span></a><ul class="menu-list"><li><a class="is-flex" href="#1、魔数"><span class="mr-2">4.1.1</span><span>1、魔数</span></a></li><li><a class="is-flex" href="#2、版本"><span class="mr-2">4.1.2</span><span>2、版本</span></a></li><li><a class="is-flex" href="#3、常量池"><span class="mr-2">4.1.3</span><span>3、常量池</span></a></li><li><a class="is-flex" href="#4、访问标识与继承信息"><span class="mr-2">4.1.4</span><span>4、访问标识与继承信息</span></a></li><li><a class="is-flex" href="#5、Filed信息"><span class="mr-2">4.1.5</span><span>5、Filed信息</span></a></li><li><a class="is-flex" href="#6、method信息"><span class="mr-2">4.1.6</span><span>6、method信息</span></a></li><li><a class="is-flex" href="#7、附加信息"><span class="mr-2">4.1.7</span><span>7、附加信息</span></a></li></ul></li><li><a class="is-flex" href="#二、字节码指令"><span class="mr-2">4.2</span><span>二、字节码指令</span></a><ul class="menu-list"><li><a class="is-flex" href="#1、javap工具"><span class="mr-2">4.2.1</span><span>1、javap工具</span></a></li><li><a class="is-flex" href="#11-synchronized字节码分析"><span class="mr-2">4.2.2</span><span>11)synchronized字节码分析</span></a></li></ul></li><li><a class="is-flex" href="#三、编译器处理"><span class="mr-2">4.3</span><span>三、编译器处理</span></a><ul class="menu-list"><li><a class="is-flex" href="#1、默认构造函数"><span class="mr-2">4.3.1</span><span>1、默认构造函数</span></a></li><li><a class="is-flex" href="#2、自动拆装箱"><span class="mr-2">4.3.2</span><span>2、自动拆装箱</span></a></li><li><a class="is-flex" href="#3、泛型集合取值"><span class="mr-2">4.3.3</span><span>3、泛型集合取值</span></a></li><li><a class="is-flex" href="#4、可变参数"><span class="mr-2">4.3.4</span><span>4、可变参数</span></a></li><li><a class="is-flex" href="#5、foreach循环"><span class="mr-2">4.3.5</span><span>5、foreach循环</span></a></li><li><a class="is-flex" href="#6、switch字符串"><span class="mr-2">4.3.6</span><span>6、switch字符串</span></a></li><li><a class="is-flex" href="#7、switch枚举"><span class="mr-2">4.3.7</span><span>7、switch枚举</span></a></li><li><a class="is-flex" href="#8、枚举类"><span class="mr-2">4.3.8</span><span>8、枚举类</span></a></li><li><a class="is-flex" href="#9、try-with-resources"><span class="mr-2">4.3.9</span><span>9、try-with-resources</span></a></li><li><a class="is-flex" href="#10、方法重写时的桥接"><span class="mr-2">4.3.10</span><span>10、方法重写时的桥接</span></a></li><li><a class="is-flex" href="#11、匿名内部类"><span class="mr-2">4.3.11</span><span>11、匿名内部类</span></a></li></ul></li><li><a class="is-flex" href="#四、类加载阶段"><span class="mr-2">4.4</span><span>四、类加载阶段</span></a><ul class="menu-list"><li><a class="is-flex" href="#1、加载"><span class="mr-2">4.4.1</span><span>1、加载</span></a></li><li><a class="is-flex" href="#③解析"><span class="mr-2">4.4.2</span><span>③解析</span></a></li><li><a class="is-flex" href="#3、初始化"><span class="mr-2">4.4.3</span><span>3、初始化</span></a></li><li><a class="is-flex" href="#4、练习"><span class="mr-2">4.4.4</span><span>*4、练习</span></a></li><li><a class="is-flex" href="#5、静态成员存储位置"><span class="mr-2">4.4.5</span><span>*5、静态成员存储位置</span></a></li></ul></li><li><a class="is-flex" href="#五、类加载器"><span class="mr-2">4.5</span><span>五、类加载器</span></a><ul class="menu-list"><li><a class="is-flex" href="#1、类加载器分类"><span class="mr-2">4.5.1</span><span>1、类加载器分类</span></a></li><li><a class="is-flex" href="#双亲委派的作用："><span class="mr-2">4.5.2</span><span>双亲委派的作用：</span></a></li><li><a class="is-flex" href="#3、线程上下文类加载器"><span class="mr-2">4.5.3</span><span>3、线程上下文类加载器</span></a></li><li><a class="is-flex" href="#4、自定义类加载器"><span class="mr-2">4.5.4</span><span>4、自定义类加载器</span></a></li></ul></li></ul></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">链接</h3><ul class="menu-list"><li><a class="level is-mobile is-mobile" href="http://vhr.louchen.top/index.html" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">人事管理</span></span><span class="level-right"><span class="level-item tag">vhr.louchen.top</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/categories/IDEA/"><span class="level-start"><span class="level-item">IDEA</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/JVM/"><span class="level-start"><span class="level-item">JVM</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/JavaWeb/"><span class="level-start"><span class="level-item">JavaWeb</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Java%E5%9F%BA%E7%A1%80/"><span class="level-start"><span class="level-item">Java基础</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Linux/"><span class="level-start"><span class="level-item">Linux</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/MySQL/"><span class="level-start"><span class="level-item">MySQL</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Redis/"><span class="level-start"><span class="level-item">Redis</span></span><span class="level-end"><span class="level-item tag">15</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/SSM/"><span class="level-start"><span class="level-item">SSM</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Spring/"><span class="level-start"><span class="level-item">Spring</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Spring-Boot/"><span class="level-start"><span class="level-item">Spring Boot</span></span><span class="level-end"><span class="level-item tag">22</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Spring-Cache/"><span class="level-start"><span class="level-item">Spring Cache</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Spring-Security/"><span class="level-start"><span class="level-item">Spring Security</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/SpringBoot/"><span class="level-start"><span class="level-item">SpringBoot</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/SpringMVC/"><span class="level-start"><span class="level-item">SpringMVC</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/%E5%AE%B9%E5%99%A8%E5%8C%96%E6%8A%80%E6%9C%AF/"><span class="level-start"><span class="level-item">容器化技术</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/"><span class="level-start"><span class="level-item">并发编程</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/%E7%89%88%E6%9C%AC%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7/"><span class="level-start"><span class="level-item">版本管理工具</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/%E9%A1%B9%E7%9B%AE%E6%9E%84%E5%BB%BA%E9%83%A8%E7%BD%B2/"><span class="level-start"><span class="level-item">项目构建部署</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2/"><span class="level-start"><span class="level-item">项目部署</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">订阅更新</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button is-primary" type="submit" value="订阅"></div></div></form></div></div></div><div class="column-right-shadow is-hidden-widescreen"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3"><div class="card widget"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content size-small"><p><time dateTime="2020-08-30T13:33:41.737Z">2020-08-30</time></p><p class="title is-6"><a class="link-muted" href="/2020/08/30/docker_linux_nginx_git_maven_gradle/gradle%E8%AF%A6%E8%A7%A3/">Gradle详解(待续)</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/%E7%89%88%E6%9C%AC%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7/">版本管理工具</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-08-30T13:33:41.720Z">2020-08-30</time></p><p class="title is-6"><a class="link-muted" href="/2020/08/30/docker_linux_nginx_git_maven_gradle/Git%E8%AF%A6%E8%A7%A3/">Git详解</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/%E7%89%88%E6%9C%AC%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7/">版本管理工具</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-08-30T13:33:41.696Z">2020-08-30</time></p><p class="title is-6"><a class="link-muted" href="/2020/08/30/docker_linux_nginx_git_maven_gradle/github%E6%90%9C%E7%B4%A2%E6%8A%80%E5%B7%A7/">github搜索技巧</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/%E7%89%88%E6%9C%AC%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7/">版本管理工具</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-08-30T13:33:41.660Z">2020-08-30</time></p><p class="title is-6"><a class="link-muted" href="/2020/08/30/docker_linux_nginx_git_maven_gradle/Maven%E8%AF%A6%E8%A7%A3/">Maven详解</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/%E7%89%88%E6%9C%AC%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7/">版本管理工具</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-08-30T13:32:38.191Z">2020-08-30</time></p><p class="title is-6"><a class="link-muted" href="/2020/08/30/docker_linux_nginx_git_maven_gradle/Nginx%E8%AF%A6%E8%A7%A3/">Nginx详解</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2/">项目部署</a></p></div></article></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/archives/2020/08/"><span class="level-start"><span class="level-item">八月 2020</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/07/"><span class="level-start"><span class="level-item">七月 2020</span></span><span class="level-end"><span class="level-item tag">62</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/ActiveMQ/"><span class="tag">ActiveMQ</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Docker/"><span class="tag">Docker</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Ehcache/"><span class="tag">Ehcache</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/FastDFS/"><span class="tag">FastDFS</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Git/"><span class="tag">Git</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Gradle/"><span class="tag">Gradle</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/IDEA/"><span class="tag">IDEA</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/JAR/"><span class="tag">JAR</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/JDK1-8/"><span class="tag">JDK1.8</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/JVM/"><span class="tag">JVM</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/JWT/"><span class="tag">JWT</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Java%E5%9F%BA%E7%A1%80/"><span class="tag">Java基础</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Linux/"><span class="tag">Linux</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Maven/"><span class="tag">Maven</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/MongoDB/"><span class="tag">MongoDB</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/MySQL/"><span class="tag">MySQL</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Nginx/"><span class="tag">Nginx</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/OAuth2/"><span class="tag">OAuth2</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Quartz/"><span class="tag">Quartz</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/RESTful/"><span class="tag">RESTful</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/RabbitMQ/"><span class="tag">RabbitMQ</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Redis/"><span class="tag">Redis</span><span class="tag is-grey-lightest">16</span></a></div><div class="control"><a class="tags has-addons" href="/tags/SSM/"><span class="tag">SSM</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Servlet/"><span class="tag">Servlet</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Session/"><span class="tag">Session</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Shiro/"><span class="tag">Shiro</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Spring/"><span class="tag">Spring</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Spring-Boot/"><span class="tag">Spring Boot</span><span class="tag is-grey-lightest">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Spring-Security/"><span class="tag">Spring Security</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/SpringBoot/"><span class="tag">SpringBoot</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/SpringMVC/"><span class="tag">SpringMVC</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Swagger2/"><span class="tag">Swagger2</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/WAR/"><span class="tag">WAR</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/WebSocket/"><span class="tag">WebSocket</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F/"><span class="tag">代理模式</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%8F%8D%E5%B0%84/"><span class="tag">反射</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%A4%9A%E6%95%B0%E6%8D%AE%E6%BA%90/"><span class="tag">多数据源</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"><span class="tag">多线程</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/"><span class="tag">定时任务</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%B3%9B%E5%9E%8B/"><span class="tag">泛型</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%B6%88%E6%81%AF%E6%9C%8D%E5%8A%A1/"><span class="tag">消息服务</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E9%82%AE%E4%BB%B6%E6%9C%8D%E5%8A%A1/"><span class="tag">邮件服务</span><span class="tag is-grey-lightest">1</span></a></div></div></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/favicon.ico" alt="MilkLc" height="28"></a><p class="size-small"><span>&copy; 2020 lc</span>  Powered by <a href="#" target="_blank" rel="noopener">LouChen</a>  </p><p class="size-small"><a href="http://www.miitbeian.gov.cn">鄂ICP备19030764号-1</a></p></div><div style="margin-left:-150px"><span id="busuanzi_container_site_pv">本站总访问量 <span id="busuanzi_value_site_pv" style="color:blue;font-size: 17px"></span> 次</span><span class="post-meta-divider"> | </span><span id="busuanzi_container_site_uv" style="display:none">本站访客数 <span id="busuanzi_value_site_uv" style="color:blue;font-size: 17px"></span> 人</span><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><div class="level-end"></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            site: {
                url: 'http://yoursite.com',
                external_link: {"enable":true,"exclude":[]}
            },
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>