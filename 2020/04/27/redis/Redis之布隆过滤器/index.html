<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="generator" content="Hexo 4.2.0"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Redis - MilkLc</title><meta description="Redis之布隆过滤器 (Bloom Filter)一、布隆过滤器的应用场景场景1：推送不同消息我们用 HyperLogLog 来估计一个数，有偏差但是也够用。HyperLogLog 主要提供两个方法：  pfadd  pfcount   ​        但是 HyperLogLog 没有判断是否包含的方法，例如 pfexists 、pfcontains 等。没有这样的方法存在，但是我们有这样的"><meta property="og:type" content="blog"><meta property="og:title" content="Redis"><meta property="og:url" content="http://yoursite.com/2020/04/27/redis/Redis%E4%B9%8B%E5%B8%83%E9%9A%86%E8%BF%87%E6%BB%A4%E5%99%A8/"><meta property="og:site_name" content="MilkLc"><meta property="og:description" content="Redis之布隆过滤器 (Bloom Filter)一、布隆过滤器的应用场景场景1：推送不同消息我们用 HyperLogLog 来估计一个数，有偏差但是也够用。HyperLogLog 主要提供两个方法：  pfadd  pfcount   ​        但是 HyperLogLog 没有判断是否包含的方法，例如 pfexists 、pfcontains 等。没有这样的方法存在，但是我们有这样的"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://img.louchen.top/2020/04/bloomfliter1.png"><meta property="og:image" content="http://img.louchen.top/2020/04/boomfilter3.png"><meta property="article:published_time" content="2020-04-27T07:02:49.865Z"><meta property="article:modified_time" content="2020-04-27T07:14:44.396Z"><meta property="article:author" content="lc"><meta property="article:tag" content="Redis"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="http://img.louchen.top/2020/04/bloomfliter1.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://yoursite.com/2020/04/27/redis/Redis%E4%B9%8B%E5%B8%83%E9%9A%86%E8%BF%87%E6%BB%A4%E5%99%A8/"},"headline":"MilkLc","image":["http://img.louchen.top/2020/04/bloomfliter1.png","http://img.louchen.top/2020/04/boomfilter3.png"],"datePublished":"2020-04-27T07:02:49.865Z","dateModified":"2020-04-27T07:14:44.396Z","author":{"@type":"Person","name":"lc"},"description":"Redis之布隆过滤器 (Bloom Filter)一、布隆过滤器的应用场景场景1：推送不同消息我们用 HyperLogLog 来估计一个数，有偏差但是也够用。HyperLogLog 主要提供两个方法：  pfadd  pfcount   ​        但是 HyperLogLog 没有判断是否包含的方法，例如 pfexists 、pfcontains 等。没有这样的方法存在，但是我们有这样的"}</script><link rel="canonical" href="http://yoursite.com/2020/04/27/redis/Redis%E4%B9%8B%E5%B8%83%E9%9A%86%E8%BF%87%E6%BB%A4%E5%99%A8/"><link rel="icon" href="/img/favicon.ico"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/favicon.ico" alt="MilkLc" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">主页</a><a class="navbar-item" href="/archives">归档</a><a class="navbar-item" href="/categories">分类</a><a class="navbar-item" href="/tags">标签</a><a class="navbar-item" href="/about">关于</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/RoyalNeverG"><i class="fab fa-github"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><input placeholder="你想要查找什么？" type="text"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-04-27T07:02:49.865Z" title="2020-04-27T07:02:49.865Z">2020-04-27</time><span class="level-item"><a class="link-muted" href="/categories/Redis/">Redis</a></span><span class="level-item">20 分钟 读完 (大约 2957 个字)</span></div></div><h1 class="title is-3 is-size-4-mobile">Redis</h1><div class="content"><h2 id="Redis之布隆过滤器-Bloom-Filter"><a href="#Redis之布隆过滤器-Bloom-Filter" class="headerlink" title="Redis之布隆过滤器 (Bloom Filter)"></a>Redis之布隆过滤器 (Bloom Filter)</h2><h3 id="一、布隆过滤器的应用场景"><a href="#一、布隆过滤器的应用场景" class="headerlink" title="一、布隆过滤器的应用场景"></a>一、布隆过滤器的应用场景</h3><h4 id="场景1：推送不同消息"><a href="#场景1：推送不同消息" class="headerlink" title="场景1：推送不同消息"></a>场景1：推送不同消息</h4><p>我们用 HyperLogLog 来估计一个数，有偏差但是也够用。HyperLogLog 主要提供两个方法：</p>
<ul>
<li><p>pfadd</p>
</li>
<li><p>pfcount</p>
</li>
</ul>
<p>​        但是 HyperLogLog 没有判断是否包含的方法，例如 pfexists 、pfcontains 等。没有这样的方法存在，但是我们有这样的业务需求。</p>
<a id="more"></a>
<p>​        例如刷今日头条，推送的内容有相似的，但是没有重复的。这就涉及到如何在推送的时候去重？</p>
<p>​        解决方案很多，例如将用户的浏览历史记录下来，然后每次推送时去比较该条消息是否已经给用户推送了。但是这种方式效率极低，不推荐。</p>
<pre><code>所以这里我们使用布隆过滤器</code></pre><p>以今日头条为例，假设我们将用户的浏览记录用 B 表示，A 表示用户没有浏览的新闻，现在要给用户推送消息，先去 B 里边判断这条消息是否已经推送过，如果判断结果说没推送过（B 里边没有这条记录），那就一定没有推送过。如果判断结果说有推送过（B 里边也有可能没有这条消息），这个时候该条消息就不会推送给用户，导致用户错过该条消息，当然这是概率极低的。</p>
<h4 id="场景2：缓存穿透-查不存在的数据"><a href="#场景2：缓存穿透-查不存在的数据" class="headerlink" title="场景2：缓存穿透(查不存在的数据)"></a>场景2：缓存穿透(查不存在的数据)</h4><p><strong>描述：</strong>缓存穿透是指<strong>缓存和数据库中都没有的数据，</strong>而用户不断发起请求，如发起为id为“-1”的数据或id为特别大不存在的数据。这时的用户很可能是攻击者，攻击会导致数据库压力过大。</p>
<p>​        我们经常会把一部分数据放在Redis等缓存，比如产品详情。这样有查询请求进来，我们可以根据产品Id直接去缓存中取数据，而不用读取数据库，这是提升性能最简单，最普遍，也是最有效的做法。一般的查询请求流程是这样的：先查缓存，有缓存的话直接返回，如果缓存中没有，再去数据库查询，然后再把数据库取出来的数据放入缓存，一切看起来很美好。但是如果现在有大量请求进来，而且都在请求一个不存在的产品Id，会发生什么？既然产品Id都不存在，那么肯定没有缓存，没有缓存，那么大量的请求都怼到数据库，数据库的压力一下子就上来了，还有可能把数据库打死。<br>虽然有很多办法都可以解决这问题，但是我们的主角是“布隆过滤器”，没错，“布隆过滤器”就可以解决（缓解）缓存穿透问题。</p>
<h4 id="题外话："><a href="#题外话：" class="headerlink" title="题外话："></a>题外话：</h4><h5 id="1、缓存击穿-并发查同一条数据"><a href="#1、缓存击穿-并发查同一条数据" class="headerlink" title="1、缓存击穿(并发查同一条数据)"></a>1、缓存击穿(并发查同一条数据)</h5><p>​        缓存击穿是<strong>指缓存中没有但数据库中有的数据</strong>（一般是缓存时间到期），这时由于并发用户特别多，同时读缓存没读到数据，又同时去数据库去取数据，引起数据库压力瞬间增大，造成过大压力</p>
<h5 id="2、缓存雪崩"><a href="#2、缓存雪崩" class="headerlink" title="2、缓存雪崩"></a>2、缓存雪崩</h5><p> 缓存雪崩是指<strong>缓存中数据大批量到过期时间</strong>，而查询数据量巨大，引起数据库压力过大甚至down机。和缓存击穿不同的是，缓存击穿指并发查同一条数据，<strong>缓存雪崩是不同数据都过期了，很多数据都查不到从而查数据库。</strong></p>
<h3 id="二、什么是布隆过滤器？"><a href="#二、什么是布隆过滤器？" class="headerlink" title="二、什么是布隆过滤器？"></a>二、什么是布隆过滤器？</h3><p>布隆过滤器是一个叫“布隆”的人提出的，它本身是一个很长的二进制向量，既然是二进制的向量，那么显而易见的，存放的不是0，就是1。</p>
<p>Bloom Filter <strong>专门用来解决我们上面所说的去重问题的</strong>，使用 Bloom Filter 不会像使用缓存那么浪费空间。当然，他也存在一个小小问题，<strong>就是不太精确</strong>。</p>
<p>Bloom Filter 相当于是一个<strong>不太精确的 set 集合</strong>，我们可以利用它里边的 <strong>contains</strong> 方法去判断某一个对象是否存在，但是需要注意，这个判断不是特别精确。<strong>一般来说，通过 contains 判断某个值不存在，那就一定不存在，但是判断某个值存在的话，则他可能不存在。</strong></p>
<h3 id="三、Bloom-Filter实现原理"><a href="#三、Bloom-Filter实现原理" class="headerlink" title="三、Bloom Filter实现原理"></a>三、Bloom Filter实现原理</h3><p>每一个布隆过滤器，在 Redis 中都对应了一个<strong>大型的bit位数组</strong>以及几<strong>(3)个不同的 hash 函数</strong>。</p>
<p>如果我们要映射一个值到布隆过滤器中，首先根据几个不同的hash函数给元素(存储对象)生成多个哈希值，拿到这些哈希值后分别对位数组长度进行取模(取余)运算得到一个位置，将位数组中对应的位置设置为1。这样就完成元素的添加操作。</p>
<blockquote>
<p>取模：a=  c%bit数组长度</p>
<p>就是取余的过程</p>
</blockquote>
<p><img src="http://img.louchen.top/2020/04/bloomfliter1.png" alt=""></p>
<p>​    例如针对值 “baidu” 和三个不同的哈希函数分别生成了哈希值 ：1、4、7，取模为：1，4,  7</p>
<p>​    例如针对值“zhihu”和三个不同的哈希函数分别生成了哈希值：1，4，9 ,取模为：1 ，4，9</p>
<p>则上图转换如下：</p>
<p><img src="http://img.louchen.top/2020/04/boomfilter3.png" alt=""></p>
<p>当判断元素是否存在时，依然先对元素进行 hash 运算，将运算的结果和位数组取模，然后去对应的位置查看是否有相应的数据，如果有，表示元素可能存在（因为这个有数据的地方也可能是其他元素存进来的），如果没有表示元素一定不存在。</p>
<p>可以看出，仅仅从布隆过滤器本身而言，根本没有存放完整的数据，只是运用一系列随机映射函数计算出位置，然后填充二进制向量。</p>
<p>这有什么用呢？比如现在再给你一个数据，你要判断这个数据是否重复，你怎么做？</p>
<p>你只需利用上面的三种固定的计算方式，计算出这个数据占据哪些格子，然后看看这些格子里面放置的是否都是1，如果有一个格子不为1，那么就代表这个数字不在其中。这很好理解吧，比如现在又给你了刚才你添加进去的数据，你通过三种固定的计算方式，算出的结果肯定和上面的是一模一样的，也是占据了布隆过滤器“1”，“4”，“9”三个格子。</p>
<p>但是有一个问题需要注意，如果这些格子里面放置的都是1，不一定代表给定的数据一定重复，也许其他数据经过三种固定的计算方式算出来的结果也是相同的。这也很好理解吧，比如我们需要判断对象是否相等，是不可以仅仅判断他们的哈希值是否相等的。</p>
<p>也就是说布隆过滤器只能判断数据是否一定不存在，而无法判断数据是否一定存在。</p>
<p>Bloom Filter 中，误判的概率和位数组的大小有很大关系，<strong>位数组越大，误判概率越小</strong>，<strong>当然占用的存储空间越大；位数组越小，误判概率越大，当然占用的存储空间就小。</strong></p>
<p>按理来说，介绍完了新增、查询的流程，就要介绍删除的流程了，但是很遗憾的是布隆过滤器是很难做到删除数据的，为什么？你想想，比如你要删除刚才给你的数据，你把“1”，“4”，“9”三个格子都改成了0，但是可能其他的数据也映射到了“1”，“4”，“9”三个格子啊，这不就乱套了吗？</p>
<h3 id="四、Bloom-Filter的优缺点："><a href="#四、Bloom-Filter的优缺点：" class="headerlink" title="四、Bloom Filter的优缺点："></a>四、Bloom Filter的优缺点：</h3><ul>
<li>优点：由于存放的不是完整的数据，所以占用的内存很少，而且新增，查询速度够快；</li>
<li>缺点： 随着数据的增加，误判率随之增加；<strong>无法做到删除数据</strong>；只能判断数据是否一定不存在，而无法判断数据是否一定存在。</li>
</ul>
<h3 id="五、Bloom-Filter的安装"><a href="#五、Bloom-Filter的安装" class="headerlink" title="五、Bloom Filter的安装"></a>五、Bloom Filter的安装</h3><p>官网：<a href="https://oss.redislabs.com/redisbloom/Quick_Start/">https://oss.redislabs.com/redisbloom/Quick_Start/</a></p>
<h4 id="1、docker安装"><a href="#1、docker安装" class="headerlink" title="1、docker安装"></a>1、docker安装</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 6379:6379 --name redis-redisbloom redislabs/rebloom:latest</span><br></pre></td></tr></table></figure>

<h4 id="2、编译安装"><a href="#2、编译安装" class="headerlink" title="2、编译安装"></a>2、编译安装</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cd redis-5.0.7</span><br><span class="line">git clone https://github.com/RedisBloom/RedisBloom.git</span><br><span class="line">cd RedisBloom/</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#编译</span></span></span><br><span class="line">make</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#切换上级目录</span></span></span><br><span class="line">cd ..</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#运行</span></span></span><br><span class="line">redis-server --loadmodule ./RedisBloom/redisbloom.so</span><br></pre></td></tr></table></figure>

<p><strong>后台运行，加入配置文件：</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-server redis.conf --loadmodule ./RedisBloom/redisbloom.so</span><br></pre></td></tr></table></figure>

<p><strong>进入redis测试是否安装成功：</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -a 密码</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 插入值</span></span></span><br><span class="line">bf.add k1 v1</span><br></pre></td></tr></table></figure>

<p>避免每次启动布隆过滤器都要<code>redis-server redis.conf --loadmodule ./RedisBloom/redisbloom.so</code>这样写，比较麻烦。</p>
<p><strong>我们修改redis.conf文件</strong>：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">################################# MODULES #####################################</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Load modules at startup. If the server is not able to load modules</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> it will abort. It is possible to use multiple loadmodule directives.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> loadmodule /path/to/my_module.so</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> loadmodule /path/to/other_module.so</span></span><br><span class="line">loadmodule /root/redis-5.0.8/RedisBloom/redisbloom.so</span><br></pre></td></tr></table></figure>

<p>保存退出。这是我们次正常启动即可 <strong>redis-server redis.conf</strong></p>
<h3 id="六、基本用法"><a href="#六、基本用法" class="headerlink" title="六、基本用法"></a>六、基本用法</h3><h4 id="1、bf-add-bf-madd"><a href="#1、bf-add-bf-madd" class="headerlink" title="1、bf.add/bf.madd"></a>1、bf.add/bf.madd</h4><blockquote>
<p>添加成功返回1 ，否则返回0</p>
</blockquote>
<p>添加：</p>
<p><code>bf.add [key] [value]</code></p>
<p>批量添加：</p>
<p><code>bf.madd [key] [value1] [value2] [ value3]</code></p>
<h4 id="2、bf-exists-bf-mexists"><a href="#2、bf-exists-bf-mexists" class="headerlink" title="2、bf.exists/bf.mexists"></a>2、bf.exists/bf.mexists</h4><blockquote>
<p>存在返回1，不存在返回0</p>
</blockquote>
<p>判断是否存在</p>
<p><code>bf.exists [key] [value]</code></p>
<p>批量判断是否存在</p>
<p><code>bf.mexists [key] [value1] [value2] [value3]</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bf.add k1 v1 #==&gt; 1</span><br><span class="line">bf.exists k1 v1 #==&gt; 1</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">bf.madd k1 v1 v2 v3  </span><br><span class="line">1) (integer) 0 #重复的添加失败</span><br><span class="line">2) (integer) 1</span><br><span class="line">3) (integer) 1</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">BF.MEXISTS k1 v1 v2 v3 v4</span><br><span class="line">1) (integer) 1</span><br><span class="line">2) (integer) 1</span><br><span class="line">3) (integer) 1</span><br><span class="line">4) (integer) 0  #不存在返回0</span><br></pre></td></tr></table></figure>

<h3 id="七、jedis实现布隆过滤器"><a href="#七、jedis实现布隆过滤器" class="headerlink" title="七、jedis实现布隆过滤器"></a>七、jedis实现布隆过滤器</h3><h4 id="1、pom-xml"><a href="#1、pom-xml" class="headerlink" title="1、pom.xml"></a>1、pom.xml</h4><p>注意这里的jedis版本必须在3以上才能使用布隆过滤器</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>redis.clients<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jedis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">type</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--布隆过滤器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.redislabs<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jrebloom<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="2、测试代码"><a href="#2、测试代码" class="headerlink" title="2、测试代码"></a>2、测试代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BloomFilerTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        GenericObjectPoolConfig config=<span class="keyword">new</span> GenericObjectPoolConfig();</span><br><span class="line">        config.setMaxIdle(<span class="number">300</span>);</span><br><span class="line">        config.setMaxTotal(<span class="number">1000</span>);</span><br><span class="line">        config.setMaxWaitMillis(<span class="number">30000</span>);</span><br><span class="line">        config.setTestOnBorrow(<span class="keyword">true</span>);</span><br><span class="line">        JedisPool jedisPool = <span class="keyword">new</span> JedisPool(config, <span class="string">"47.96.141.44"</span>, <span class="number">6379</span>, <span class="number">30000</span>, <span class="string">"你的密码"</span>);</span><br><span class="line">        Client client=<span class="keyword">new</span> Client(jedisPool);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++) &#123;</span><br><span class="line"><span class="comment">//            存入数据</span></span><br><span class="line">            client.add(<span class="string">"k1"</span>, <span class="string">"lc:"</span>+i);</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//        判断是否存在</span></span><br><span class="line">        <span class="comment">//boolean exists= client.exists("k1", "lc:1001"); //false</span></span><br><span class="line">        <span class="comment">//存在误判情况</span></span><br><span class="line">        <span class="keyword">boolean</span> exists=client.exists(<span class="string">"k1"</span>,<span class="string">"lc:1002"</span>) <span class="comment">//true </span></span><br><span class="line">        System.out.println(exists);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="八、设置布隆过滤器的错误率"><a href="#八、设置布隆过滤器的错误率" class="headerlink" title="八、设置布隆过滤器的错误率"></a>八、设置布隆过滤器的错误率</h3><p>默认情况下，我们使用的布隆过滤器它的错误率是 0.01 ，默认的元素大小是 100。但是这两个参数也是可以配置的。</p>
<p>我们可以调用 bf.reserve 方法进行配置。</p>
<p><code>BF.RESERVE k1 0.0001 1000000</code></p>
<p>前提是该k1要存在，否则将设置为默认的值</p>
<p>第一个参数是 key，第二个参数是错误率，错误率越低，占用的空间越大，第三个参数预计存储的数量，当实际数量超出预计数量时，错误率会上升。</p>
<p><a href="https://www.cnblogs.com/CodeBear/p/10911177.html">https://www.cnblogs.com/CodeBear/p/10911177.html</a></p>
</div><div class="article-tags size-small is-uppercase mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/Redis/">Redis</a></div><!--!--></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">喜欢这篇文章？打赏一下作者吧</h3><div class="buttons is-centered"><a class="button is-success donate"><span class="icon is-small"><i class="fab fa-weixin"></i></span><span>微信</span><span class="qrcode"><img src="/img/pay.jpg" alt="微信"></span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2020/04/27/redis/Redis%E4%B9%8BHyperLogLog/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">Redis中的HyperLogLog</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2020/04/25/springboot/SpringBoot%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%8A%A0%E5%AF%86/"><span class="level-item">是否担心配置文件被盗获取密码？</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!--></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1"><div class="card widget"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="" src="/img/milk.png" alt="娄晨"></figure><p class="title is-size-4 is-block line-height-inherit">娄晨</p><p class="is-size-6 is-block">学生</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>中国·武汉</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">53</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">12</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">29</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded cursor:pointer" href="/img/wechart.jpg" target="_blank" rel="noopener">联系我</a></div><div class="level is-mobile"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/ppoffice"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Facebook" href="https://facebook.com"><i class="fab fa-facebook"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Dribbble" href="https://dribbble.com"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><div class="card widget" id="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">目录</h3><ul class="menu-list"><li><a class="is-flex" href="#Redis之布隆过滤器-Bloom-Filter"><span class="mr-2">1</span><span>Redis之布隆过滤器 (Bloom Filter)</span></a><ul class="menu-list"><li><a class="is-flex" href="#一、布隆过滤器的应用场景"><span class="mr-2">1.1</span><span>一、布隆过滤器的应用场景</span></a><ul class="menu-list"><li><a class="is-flex" href="#场景1：推送不同消息"><span class="mr-2">1.1.1</span><span>场景1：推送不同消息</span></a></li><li><a class="is-flex" href="#场景2：缓存穿透-查不存在的数据"><span class="mr-2">1.1.2</span><span>场景2：缓存穿透(查不存在的数据)</span></a></li><li><a class="is-flex" href="#2、缓存雪崩"><span class="mr-2">1.1.3</span><span>2、缓存雪崩</span></a></li></ul></li><li><a class="is-flex" href="#二、什么是布隆过滤器？"><span class="mr-2">1.2</span><span>二、什么是布隆过滤器？</span></a></li><li><a class="is-flex" href="#三、Bloom-Filter实现原理"><span class="mr-2">1.3</span><span>三、Bloom Filter实现原理</span></a></li><li><a class="is-flex" href="#四、Bloom-Filter的优缺点："><span class="mr-2">1.4</span><span>四、Bloom Filter的优缺点：</span></a></li><li><a class="is-flex" href="#五、Bloom-Filter的安装"><span class="mr-2">1.5</span><span>五、Bloom Filter的安装</span></a><ul class="menu-list"><li><a class="is-flex" href="#1、docker安装"><span class="mr-2">1.5.1</span><span>1、docker安装</span></a></li><li><a class="is-flex" href="#2、编译安装"><span class="mr-2">1.5.2</span><span>2、编译安装</span></a></li></ul></li><li><a class="is-flex" href="#六、基本用法"><span class="mr-2">1.6</span><span>六、基本用法</span></a><ul class="menu-list"><li><a class="is-flex" href="#1、bf-add-bf-madd"><span class="mr-2">1.6.1</span><span>1、bf.add/bf.madd</span></a></li><li><a class="is-flex" href="#2、bf-exists-bf-mexists"><span class="mr-2">1.6.2</span><span>2、bf.exists/bf.mexists</span></a></li></ul></li><li><a class="is-flex" href="#七、jedis实现布隆过滤器"><span class="mr-2">1.7</span><span>七、jedis实现布隆过滤器</span></a><ul class="menu-list"><li><a class="is-flex" href="#1、pom-xml"><span class="mr-2">1.7.1</span><span>1、pom.xml</span></a></li><li><a class="is-flex" href="#2、测试代码"><span class="mr-2">1.7.2</span><span>2、测试代码</span></a></li></ul></li><li><a class="is-flex" href="#八、设置布隆过滤器的错误率"><span class="mr-2">1.8</span><span>八、设置布隆过滤器的错误率</span></a></li></ul></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">链接</h3><ul class="menu-list"><li><a class="level is-mobile is-mobile" href="http://vhr.louchen.top/index.html" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">人事管理</span></span><span class="level-right"><span class="level-item tag">vhr.louchen.top</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/categories/Git/"><span class="level-start"><span class="level-item">Git</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/IDEA/"><span class="level-start"><span class="level-item">IDEA</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Linux/"><span class="level-start"><span class="level-item">Linux</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Nginx/"><span class="level-start"><span class="level-item">Nginx</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Redis/"><span class="level-start"><span class="level-item">Redis</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Spring-Boot/"><span class="level-start"><span class="level-item">Spring Boot</span></span><span class="level-end"><span class="level-item tag">22</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Spring-Cache/"><span class="level-start"><span class="level-item">Spring Cache</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Spring-Security/"><span class="level-start"><span class="level-item">Spring Security</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/SpringBoot/"><span class="level-start"><span class="level-item">SpringBoot</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Windows/"><span class="level-start"><span class="level-item">Windows</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"><span class="level-start"><span class="level-item">数据库</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/%E9%A1%B9%E7%9B%AE%E6%9E%84%E5%BB%BA%E9%83%A8%E7%BD%B2/"><span class="level-start"><span class="level-item">项目构建部署</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">订阅更新</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button is-primary" type="submit" value="订阅"></div></div></form></div></div></div><div class="column-right-shadow is-hidden-widescreen"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3"><div class="card widget"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content size-small"><p><time dateTime="2020-04-30T11:52:07.913Z">2020-04-30</time></p><p class="title is-6"><a class="link-muted" href="/2020/04/30/redis/Redis%E5%9C%B0%E7%90%86%E4%BD%8D%E7%BD%AEGEO/">Redis实现GEO地理位置</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/Redis/">Redis</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-04-30T11:52:07.912Z">2020-04-30</time></p><p class="title is-6"><a class="link-muted" href="/2020/04/30/redis/Redis%E4%B9%8BScan/">Redis的Scan命令</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/Redis/">Redis</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-04-27T07:02:49.909Z">2020-04-27</time></p><p class="title is-6"><a class="link-muted" href="/2020/04/27/redis/Redis%E4%B9%8BHyperLogLog/">Redis中的HyperLogLog</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/Redis/">Redis</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-04-27T07:02:49.865Z">2020-04-27</time></p><p class="title is-6"><a class="link-muted" href="/2020/04/27/redis/Redis%E4%B9%8B%E5%B8%83%E9%9A%86%E8%BF%87%E6%BB%A4%E5%99%A8/">Redis</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/Redis/">Redis</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-04-25T15:15:46.224Z">2020-04-25</time></p><p class="title is-6"><a class="link-muted" href="/2020/04/25/springboot/SpringBoot%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%8A%A0%E5%AF%86/">是否担心配置文件被盗获取密码？</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/SpringBoot/">SpringBoot</a></p></div></article></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/archives/2020/04/"><span class="level-start"><span class="level-item">四月 2020</span></span><span class="level-end"><span class="level-item tag">53</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/ActiveMQ/"><span class="tag">ActiveMQ</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Docker/"><span class="tag">Docker</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Ehcache/"><span class="tag">Ehcache</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/FastDFS/"><span class="tag">FastDFS</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Git/"><span class="tag">Git</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/IDEA/"><span class="tag">IDEA</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/JAR/"><span class="tag">JAR</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/JWT/"><span class="tag">JWT</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Maven/"><span class="tag">Maven</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/MongoDB/"><span class="tag">MongoDB</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/MySql/"><span class="tag">MySql</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Nginx/"><span class="tag">Nginx</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/OAuth2/"><span class="tag">OAuth2</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Quartz/"><span class="tag">Quartz</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/RESTful/"><span class="tag">RESTful</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/RabbitMQ/"><span class="tag">RabbitMQ</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Redis/"><span class="tag">Redis</span><span class="tag is-grey-lightest">12</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Session/"><span class="tag">Session</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Shiro/"><span class="tag">Shiro</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Spring-Boot/"><span class="tag">Spring Boot</span><span class="tag is-grey-lightest">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Spring-Security/"><span class="tag">Spring Security</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/SpringBoot/"><span class="tag">SpringBoot</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Swagger2/"><span class="tag">Swagger2</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/WAR/"><span class="tag">WAR</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/WebSocket/"><span class="tag">WebSocket</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%A4%9A%E6%95%B0%E6%8D%AE%E6%BA%90/"><span class="tag">多数据源</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/"><span class="tag">定时任务</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%B6%88%E6%81%AF%E6%9C%8D%E5%8A%A1/"><span class="tag">消息服务</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E9%82%AE%E4%BB%B6%E6%9C%8D%E5%8A%A1/"><span class="tag">邮件服务</span><span class="tag is-grey-lightest">1</span></a></div></div></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/favicon.ico" alt="MilkLc" height="28"></a><p class="size-small"><span>&copy; 2020 lc</span>  Powered by <a href="#" target="_blank" rel="noopener">LouChen</a>  </p><p class="size-small"><a href="http://www.beian.miit.gov.cn">鄂ICP备19030764号-1</a></p></div><div style="margin-left:-150px"><span id="busuanzi_container_site_pv">本站总访问量 <span id="busuanzi_value_site_pv" style="color:blue;font-size: 17px"></span> 次</span><span class="post-meta-divider"> | </span><span id="busuanzi_container_site_uv" style="display:none">本站访客数 <span id="busuanzi_value_site_uv" style="color:blue;font-size: 17px"></span> 人</span><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><div class="level-end"></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            site: {
                url: 'http://yoursite.com',
                external_link: {"enable":true,"exclude":[]}
            },
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>